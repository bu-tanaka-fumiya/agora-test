(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))h(E);new MutationObserver(E=>{for(const S of E)if(S.type==="childList")for(const y of S.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&h(y)}).observe(document,{childList:!0,subtree:!0});function d(E){const S={};return E.integrity&&(S.integrity=E.integrity),E.referrerPolicy&&(S.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?S.credentials="include":E.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function h(E){if(E.ep)return;E.ep=!0;const S=d(E);fetch(E.href,S)}})();var eE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function QO(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var $O={exports:{}},ph={},ZO={exports:{}},ct={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Od=Symbol.for("react.element"),Lj=Symbol.for("react.portal"),Mj=Symbol.for("react.fragment"),Uj=Symbol.for("react.strict_mode"),xj=Symbol.for("react.profiler"),Vj=Symbol.for("react.provider"),jj=Symbol.for("react.context"),Fj=Symbol.for("react.forward_ref"),Bj=Symbol.for("react.suspense"),Gj=Symbol.for("react.memo"),Wj=Symbol.for("react.lazy"),Bw=Symbol.iterator;function Hj(r){return r===null||typeof r!="object"?null:(r=Bw&&r[Bw]||r["@@iterator"],typeof r=="function"?r:null)}var e0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},t0=Object.assign,n0={};function $a(r,s,d){this.props=r,this.context=s,this.refs=n0,this.updater=d||e0}$a.prototype.isReactComponent={};$a.prototype.setState=function(r,s){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,s,"setState")};$a.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function i0(){}i0.prototype=$a.prototype;function T_(r,s,d){this.props=r,this.context=s,this.refs=n0,this.updater=d||e0}var R_=T_.prototype=new i0;R_.constructor=T_;t0(R_,$a.prototype);R_.isPureReactComponent=!0;var Gw=Array.isArray,r0=Object.prototype.hasOwnProperty,y_={current:null},o0={key:!0,ref:!0,__self:!0,__source:!0};function s0(r,s,d){var h,E={},S=null,y=null;if(s!=null)for(h in s.ref!==void 0&&(y=s.ref),s.key!==void 0&&(S=""+s.key),s)r0.call(s,h)&&!o0.hasOwnProperty(h)&&(E[h]=s[h]);var D=arguments.length-2;if(D===1)E.children=d;else if(1<D){for(var P=Array(D),V=0;V<D;V++)P[V]=arguments[V+2];E.children=P}if(r&&r.defaultProps)for(h in D=r.defaultProps,D)E[h]===void 0&&(E[h]=D[h]);return{$$typeof:Od,type:r,key:S,ref:y,props:E,_owner:y_.current}}function Kj(r,s){return{$$typeof:Od,type:r.type,key:s,ref:r.ref,props:r.props,_owner:r._owner}}function I_(r){return typeof r=="object"&&r!==null&&r.$$typeof===Od}function zj(r){var s={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(d){return s[d]})}var Ww=/\/+/g;function tE(r,s){return typeof r=="object"&&r!==null&&r.key!=null?zj(""+r.key):s.toString(36)}function Nu(r,s,d,h,E){var S=typeof r;(S==="undefined"||S==="boolean")&&(r=null);var y=!1;if(r===null)y=!0;else switch(S){case"string":case"number":y=!0;break;case"object":switch(r.$$typeof){case Od:case Lj:y=!0}}if(y)return y=r,E=E(y),r=h===""?"."+tE(y,0):h,Gw(E)?(d="",r!=null&&(d=r.replace(Ww,"$&/")+"/"),Nu(E,s,d,"",function(V){return V})):E!=null&&(I_(E)&&(E=Kj(E,d+(!E.key||y&&y.key===E.key?"":(""+E.key).replace(Ww,"$&/")+"/")+r)),s.push(E)),1;if(y=0,h=h===""?".":h+":",Gw(r))for(var D=0;D<r.length;D++){S=r[D];var P=h+tE(S,D);y+=Nu(S,s,d,P,E)}else if(P=Hj(r),typeof P=="function")for(r=P.call(r),D=0;!(S=r.next()).done;)S=S.value,P=h+tE(S,D++),y+=Nu(S,s,d,P,E);else if(S==="object")throw s=String(r),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return y}function hu(r,s,d){if(r==null)return r;var h=[],E=0;return Nu(r,h,"","",function(S){return s.call(d,S,E++)}),h}function Yj(r){if(r._status===-1){var s=r._result;s=s(),s.then(function(d){(r._status===0||r._status===-1)&&(r._status=1,r._result=d)},function(d){(r._status===0||r._status===-1)&&(r._status=2,r._result=d)}),r._status===-1&&(r._status=0,r._result=s)}if(r._status===1)return r._result.default;throw r._result}var ri={current:null},bu={transition:null},qj={ReactCurrentDispatcher:ri,ReactCurrentBatchConfig:bu,ReactCurrentOwner:y_};ct.Children={map:hu,forEach:function(r,s,d){hu(r,function(){s.apply(this,arguments)},d)},count:function(r){var s=0;return hu(r,function(){s++}),s},toArray:function(r){return hu(r,function(s){return s})||[]},only:function(r){if(!I_(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};ct.Component=$a;ct.Fragment=Mj;ct.Profiler=xj;ct.PureComponent=T_;ct.StrictMode=Uj;ct.Suspense=Bj;ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qj;ct.cloneElement=function(r,s,d){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var h=t0({},r.props),E=r.key,S=r.ref,y=r._owner;if(s!=null){if(s.ref!==void 0&&(S=s.ref,y=y_.current),s.key!==void 0&&(E=""+s.key),r.type&&r.type.defaultProps)var D=r.type.defaultProps;for(P in s)r0.call(s,P)&&!o0.hasOwnProperty(P)&&(h[P]=s[P]===void 0&&D!==void 0?D[P]:s[P])}var P=arguments.length-2;if(P===1)h.children=d;else if(1<P){D=Array(P);for(var V=0;V<P;V++)D[V]=arguments[V+2];h.children=D}return{$$typeof:Od,type:r.type,key:E,ref:S,props:h,_owner:y}};ct.createContext=function(r){return r={$$typeof:jj,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Vj,_context:r},r.Consumer=r};ct.createElement=s0;ct.createFactory=function(r){var s=s0.bind(null,r);return s.type=r,s};ct.createRef=function(){return{current:null}};ct.forwardRef=function(r){return{$$typeof:Fj,render:r}};ct.isValidElement=I_;ct.lazy=function(r){return{$$typeof:Wj,_payload:{_status:-1,_result:r},_init:Yj}};ct.memo=function(r,s){return{$$typeof:Gj,type:r,compare:s===void 0?null:s}};ct.startTransition=function(r){var s=bu.transition;bu.transition={};try{r()}finally{bu.transition=s}};ct.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ct.useCallback=function(r,s){return ri.current.useCallback(r,s)};ct.useContext=function(r){return ri.current.useContext(r)};ct.useDebugValue=function(){};ct.useDeferredValue=function(r){return ri.current.useDeferredValue(r)};ct.useEffect=function(r,s){return ri.current.useEffect(r,s)};ct.useId=function(){return ri.current.useId()};ct.useImperativeHandle=function(r,s,d){return ri.current.useImperativeHandle(r,s,d)};ct.useInsertionEffect=function(r,s){return ri.current.useInsertionEffect(r,s)};ct.useLayoutEffect=function(r,s){return ri.current.useLayoutEffect(r,s)};ct.useMemo=function(r,s){return ri.current.useMemo(r,s)};ct.useReducer=function(r,s,d){return ri.current.useReducer(r,s,d)};ct.useRef=function(r){return ri.current.useRef(r)};ct.useState=function(r){return ri.current.useState(r)};ct.useSyncExternalStore=function(r,s,d){return ri.current.useSyncExternalStore(r,s,d)};ct.useTransition=function(){return ri.current.useTransition()};ct.version="18.2.0";ZO.exports=ct;var C_=ZO.exports;const at=QO(C_);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jj=C_,Xj=Symbol.for("react.element"),Qj=Symbol.for("react.fragment"),$j=Object.prototype.hasOwnProperty,Zj=Jj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,eF={key:!0,ref:!0,__self:!0,__source:!0};function a0(r,s,d){var h,E={},S=null,y=null;d!==void 0&&(S=""+d),s.key!==void 0&&(S=""+s.key),s.ref!==void 0&&(y=s.ref);for(h in s)$j.call(s,h)&&!eF.hasOwnProperty(h)&&(E[h]=s[h]);if(r&&r.defaultProps)for(h in s=r.defaultProps,s)E[h]===void 0&&(E[h]=s[h]);return{$$typeof:Xj,type:r,key:S,ref:y,props:E,_owner:Zj.current}}ph.Fragment=Qj;ph.jsx=a0;ph.jsxs=a0;$O.exports=ph;var Re=$O.exports,wE={},c0={exports:{}},ji={},d0={exports:{}},l0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function s(ye,He){var Ge=ye.length;ye.push(He);e:for(;0<Ge;){var Yt=Ge-1>>>1,sn=ye[Yt];if(0<E(sn,He))ye[Yt]=He,ye[Ge]=sn,Ge=Yt;else break e}}function d(ye){return ye.length===0?null:ye[0]}function h(ye){if(ye.length===0)return null;var He=ye[0],Ge=ye.pop();if(Ge!==He){ye[0]=Ge;e:for(var Yt=0,sn=ye.length,js=sn>>>1;Yt<js;){var sr=2*(Yt+1)-1,tc=ye[sr],ar=sr+1,Fs=ye[ar];if(0>E(tc,Ge))ar<sn&&0>E(Fs,tc)?(ye[Yt]=Fs,ye[ar]=Ge,Yt=ar):(ye[Yt]=tc,ye[sr]=Ge,Yt=sr);else if(ar<sn&&0>E(Fs,Ge))ye[Yt]=Fs,ye[ar]=Ge,Yt=ar;else break e}}return He}function E(ye,He){var Ge=ye.sortIndex-He.sortIndex;return Ge!==0?Ge:ye.id-He.id}if(typeof performance=="object"&&typeof performance.now=="function"){var S=performance;r.unstable_now=function(){return S.now()}}else{var y=Date,D=y.now();r.unstable_now=function(){return y.now()-D}}var P=[],V=[],X=1,W=null,B=3,fe=!1,Y=!1,q=!1,ce=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function j(ye){for(var He=d(V);He!==null;){if(He.callback===null)h(V);else if(He.startTime<=ye)h(V),He.sortIndex=He.expirationTime,s(P,He);else break;He=d(V)}}function z(ye){if(q=!1,j(ye),!Y)if(d(P)!==null)Y=!0,or(ae);else{var He=d(V);He!==null&&Vs(z,He.startTime-ye)}}function ae(ye,He){Y=!1,q&&(q=!1,M(Ce),Ce=-1),fe=!0;var Ge=B;try{for(j(He),W=d(P);W!==null&&(!(W.expirationTime>He)||ye&&!si());){var Yt=W.callback;if(typeof Yt=="function"){W.callback=null,B=W.priorityLevel;var sn=Yt(W.expirationTime<=He);He=r.unstable_now(),typeof sn=="function"?W.callback=sn:W===d(P)&&h(P),j(He)}else h(P);W=d(P)}if(W!==null)var js=!0;else{var sr=d(V);sr!==null&&Vs(z,sr.startTime-He),js=!1}return js}finally{W=null,B=Ge,fe=!1}}var ie=!1,Ee=null,Ce=-1,nt=5,Ze=-1;function si(){return!(r.unstable_now()-Ze<nt)}function ao(){if(Ee!==null){var ye=r.unstable_now();Ze=ye;var He=!0;try{He=Ee(!0,ye)}finally{He?Zo():(ie=!1,Ee=null)}}else ie=!1}var Zo;if(typeof L=="function")Zo=function(){L(ao)};else if(typeof MessageChannel<"u"){var rr=new MessageChannel,xs=rr.port2;rr.port1.onmessage=ao,Zo=function(){xs.postMessage(null)}}else Zo=function(){ce(ao,0)};function or(ye){Ee=ye,ie||(ie=!0,Zo())}function Vs(ye,He){Ce=ce(function(){ye(r.unstable_now())},He)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(ye){ye.callback=null},r.unstable_continueExecution=function(){Y||fe||(Y=!0,or(ae))},r.unstable_forceFrameRate=function(ye){0>ye||125<ye?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):nt=0<ye?Math.floor(1e3/ye):5},r.unstable_getCurrentPriorityLevel=function(){return B},r.unstable_getFirstCallbackNode=function(){return d(P)},r.unstable_next=function(ye){switch(B){case 1:case 2:case 3:var He=3;break;default:He=B}var Ge=B;B=He;try{return ye()}finally{B=Ge}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(ye,He){switch(ye){case 1:case 2:case 3:case 4:case 5:break;default:ye=3}var Ge=B;B=ye;try{return He()}finally{B=Ge}},r.unstable_scheduleCallback=function(ye,He,Ge){var Yt=r.unstable_now();switch(typeof Ge=="object"&&Ge!==null?(Ge=Ge.delay,Ge=typeof Ge=="number"&&0<Ge?Yt+Ge:Yt):Ge=Yt,ye){case 1:var sn=-1;break;case 2:sn=250;break;case 5:sn=1073741823;break;case 4:sn=1e4;break;default:sn=5e3}return sn=Ge+sn,ye={id:X++,callback:He,priorityLevel:ye,startTime:Ge,expirationTime:sn,sortIndex:-1},Ge>Yt?(ye.sortIndex=Ge,s(V,ye),d(P)===null&&ye===d(V)&&(q?(M(Ce),Ce=-1):q=!0,Vs(z,Ge-Yt))):(ye.sortIndex=sn,s(P,ye),Y||fe||(Y=!0,or(ae))),ye},r.unstable_shouldYield=si,r.unstable_wrapCallback=function(ye){var He=B;return function(){var Ge=B;B=He;try{return ye.apply(this,arguments)}finally{B=Ge}}}})(l0);d0.exports=l0;var tF=d0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u0=C_,Vi=tF;function de(r){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+r,d=1;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h0=new Set,ld={};function Ms(r,s){Ka(r,s),Ka(r+"Capture",s)}function Ka(r,s){for(ld[r]=s,r=0;r<s.length;r++)h0.add(s[r])}var no=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),OE=Object.prototype.hasOwnProperty,nF=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Hw={},Kw={};function iF(r){return OE.call(Kw,r)?!0:OE.call(Hw,r)?!1:nF.test(r)?Kw[r]=!0:(Hw[r]=!0,!1)}function rF(r,s,d,h){if(d!==null&&d.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return h?!1:d!==null?!d.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function oF(r,s,d,h){if(s===null||typeof s>"u"||rF(r,s,d,h))return!0;if(h)return!1;if(d!==null)switch(d.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function oi(r,s,d,h,E,S,y){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=h,this.attributeNamespace=E,this.mustUseProperty=d,this.propertyName=r,this.type=s,this.sanitizeURL=S,this.removeEmptyString=y}var Fn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Fn[r]=new oi(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var s=r[0];Fn[s]=new oi(s,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Fn[r]=new oi(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Fn[r]=new oi(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Fn[r]=new oi(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Fn[r]=new oi(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Fn[r]=new oi(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Fn[r]=new oi(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Fn[r]=new oi(r,5,!1,r.toLowerCase(),null,!1,!1)});var A_=/[\-:]([a-z])/g;function w_(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var s=r.replace(A_,w_);Fn[s]=new oi(s,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var s=r.replace(A_,w_);Fn[s]=new oi(s,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var s=r.replace(A_,w_);Fn[s]=new oi(s,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Fn[r]=new oi(r,1,!1,r.toLowerCase(),null,!1,!1)});Fn.xlinkHref=new oi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Fn[r]=new oi(r,1,!1,r.toLowerCase(),null,!0,!0)});function O_(r,s,d,h){var E=Fn.hasOwnProperty(s)?Fn[s]:null;(E!==null?E.type!==0:h||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(oF(s,d,E,h)&&(d=null),h||E===null?iF(s)&&(d===null?r.removeAttribute(s):r.setAttribute(s,""+d)):E.mustUseProperty?r[E.propertyName]=d===null?E.type===3?!1:"":d:(s=E.attributeName,h=E.attributeNamespace,d===null?r.removeAttribute(s):(E=E.type,d=E===3||E===4&&d===!0?"":""+d,h?r.setAttributeNS(h,s,d):r.setAttribute(s,d))))}var so=u0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pu=Symbol.for("react.element"),wa=Symbol.for("react.portal"),Oa=Symbol.for("react.fragment"),N_=Symbol.for("react.strict_mode"),NE=Symbol.for("react.profiler"),p0=Symbol.for("react.provider"),f0=Symbol.for("react.context"),b_=Symbol.for("react.forward_ref"),bE=Symbol.for("react.suspense"),DE=Symbol.for("react.suspense_list"),D_=Symbol.for("react.memo"),Lo=Symbol.for("react.lazy"),m0=Symbol.for("react.offscreen"),zw=Symbol.iterator;function Bc(r){return r===null||typeof r!="object"?null:(r=zw&&r[zw]||r["@@iterator"],typeof r=="function"?r:null)}var $t=Object.assign,nE;function Jc(r){if(nE===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);nE=s&&s[1]||""}return`
`+nE+r}var iE=!1;function rE(r,s){if(!r||iE)return"";iE=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(V){var h=V}Reflect.construct(r,[],s)}else{try{s.call()}catch(V){h=V}r.call(s.prototype)}else{try{throw Error()}catch(V){h=V}r()}}catch(V){if(V&&h&&typeof V.stack=="string"){for(var E=V.stack.split(`
`),S=h.stack.split(`
`),y=E.length-1,D=S.length-1;1<=y&&0<=D&&E[y]!==S[D];)D--;for(;1<=y&&0<=D;y--,D--)if(E[y]!==S[D]){if(y!==1||D!==1)do if(y--,D--,0>D||E[y]!==S[D]){var P=`
`+E[y].replace(" at new "," at ");return r.displayName&&P.includes("<anonymous>")&&(P=P.replace("<anonymous>",r.displayName)),P}while(1<=y&&0<=D);break}}}finally{iE=!1,Error.prepareStackTrace=d}return(r=r?r.displayName||r.name:"")?Jc(r):""}function sF(r){switch(r.tag){case 5:return Jc(r.type);case 16:return Jc("Lazy");case 13:return Jc("Suspense");case 19:return Jc("SuspenseList");case 0:case 2:case 15:return r=rE(r.type,!1),r;case 11:return r=rE(r.type.render,!1),r;case 1:return r=rE(r.type,!0),r;default:return""}}function PE(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Oa:return"Fragment";case wa:return"Portal";case NE:return"Profiler";case N_:return"StrictMode";case bE:return"Suspense";case DE:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case f0:return(r.displayName||"Context")+".Consumer";case p0:return(r._context.displayName||"Context")+".Provider";case b_:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case D_:return s=r.displayName||null,s!==null?s:PE(r.type)||"Memo";case Lo:s=r._payload,r=r._init;try{return PE(r(s))}catch{}}return null}function aF(r){var s=r.type;switch(r.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=s.render,r=r.displayName||r.name||"",s.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return PE(s);case 8:return s===N_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function qo(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function E0(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function cF(r){var s=E0(r)?"checked":"value",d=Object.getOwnPropertyDescriptor(r.constructor.prototype,s),h=""+r[s];if(!r.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var E=d.get,S=d.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return E.call(this)},set:function(y){h=""+y,S.call(this,y)}}),Object.defineProperty(r,s,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(y){h=""+y},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function fu(r){r._valueTracker||(r._valueTracker=cF(r))}function _0(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),h="";return r&&(h=E0(r)?r.checked?"true":"false":r.value),r=h,r!==d?(s.setValue(r),!0):!1}function Wu(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function kE(r,s){var d=s.checked;return $t({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??r._wrapperState.initialChecked})}function Yw(r,s){var d=s.defaultValue==null?"":s.defaultValue,h=s.checked!=null?s.checked:s.defaultChecked;d=qo(s.value!=null?s.value:d),r._wrapperState={initialChecked:h,initialValue:d,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function g0(r,s){s=s.checked,s!=null&&O_(r,"checked",s,!1)}function LE(r,s){g0(r,s);var d=qo(s.value),h=s.type;if(d!=null)h==="number"?(d===0&&r.value===""||r.value!=d)&&(r.value=""+d):r.value!==""+d&&(r.value=""+d);else if(h==="submit"||h==="reset"){r.removeAttribute("value");return}s.hasOwnProperty("value")?ME(r,s.type,d):s.hasOwnProperty("defaultValue")&&ME(r,s.type,qo(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(r.defaultChecked=!!s.defaultChecked)}function qw(r,s,d){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var h=s.type;if(!(h!=="submit"&&h!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+r._wrapperState.initialValue,d||s===r.value||(r.value=s),r.defaultValue=s}d=r.name,d!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,d!==""&&(r.name=d)}function ME(r,s,d){(s!=="number"||Wu(r.ownerDocument)!==r)&&(d==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+d&&(r.defaultValue=""+d))}var Xc=Array.isArray;function ja(r,s,d,h){if(r=r.options,s){s={};for(var E=0;E<d.length;E++)s["$"+d[E]]=!0;for(d=0;d<r.length;d++)E=s.hasOwnProperty("$"+r[d].value),r[d].selected!==E&&(r[d].selected=E),E&&h&&(r[d].defaultSelected=!0)}else{for(d=""+qo(d),s=null,E=0;E<r.length;E++){if(r[E].value===d){r[E].selected=!0,h&&(r[E].defaultSelected=!0);return}s!==null||r[E].disabled||(s=r[E])}s!==null&&(s.selected=!0)}}function UE(r,s){if(s.dangerouslySetInnerHTML!=null)throw Error(de(91));return $t({},s,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Jw(r,s){var d=s.value;if(d==null){if(d=s.children,s=s.defaultValue,d!=null){if(s!=null)throw Error(de(92));if(Xc(d)){if(1<d.length)throw Error(de(93));d=d[0]}s=d}s==null&&(s=""),d=s}r._wrapperState={initialValue:qo(d)}}function S0(r,s){var d=qo(s.value),h=qo(s.defaultValue);d!=null&&(d=""+d,d!==r.value&&(r.value=d),s.defaultValue==null&&r.defaultValue!==d&&(r.defaultValue=d)),h!=null&&(r.defaultValue=""+h)}function Xw(r){var s=r.textContent;s===r._wrapperState.initialValue&&s!==""&&s!==null&&(r.value=s)}function v0(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xE(r,s){return r==null||r==="http://www.w3.org/1999/xhtml"?v0(s):r==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var mu,T0=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,d,h,E){MSApp.execUnsafeLocalFunction(function(){return r(s,d,h,E)})}:r}(function(r,s){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=s;else{for(mu=mu||document.createElement("div"),mu.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=mu.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;s.firstChild;)r.appendChild(s.firstChild)}});function ud(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var td={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},dF=["Webkit","ms","Moz","O"];Object.keys(td).forEach(function(r){dF.forEach(function(s){s=s+r.charAt(0).toUpperCase()+r.substring(1),td[s]=td[r]})});function R0(r,s,d){return s==null||typeof s=="boolean"||s===""?"":d||typeof s!="number"||s===0||td.hasOwnProperty(r)&&td[r]?(""+s).trim():s+"px"}function y0(r,s){r=r.style;for(var d in s)if(s.hasOwnProperty(d)){var h=d.indexOf("--")===0,E=R0(d,s[d],h);d==="float"&&(d="cssFloat"),h?r.setProperty(d,E):r[d]=E}}var lF=$t({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function VE(r,s){if(s){if(lF[r]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(de(137,r));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(de(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(de(61))}if(s.style!=null&&typeof s.style!="object")throw Error(de(62))}}function jE(r,s){if(r.indexOf("-")===-1)return typeof s.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var FE=null;function P_(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var BE=null,Fa=null,Ba=null;function Qw(r){if(r=Dd(r)){if(typeof BE!="function")throw Error(de(280));var s=r.stateNode;s&&(s=gh(s),BE(r.stateNode,r.type,s))}}function I0(r){Fa?Ba?Ba.push(r):Ba=[r]:Fa=r}function C0(){if(Fa){var r=Fa,s=Ba;if(Ba=Fa=null,Qw(r),s)for(r=0;r<s.length;r++)Qw(s[r])}}function A0(r,s){return r(s)}function w0(){}var oE=!1;function O0(r,s,d){if(oE)return r(s,d);oE=!0;try{return A0(r,s,d)}finally{oE=!1,(Fa!==null||Ba!==null)&&(w0(),C0())}}function hd(r,s){var d=r.stateNode;if(d===null)return null;var h=gh(d);if(h===null)return null;d=h[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(r=r.type,h=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!h;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(de(231,s,typeof d));return d}var GE=!1;if(no)try{var Gc={};Object.defineProperty(Gc,"passive",{get:function(){GE=!0}}),window.addEventListener("test",Gc,Gc),window.removeEventListener("test",Gc,Gc)}catch{GE=!1}function uF(r,s,d,h,E,S,y,D,P){var V=Array.prototype.slice.call(arguments,3);try{s.apply(d,V)}catch(X){this.onError(X)}}var nd=!1,Hu=null,Ku=!1,WE=null,hF={onError:function(r){nd=!0,Hu=r}};function pF(r,s,d,h,E,S,y,D,P){nd=!1,Hu=null,uF.apply(hF,arguments)}function fF(r,s,d,h,E,S,y,D,P){if(pF.apply(this,arguments),nd){if(nd){var V=Hu;nd=!1,Hu=null}else throw Error(de(198));Ku||(Ku=!0,WE=V)}}function Us(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,s.flags&4098&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function N0(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function $w(r){if(Us(r)!==r)throw Error(de(188))}function mF(r){var s=r.alternate;if(!s){if(s=Us(r),s===null)throw Error(de(188));return s!==r?null:r}for(var d=r,h=s;;){var E=d.return;if(E===null)break;var S=E.alternate;if(S===null){if(h=E.return,h!==null){d=h;continue}break}if(E.child===S.child){for(S=E.child;S;){if(S===d)return $w(E),r;if(S===h)return $w(E),s;S=S.sibling}throw Error(de(188))}if(d.return!==h.return)d=E,h=S;else{for(var y=!1,D=E.child;D;){if(D===d){y=!0,d=E,h=S;break}if(D===h){y=!0,h=E,d=S;break}D=D.sibling}if(!y){for(D=S.child;D;){if(D===d){y=!0,d=S,h=E;break}if(D===h){y=!0,h=S,d=E;break}D=D.sibling}if(!y)throw Error(de(189))}}if(d.alternate!==h)throw Error(de(190))}if(d.tag!==3)throw Error(de(188));return d.stateNode.current===d?r:s}function b0(r){return r=mF(r),r!==null?D0(r):null}function D0(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var s=D0(r);if(s!==null)return s;r=r.sibling}return null}var P0=Vi.unstable_scheduleCallback,Zw=Vi.unstable_cancelCallback,EF=Vi.unstable_shouldYield,_F=Vi.unstable_requestPaint,on=Vi.unstable_now,gF=Vi.unstable_getCurrentPriorityLevel,k_=Vi.unstable_ImmediatePriority,k0=Vi.unstable_UserBlockingPriority,zu=Vi.unstable_NormalPriority,SF=Vi.unstable_LowPriority,L0=Vi.unstable_IdlePriority,fh=null,Vr=null;function vF(r){if(Vr&&typeof Vr.onCommitFiberRoot=="function")try{Vr.onCommitFiberRoot(fh,r,void 0,(r.current.flags&128)===128)}catch{}}var Sr=Math.clz32?Math.clz32:yF,TF=Math.log,RF=Math.LN2;function yF(r){return r>>>=0,r===0?32:31-(TF(r)/RF|0)|0}var Eu=64,_u=4194304;function Qc(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function Yu(r,s){var d=r.pendingLanes;if(d===0)return 0;var h=0,E=r.suspendedLanes,S=r.pingedLanes,y=d&268435455;if(y!==0){var D=y&~E;D!==0?h=Qc(D):(S&=y,S!==0&&(h=Qc(S)))}else y=d&~E,y!==0?h=Qc(y):S!==0&&(h=Qc(S));if(h===0)return 0;if(s!==0&&s!==h&&!(s&E)&&(E=h&-h,S=s&-s,E>=S||E===16&&(S&4194240)!==0))return s;if(h&4&&(h|=d&16),s=r.entangledLanes,s!==0)for(r=r.entanglements,s&=h;0<s;)d=31-Sr(s),E=1<<d,h|=r[d],s&=~E;return h}function IF(r,s){switch(r){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function CF(r,s){for(var d=r.suspendedLanes,h=r.pingedLanes,E=r.expirationTimes,S=r.pendingLanes;0<S;){var y=31-Sr(S),D=1<<y,P=E[y];P===-1?(!(D&d)||D&h)&&(E[y]=IF(D,s)):P<=s&&(r.expiredLanes|=D),S&=~D}}function HE(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function M0(){var r=Eu;return Eu<<=1,!(Eu&4194240)&&(Eu=64),r}function sE(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function Nd(r,s,d){r.pendingLanes|=s,s!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,s=31-Sr(s),r[s]=d}function AF(r,s){var d=r.pendingLanes&~s;r.pendingLanes=s,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=s,r.mutableReadLanes&=s,r.entangledLanes&=s,s=r.entanglements;var h=r.eventTimes;for(r=r.expirationTimes;0<d;){var E=31-Sr(d),S=1<<E;s[E]=0,h[E]=-1,r[E]=-1,d&=~S}}function L_(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var h=31-Sr(d),E=1<<h;E&s|r[h]&s&&(r[h]|=s),d&=~E}}var At=0;function U0(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var x0,M_,V0,j0,F0,KE=!1,gu=[],Fo=null,Bo=null,Go=null,pd=new Map,fd=new Map,Uo=[],wF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function eO(r,s){switch(r){case"focusin":case"focusout":Fo=null;break;case"dragenter":case"dragleave":Bo=null;break;case"mouseover":case"mouseout":Go=null;break;case"pointerover":case"pointerout":pd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":fd.delete(s.pointerId)}}function Wc(r,s,d,h,E,S){return r===null||r.nativeEvent!==S?(r={blockedOn:s,domEventName:d,eventSystemFlags:h,nativeEvent:S,targetContainers:[E]},s!==null&&(s=Dd(s),s!==null&&M_(s)),r):(r.eventSystemFlags|=h,s=r.targetContainers,E!==null&&s.indexOf(E)===-1&&s.push(E),r)}function OF(r,s,d,h,E){switch(s){case"focusin":return Fo=Wc(Fo,r,s,d,h,E),!0;case"dragenter":return Bo=Wc(Bo,r,s,d,h,E),!0;case"mouseover":return Go=Wc(Go,r,s,d,h,E),!0;case"pointerover":var S=E.pointerId;return pd.set(S,Wc(pd.get(S)||null,r,s,d,h,E)),!0;case"gotpointercapture":return S=E.pointerId,fd.set(S,Wc(fd.get(S)||null,r,s,d,h,E)),!0}return!1}function B0(r){var s=Cs(r.target);if(s!==null){var d=Us(s);if(d!==null){if(s=d.tag,s===13){if(s=N0(d),s!==null){r.blockedOn=s,F0(r.priority,function(){V0(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Du(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=zE(r.domEventName,r.eventSystemFlags,s[0],r.nativeEvent);if(d===null){d=r.nativeEvent;var h=new d.constructor(d.type,d);FE=h,d.target.dispatchEvent(h),FE=null}else return s=Dd(d),s!==null&&M_(s),r.blockedOn=d,!1;s.shift()}return!0}function tO(r,s,d){Du(r)&&d.delete(s)}function NF(){KE=!1,Fo!==null&&Du(Fo)&&(Fo=null),Bo!==null&&Du(Bo)&&(Bo=null),Go!==null&&Du(Go)&&(Go=null),pd.forEach(tO),fd.forEach(tO)}function Hc(r,s){r.blockedOn===s&&(r.blockedOn=null,KE||(KE=!0,Vi.unstable_scheduleCallback(Vi.unstable_NormalPriority,NF)))}function md(r){function s(E){return Hc(E,r)}if(0<gu.length){Hc(gu[0],r);for(var d=1;d<gu.length;d++){var h=gu[d];h.blockedOn===r&&(h.blockedOn=null)}}for(Fo!==null&&Hc(Fo,r),Bo!==null&&Hc(Bo,r),Go!==null&&Hc(Go,r),pd.forEach(s),fd.forEach(s),d=0;d<Uo.length;d++)h=Uo[d],h.blockedOn===r&&(h.blockedOn=null);for(;0<Uo.length&&(d=Uo[0],d.blockedOn===null);)B0(d),d.blockedOn===null&&Uo.shift()}var Ga=so.ReactCurrentBatchConfig,qu=!0;function bF(r,s,d,h){var E=At,S=Ga.transition;Ga.transition=null;try{At=1,U_(r,s,d,h)}finally{At=E,Ga.transition=S}}function DF(r,s,d,h){var E=At,S=Ga.transition;Ga.transition=null;try{At=4,U_(r,s,d,h)}finally{At=E,Ga.transition=S}}function U_(r,s,d,h){if(qu){var E=zE(r,s,d,h);if(E===null)EE(r,s,h,Ju,d),eO(r,h);else if(OF(E,r,s,d,h))h.stopPropagation();else if(eO(r,h),s&4&&-1<wF.indexOf(r)){for(;E!==null;){var S=Dd(E);if(S!==null&&x0(S),S=zE(r,s,d,h),S===null&&EE(r,s,h,Ju,d),S===E)break;E=S}E!==null&&h.stopPropagation()}else EE(r,s,h,null,d)}}var Ju=null;function zE(r,s,d,h){if(Ju=null,r=P_(h),r=Cs(r),r!==null)if(s=Us(r),s===null)r=null;else if(d=s.tag,d===13){if(r=N0(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null);return Ju=r,null}function G0(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gF()){case k_:return 1;case k0:return 4;case zu:case SF:return 16;case L0:return 536870912;default:return 16}default:return 16}}var Vo=null,x_=null,Pu=null;function W0(){if(Pu)return Pu;var r,s=x_,d=s.length,h,E="value"in Vo?Vo.value:Vo.textContent,S=E.length;for(r=0;r<d&&s[r]===E[r];r++);var y=d-r;for(h=1;h<=y&&s[d-h]===E[S-h];h++);return Pu=E.slice(r,1<h?1-h:void 0)}function ku(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Su(){return!0}function nO(){return!1}function Fi(r){function s(d,h,E,S,y){this._reactName=d,this._targetInst=E,this.type=h,this.nativeEvent=S,this.target=y,this.currentTarget=null;for(var D in r)r.hasOwnProperty(D)&&(d=r[D],this[D]=d?d(S):S[D]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?Su:nO,this.isPropagationStopped=nO,this}return $t(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Su)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Su)},persist:function(){},isPersistent:Su}),s}var Za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},V_=Fi(Za),bd=$t({},Za,{view:0,detail:0}),PF=Fi(bd),aE,cE,Kc,mh=$t({},bd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:j_,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Kc&&(Kc&&r.type==="mousemove"?(aE=r.screenX-Kc.screenX,cE=r.screenY-Kc.screenY):cE=aE=0,Kc=r),aE)},movementY:function(r){return"movementY"in r?r.movementY:cE}}),iO=Fi(mh),kF=$t({},mh,{dataTransfer:0}),LF=Fi(kF),MF=$t({},bd,{relatedTarget:0}),dE=Fi(MF),UF=$t({},Za,{animationName:0,elapsedTime:0,pseudoElement:0}),xF=Fi(UF),VF=$t({},Za,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),jF=Fi(VF),FF=$t({},Za,{data:0}),rO=Fi(FF),BF={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},GF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},WF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function HF(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=WF[r])?!!s[r]:!1}function j_(){return HF}var KF=$t({},bd,{key:function(r){if(r.key){var s=BF[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=ku(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?GF[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:j_,charCode:function(r){return r.type==="keypress"?ku(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ku(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),zF=Fi(KF),YF=$t({},mh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),oO=Fi(YF),qF=$t({},bd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:j_}),JF=Fi(qF),XF=$t({},Za,{propertyName:0,elapsedTime:0,pseudoElement:0}),QF=Fi(XF),$F=$t({},mh,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),ZF=Fi($F),eB=[9,13,27,32],F_=no&&"CompositionEvent"in window,id=null;no&&"documentMode"in document&&(id=document.documentMode);var tB=no&&"TextEvent"in window&&!id,H0=no&&(!F_||id&&8<id&&11>=id),sO=String.fromCharCode(32),aO=!1;function K0(r,s){switch(r){case"keyup":return eB.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function z0(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Na=!1;function nB(r,s){switch(r){case"compositionend":return z0(s);case"keypress":return s.which!==32?null:(aO=!0,sO);case"textInput":return r=s.data,r===sO&&aO?null:r;default:return null}}function iB(r,s){if(Na)return r==="compositionend"||!F_&&K0(r,s)?(r=W0(),Pu=x_=Vo=null,Na=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return H0&&s.locale!=="ko"?null:s.data;default:return null}}var rB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cO(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!rB[r.type]:s==="textarea"}function Y0(r,s,d,h){I0(h),s=Xu(s,"onChange"),0<s.length&&(d=new V_("onChange","change",null,d,h),r.push({event:d,listeners:s}))}var rd=null,Ed=null;function oB(r){rN(r,0)}function Eh(r){var s=Pa(r);if(_0(s))return r}function sB(r,s){if(r==="change")return s}var q0=!1;if(no){var lE;if(no){var uE="oninput"in document;if(!uE){var dO=document.createElement("div");dO.setAttribute("oninput","return;"),uE=typeof dO.oninput=="function"}lE=uE}else lE=!1;q0=lE&&(!document.documentMode||9<document.documentMode)}function lO(){rd&&(rd.detachEvent("onpropertychange",J0),Ed=rd=null)}function J0(r){if(r.propertyName==="value"&&Eh(Ed)){var s=[];Y0(s,Ed,r,P_(r)),O0(oB,s)}}function aB(r,s,d){r==="focusin"?(lO(),rd=s,Ed=d,rd.attachEvent("onpropertychange",J0)):r==="focusout"&&lO()}function cB(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Eh(Ed)}function dB(r,s){if(r==="click")return Eh(s)}function lB(r,s){if(r==="input"||r==="change")return Eh(s)}function uB(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Tr=typeof Object.is=="function"?Object.is:uB;function _d(r,s){if(Tr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),h=Object.keys(s);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var E=d[h];if(!OE.call(s,E)||!Tr(r[E],s[E]))return!1}return!0}function uO(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function hO(r,s){var d=uO(r);r=0;for(var h;d;){if(d.nodeType===3){if(h=r+d.textContent.length,r<=s&&h>=s)return{node:d,offset:s-r};r=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=uO(d)}}function X0(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?X0(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function Q0(){for(var r=window,s=Wu();s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=Wu(r.document)}return s}function B_(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}function hB(r){var s=Q0(),d=r.focusedElem,h=r.selectionRange;if(s!==d&&d&&d.ownerDocument&&X0(d.ownerDocument.documentElement,d)){if(h!==null&&B_(d)){if(s=h.start,r=h.end,r===void 0&&(r=s),"selectionStart"in d)d.selectionStart=s,d.selectionEnd=Math.min(r,d.value.length);else if(r=(s=d.ownerDocument||document)&&s.defaultView||window,r.getSelection){r=r.getSelection();var E=d.textContent.length,S=Math.min(h.start,E);h=h.end===void 0?S:Math.min(h.end,E),!r.extend&&S>h&&(E=h,h=S,S=E),E=hO(d,S);var y=hO(d,h);E&&y&&(r.rangeCount!==1||r.anchorNode!==E.node||r.anchorOffset!==E.offset||r.focusNode!==y.node||r.focusOffset!==y.offset)&&(s=s.createRange(),s.setStart(E.node,E.offset),r.removeAllRanges(),S>h?(r.addRange(s),r.extend(y.node,y.offset)):(s.setEnd(y.node,y.offset),r.addRange(s)))}}for(s=[],r=d;r=r.parentNode;)r.nodeType===1&&s.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<s.length;d++)r=s[d],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var pB=no&&"documentMode"in document&&11>=document.documentMode,ba=null,YE=null,od=null,qE=!1;function pO(r,s,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;qE||ba==null||ba!==Wu(h)||(h=ba,"selectionStart"in h&&B_(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),od&&_d(od,h)||(od=h,h=Xu(YE,"onSelect"),0<h.length&&(s=new V_("onSelect","select",null,s,d),r.push({event:s,listeners:h}),s.target=ba)))}function vu(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var Da={animationend:vu("Animation","AnimationEnd"),animationiteration:vu("Animation","AnimationIteration"),animationstart:vu("Animation","AnimationStart"),transitionend:vu("Transition","TransitionEnd")},hE={},$0={};no&&($0=document.createElement("div").style,"AnimationEvent"in window||(delete Da.animationend.animation,delete Da.animationiteration.animation,delete Da.animationstart.animation),"TransitionEvent"in window||delete Da.transitionend.transition);function _h(r){if(hE[r])return hE[r];if(!Da[r])return r;var s=Da[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in $0)return hE[r]=s[d];return r}var Z0=_h("animationend"),eN=_h("animationiteration"),tN=_h("animationstart"),nN=_h("transitionend"),iN=new Map,fO="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xo(r,s){iN.set(r,s),Ms(s,[r])}for(var pE=0;pE<fO.length;pE++){var fE=fO[pE],fB=fE.toLowerCase(),mB=fE[0].toUpperCase()+fE.slice(1);Xo(fB,"on"+mB)}Xo(Z0,"onAnimationEnd");Xo(eN,"onAnimationIteration");Xo(tN,"onAnimationStart");Xo("dblclick","onDoubleClick");Xo("focusin","onFocus");Xo("focusout","onBlur");Xo(nN,"onTransitionEnd");Ka("onMouseEnter",["mouseout","mouseover"]);Ka("onMouseLeave",["mouseout","mouseover"]);Ka("onPointerEnter",["pointerout","pointerover"]);Ka("onPointerLeave",["pointerout","pointerover"]);Ms("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ms("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ms("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ms("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ms("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ms("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $c="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),EB=new Set("cancel close invalid load scroll toggle".split(" ").concat($c));function mO(r,s,d){var h=r.type||"unknown-event";r.currentTarget=d,fF(h,s,void 0,r),r.currentTarget=null}function rN(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var h=r[d],E=h.event;h=h.listeners;e:{var S=void 0;if(s)for(var y=h.length-1;0<=y;y--){var D=h[y],P=D.instance,V=D.currentTarget;if(D=D.listener,P!==S&&E.isPropagationStopped())break e;mO(E,D,V),S=P}else for(y=0;y<h.length;y++){if(D=h[y],P=D.instance,V=D.currentTarget,D=D.listener,P!==S&&E.isPropagationStopped())break e;mO(E,D,V),S=P}}}if(Ku)throw r=WE,Ku=!1,WE=null,r}function Gt(r,s){var d=s[ZE];d===void 0&&(d=s[ZE]=new Set);var h=r+"__bubble";d.has(h)||(oN(s,r,2,!1),d.add(h))}function mE(r,s,d){var h=0;s&&(h|=4),oN(d,r,h,s)}var Tu="_reactListening"+Math.random().toString(36).slice(2);function gd(r){if(!r[Tu]){r[Tu]=!0,h0.forEach(function(d){d!=="selectionchange"&&(EB.has(d)||mE(d,!1,r),mE(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Tu]||(s[Tu]=!0,mE("selectionchange",!1,s))}}function oN(r,s,d,h){switch(G0(s)){case 1:var E=bF;break;case 4:E=DF;break;default:E=U_}d=E.bind(null,s,d,r),E=void 0,!GE||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(E=!0),h?E!==void 0?r.addEventListener(s,d,{capture:!0,passive:E}):r.addEventListener(s,d,!0):E!==void 0?r.addEventListener(s,d,{passive:E}):r.addEventListener(s,d,!1)}function EE(r,s,d,h,E){var S=h;if(!(s&1)&&!(s&2)&&h!==null)e:for(;;){if(h===null)return;var y=h.tag;if(y===3||y===4){var D=h.stateNode.containerInfo;if(D===E||D.nodeType===8&&D.parentNode===E)break;if(y===4)for(y=h.return;y!==null;){var P=y.tag;if((P===3||P===4)&&(P=y.stateNode.containerInfo,P===E||P.nodeType===8&&P.parentNode===E))return;y=y.return}for(;D!==null;){if(y=Cs(D),y===null)return;if(P=y.tag,P===5||P===6){h=S=y;continue e}D=D.parentNode}}h=h.return}O0(function(){var V=S,X=P_(d),W=[];e:{var B=iN.get(r);if(B!==void 0){var fe=V_,Y=r;switch(r){case"keypress":if(ku(d)===0)break e;case"keydown":case"keyup":fe=zF;break;case"focusin":Y="focus",fe=dE;break;case"focusout":Y="blur",fe=dE;break;case"beforeblur":case"afterblur":fe=dE;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fe=iO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fe=LF;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fe=JF;break;case Z0:case eN:case tN:fe=xF;break;case nN:fe=QF;break;case"scroll":fe=PF;break;case"wheel":fe=ZF;break;case"copy":case"cut":case"paste":fe=jF;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fe=oO}var q=(s&4)!==0,ce=!q&&r==="scroll",M=q?B!==null?B+"Capture":null:B;q=[];for(var L=V,j;L!==null;){j=L;var z=j.stateNode;if(j.tag===5&&z!==null&&(j=z,M!==null&&(z=hd(L,M),z!=null&&q.push(Sd(L,z,j)))),ce)break;L=L.return}0<q.length&&(B=new fe(B,Y,null,d,X),W.push({event:B,listeners:q}))}}if(!(s&7)){e:{if(B=r==="mouseover"||r==="pointerover",fe=r==="mouseout"||r==="pointerout",B&&d!==FE&&(Y=d.relatedTarget||d.fromElement)&&(Cs(Y)||Y[io]))break e;if((fe||B)&&(B=X.window===X?X:(B=X.ownerDocument)?B.defaultView||B.parentWindow:window,fe?(Y=d.relatedTarget||d.toElement,fe=V,Y=Y?Cs(Y):null,Y!==null&&(ce=Us(Y),Y!==ce||Y.tag!==5&&Y.tag!==6)&&(Y=null)):(fe=null,Y=V),fe!==Y)){if(q=iO,z="onMouseLeave",M="onMouseEnter",L="mouse",(r==="pointerout"||r==="pointerover")&&(q=oO,z="onPointerLeave",M="onPointerEnter",L="pointer"),ce=fe==null?B:Pa(fe),j=Y==null?B:Pa(Y),B=new q(z,L+"leave",fe,d,X),B.target=ce,B.relatedTarget=j,z=null,Cs(X)===V&&(q=new q(M,L+"enter",Y,d,X),q.target=j,q.relatedTarget=ce,z=q),ce=z,fe&&Y)t:{for(q=fe,M=Y,L=0,j=q;j;j=Aa(j))L++;for(j=0,z=M;z;z=Aa(z))j++;for(;0<L-j;)q=Aa(q),L--;for(;0<j-L;)M=Aa(M),j--;for(;L--;){if(q===M||M!==null&&q===M.alternate)break t;q=Aa(q),M=Aa(M)}q=null}else q=null;fe!==null&&EO(W,B,fe,q,!1),Y!==null&&ce!==null&&EO(W,ce,Y,q,!0)}}e:{if(B=V?Pa(V):window,fe=B.nodeName&&B.nodeName.toLowerCase(),fe==="select"||fe==="input"&&B.type==="file")var ae=sB;else if(cO(B))if(q0)ae=lB;else{ae=cB;var ie=aB}else(fe=B.nodeName)&&fe.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(ae=dB);if(ae&&(ae=ae(r,V))){Y0(W,ae,d,X);break e}ie&&ie(r,B,V),r==="focusout"&&(ie=B._wrapperState)&&ie.controlled&&B.type==="number"&&ME(B,"number",B.value)}switch(ie=V?Pa(V):window,r){case"focusin":(cO(ie)||ie.contentEditable==="true")&&(ba=ie,YE=V,od=null);break;case"focusout":od=YE=ba=null;break;case"mousedown":qE=!0;break;case"contextmenu":case"mouseup":case"dragend":qE=!1,pO(W,d,X);break;case"selectionchange":if(pB)break;case"keydown":case"keyup":pO(W,d,X)}var Ee;if(F_)e:{switch(r){case"compositionstart":var Ce="onCompositionStart";break e;case"compositionend":Ce="onCompositionEnd";break e;case"compositionupdate":Ce="onCompositionUpdate";break e}Ce=void 0}else Na?K0(r,d)&&(Ce="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Ce="onCompositionStart");Ce&&(H0&&d.locale!=="ko"&&(Na||Ce!=="onCompositionStart"?Ce==="onCompositionEnd"&&Na&&(Ee=W0()):(Vo=X,x_="value"in Vo?Vo.value:Vo.textContent,Na=!0)),ie=Xu(V,Ce),0<ie.length&&(Ce=new rO(Ce,r,null,d,X),W.push({event:Ce,listeners:ie}),Ee?Ce.data=Ee:(Ee=z0(d),Ee!==null&&(Ce.data=Ee)))),(Ee=tB?nB(r,d):iB(r,d))&&(V=Xu(V,"onBeforeInput"),0<V.length&&(X=new rO("onBeforeInput","beforeinput",null,d,X),W.push({event:X,listeners:V}),X.data=Ee))}rN(W,s)})}function Sd(r,s,d){return{instance:r,listener:s,currentTarget:d}}function Xu(r,s){for(var d=s+"Capture",h=[];r!==null;){var E=r,S=E.stateNode;E.tag===5&&S!==null&&(E=S,S=hd(r,d),S!=null&&h.unshift(Sd(r,S,E)),S=hd(r,s),S!=null&&h.push(Sd(r,S,E))),r=r.return}return h}function Aa(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function EO(r,s,d,h,E){for(var S=s._reactName,y=[];d!==null&&d!==h;){var D=d,P=D.alternate,V=D.stateNode;if(P!==null&&P===h)break;D.tag===5&&V!==null&&(D=V,E?(P=hd(d,S),P!=null&&y.unshift(Sd(d,P,D))):E||(P=hd(d,S),P!=null&&y.push(Sd(d,P,D)))),d=d.return}y.length!==0&&r.push({event:s,listeners:y})}var _B=/\r\n?/g,gB=/\u0000|\uFFFD/g;function _O(r){return(typeof r=="string"?r:""+r).replace(_B,`
`).replace(gB,"")}function Ru(r,s,d){if(s=_O(s),_O(r)!==s&&d)throw Error(de(425))}function Qu(){}var JE=null,XE=null;function QE(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var $E=typeof setTimeout=="function"?setTimeout:void 0,SB=typeof clearTimeout=="function"?clearTimeout:void 0,gO=typeof Promise=="function"?Promise:void 0,vB=typeof queueMicrotask=="function"?queueMicrotask:typeof gO<"u"?function(r){return gO.resolve(null).then(r).catch(TB)}:$E;function TB(r){setTimeout(function(){throw r})}function _E(r,s){var d=s,h=0;do{var E=d.nextSibling;if(r.removeChild(d),E&&E.nodeType===8)if(d=E.data,d==="/$"){if(h===0){r.removeChild(E),md(s);return}h--}else d!=="$"&&d!=="$?"&&d!=="$!"||h++;d=E}while(d);md(s)}function Wo(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return r}function SO(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"){if(s===0)return r;s--}else d==="/$"&&s++}r=r.previousSibling}return null}var ec=Math.random().toString(36).slice(2),xr="__reactFiber$"+ec,vd="__reactProps$"+ec,io="__reactContainer$"+ec,ZE="__reactEvents$"+ec,RB="__reactListeners$"+ec,yB="__reactHandles$"+ec;function Cs(r){var s=r[xr];if(s)return s;for(var d=r.parentNode;d;){if(s=d[io]||d[xr]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=SO(r);r!==null;){if(d=r[xr])return d;r=SO(r)}return s}r=d,d=r.parentNode}return null}function Dd(r){return r=r[xr]||r[io],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Pa(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(de(33))}function gh(r){return r[vd]||null}var e_=[],ka=-1;function Qo(r){return{current:r}}function Wt(r){0>ka||(r.current=e_[ka],e_[ka]=null,ka--)}function Vt(r,s){ka++,e_[ka]=r.current,r.current=s}var Jo={},$n=Qo(Jo),Si=Qo(!1),bs=Jo;function za(r,s){var d=r.type.contextTypes;if(!d)return Jo;var h=r.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===s)return h.__reactInternalMemoizedMaskedChildContext;var E={},S;for(S in d)E[S]=s[S];return h&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=E),E}function vi(r){return r=r.childContextTypes,r!=null}function $u(){Wt(Si),Wt($n)}function vO(r,s,d){if($n.current!==Jo)throw Error(de(168));Vt($n,s),Vt(Si,d)}function sN(r,s,d){var h=r.stateNode;if(s=s.childContextTypes,typeof h.getChildContext!="function")return d;h=h.getChildContext();for(var E in h)if(!(E in s))throw Error(de(108,aF(r)||"Unknown",E));return $t({},d,h)}function Zu(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Jo,bs=$n.current,Vt($n,r),Vt(Si,Si.current),!0}function TO(r,s,d){var h=r.stateNode;if(!h)throw Error(de(169));d?(r=sN(r,s,bs),h.__reactInternalMemoizedMergedChildContext=r,Wt(Si),Wt($n),Vt($n,r)):Wt(Si),Vt(Si,d)}var $r=null,Sh=!1,gE=!1;function aN(r){$r===null?$r=[r]:$r.push(r)}function IB(r){Sh=!0,aN(r)}function $o(){if(!gE&&$r!==null){gE=!0;var r=0,s=At;try{var d=$r;for(At=1;r<d.length;r++){var h=d[r];do h=h(!0);while(h!==null)}$r=null,Sh=!1}catch(E){throw $r!==null&&($r=$r.slice(r+1)),P0(k_,$o),E}finally{At=s,gE=!1}}return null}var La=[],Ma=0,eh=null,th=0,$i=[],Zi=0,Ds=null,Zr=1,eo="";function ys(r,s){La[Ma++]=th,La[Ma++]=eh,eh=r,th=s}function cN(r,s,d){$i[Zi++]=Zr,$i[Zi++]=eo,$i[Zi++]=Ds,Ds=r;var h=Zr;r=eo;var E=32-Sr(h)-1;h&=~(1<<E),d+=1;var S=32-Sr(s)+E;if(30<S){var y=E-E%5;S=(h&(1<<y)-1).toString(32),h>>=y,E-=y,Zr=1<<32-Sr(s)+E|d<<E|h,eo=S+r}else Zr=1<<S|d<<E|h,eo=r}function G_(r){r.return!==null&&(ys(r,1),cN(r,1,0))}function W_(r){for(;r===eh;)eh=La[--Ma],La[Ma]=null,th=La[--Ma],La[Ma]=null;for(;r===Ds;)Ds=$i[--Zi],$i[Zi]=null,eo=$i[--Zi],$i[Zi]=null,Zr=$i[--Zi],$i[Zi]=null}var xi=null,Ui=null,zt=!1,gr=null;function dN(r,s){var d=er(5,null,null,0);d.elementType="DELETED",d.stateNode=s,d.return=r,s=r.deletions,s===null?(r.deletions=[d],r.flags|=16):s.push(d)}function RO(r,s){switch(r.tag){case 5:var d=r.type;return s=s.nodeType!==1||d.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(r.stateNode=s,xi=r,Ui=Wo(s.firstChild),!0):!1;case 6:return s=r.pendingProps===""||s.nodeType!==3?null:s,s!==null?(r.stateNode=s,xi=r,Ui=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(d=Ds!==null?{id:Zr,overflow:eo}:null,r.memoizedState={dehydrated:s,treeContext:d,retryLane:1073741824},d=er(18,null,null,0),d.stateNode=s,d.return=r,r.child=d,xi=r,Ui=null,!0):!1;default:return!1}}function t_(r){return(r.mode&1)!==0&&(r.flags&128)===0}function n_(r){if(zt){var s=Ui;if(s){var d=s;if(!RO(r,s)){if(t_(r))throw Error(de(418));s=Wo(d.nextSibling);var h=xi;s&&RO(r,s)?dN(h,d):(r.flags=r.flags&-4097|2,zt=!1,xi=r)}}else{if(t_(r))throw Error(de(418));r.flags=r.flags&-4097|2,zt=!1,xi=r}}}function yO(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;xi=r}function yu(r){if(r!==xi)return!1;if(!zt)return yO(r),zt=!0,!1;var s;if((s=r.tag!==3)&&!(s=r.tag!==5)&&(s=r.type,s=s!=="head"&&s!=="body"&&!QE(r.type,r.memoizedProps)),s&&(s=Ui)){if(t_(r))throw lN(),Error(de(418));for(;s;)dN(r,s),s=Wo(s.nextSibling)}if(yO(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(de(317));e:{for(r=r.nextSibling,s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"){if(s===0){Ui=Wo(r.nextSibling);break e}s--}else d!=="$"&&d!=="$!"&&d!=="$?"||s++}r=r.nextSibling}Ui=null}}else Ui=xi?Wo(r.stateNode.nextSibling):null;return!0}function lN(){for(var r=Ui;r;)r=Wo(r.nextSibling)}function Ya(){Ui=xi=null,zt=!1}function H_(r){gr===null?gr=[r]:gr.push(r)}var CB=so.ReactCurrentBatchConfig;function Er(r,s){if(r&&r.defaultProps){s=$t({},s),r=r.defaultProps;for(var d in r)s[d]===void 0&&(s[d]=r[d]);return s}return s}var nh=Qo(null),ih=null,Ua=null,K_=null;function z_(){K_=Ua=ih=null}function Y_(r){var s=nh.current;Wt(nh),r._currentValue=s}function i_(r,s,d){for(;r!==null;){var h=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,h!==null&&(h.childLanes|=s)):h!==null&&(h.childLanes&s)!==s&&(h.childLanes|=s),r===d)break;r=r.return}}function Wa(r,s){ih=r,K_=Ua=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&s&&(gi=!0),r.firstContext=null)}function nr(r){var s=r._currentValue;if(K_!==r)if(r={context:r,memoizedValue:s,next:null},Ua===null){if(ih===null)throw Error(de(308));Ua=r,ih.dependencies={lanes:0,firstContext:r}}else Ua=Ua.next=r;return s}var As=null;function q_(r){As===null?As=[r]:As.push(r)}function uN(r,s,d,h){var E=s.interleaved;return E===null?(d.next=d,q_(s)):(d.next=E.next,E.next=d),s.interleaved=d,ro(r,h)}function ro(r,s){r.lanes|=s;var d=r.alternate;for(d!==null&&(d.lanes|=s),d=r,r=r.return;r!==null;)r.childLanes|=s,d=r.alternate,d!==null&&(d.childLanes|=s),d=r,r=r.return;return d.tag===3?d.stateNode:null}var Mo=!1;function J_(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hN(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function to(r,s){return{eventTime:r,lane:s,tag:0,payload:null,callback:null,next:null}}function Ho(r,s,d){var h=r.updateQueue;if(h===null)return null;if(h=h.shared,pt&2){var E=h.pending;return E===null?s.next=s:(s.next=E.next,E.next=s),h.pending=s,ro(r,d)}return E=h.interleaved,E===null?(s.next=s,q_(h)):(s.next=E.next,E.next=s),h.interleaved=s,ro(r,d)}function Lu(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194240)!==0)){var h=s.lanes;h&=r.pendingLanes,d|=h,s.lanes=d,L_(r,d)}}function IO(r,s){var d=r.updateQueue,h=r.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var E=null,S=null;if(d=d.firstBaseUpdate,d!==null){do{var y={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};S===null?E=S=y:S=S.next=y,d=d.next}while(d!==null);S===null?E=S=s:S=S.next=s}else E=S=s;d={baseState:h.baseState,firstBaseUpdate:E,lastBaseUpdate:S,shared:h.shared,effects:h.effects},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}function rh(r,s,d,h){var E=r.updateQueue;Mo=!1;var S=E.firstBaseUpdate,y=E.lastBaseUpdate,D=E.shared.pending;if(D!==null){E.shared.pending=null;var P=D,V=P.next;P.next=null,y===null?S=V:y.next=V,y=P;var X=r.alternate;X!==null&&(X=X.updateQueue,D=X.lastBaseUpdate,D!==y&&(D===null?X.firstBaseUpdate=V:D.next=V,X.lastBaseUpdate=P))}if(S!==null){var W=E.baseState;y=0,X=V=P=null,D=S;do{var B=D.lane,fe=D.eventTime;if((h&B)===B){X!==null&&(X=X.next={eventTime:fe,lane:0,tag:D.tag,payload:D.payload,callback:D.callback,next:null});e:{var Y=r,q=D;switch(B=s,fe=d,q.tag){case 1:if(Y=q.payload,typeof Y=="function"){W=Y.call(fe,W,B);break e}W=Y;break e;case 3:Y.flags=Y.flags&-65537|128;case 0:if(Y=q.payload,B=typeof Y=="function"?Y.call(fe,W,B):Y,B==null)break e;W=$t({},W,B);break e;case 2:Mo=!0}}D.callback!==null&&D.lane!==0&&(r.flags|=64,B=E.effects,B===null?E.effects=[D]:B.push(D))}else fe={eventTime:fe,lane:B,tag:D.tag,payload:D.payload,callback:D.callback,next:null},X===null?(V=X=fe,P=W):X=X.next=fe,y|=B;if(D=D.next,D===null){if(D=E.shared.pending,D===null)break;B=D,D=B.next,B.next=null,E.lastBaseUpdate=B,E.shared.pending=null}}while(1);if(X===null&&(P=W),E.baseState=P,E.firstBaseUpdate=V,E.lastBaseUpdate=X,s=E.shared.interleaved,s!==null){E=s;do y|=E.lane,E=E.next;while(E!==s)}else S===null&&(E.shared.lanes=0);ks|=y,r.lanes=y,r.memoizedState=W}}function CO(r,s,d){if(r=s.effects,s.effects=null,r!==null)for(s=0;s<r.length;s++){var h=r[s],E=h.callback;if(E!==null){if(h.callback=null,h=d,typeof E!="function")throw Error(de(191,E));E.call(h)}}}var pN=new u0.Component().refs;function r_(r,s,d,h){s=r.memoizedState,d=d(h,s),d=d==null?s:$t({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var vh={isMounted:function(r){return(r=r._reactInternals)?Us(r)===r:!1},enqueueSetState:function(r,s,d){r=r._reactInternals;var h=ii(),E=zo(r),S=to(h,E);S.payload=s,d!=null&&(S.callback=d),s=Ho(r,S,E),s!==null&&(vr(s,r,E,h),Lu(s,r,E))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var h=ii(),E=zo(r),S=to(h,E);S.tag=1,S.payload=s,d!=null&&(S.callback=d),s=Ho(r,S,E),s!==null&&(vr(s,r,E,h),Lu(s,r,E))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=ii(),h=zo(r),E=to(d,h);E.tag=2,s!=null&&(E.callback=s),s=Ho(r,E,h),s!==null&&(vr(s,r,h,d),Lu(s,r,h))}};function AO(r,s,d,h,E,S,y){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(h,S,y):s.prototype&&s.prototype.isPureReactComponent?!_d(d,h)||!_d(E,S):!0}function fN(r,s,d){var h=!1,E=Jo,S=s.contextType;return typeof S=="object"&&S!==null?S=nr(S):(E=vi(s)?bs:$n.current,h=s.contextTypes,S=(h=h!=null)?za(r,E):Jo),s=new s(d,S),r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=vh,r.stateNode=s,s._reactInternals=r,h&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=E,r.__reactInternalMemoizedMaskedChildContext=S),s}function wO(r,s,d,h){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,h),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,h),s.state!==r&&vh.enqueueReplaceState(s,s.state,null)}function o_(r,s,d,h){var E=r.stateNode;E.props=d,E.state=r.memoizedState,E.refs=pN,J_(r);var S=s.contextType;typeof S=="object"&&S!==null?E.context=nr(S):(S=vi(s)?bs:$n.current,E.context=za(r,S)),E.state=r.memoizedState,S=s.getDerivedStateFromProps,typeof S=="function"&&(r_(r,s,S,d),E.state=r.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(s=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),s!==E.state&&vh.enqueueReplaceState(E,E.state,null),rh(r,d,E,h),E.state=r.memoizedState),typeof E.componentDidMount=="function"&&(r.flags|=4194308)}function zc(r,s,d){if(r=d.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(de(309));var h=d.stateNode}if(!h)throw Error(de(147,r));var E=h,S=""+r;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===S?s.ref:(s=function(y){var D=E.refs;D===pN&&(D=E.refs={}),y===null?delete D[S]:D[S]=y},s._stringRef=S,s)}if(typeof r!="string")throw Error(de(284));if(!d._owner)throw Error(de(290,r))}return r}function Iu(r,s){throw r=Object.prototype.toString.call(s),Error(de(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r))}function OO(r){var s=r._init;return s(r._payload)}function mN(r){function s(M,L){if(r){var j=M.deletions;j===null?(M.deletions=[L],M.flags|=16):j.push(L)}}function d(M,L){if(!r)return null;for(;L!==null;)s(M,L),L=L.sibling;return null}function h(M,L){for(M=new Map;L!==null;)L.key!==null?M.set(L.key,L):M.set(L.index,L),L=L.sibling;return M}function E(M,L){return M=Yo(M,L),M.index=0,M.sibling=null,M}function S(M,L,j){return M.index=j,r?(j=M.alternate,j!==null?(j=j.index,j<L?(M.flags|=2,L):j):(M.flags|=2,L)):(M.flags|=1048576,L)}function y(M){return r&&M.alternate===null&&(M.flags|=2),M}function D(M,L,j,z){return L===null||L.tag!==6?(L=CE(j,M.mode,z),L.return=M,L):(L=E(L,j),L.return=M,L)}function P(M,L,j,z){var ae=j.type;return ae===Oa?X(M,L,j.props.children,z,j.key):L!==null&&(L.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===Lo&&OO(ae)===L.type)?(z=E(L,j.props),z.ref=zc(M,L,j),z.return=M,z):(z=Fu(j.type,j.key,j.props,null,M.mode,z),z.ref=zc(M,L,j),z.return=M,z)}function V(M,L,j,z){return L===null||L.tag!==4||L.stateNode.containerInfo!==j.containerInfo||L.stateNode.implementation!==j.implementation?(L=AE(j,M.mode,z),L.return=M,L):(L=E(L,j.children||[]),L.return=M,L)}function X(M,L,j,z,ae){return L===null||L.tag!==7?(L=Ns(j,M.mode,z,ae),L.return=M,L):(L=E(L,j),L.return=M,L)}function W(M,L,j){if(typeof L=="string"&&L!==""||typeof L=="number")return L=CE(""+L,M.mode,j),L.return=M,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case pu:return j=Fu(L.type,L.key,L.props,null,M.mode,j),j.ref=zc(M,null,L),j.return=M,j;case wa:return L=AE(L,M.mode,j),L.return=M,L;case Lo:var z=L._init;return W(M,z(L._payload),j)}if(Xc(L)||Bc(L))return L=Ns(L,M.mode,j,null),L.return=M,L;Iu(M,L)}return null}function B(M,L,j,z){var ae=L!==null?L.key:null;if(typeof j=="string"&&j!==""||typeof j=="number")return ae!==null?null:D(M,L,""+j,z);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case pu:return j.key===ae?P(M,L,j,z):null;case wa:return j.key===ae?V(M,L,j,z):null;case Lo:return ae=j._init,B(M,L,ae(j._payload),z)}if(Xc(j)||Bc(j))return ae!==null?null:X(M,L,j,z,null);Iu(M,j)}return null}function fe(M,L,j,z,ae){if(typeof z=="string"&&z!==""||typeof z=="number")return M=M.get(j)||null,D(L,M,""+z,ae);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case pu:return M=M.get(z.key===null?j:z.key)||null,P(L,M,z,ae);case wa:return M=M.get(z.key===null?j:z.key)||null,V(L,M,z,ae);case Lo:var ie=z._init;return fe(M,L,j,ie(z._payload),ae)}if(Xc(z)||Bc(z))return M=M.get(j)||null,X(L,M,z,ae,null);Iu(L,z)}return null}function Y(M,L,j,z){for(var ae=null,ie=null,Ee=L,Ce=L=0,nt=null;Ee!==null&&Ce<j.length;Ce++){Ee.index>Ce?(nt=Ee,Ee=null):nt=Ee.sibling;var Ze=B(M,Ee,j[Ce],z);if(Ze===null){Ee===null&&(Ee=nt);break}r&&Ee&&Ze.alternate===null&&s(M,Ee),L=S(Ze,L,Ce),ie===null?ae=Ze:ie.sibling=Ze,ie=Ze,Ee=nt}if(Ce===j.length)return d(M,Ee),zt&&ys(M,Ce),ae;if(Ee===null){for(;Ce<j.length;Ce++)Ee=W(M,j[Ce],z),Ee!==null&&(L=S(Ee,L,Ce),ie===null?ae=Ee:ie.sibling=Ee,ie=Ee);return zt&&ys(M,Ce),ae}for(Ee=h(M,Ee);Ce<j.length;Ce++)nt=fe(Ee,M,Ce,j[Ce],z),nt!==null&&(r&&nt.alternate!==null&&Ee.delete(nt.key===null?Ce:nt.key),L=S(nt,L,Ce),ie===null?ae=nt:ie.sibling=nt,ie=nt);return r&&Ee.forEach(function(si){return s(M,si)}),zt&&ys(M,Ce),ae}function q(M,L,j,z){var ae=Bc(j);if(typeof ae!="function")throw Error(de(150));if(j=ae.call(j),j==null)throw Error(de(151));for(var ie=ae=null,Ee=L,Ce=L=0,nt=null,Ze=j.next();Ee!==null&&!Ze.done;Ce++,Ze=j.next()){Ee.index>Ce?(nt=Ee,Ee=null):nt=Ee.sibling;var si=B(M,Ee,Ze.value,z);if(si===null){Ee===null&&(Ee=nt);break}r&&Ee&&si.alternate===null&&s(M,Ee),L=S(si,L,Ce),ie===null?ae=si:ie.sibling=si,ie=si,Ee=nt}if(Ze.done)return d(M,Ee),zt&&ys(M,Ce),ae;if(Ee===null){for(;!Ze.done;Ce++,Ze=j.next())Ze=W(M,Ze.value,z),Ze!==null&&(L=S(Ze,L,Ce),ie===null?ae=Ze:ie.sibling=Ze,ie=Ze);return zt&&ys(M,Ce),ae}for(Ee=h(M,Ee);!Ze.done;Ce++,Ze=j.next())Ze=fe(Ee,M,Ce,Ze.value,z),Ze!==null&&(r&&Ze.alternate!==null&&Ee.delete(Ze.key===null?Ce:Ze.key),L=S(Ze,L,Ce),ie===null?ae=Ze:ie.sibling=Ze,ie=Ze);return r&&Ee.forEach(function(ao){return s(M,ao)}),zt&&ys(M,Ce),ae}function ce(M,L,j,z){if(typeof j=="object"&&j!==null&&j.type===Oa&&j.key===null&&(j=j.props.children),typeof j=="object"&&j!==null){switch(j.$$typeof){case pu:e:{for(var ae=j.key,ie=L;ie!==null;){if(ie.key===ae){if(ae=j.type,ae===Oa){if(ie.tag===7){d(M,ie.sibling),L=E(ie,j.props.children),L.return=M,M=L;break e}}else if(ie.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===Lo&&OO(ae)===ie.type){d(M,ie.sibling),L=E(ie,j.props),L.ref=zc(M,ie,j),L.return=M,M=L;break e}d(M,ie);break}else s(M,ie);ie=ie.sibling}j.type===Oa?(L=Ns(j.props.children,M.mode,z,j.key),L.return=M,M=L):(z=Fu(j.type,j.key,j.props,null,M.mode,z),z.ref=zc(M,L,j),z.return=M,M=z)}return y(M);case wa:e:{for(ie=j.key;L!==null;){if(L.key===ie)if(L.tag===4&&L.stateNode.containerInfo===j.containerInfo&&L.stateNode.implementation===j.implementation){d(M,L.sibling),L=E(L,j.children||[]),L.return=M,M=L;break e}else{d(M,L);break}else s(M,L);L=L.sibling}L=AE(j,M.mode,z),L.return=M,M=L}return y(M);case Lo:return ie=j._init,ce(M,L,ie(j._payload),z)}if(Xc(j))return Y(M,L,j,z);if(Bc(j))return q(M,L,j,z);Iu(M,j)}return typeof j=="string"&&j!==""||typeof j=="number"?(j=""+j,L!==null&&L.tag===6?(d(M,L.sibling),L=E(L,j),L.return=M,M=L):(d(M,L),L=CE(j,M.mode,z),L.return=M,M=L),y(M)):d(M,L)}return ce}var qa=mN(!0),EN=mN(!1),Pd={},jr=Qo(Pd),Td=Qo(Pd),Rd=Qo(Pd);function ws(r){if(r===Pd)throw Error(de(174));return r}function X_(r,s){switch(Vt(Rd,s),Vt(Td,r),Vt(jr,Pd),r=s.nodeType,r){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:xE(null,"");break;default:r=r===8?s.parentNode:s,s=r.namespaceURI||null,r=r.tagName,s=xE(s,r)}Wt(jr),Vt(jr,s)}function Ja(){Wt(jr),Wt(Td),Wt(Rd)}function _N(r){ws(Rd.current);var s=ws(jr.current),d=xE(s,r.type);s!==d&&(Vt(Td,r),Vt(jr,d))}function Q_(r){Td.current===r&&(Wt(jr),Wt(Td))}var Xt=Qo(0);function oh(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var SE=[];function $_(){for(var r=0;r<SE.length;r++)SE[r]._workInProgressVersionPrimary=null;SE.length=0}var Mu=so.ReactCurrentDispatcher,vE=so.ReactCurrentBatchConfig,Ps=0,Qt=null,Tn=null,Nn=null,sh=!1,sd=!1,yd=0,AB=0;function Jn(){throw Error(de(321))}function Z_(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!Tr(r[d],s[d]))return!1;return!0}function eg(r,s,d,h,E,S){if(Ps=S,Qt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Mu.current=r===null||r.memoizedState===null?bB:DB,r=d(h,E),sd){S=0;do{if(sd=!1,yd=0,25<=S)throw Error(de(301));S+=1,Nn=Tn=null,s.updateQueue=null,Mu.current=PB,r=d(h,E)}while(sd)}if(Mu.current=ah,s=Tn!==null&&Tn.next!==null,Ps=0,Nn=Tn=Qt=null,sh=!1,s)throw Error(de(300));return r}function tg(){var r=yd!==0;return yd=0,r}function Ur(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nn===null?Qt.memoizedState=Nn=r:Nn=Nn.next=r,Nn}function ir(){if(Tn===null){var r=Qt.alternate;r=r!==null?r.memoizedState:null}else r=Tn.next;var s=Nn===null?Qt.memoizedState:Nn.next;if(s!==null)Nn=s,Tn=r;else{if(r===null)throw Error(de(310));Tn=r,r={memoizedState:Tn.memoizedState,baseState:Tn.baseState,baseQueue:Tn.baseQueue,queue:Tn.queue,next:null},Nn===null?Qt.memoizedState=Nn=r:Nn=Nn.next=r}return Nn}function Id(r,s){return typeof s=="function"?s(r):s}function TE(r){var s=ir(),d=s.queue;if(d===null)throw Error(de(311));d.lastRenderedReducer=r;var h=Tn,E=h.baseQueue,S=d.pending;if(S!==null){if(E!==null){var y=E.next;E.next=S.next,S.next=y}h.baseQueue=E=S,d.pending=null}if(E!==null){S=E.next,h=h.baseState;var D=y=null,P=null,V=S;do{var X=V.lane;if((Ps&X)===X)P!==null&&(P=P.next={lane:0,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),h=V.hasEagerState?V.eagerState:r(h,V.action);else{var W={lane:X,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null};P===null?(D=P=W,y=h):P=P.next=W,Qt.lanes|=X,ks|=X}V=V.next}while(V!==null&&V!==S);P===null?y=h:P.next=D,Tr(h,s.memoizedState)||(gi=!0),s.memoizedState=h,s.baseState=y,s.baseQueue=P,d.lastRenderedState=h}if(r=d.interleaved,r!==null){E=r;do S=E.lane,Qt.lanes|=S,ks|=S,E=E.next;while(E!==r)}else E===null&&(d.lanes=0);return[s.memoizedState,d.dispatch]}function RE(r){var s=ir(),d=s.queue;if(d===null)throw Error(de(311));d.lastRenderedReducer=r;var h=d.dispatch,E=d.pending,S=s.memoizedState;if(E!==null){d.pending=null;var y=E=E.next;do S=r(S,y.action),y=y.next;while(y!==E);Tr(S,s.memoizedState)||(gi=!0),s.memoizedState=S,s.baseQueue===null&&(s.baseState=S),d.lastRenderedState=S}return[S,h]}function gN(){}function SN(r,s){var d=Qt,h=ir(),E=s(),S=!Tr(h.memoizedState,E);if(S&&(h.memoizedState=E,gi=!0),h=h.queue,ng(RN.bind(null,d,h,r),[r]),h.getSnapshot!==s||S||Nn!==null&&Nn.memoizedState.tag&1){if(d.flags|=2048,Cd(9,TN.bind(null,d,h,E,s),void 0,null),bn===null)throw Error(de(349));Ps&30||vN(d,s,E)}return E}function vN(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=Qt.updateQueue,s===null?(s={lastEffect:null,stores:null},Qt.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function TN(r,s,d,h){s.value=d,s.getSnapshot=h,yN(s)&&IN(r)}function RN(r,s,d){return d(function(){yN(s)&&IN(r)})}function yN(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!Tr(r,d)}catch{return!0}}function IN(r){var s=ro(r,1);s!==null&&vr(s,r,1,-1)}function NO(r){var s=Ur();return typeof r=="function"&&(r=r()),s.memoizedState=s.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Id,lastRenderedState:r},s.queue=r,r=r.dispatch=NB.bind(null,Qt,r),[s.memoizedState,r]}function Cd(r,s,d,h){return r={tag:r,create:s,destroy:d,deps:h,next:null},s=Qt.updateQueue,s===null?(s={lastEffect:null,stores:null},Qt.updateQueue=s,s.lastEffect=r.next=r):(d=s.lastEffect,d===null?s.lastEffect=r.next=r:(h=d.next,d.next=r,r.next=h,s.lastEffect=r)),r}function CN(){return ir().memoizedState}function Uu(r,s,d,h){var E=Ur();Qt.flags|=r,E.memoizedState=Cd(1|s,d,void 0,h===void 0?null:h)}function Th(r,s,d,h){var E=ir();h=h===void 0?null:h;var S=void 0;if(Tn!==null){var y=Tn.memoizedState;if(S=y.destroy,h!==null&&Z_(h,y.deps)){E.memoizedState=Cd(s,d,S,h);return}}Qt.flags|=r,E.memoizedState=Cd(1|s,d,S,h)}function bO(r,s){return Uu(8390656,8,r,s)}function ng(r,s){return Th(2048,8,r,s)}function AN(r,s){return Th(4,2,r,s)}function wN(r,s){return Th(4,4,r,s)}function ON(r,s){if(typeof s=="function")return r=r(),s(r),function(){s(null)};if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function NN(r,s,d){return d=d!=null?d.concat([r]):null,Th(4,4,ON.bind(null,s,r),d)}function ig(){}function bN(r,s){var d=ir();s=s===void 0?null:s;var h=d.memoizedState;return h!==null&&s!==null&&Z_(s,h[1])?h[0]:(d.memoizedState=[r,s],r)}function DN(r,s){var d=ir();s=s===void 0?null:s;var h=d.memoizedState;return h!==null&&s!==null&&Z_(s,h[1])?h[0]:(r=r(),d.memoizedState=[r,s],r)}function PN(r,s,d){return Ps&21?(Tr(d,s)||(d=M0(),Qt.lanes|=d,ks|=d,r.baseState=!0),s):(r.baseState&&(r.baseState=!1,gi=!0),r.memoizedState=d)}function wB(r,s){var d=At;At=d!==0&&4>d?d:4,r(!0);var h=vE.transition;vE.transition={};try{r(!1),s()}finally{At=d,vE.transition=h}}function kN(){return ir().memoizedState}function OB(r,s,d){var h=zo(r);if(d={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null},LN(r))MN(s,d);else if(d=uN(r,s,d,h),d!==null){var E=ii();vr(d,r,h,E),UN(d,s,h)}}function NB(r,s,d){var h=zo(r),E={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null};if(LN(r))MN(s,E);else{var S=r.alternate;if(r.lanes===0&&(S===null||S.lanes===0)&&(S=s.lastRenderedReducer,S!==null))try{var y=s.lastRenderedState,D=S(y,d);if(E.hasEagerState=!0,E.eagerState=D,Tr(D,y)){var P=s.interleaved;P===null?(E.next=E,q_(s)):(E.next=P.next,P.next=E),s.interleaved=E;return}}catch{}finally{}d=uN(r,s,E,h),d!==null&&(E=ii(),vr(d,r,h,E),UN(d,s,h))}}function LN(r){var s=r.alternate;return r===Qt||s!==null&&s===Qt}function MN(r,s){sd=sh=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function UN(r,s,d){if(d&4194240){var h=s.lanes;h&=r.pendingLanes,d|=h,s.lanes=d,L_(r,d)}}var ah={readContext:nr,useCallback:Jn,useContext:Jn,useEffect:Jn,useImperativeHandle:Jn,useInsertionEffect:Jn,useLayoutEffect:Jn,useMemo:Jn,useReducer:Jn,useRef:Jn,useState:Jn,useDebugValue:Jn,useDeferredValue:Jn,useTransition:Jn,useMutableSource:Jn,useSyncExternalStore:Jn,useId:Jn,unstable_isNewReconciler:!1},bB={readContext:nr,useCallback:function(r,s){return Ur().memoizedState=[r,s===void 0?null:s],r},useContext:nr,useEffect:bO,useImperativeHandle:function(r,s,d){return d=d!=null?d.concat([r]):null,Uu(4194308,4,ON.bind(null,s,r),d)},useLayoutEffect:function(r,s){return Uu(4194308,4,r,s)},useInsertionEffect:function(r,s){return Uu(4,2,r,s)},useMemo:function(r,s){var d=Ur();return s=s===void 0?null:s,r=r(),d.memoizedState=[r,s],r},useReducer:function(r,s,d){var h=Ur();return s=d!==void 0?d(s):s,h.memoizedState=h.baseState=s,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:s},h.queue=r,r=r.dispatch=OB.bind(null,Qt,r),[h.memoizedState,r]},useRef:function(r){var s=Ur();return r={current:r},s.memoizedState=r},useState:NO,useDebugValue:ig,useDeferredValue:function(r){return Ur().memoizedState=r},useTransition:function(){var r=NO(!1),s=r[0];return r=wB.bind(null,r[1]),Ur().memoizedState=r,[s,r]},useMutableSource:function(){},useSyncExternalStore:function(r,s,d){var h=Qt,E=Ur();if(zt){if(d===void 0)throw Error(de(407));d=d()}else{if(d=s(),bn===null)throw Error(de(349));Ps&30||vN(h,s,d)}E.memoizedState=d;var S={value:d,getSnapshot:s};return E.queue=S,bO(RN.bind(null,h,S,r),[r]),h.flags|=2048,Cd(9,TN.bind(null,h,S,d,s),void 0,null),d},useId:function(){var r=Ur(),s=bn.identifierPrefix;if(zt){var d=eo,h=Zr;d=(h&~(1<<32-Sr(h)-1)).toString(32)+d,s=":"+s+"R"+d,d=yd++,0<d&&(s+="H"+d.toString(32)),s+=":"}else d=AB++,s=":"+s+"r"+d.toString(32)+":";return r.memoizedState=s},unstable_isNewReconciler:!1},DB={readContext:nr,useCallback:bN,useContext:nr,useEffect:ng,useImperativeHandle:NN,useInsertionEffect:AN,useLayoutEffect:wN,useMemo:DN,useReducer:TE,useRef:CN,useState:function(){return TE(Id)},useDebugValue:ig,useDeferredValue:function(r){var s=ir();return PN(s,Tn.memoizedState,r)},useTransition:function(){var r=TE(Id)[0],s=ir().memoizedState;return[r,s]},useMutableSource:gN,useSyncExternalStore:SN,useId:kN,unstable_isNewReconciler:!1},PB={readContext:nr,useCallback:bN,useContext:nr,useEffect:ng,useImperativeHandle:NN,useInsertionEffect:AN,useLayoutEffect:wN,useMemo:DN,useReducer:RE,useRef:CN,useState:function(){return RE(Id)},useDebugValue:ig,useDeferredValue:function(r){var s=ir();return Tn===null?s.memoizedState=r:PN(s,Tn.memoizedState,r)},useTransition:function(){var r=RE(Id)[0],s=ir().memoizedState;return[r,s]},useMutableSource:gN,useSyncExternalStore:SN,useId:kN,unstable_isNewReconciler:!1};function Xa(r,s){try{var d="",h=s;do d+=sF(h),h=h.return;while(h);var E=d}catch(S){E=`
Error generating stack: `+S.message+`
`+S.stack}return{value:r,source:s,stack:E,digest:null}}function yE(r,s,d){return{value:r,source:null,stack:d??null,digest:s??null}}function s_(r,s){try{console.error(s.value)}catch(d){setTimeout(function(){throw d})}}var kB=typeof WeakMap=="function"?WeakMap:Map;function xN(r,s,d){d=to(-1,d),d.tag=3,d.payload={element:null};var h=s.value;return d.callback=function(){dh||(dh=!0,E_=h),s_(r,s)},d}function VN(r,s,d){d=to(-1,d),d.tag=3;var h=r.type.getDerivedStateFromError;if(typeof h=="function"){var E=s.value;d.payload=function(){return h(E)},d.callback=function(){s_(r,s)}}var S=r.stateNode;return S!==null&&typeof S.componentDidCatch=="function"&&(d.callback=function(){s_(r,s),typeof h!="function"&&(Ko===null?Ko=new Set([this]):Ko.add(this));var y=s.stack;this.componentDidCatch(s.value,{componentStack:y!==null?y:""})}),d}function DO(r,s,d){var h=r.pingCache;if(h===null){h=r.pingCache=new kB;var E=new Set;h.set(s,E)}else E=h.get(s),E===void 0&&(E=new Set,h.set(s,E));E.has(d)||(E.add(d),r=YB.bind(null,r,s,d),s.then(r,r))}function PO(r){do{var s;if((s=r.tag===13)&&(s=r.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return r;r=r.return}while(r!==null);return null}function kO(r,s,d,h,E){return r.mode&1?(r.flags|=65536,r.lanes=E,r):(r===s?r.flags|=65536:(r.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(s=to(-1,1),s.tag=2,Ho(d,s,1))),d.lanes|=1),r)}var LB=so.ReactCurrentOwner,gi=!1;function ni(r,s,d,h){s.child=r===null?EN(s,null,d,h):qa(s,r.child,d,h)}function LO(r,s,d,h,E){d=d.render;var S=s.ref;return Wa(s,E),h=eg(r,s,d,h,S,E),d=tg(),r!==null&&!gi?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~E,oo(r,s,E)):(zt&&d&&G_(s),s.flags|=1,ni(r,s,h,E),s.child)}function MO(r,s,d,h,E){if(r===null){var S=d.type;return typeof S=="function"&&!ug(S)&&S.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(s.tag=15,s.type=S,jN(r,s,S,h,E)):(r=Fu(d.type,null,h,s,s.mode,E),r.ref=s.ref,r.return=s,s.child=r)}if(S=r.child,!(r.lanes&E)){var y=S.memoizedProps;if(d=d.compare,d=d!==null?d:_d,d(y,h)&&r.ref===s.ref)return oo(r,s,E)}return s.flags|=1,r=Yo(S,h),r.ref=s.ref,r.return=s,s.child=r}function jN(r,s,d,h,E){if(r!==null){var S=r.memoizedProps;if(_d(S,h)&&r.ref===s.ref)if(gi=!1,s.pendingProps=h=S,(r.lanes&E)!==0)r.flags&131072&&(gi=!0);else return s.lanes=r.lanes,oo(r,s,E)}return a_(r,s,d,h,E)}function FN(r,s,d){var h=s.pendingProps,E=h.children,S=r!==null?r.memoizedState:null;if(h.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vt(Va,Mi),Mi|=d;else{if(!(d&1073741824))return r=S!==null?S.baseLanes|d:d,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:r,cachePool:null,transitions:null},s.updateQueue=null,Vt(Va,Mi),Mi|=r,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=S!==null?S.baseLanes:d,Vt(Va,Mi),Mi|=h}else S!==null?(h=S.baseLanes|d,s.memoizedState=null):h=d,Vt(Va,Mi),Mi|=h;return ni(r,s,E,d),s.child}function BN(r,s){var d=s.ref;(r===null&&d!==null||r!==null&&r.ref!==d)&&(s.flags|=512,s.flags|=2097152)}function a_(r,s,d,h,E){var S=vi(d)?bs:$n.current;return S=za(s,S),Wa(s,E),d=eg(r,s,d,h,S,E),h=tg(),r!==null&&!gi?(s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~E,oo(r,s,E)):(zt&&h&&G_(s),s.flags|=1,ni(r,s,d,E),s.child)}function UO(r,s,d,h,E){if(vi(d)){var S=!0;Zu(s)}else S=!1;if(Wa(s,E),s.stateNode===null)xu(r,s),fN(s,d,h),o_(s,d,h,E),h=!0;else if(r===null){var y=s.stateNode,D=s.memoizedProps;y.props=D;var P=y.context,V=d.contextType;typeof V=="object"&&V!==null?V=nr(V):(V=vi(d)?bs:$n.current,V=za(s,V));var X=d.getDerivedStateFromProps,W=typeof X=="function"||typeof y.getSnapshotBeforeUpdate=="function";W||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(D!==h||P!==V)&&wO(s,y,h,V),Mo=!1;var B=s.memoizedState;y.state=B,rh(s,h,y,E),P=s.memoizedState,D!==h||B!==P||Si.current||Mo?(typeof X=="function"&&(r_(s,d,X,h),P=s.memoizedState),(D=Mo||AO(s,d,D,h,B,P,V))?(W||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(s.flags|=4194308)):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=h,s.memoizedState=P),y.props=h,y.state=P,y.context=V,h=D):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),h=!1)}else{y=s.stateNode,hN(r,s),D=s.memoizedProps,V=s.type===s.elementType?D:Er(s.type,D),y.props=V,W=s.pendingProps,B=y.context,P=d.contextType,typeof P=="object"&&P!==null?P=nr(P):(P=vi(d)?bs:$n.current,P=za(s,P));var fe=d.getDerivedStateFromProps;(X=typeof fe=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(D!==W||B!==P)&&wO(s,y,h,P),Mo=!1,B=s.memoizedState,y.state=B,rh(s,h,y,E);var Y=s.memoizedState;D!==W||B!==Y||Si.current||Mo?(typeof fe=="function"&&(r_(s,d,fe,h),Y=s.memoizedState),(V=Mo||AO(s,d,V,h,B,Y,P)||!1)?(X||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(h,Y,P),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(h,Y,P)),typeof y.componentDidUpdate=="function"&&(s.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof y.componentDidUpdate!="function"||D===r.memoizedProps&&B===r.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||D===r.memoizedProps&&B===r.memoizedState||(s.flags|=1024),s.memoizedProps=h,s.memoizedState=Y),y.props=h,y.state=Y,y.context=P,h=V):(typeof y.componentDidUpdate!="function"||D===r.memoizedProps&&B===r.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||D===r.memoizedProps&&B===r.memoizedState||(s.flags|=1024),h=!1)}return c_(r,s,d,h,S,E)}function c_(r,s,d,h,E,S){BN(r,s);var y=(s.flags&128)!==0;if(!h&&!y)return E&&TO(s,d,!1),oo(r,s,S);h=s.stateNode,LB.current=s;var D=y&&typeof d.getDerivedStateFromError!="function"?null:h.render();return s.flags|=1,r!==null&&y?(s.child=qa(s,r.child,null,S),s.child=qa(s,null,D,S)):ni(r,s,D,S),s.memoizedState=h.state,E&&TO(s,d,!0),s.child}function GN(r){var s=r.stateNode;s.pendingContext?vO(r,s.pendingContext,s.pendingContext!==s.context):s.context&&vO(r,s.context,!1),X_(r,s.containerInfo)}function xO(r,s,d,h,E){return Ya(),H_(E),s.flags|=256,ni(r,s,d,h),s.child}var d_={dehydrated:null,treeContext:null,retryLane:0};function l_(r){return{baseLanes:r,cachePool:null,transitions:null}}function WN(r,s,d){var h=s.pendingProps,E=Xt.current,S=!1,y=(s.flags&128)!==0,D;if((D=y)||(D=r!==null&&r.memoizedState===null?!1:(E&2)!==0),D?(S=!0,s.flags&=-129):(r===null||r.memoizedState!==null)&&(E|=1),Vt(Xt,E&1),r===null)return n_(s),r=s.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(s.mode&1?r.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(y=h.children,r=h.fallback,S?(h=s.mode,S=s.child,y={mode:"hidden",children:y},!(h&1)&&S!==null?(S.childLanes=0,S.pendingProps=y):S=Ih(y,h,0,null),r=Ns(r,h,d,null),S.return=s,r.return=s,S.sibling=r,s.child=S,s.child.memoizedState=l_(d),s.memoizedState=d_,r):rg(s,y));if(E=r.memoizedState,E!==null&&(D=E.dehydrated,D!==null))return MB(r,s,y,h,D,E,d);if(S){S=h.fallback,y=s.mode,E=r.child,D=E.sibling;var P={mode:"hidden",children:h.children};return!(y&1)&&s.child!==E?(h=s.child,h.childLanes=0,h.pendingProps=P,s.deletions=null):(h=Yo(E,P),h.subtreeFlags=E.subtreeFlags&14680064),D!==null?S=Yo(D,S):(S=Ns(S,y,d,null),S.flags|=2),S.return=s,h.return=s,h.sibling=S,s.child=h,h=S,S=s.child,y=r.child.memoizedState,y=y===null?l_(d):{baseLanes:y.baseLanes|d,cachePool:null,transitions:y.transitions},S.memoizedState=y,S.childLanes=r.childLanes&~d,s.memoizedState=d_,h}return S=r.child,r=S.sibling,h=Yo(S,{mode:"visible",children:h.children}),!(s.mode&1)&&(h.lanes=d),h.return=s,h.sibling=null,r!==null&&(d=s.deletions,d===null?(s.deletions=[r],s.flags|=16):d.push(r)),s.child=h,s.memoizedState=null,h}function rg(r,s){return s=Ih({mode:"visible",children:s},r.mode,0,null),s.return=r,r.child=s}function Cu(r,s,d,h){return h!==null&&H_(h),qa(s,r.child,null,d),r=rg(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function MB(r,s,d,h,E,S,y){if(d)return s.flags&256?(s.flags&=-257,h=yE(Error(de(422))),Cu(r,s,y,h)):s.memoizedState!==null?(s.child=r.child,s.flags|=128,null):(S=h.fallback,E=s.mode,h=Ih({mode:"visible",children:h.children},E,0,null),S=Ns(S,E,y,null),S.flags|=2,h.return=s,S.return=s,h.sibling=S,s.child=h,s.mode&1&&qa(s,r.child,null,y),s.child.memoizedState=l_(y),s.memoizedState=d_,S);if(!(s.mode&1))return Cu(r,s,y,null);if(E.data==="$!"){if(h=E.nextSibling&&E.nextSibling.dataset,h)var D=h.dgst;return h=D,S=Error(de(419)),h=yE(S,h,void 0),Cu(r,s,y,h)}if(D=(y&r.childLanes)!==0,gi||D){if(h=bn,h!==null){switch(y&-y){case 4:E=2;break;case 16:E=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:E=32;break;case 536870912:E=268435456;break;default:E=0}E=E&(h.suspendedLanes|y)?0:E,E!==0&&E!==S.retryLane&&(S.retryLane=E,ro(r,E),vr(h,r,E,-1))}return lg(),h=yE(Error(de(421))),Cu(r,s,y,h)}return E.data==="$?"?(s.flags|=128,s.child=r.child,s=qB.bind(null,r),E._reactRetry=s,null):(r=S.treeContext,Ui=Wo(E.nextSibling),xi=s,zt=!0,gr=null,r!==null&&($i[Zi++]=Zr,$i[Zi++]=eo,$i[Zi++]=Ds,Zr=r.id,eo=r.overflow,Ds=s),s=rg(s,h.children),s.flags|=4096,s)}function VO(r,s,d){r.lanes|=s;var h=r.alternate;h!==null&&(h.lanes|=s),i_(r.return,s,d)}function IE(r,s,d,h,E){var S=r.memoizedState;S===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:E}:(S.isBackwards=s,S.rendering=null,S.renderingStartTime=0,S.last=h,S.tail=d,S.tailMode=E)}function HN(r,s,d){var h=s.pendingProps,E=h.revealOrder,S=h.tail;if(ni(r,s,h.children,d),h=Xt.current,h&2)h=h&1|2,s.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&VO(r,d,s);else if(r.tag===19)VO(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}h&=1}if(Vt(Xt,h),!(s.mode&1))s.memoizedState=null;else switch(E){case"forwards":for(d=s.child,E=null;d!==null;)r=d.alternate,r!==null&&oh(r)===null&&(E=d),d=d.sibling;d=E,d===null?(E=s.child,s.child=null):(E=d.sibling,d.sibling=null),IE(s,!1,E,d,S);break;case"backwards":for(d=null,E=s.child,s.child=null;E!==null;){if(r=E.alternate,r!==null&&oh(r)===null){s.child=E;break}r=E.sibling,E.sibling=d,d=E,E=r}IE(s,!0,d,null,S);break;case"together":IE(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function xu(r,s){!(s.mode&1)&&r!==null&&(r.alternate=null,s.alternate=null,s.flags|=2)}function oo(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),ks|=s.lanes,!(d&s.childLanes))return null;if(r!==null&&s.child!==r.child)throw Error(de(153));if(s.child!==null){for(r=s.child,d=Yo(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=Yo(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function UB(r,s,d){switch(s.tag){case 3:GN(s),Ya();break;case 5:_N(s);break;case 1:vi(s.type)&&Zu(s);break;case 4:X_(s,s.stateNode.containerInfo);break;case 10:var h=s.type._context,E=s.memoizedProps.value;Vt(nh,h._currentValue),h._currentValue=E;break;case 13:if(h=s.memoizedState,h!==null)return h.dehydrated!==null?(Vt(Xt,Xt.current&1),s.flags|=128,null):d&s.child.childLanes?WN(r,s,d):(Vt(Xt,Xt.current&1),r=oo(r,s,d),r!==null?r.sibling:null);Vt(Xt,Xt.current&1);break;case 19:if(h=(d&s.childLanes)!==0,r.flags&128){if(h)return HN(r,s,d);s.flags|=128}if(E=s.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Vt(Xt,Xt.current),h)break;return null;case 22:case 23:return s.lanes=0,FN(r,s,d)}return oo(r,s,d)}var KN,u_,zN,YN;KN=function(r,s){for(var d=s.child;d!==null;){if(d.tag===5||d.tag===6)r.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break;for(;d.sibling===null;){if(d.return===null||d.return===s)return;d=d.return}d.sibling.return=d.return,d=d.sibling}};u_=function(){};zN=function(r,s,d,h){var E=r.memoizedProps;if(E!==h){r=s.stateNode,ws(jr.current);var S=null;switch(d){case"input":E=kE(r,E),h=kE(r,h),S=[];break;case"select":E=$t({},E,{value:void 0}),h=$t({},h,{value:void 0}),S=[];break;case"textarea":E=UE(r,E),h=UE(r,h),S=[];break;default:typeof E.onClick!="function"&&typeof h.onClick=="function"&&(r.onclick=Qu)}VE(d,h);var y;d=null;for(V in E)if(!h.hasOwnProperty(V)&&E.hasOwnProperty(V)&&E[V]!=null)if(V==="style"){var D=E[V];for(y in D)D.hasOwnProperty(y)&&(d||(d={}),d[y]="")}else V!=="dangerouslySetInnerHTML"&&V!=="children"&&V!=="suppressContentEditableWarning"&&V!=="suppressHydrationWarning"&&V!=="autoFocus"&&(ld.hasOwnProperty(V)?S||(S=[]):(S=S||[]).push(V,null));for(V in h){var P=h[V];if(D=E!=null?E[V]:void 0,h.hasOwnProperty(V)&&P!==D&&(P!=null||D!=null))if(V==="style")if(D){for(y in D)!D.hasOwnProperty(y)||P&&P.hasOwnProperty(y)||(d||(d={}),d[y]="");for(y in P)P.hasOwnProperty(y)&&D[y]!==P[y]&&(d||(d={}),d[y]=P[y])}else d||(S||(S=[]),S.push(V,d)),d=P;else V==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,D=D?D.__html:void 0,P!=null&&D!==P&&(S=S||[]).push(V,P)):V==="children"?typeof P!="string"&&typeof P!="number"||(S=S||[]).push(V,""+P):V!=="suppressContentEditableWarning"&&V!=="suppressHydrationWarning"&&(ld.hasOwnProperty(V)?(P!=null&&V==="onScroll"&&Gt("scroll",r),S||D===P||(S=[])):(S=S||[]).push(V,P))}d&&(S=S||[]).push("style",d);var V=S;(s.updateQueue=V)&&(s.flags|=4)}};YN=function(r,s,d,h){d!==h&&(s.flags|=4)};function Yc(r,s){if(!zt)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:h.sibling=null}}function Xn(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,h=0;if(s)for(var E=r.child;E!==null;)d|=E.lanes|E.childLanes,h|=E.subtreeFlags&14680064,h|=E.flags&14680064,E.return=r,E=E.sibling;else for(E=r.child;E!==null;)d|=E.lanes|E.childLanes,h|=E.subtreeFlags,h|=E.flags,E.return=r,E=E.sibling;return r.subtreeFlags|=h,r.childLanes=d,s}function xB(r,s,d){var h=s.pendingProps;switch(W_(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xn(s),null;case 1:return vi(s.type)&&$u(),Xn(s),null;case 3:return h=s.stateNode,Ja(),Wt(Si),Wt($n),$_(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(r===null||r.child===null)&&(yu(s)?s.flags|=4:r===null||r.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,gr!==null&&(S_(gr),gr=null))),u_(r,s),Xn(s),null;case 5:Q_(s);var E=ws(Rd.current);if(d=s.type,r!==null&&s.stateNode!=null)zN(r,s,d,h,E),r.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!h){if(s.stateNode===null)throw Error(de(166));return Xn(s),null}if(r=ws(jr.current),yu(s)){h=s.stateNode,d=s.type;var S=s.memoizedProps;switch(h[xr]=s,h[vd]=S,r=(s.mode&1)!==0,d){case"dialog":Gt("cancel",h),Gt("close",h);break;case"iframe":case"object":case"embed":Gt("load",h);break;case"video":case"audio":for(E=0;E<$c.length;E++)Gt($c[E],h);break;case"source":Gt("error",h);break;case"img":case"image":case"link":Gt("error",h),Gt("load",h);break;case"details":Gt("toggle",h);break;case"input":Yw(h,S),Gt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!S.multiple},Gt("invalid",h);break;case"textarea":Jw(h,S),Gt("invalid",h)}VE(d,S),E=null;for(var y in S)if(S.hasOwnProperty(y)){var D=S[y];y==="children"?typeof D=="string"?h.textContent!==D&&(S.suppressHydrationWarning!==!0&&Ru(h.textContent,D,r),E=["children",D]):typeof D=="number"&&h.textContent!==""+D&&(S.suppressHydrationWarning!==!0&&Ru(h.textContent,D,r),E=["children",""+D]):ld.hasOwnProperty(y)&&D!=null&&y==="onScroll"&&Gt("scroll",h)}switch(d){case"input":fu(h),qw(h,S,!0);break;case"textarea":fu(h),Xw(h);break;case"select":case"option":break;default:typeof S.onClick=="function"&&(h.onclick=Qu)}h=E,s.updateQueue=h,h!==null&&(s.flags|=4)}else{y=E.nodeType===9?E:E.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=v0(d)),r==="http://www.w3.org/1999/xhtml"?d==="script"?(r=y.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof h.is=="string"?r=y.createElement(d,{is:h.is}):(r=y.createElement(d),d==="select"&&(y=r,h.multiple?y.multiple=!0:h.size&&(y.size=h.size))):r=y.createElementNS(r,d),r[xr]=s,r[vd]=h,KN(r,s,!1,!1),s.stateNode=r;e:{switch(y=jE(d,h),d){case"dialog":Gt("cancel",r),Gt("close",r),E=h;break;case"iframe":case"object":case"embed":Gt("load",r),E=h;break;case"video":case"audio":for(E=0;E<$c.length;E++)Gt($c[E],r);E=h;break;case"source":Gt("error",r),E=h;break;case"img":case"image":case"link":Gt("error",r),Gt("load",r),E=h;break;case"details":Gt("toggle",r),E=h;break;case"input":Yw(r,h),E=kE(r,h),Gt("invalid",r);break;case"option":E=h;break;case"select":r._wrapperState={wasMultiple:!!h.multiple},E=$t({},h,{value:void 0}),Gt("invalid",r);break;case"textarea":Jw(r,h),E=UE(r,h),Gt("invalid",r);break;default:E=h}VE(d,E),D=E;for(S in D)if(D.hasOwnProperty(S)){var P=D[S];S==="style"?y0(r,P):S==="dangerouslySetInnerHTML"?(P=P?P.__html:void 0,P!=null&&T0(r,P)):S==="children"?typeof P=="string"?(d!=="textarea"||P!=="")&&ud(r,P):typeof P=="number"&&ud(r,""+P):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(ld.hasOwnProperty(S)?P!=null&&S==="onScroll"&&Gt("scroll",r):P!=null&&O_(r,S,P,y))}switch(d){case"input":fu(r),qw(r,h,!1);break;case"textarea":fu(r),Xw(r);break;case"option":h.value!=null&&r.setAttribute("value",""+qo(h.value));break;case"select":r.multiple=!!h.multiple,S=h.value,S!=null?ja(r,!!h.multiple,S,!1):h.defaultValue!=null&&ja(r,!!h.multiple,h.defaultValue,!0);break;default:typeof E.onClick=="function"&&(r.onclick=Qu)}switch(d){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Xn(s),null;case 6:if(r&&s.stateNode!=null)YN(r,s,r.memoizedProps,h);else{if(typeof h!="string"&&s.stateNode===null)throw Error(de(166));if(d=ws(Rd.current),ws(jr.current),yu(s)){if(h=s.stateNode,d=s.memoizedProps,h[xr]=s,(S=h.nodeValue!==d)&&(r=xi,r!==null))switch(r.tag){case 3:Ru(h.nodeValue,d,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Ru(h.nodeValue,d,(r.mode&1)!==0)}S&&(s.flags|=4)}else h=(d.nodeType===9?d:d.ownerDocument).createTextNode(h),h[xr]=s,s.stateNode=h}return Xn(s),null;case 13:if(Wt(Xt),h=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(zt&&Ui!==null&&s.mode&1&&!(s.flags&128))lN(),Ya(),s.flags|=98560,S=!1;else if(S=yu(s),h!==null&&h.dehydrated!==null){if(r===null){if(!S)throw Error(de(318));if(S=s.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(de(317));S[xr]=s}else Ya(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Xn(s),S=!1}else gr!==null&&(S_(gr),gr=null),S=!0;if(!S)return s.flags&65536?s:null}return s.flags&128?(s.lanes=d,s):(h=h!==null,h!==(r!==null&&r.memoizedState!==null)&&h&&(s.child.flags|=8192,s.mode&1&&(r===null||Xt.current&1?Rn===0&&(Rn=3):lg())),s.updateQueue!==null&&(s.flags|=4),Xn(s),null);case 4:return Ja(),u_(r,s),r===null&&gd(s.stateNode.containerInfo),Xn(s),null;case 10:return Y_(s.type._context),Xn(s),null;case 17:return vi(s.type)&&$u(),Xn(s),null;case 19:if(Wt(Xt),S=s.memoizedState,S===null)return Xn(s),null;if(h=(s.flags&128)!==0,y=S.rendering,y===null)if(h)Yc(S,!1);else{if(Rn!==0||r!==null&&r.flags&128)for(r=s.child;r!==null;){if(y=oh(r),y!==null){for(s.flags|=128,Yc(S,!1),h=y.updateQueue,h!==null&&(s.updateQueue=h,s.flags|=4),s.subtreeFlags=0,h=d,d=s.child;d!==null;)S=d,r=h,S.flags&=14680066,y=S.alternate,y===null?(S.childLanes=0,S.lanes=r,S.child=null,S.subtreeFlags=0,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=y.childLanes,S.lanes=y.lanes,S.child=y.child,S.subtreeFlags=0,S.deletions=null,S.memoizedProps=y.memoizedProps,S.memoizedState=y.memoizedState,S.updateQueue=y.updateQueue,S.type=y.type,r=y.dependencies,S.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),d=d.sibling;return Vt(Xt,Xt.current&1|2),s.child}r=r.sibling}S.tail!==null&&on()>Qa&&(s.flags|=128,h=!0,Yc(S,!1),s.lanes=4194304)}else{if(!h)if(r=oh(y),r!==null){if(s.flags|=128,h=!0,d=r.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),Yc(S,!0),S.tail===null&&S.tailMode==="hidden"&&!y.alternate&&!zt)return Xn(s),null}else 2*on()-S.renderingStartTime>Qa&&d!==1073741824&&(s.flags|=128,h=!0,Yc(S,!1),s.lanes=4194304);S.isBackwards?(y.sibling=s.child,s.child=y):(d=S.last,d!==null?d.sibling=y:s.child=y,S.last=y)}return S.tail!==null?(s=S.tail,S.rendering=s,S.tail=s.sibling,S.renderingStartTime=on(),s.sibling=null,d=Xt.current,Vt(Xt,h?d&1|2:d&1),s):(Xn(s),null);case 22:case 23:return dg(),h=s.memoizedState!==null,r!==null&&r.memoizedState!==null!==h&&(s.flags|=8192),h&&s.mode&1?Mi&1073741824&&(Xn(s),s.subtreeFlags&6&&(s.flags|=8192)):Xn(s),null;case 24:return null;case 25:return null}throw Error(de(156,s.tag))}function VB(r,s){switch(W_(s),s.tag){case 1:return vi(s.type)&&$u(),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Ja(),Wt(Si),Wt($n),$_(),r=s.flags,r&65536&&!(r&128)?(s.flags=r&-65537|128,s):null;case 5:return Q_(s),null;case 13:if(Wt(Xt),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(de(340));Ya()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Wt(Xt),null;case 4:return Ja(),null;case 10:return Y_(s.type._context),null;case 22:case 23:return dg(),null;case 24:return null;default:return null}}var Au=!1,Qn=!1,jB=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function xa(r,s){var d=r.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(h){en(r,s,h)}else d.current=null}function h_(r,s,d){try{d()}catch(h){en(r,s,h)}}var jO=!1;function FB(r,s){if(JE=qu,r=Q0(),B_(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var E=h.anchorOffset,S=h.focusNode;h=h.focusOffset;try{d.nodeType,S.nodeType}catch{d=null;break e}var y=0,D=-1,P=-1,V=0,X=0,W=r,B=null;t:for(;;){for(var fe;W!==d||E!==0&&W.nodeType!==3||(D=y+E),W!==S||h!==0&&W.nodeType!==3||(P=y+h),W.nodeType===3&&(y+=W.nodeValue.length),(fe=W.firstChild)!==null;)B=W,W=fe;for(;;){if(W===r)break t;if(B===d&&++V===E&&(D=y),B===S&&++X===h&&(P=y),(fe=W.nextSibling)!==null)break;W=B,B=W.parentNode}W=fe}d=D===-1||P===-1?null:{start:D,end:P}}else d=null}d=d||{start:0,end:0}}else d=null;for(XE={focusedElem:r,selectionRange:d},qu=!1,Ie=s;Ie!==null;)if(s=Ie,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Ie=r;else for(;Ie!==null;){s=Ie;try{var Y=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(Y!==null){var q=Y.memoizedProps,ce=Y.memoizedState,M=s.stateNode,L=M.getSnapshotBeforeUpdate(s.elementType===s.type?q:Er(s.type,q),ce);M.__reactInternalSnapshotBeforeUpdate=L}break;case 3:var j=s.stateNode.containerInfo;j.nodeType===1?j.textContent="":j.nodeType===9&&j.documentElement&&j.removeChild(j.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(de(163))}}catch(z){en(s,s.return,z)}if(r=s.sibling,r!==null){r.return=s.return,Ie=r;break}Ie=s.return}return Y=jO,jO=!1,Y}function ad(r,s,d){var h=s.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var E=h=h.next;do{if((E.tag&r)===r){var S=E.destroy;E.destroy=void 0,S!==void 0&&h_(s,d,S)}E=E.next}while(E!==h)}}function Rh(r,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var d=s=s.next;do{if((d.tag&r)===r){var h=d.create;d.destroy=h()}d=d.next}while(d!==s)}}function p_(r){var s=r.ref;if(s!==null){var d=r.stateNode;switch(r.tag){case 5:r=d;break;default:r=d}typeof s=="function"?s(r):s.current=r}}function qN(r){var s=r.alternate;s!==null&&(r.alternate=null,qN(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&(delete s[xr],delete s[vd],delete s[ZE],delete s[RB],delete s[yB])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function JN(r){return r.tag===5||r.tag===3||r.tag===4}function FO(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||JN(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function f_(r,s,d){var h=r.tag;if(h===5||h===6)r=r.stateNode,s?d.nodeType===8?d.parentNode.insertBefore(r,s):d.insertBefore(r,s):(d.nodeType===8?(s=d.parentNode,s.insertBefore(r,d)):(s=d,s.appendChild(r)),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=Qu));else if(h!==4&&(r=r.child,r!==null))for(f_(r,s,d),r=r.sibling;r!==null;)f_(r,s,d),r=r.sibling}function m_(r,s,d){var h=r.tag;if(h===5||h===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(h!==4&&(r=r.child,r!==null))for(m_(r,s,d),r=r.sibling;r!==null;)m_(r,s,d),r=r.sibling}var Vn=null,_r=!1;function ko(r,s,d){for(d=d.child;d!==null;)XN(r,s,d),d=d.sibling}function XN(r,s,d){if(Vr&&typeof Vr.onCommitFiberUnmount=="function")try{Vr.onCommitFiberUnmount(fh,d)}catch{}switch(d.tag){case 5:Qn||xa(d,s);case 6:var h=Vn,E=_r;Vn=null,ko(r,s,d),Vn=h,_r=E,Vn!==null&&(_r?(r=Vn,d=d.stateNode,r.nodeType===8?r.parentNode.removeChild(d):r.removeChild(d)):Vn.removeChild(d.stateNode));break;case 18:Vn!==null&&(_r?(r=Vn,d=d.stateNode,r.nodeType===8?_E(r.parentNode,d):r.nodeType===1&&_E(r,d),md(r)):_E(Vn,d.stateNode));break;case 4:h=Vn,E=_r,Vn=d.stateNode.containerInfo,_r=!0,ko(r,s,d),Vn=h,_r=E;break;case 0:case 11:case 14:case 15:if(!Qn&&(h=d.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){E=h=h.next;do{var S=E,y=S.destroy;S=S.tag,y!==void 0&&(S&2||S&4)&&h_(d,s,y),E=E.next}while(E!==h)}ko(r,s,d);break;case 1:if(!Qn&&(xa(d,s),h=d.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=d.memoizedProps,h.state=d.memoizedState,h.componentWillUnmount()}catch(D){en(d,s,D)}ko(r,s,d);break;case 21:ko(r,s,d);break;case 22:d.mode&1?(Qn=(h=Qn)||d.memoizedState!==null,ko(r,s,d),Qn=h):ko(r,s,d);break;default:ko(r,s,d)}}function BO(r){var s=r.updateQueue;if(s!==null){r.updateQueue=null;var d=r.stateNode;d===null&&(d=r.stateNode=new jB),s.forEach(function(h){var E=JB.bind(null,r,h);d.has(h)||(d.add(h),h.then(E,E))})}}function mr(r,s){var d=s.deletions;if(d!==null)for(var h=0;h<d.length;h++){var E=d[h];try{var S=r,y=s,D=y;e:for(;D!==null;){switch(D.tag){case 5:Vn=D.stateNode,_r=!1;break e;case 3:Vn=D.stateNode.containerInfo,_r=!0;break e;case 4:Vn=D.stateNode.containerInfo,_r=!0;break e}D=D.return}if(Vn===null)throw Error(de(160));XN(S,y,E),Vn=null,_r=!1;var P=E.alternate;P!==null&&(P.return=null),E.return=null}catch(V){en(E,s,V)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)QN(s,r),s=s.sibling}function QN(r,s){var d=r.alternate,h=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(mr(s,r),Mr(r),h&4){try{ad(3,r,r.return),Rh(3,r)}catch(q){en(r,r.return,q)}try{ad(5,r,r.return)}catch(q){en(r,r.return,q)}}break;case 1:mr(s,r),Mr(r),h&512&&d!==null&&xa(d,d.return);break;case 5:if(mr(s,r),Mr(r),h&512&&d!==null&&xa(d,d.return),r.flags&32){var E=r.stateNode;try{ud(E,"")}catch(q){en(r,r.return,q)}}if(h&4&&(E=r.stateNode,E!=null)){var S=r.memoizedProps,y=d!==null?d.memoizedProps:S,D=r.type,P=r.updateQueue;if(r.updateQueue=null,P!==null)try{D==="input"&&S.type==="radio"&&S.name!=null&&g0(E,S),jE(D,y);var V=jE(D,S);for(y=0;y<P.length;y+=2){var X=P[y],W=P[y+1];X==="style"?y0(E,W):X==="dangerouslySetInnerHTML"?T0(E,W):X==="children"?ud(E,W):O_(E,X,W,V)}switch(D){case"input":LE(E,S);break;case"textarea":S0(E,S);break;case"select":var B=E._wrapperState.wasMultiple;E._wrapperState.wasMultiple=!!S.multiple;var fe=S.value;fe!=null?ja(E,!!S.multiple,fe,!1):B!==!!S.multiple&&(S.defaultValue!=null?ja(E,!!S.multiple,S.defaultValue,!0):ja(E,!!S.multiple,S.multiple?[]:"",!1))}E[vd]=S}catch(q){en(r,r.return,q)}}break;case 6:if(mr(s,r),Mr(r),h&4){if(r.stateNode===null)throw Error(de(162));E=r.stateNode,S=r.memoizedProps;try{E.nodeValue=S}catch(q){en(r,r.return,q)}}break;case 3:if(mr(s,r),Mr(r),h&4&&d!==null&&d.memoizedState.isDehydrated)try{md(s.containerInfo)}catch(q){en(r,r.return,q)}break;case 4:mr(s,r),Mr(r);break;case 13:mr(s,r),Mr(r),E=r.child,E.flags&8192&&(S=E.memoizedState!==null,E.stateNode.isHidden=S,!S||E.alternate!==null&&E.alternate.memoizedState!==null||(ag=on())),h&4&&BO(r);break;case 22:if(X=d!==null&&d.memoizedState!==null,r.mode&1?(Qn=(V=Qn)||X,mr(s,r),Qn=V):mr(s,r),Mr(r),h&8192){if(V=r.memoizedState!==null,(r.stateNode.isHidden=V)&&!X&&r.mode&1)for(Ie=r,X=r.child;X!==null;){for(W=Ie=X;Ie!==null;){switch(B=Ie,fe=B.child,B.tag){case 0:case 11:case 14:case 15:ad(4,B,B.return);break;case 1:xa(B,B.return);var Y=B.stateNode;if(typeof Y.componentWillUnmount=="function"){h=B,d=B.return;try{s=h,Y.props=s.memoizedProps,Y.state=s.memoizedState,Y.componentWillUnmount()}catch(q){en(h,d,q)}}break;case 5:xa(B,B.return);break;case 22:if(B.memoizedState!==null){WO(W);continue}}fe!==null?(fe.return=B,Ie=fe):WO(W)}X=X.sibling}e:for(X=null,W=r;;){if(W.tag===5){if(X===null){X=W;try{E=W.stateNode,V?(S=E.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none"):(D=W.stateNode,P=W.memoizedProps.style,y=P!=null&&P.hasOwnProperty("display")?P.display:null,D.style.display=R0("display",y))}catch(q){en(r,r.return,q)}}}else if(W.tag===6){if(X===null)try{W.stateNode.nodeValue=V?"":W.memoizedProps}catch(q){en(r,r.return,q)}}else if((W.tag!==22&&W.tag!==23||W.memoizedState===null||W===r)&&W.child!==null){W.child.return=W,W=W.child;continue}if(W===r)break e;for(;W.sibling===null;){if(W.return===null||W.return===r)break e;X===W&&(X=null),W=W.return}X===W&&(X=null),W.sibling.return=W.return,W=W.sibling}}break;case 19:mr(s,r),Mr(r),h&4&&BO(r);break;case 21:break;default:mr(s,r),Mr(r)}}function Mr(r){var s=r.flags;if(s&2){try{e:{for(var d=r.return;d!==null;){if(JN(d)){var h=d;break e}d=d.return}throw Error(de(160))}switch(h.tag){case 5:var E=h.stateNode;h.flags&32&&(ud(E,""),h.flags&=-33);var S=FO(r);m_(r,S,E);break;case 3:case 4:var y=h.stateNode.containerInfo,D=FO(r);f_(r,D,y);break;default:throw Error(de(161))}}catch(P){en(r,r.return,P)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function BB(r,s,d){Ie=r,$N(r)}function $N(r,s,d){for(var h=(r.mode&1)!==0;Ie!==null;){var E=Ie,S=E.child;if(E.tag===22&&h){var y=E.memoizedState!==null||Au;if(!y){var D=E.alternate,P=D!==null&&D.memoizedState!==null||Qn;D=Au;var V=Qn;if(Au=y,(Qn=P)&&!V)for(Ie=E;Ie!==null;)y=Ie,P=y.child,y.tag===22&&y.memoizedState!==null?HO(E):P!==null?(P.return=y,Ie=P):HO(E);for(;S!==null;)Ie=S,$N(S),S=S.sibling;Ie=E,Au=D,Qn=V}GO(r)}else E.subtreeFlags&8772&&S!==null?(S.return=E,Ie=S):GO(r)}}function GO(r){for(;Ie!==null;){var s=Ie;if(s.flags&8772){var d=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Qn||Rh(5,s);break;case 1:var h=s.stateNode;if(s.flags&4&&!Qn)if(d===null)h.componentDidMount();else{var E=s.elementType===s.type?d.memoizedProps:Er(s.type,d.memoizedProps);h.componentDidUpdate(E,d.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var S=s.updateQueue;S!==null&&CO(s,S,h);break;case 3:var y=s.updateQueue;if(y!==null){if(d=null,s.child!==null)switch(s.child.tag){case 5:d=s.child.stateNode;break;case 1:d=s.child.stateNode}CO(s,y,d)}break;case 5:var D=s.stateNode;if(d===null&&s.flags&4){d=D;var P=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":P.autoFocus&&d.focus();break;case"img":P.src&&(d.src=P.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var V=s.alternate;if(V!==null){var X=V.memoizedState;if(X!==null){var W=X.dehydrated;W!==null&&md(W)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(de(163))}Qn||s.flags&512&&p_(s)}catch(B){en(s,s.return,B)}}if(s===r){Ie=null;break}if(d=s.sibling,d!==null){d.return=s.return,Ie=d;break}Ie=s.return}}function WO(r){for(;Ie!==null;){var s=Ie;if(s===r){Ie=null;break}var d=s.sibling;if(d!==null){d.return=s.return,Ie=d;break}Ie=s.return}}function HO(r){for(;Ie!==null;){var s=Ie;try{switch(s.tag){case 0:case 11:case 15:var d=s.return;try{Rh(4,s)}catch(P){en(s,d,P)}break;case 1:var h=s.stateNode;if(typeof h.componentDidMount=="function"){var E=s.return;try{h.componentDidMount()}catch(P){en(s,E,P)}}var S=s.return;try{p_(s)}catch(P){en(s,S,P)}break;case 5:var y=s.return;try{p_(s)}catch(P){en(s,y,P)}}}catch(P){en(s,s.return,P)}if(s===r){Ie=null;break}var D=s.sibling;if(D!==null){D.return=s.return,Ie=D;break}Ie=s.return}}var GB=Math.ceil,ch=so.ReactCurrentDispatcher,og=so.ReactCurrentOwner,tr=so.ReactCurrentBatchConfig,pt=0,bn=null,_n=null,jn=0,Mi=0,Va=Qo(0),Rn=0,Ad=null,ks=0,yh=0,sg=0,cd=null,_i=null,ag=0,Qa=1/0,Qr=null,dh=!1,E_=null,Ko=null,wu=!1,jo=null,lh=0,dd=0,__=null,Vu=-1,ju=0;function ii(){return pt&6?on():Vu!==-1?Vu:Vu=on()}function zo(r){return r.mode&1?pt&2&&jn!==0?jn&-jn:CB.transition!==null?(ju===0&&(ju=M0()),ju):(r=At,r!==0||(r=window.event,r=r===void 0?16:G0(r.type)),r):1}function vr(r,s,d,h){if(50<dd)throw dd=0,__=null,Error(de(185));Nd(r,d,h),(!(pt&2)||r!==bn)&&(r===bn&&(!(pt&2)&&(yh|=d),Rn===4&&xo(r,jn)),Ti(r,h),d===1&&pt===0&&!(s.mode&1)&&(Qa=on()+500,Sh&&$o()))}function Ti(r,s){var d=r.callbackNode;CF(r,s);var h=Yu(r,r===bn?jn:0);if(h===0)d!==null&&Zw(d),r.callbackNode=null,r.callbackPriority=0;else if(s=h&-h,r.callbackPriority!==s){if(d!=null&&Zw(d),s===1)r.tag===0?IB(KO.bind(null,r)):aN(KO.bind(null,r)),vB(function(){!(pt&6)&&$o()}),d=null;else{switch(U0(h)){case 1:d=k_;break;case 4:d=k0;break;case 16:d=zu;break;case 536870912:d=L0;break;default:d=zu}d=sb(d,ZN.bind(null,r))}r.callbackPriority=s,r.callbackNode=d}}function ZN(r,s){if(Vu=-1,ju=0,pt&6)throw Error(de(327));var d=r.callbackNode;if(Ha()&&r.callbackNode!==d)return null;var h=Yu(r,r===bn?jn:0);if(h===0)return null;if(h&30||h&r.expiredLanes||s)s=uh(r,h);else{s=h;var E=pt;pt|=2;var S=tb();(bn!==r||jn!==s)&&(Qr=null,Qa=on()+500,Os(r,s));do try{KB();break}catch(D){eb(r,D)}while(1);z_(),ch.current=S,pt=E,_n!==null?s=0:(bn=null,jn=0,s=Rn)}if(s!==0){if(s===2&&(E=HE(r),E!==0&&(h=E,s=g_(r,E))),s===1)throw d=Ad,Os(r,0),xo(r,h),Ti(r,on()),d;if(s===6)xo(r,h);else{if(E=r.current.alternate,!(h&30)&&!WB(E)&&(s=uh(r,h),s===2&&(S=HE(r),S!==0&&(h=S,s=g_(r,S))),s===1))throw d=Ad,Os(r,0),xo(r,h),Ti(r,on()),d;switch(r.finishedWork=E,r.finishedLanes=h,s){case 0:case 1:throw Error(de(345));case 2:Is(r,_i,Qr);break;case 3:if(xo(r,h),(h&130023424)===h&&(s=ag+500-on(),10<s)){if(Yu(r,0)!==0)break;if(E=r.suspendedLanes,(E&h)!==h){ii(),r.pingedLanes|=r.suspendedLanes&E;break}r.timeoutHandle=$E(Is.bind(null,r,_i,Qr),s);break}Is(r,_i,Qr);break;case 4:if(xo(r,h),(h&4194240)===h)break;for(s=r.eventTimes,E=-1;0<h;){var y=31-Sr(h);S=1<<y,y=s[y],y>E&&(E=y),h&=~S}if(h=E,h=on()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*GB(h/1960))-h,10<h){r.timeoutHandle=$E(Is.bind(null,r,_i,Qr),h);break}Is(r,_i,Qr);break;case 5:Is(r,_i,Qr);break;default:throw Error(de(329))}}}return Ti(r,on()),r.callbackNode===d?ZN.bind(null,r):null}function g_(r,s){var d=cd;return r.current.memoizedState.isDehydrated&&(Os(r,s).flags|=256),r=uh(r,s),r!==2&&(s=_i,_i=d,s!==null&&S_(s)),r}function S_(r){_i===null?_i=r:_i.push.apply(_i,r)}function WB(r){for(var s=r;;){if(s.flags&16384){var d=s.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var h=0;h<d.length;h++){var E=d[h],S=E.getSnapshot;E=E.value;try{if(!Tr(S(),E))return!1}catch{return!1}}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function xo(r,s){for(s&=~sg,s&=~yh,r.suspendedLanes|=s,r.pingedLanes&=~s,r=r.expirationTimes;0<s;){var d=31-Sr(s),h=1<<d;r[d]=-1,s&=~h}}function KO(r){if(pt&6)throw Error(de(327));Ha();var s=Yu(r,0);if(!(s&1))return Ti(r,on()),null;var d=uh(r,s);if(r.tag!==0&&d===2){var h=HE(r);h!==0&&(s=h,d=g_(r,h))}if(d===1)throw d=Ad,Os(r,0),xo(r,s),Ti(r,on()),d;if(d===6)throw Error(de(345));return r.finishedWork=r.current.alternate,r.finishedLanes=s,Is(r,_i,Qr),Ti(r,on()),null}function cg(r,s){var d=pt;pt|=1;try{return r(s)}finally{pt=d,pt===0&&(Qa=on()+500,Sh&&$o())}}function Ls(r){jo!==null&&jo.tag===0&&!(pt&6)&&Ha();var s=pt;pt|=1;var d=tr.transition,h=At;try{if(tr.transition=null,At=1,r)return r()}finally{At=h,tr.transition=d,pt=s,!(pt&6)&&$o()}}function dg(){Mi=Va.current,Wt(Va)}function Os(r,s){r.finishedWork=null,r.finishedLanes=0;var d=r.timeoutHandle;if(d!==-1&&(r.timeoutHandle=-1,SB(d)),_n!==null)for(d=_n.return;d!==null;){var h=d;switch(W_(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&$u();break;case 3:Ja(),Wt(Si),Wt($n),$_();break;case 5:Q_(h);break;case 4:Ja();break;case 13:Wt(Xt);break;case 19:Wt(Xt);break;case 10:Y_(h.type._context);break;case 22:case 23:dg()}d=d.return}if(bn=r,_n=r=Yo(r.current,null),jn=Mi=s,Rn=0,Ad=null,sg=yh=ks=0,_i=cd=null,As!==null){for(s=0;s<As.length;s++)if(d=As[s],h=d.interleaved,h!==null){d.interleaved=null;var E=h.next,S=d.pending;if(S!==null){var y=S.next;S.next=E,h.next=y}d.pending=h}As=null}return r}function eb(r,s){do{var d=_n;try{if(z_(),Mu.current=ah,sh){for(var h=Qt.memoizedState;h!==null;){var E=h.queue;E!==null&&(E.pending=null),h=h.next}sh=!1}if(Ps=0,Nn=Tn=Qt=null,sd=!1,yd=0,og.current=null,d===null||d.return===null){Rn=1,Ad=s,_n=null;break}e:{var S=r,y=d.return,D=d,P=s;if(s=jn,D.flags|=32768,P!==null&&typeof P=="object"&&typeof P.then=="function"){var V=P,X=D,W=X.tag;if(!(X.mode&1)&&(W===0||W===11||W===15)){var B=X.alternate;B?(X.updateQueue=B.updateQueue,X.memoizedState=B.memoizedState,X.lanes=B.lanes):(X.updateQueue=null,X.memoizedState=null)}var fe=PO(y);if(fe!==null){fe.flags&=-257,kO(fe,y,D,S,s),fe.mode&1&&DO(S,V,s),s=fe,P=V;var Y=s.updateQueue;if(Y===null){var q=new Set;q.add(P),s.updateQueue=q}else Y.add(P);break e}else{if(!(s&1)){DO(S,V,s),lg();break e}P=Error(de(426))}}else if(zt&&D.mode&1){var ce=PO(y);if(ce!==null){!(ce.flags&65536)&&(ce.flags|=256),kO(ce,y,D,S,s),H_(Xa(P,D));break e}}S=P=Xa(P,D),Rn!==4&&(Rn=2),cd===null?cd=[S]:cd.push(S),S=y;do{switch(S.tag){case 3:S.flags|=65536,s&=-s,S.lanes|=s;var M=xN(S,P,s);IO(S,M);break e;case 1:D=P;var L=S.type,j=S.stateNode;if(!(S.flags&128)&&(typeof L.getDerivedStateFromError=="function"||j!==null&&typeof j.componentDidCatch=="function"&&(Ko===null||!Ko.has(j)))){S.flags|=65536,s&=-s,S.lanes|=s;var z=VN(S,D,s);IO(S,z);break e}}S=S.return}while(S!==null)}ib(d)}catch(ae){s=ae,_n===d&&d!==null&&(_n=d=d.return);continue}break}while(1)}function tb(){var r=ch.current;return ch.current=ah,r===null?ah:r}function lg(){(Rn===0||Rn===3||Rn===2)&&(Rn=4),bn===null||!(ks&268435455)&&!(yh&268435455)||xo(bn,jn)}function uh(r,s){var d=pt;pt|=2;var h=tb();(bn!==r||jn!==s)&&(Qr=null,Os(r,s));do try{HB();break}catch(E){eb(r,E)}while(1);if(z_(),pt=d,ch.current=h,_n!==null)throw Error(de(261));return bn=null,jn=0,Rn}function HB(){for(;_n!==null;)nb(_n)}function KB(){for(;_n!==null&&!EF();)nb(_n)}function nb(r){var s=ob(r.alternate,r,Mi);r.memoizedProps=r.pendingProps,s===null?ib(r):_n=s,og.current=null}function ib(r){var s=r;do{var d=s.alternate;if(r=s.return,s.flags&32768){if(d=VB(d,s),d!==null){d.flags&=32767,_n=d;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{Rn=6,_n=null;return}}else if(d=xB(d,s,Mi),d!==null){_n=d;return}if(s=s.sibling,s!==null){_n=s;return}_n=s=r}while(s!==null);Rn===0&&(Rn=5)}function Is(r,s,d){var h=At,E=tr.transition;try{tr.transition=null,At=1,zB(r,s,d,h)}finally{tr.transition=E,At=h}return null}function zB(r,s,d,h){do Ha();while(jo!==null);if(pt&6)throw Error(de(327));d=r.finishedWork;var E=r.finishedLanes;if(d===null)return null;if(r.finishedWork=null,r.finishedLanes=0,d===r.current)throw Error(de(177));r.callbackNode=null,r.callbackPriority=0;var S=d.lanes|d.childLanes;if(AF(r,S),r===bn&&(_n=bn=null,jn=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||wu||(wu=!0,sb(zu,function(){return Ha(),null})),S=(d.flags&15990)!==0,d.subtreeFlags&15990||S){S=tr.transition,tr.transition=null;var y=At;At=1;var D=pt;pt|=4,og.current=null,FB(r,d),QN(d,r),hB(XE),qu=!!JE,XE=JE=null,r.current=d,BB(d),_F(),pt=D,At=y,tr.transition=S}else r.current=d;if(wu&&(wu=!1,jo=r,lh=E),S=r.pendingLanes,S===0&&(Ko=null),vF(d.stateNode),Ti(r,on()),s!==null)for(h=r.onRecoverableError,d=0;d<s.length;d++)E=s[d],h(E.value,{componentStack:E.stack,digest:E.digest});if(dh)throw dh=!1,r=E_,E_=null,r;return lh&1&&r.tag!==0&&Ha(),S=r.pendingLanes,S&1?r===__?dd++:(dd=0,__=r):dd=0,$o(),null}function Ha(){if(jo!==null){var r=U0(lh),s=tr.transition,d=At;try{if(tr.transition=null,At=16>r?16:r,jo===null)var h=!1;else{if(r=jo,jo=null,lh=0,pt&6)throw Error(de(331));var E=pt;for(pt|=4,Ie=r.current;Ie!==null;){var S=Ie,y=S.child;if(Ie.flags&16){var D=S.deletions;if(D!==null){for(var P=0;P<D.length;P++){var V=D[P];for(Ie=V;Ie!==null;){var X=Ie;switch(X.tag){case 0:case 11:case 15:ad(8,X,S)}var W=X.child;if(W!==null)W.return=X,Ie=W;else for(;Ie!==null;){X=Ie;var B=X.sibling,fe=X.return;if(qN(X),X===V){Ie=null;break}if(B!==null){B.return=fe,Ie=B;break}Ie=fe}}}var Y=S.alternate;if(Y!==null){var q=Y.child;if(q!==null){Y.child=null;do{var ce=q.sibling;q.sibling=null,q=ce}while(q!==null)}}Ie=S}}if(S.subtreeFlags&2064&&y!==null)y.return=S,Ie=y;else e:for(;Ie!==null;){if(S=Ie,S.flags&2048)switch(S.tag){case 0:case 11:case 15:ad(9,S,S.return)}var M=S.sibling;if(M!==null){M.return=S.return,Ie=M;break e}Ie=S.return}}var L=r.current;for(Ie=L;Ie!==null;){y=Ie;var j=y.child;if(y.subtreeFlags&2064&&j!==null)j.return=y,Ie=j;else e:for(y=L;Ie!==null;){if(D=Ie,D.flags&2048)try{switch(D.tag){case 0:case 11:case 15:Rh(9,D)}}catch(ae){en(D,D.return,ae)}if(D===y){Ie=null;break e}var z=D.sibling;if(z!==null){z.return=D.return,Ie=z;break e}Ie=D.return}}if(pt=E,$o(),Vr&&typeof Vr.onPostCommitFiberRoot=="function")try{Vr.onPostCommitFiberRoot(fh,r)}catch{}h=!0}return h}finally{At=d,tr.transition=s}}return!1}function zO(r,s,d){s=Xa(d,s),s=xN(r,s,1),r=Ho(r,s,1),s=ii(),r!==null&&(Nd(r,1,s),Ti(r,s))}function en(r,s,d){if(r.tag===3)zO(r,r,d);else for(;s!==null;){if(s.tag===3){zO(s,r,d);break}else if(s.tag===1){var h=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Ko===null||!Ko.has(h))){r=Xa(d,r),r=VN(s,r,1),s=Ho(s,r,1),r=ii(),s!==null&&(Nd(s,1,r),Ti(s,r));break}}s=s.return}}function YB(r,s,d){var h=r.pingCache;h!==null&&h.delete(s),s=ii(),r.pingedLanes|=r.suspendedLanes&d,bn===r&&(jn&d)===d&&(Rn===4||Rn===3&&(jn&130023424)===jn&&500>on()-ag?Os(r,0):sg|=d),Ti(r,s)}function rb(r,s){s===0&&(r.mode&1?(s=_u,_u<<=1,!(_u&130023424)&&(_u=4194304)):s=1);var d=ii();r=ro(r,s),r!==null&&(Nd(r,s,d),Ti(r,d))}function qB(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),rb(r,d)}function JB(r,s){var d=0;switch(r.tag){case 13:var h=r.stateNode,E=r.memoizedState;E!==null&&(d=E.retryLane);break;case 19:h=r.stateNode;break;default:throw Error(de(314))}h!==null&&h.delete(s),rb(r,d)}var ob;ob=function(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps||Si.current)gi=!0;else{if(!(r.lanes&d)&&!(s.flags&128))return gi=!1,UB(r,s,d);gi=!!(r.flags&131072)}else gi=!1,zt&&s.flags&1048576&&cN(s,th,s.index);switch(s.lanes=0,s.tag){case 2:var h=s.type;xu(r,s),r=s.pendingProps;var E=za(s,$n.current);Wa(s,d),E=eg(null,s,h,r,E,d);var S=tg();return s.flags|=1,typeof E=="object"&&E!==null&&typeof E.render=="function"&&E.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,vi(h)?(S=!0,Zu(s)):S=!1,s.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,J_(s),E.updater=vh,s.stateNode=E,E._reactInternals=s,o_(s,h,r,d),s=c_(null,s,h,!0,S,d)):(s.tag=0,zt&&S&&G_(s),ni(null,s,E,d),s=s.child),s;case 16:h=s.elementType;e:{switch(xu(r,s),r=s.pendingProps,E=h._init,h=E(h._payload),s.type=h,E=s.tag=QB(h),r=Er(h,r),E){case 0:s=a_(null,s,h,r,d);break e;case 1:s=UO(null,s,h,r,d);break e;case 11:s=LO(null,s,h,r,d);break e;case 14:s=MO(null,s,h,Er(h.type,r),d);break e}throw Error(de(306,h,""))}return s;case 0:return h=s.type,E=s.pendingProps,E=s.elementType===h?E:Er(h,E),a_(r,s,h,E,d);case 1:return h=s.type,E=s.pendingProps,E=s.elementType===h?E:Er(h,E),UO(r,s,h,E,d);case 3:e:{if(GN(s),r===null)throw Error(de(387));h=s.pendingProps,S=s.memoizedState,E=S.element,hN(r,s),rh(s,h,null,d);var y=s.memoizedState;if(h=y.element,S.isDehydrated)if(S={element:h,isDehydrated:!1,cache:y.cache,pendingSuspenseBoundaries:y.pendingSuspenseBoundaries,transitions:y.transitions},s.updateQueue.baseState=S,s.memoizedState=S,s.flags&256){E=Xa(Error(de(423)),s),s=xO(r,s,h,d,E);break e}else if(h!==E){E=Xa(Error(de(424)),s),s=xO(r,s,h,d,E);break e}else for(Ui=Wo(s.stateNode.containerInfo.firstChild),xi=s,zt=!0,gr=null,d=EN(s,null,h,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ya(),h===E){s=oo(r,s,d);break e}ni(r,s,h,d)}s=s.child}return s;case 5:return _N(s),r===null&&n_(s),h=s.type,E=s.pendingProps,S=r!==null?r.memoizedProps:null,y=E.children,QE(h,E)?y=null:S!==null&&QE(h,S)&&(s.flags|=32),BN(r,s),ni(r,s,y,d),s.child;case 6:return r===null&&n_(s),null;case 13:return WN(r,s,d);case 4:return X_(s,s.stateNode.containerInfo),h=s.pendingProps,r===null?s.child=qa(s,null,h,d):ni(r,s,h,d),s.child;case 11:return h=s.type,E=s.pendingProps,E=s.elementType===h?E:Er(h,E),LO(r,s,h,E,d);case 7:return ni(r,s,s.pendingProps,d),s.child;case 8:return ni(r,s,s.pendingProps.children,d),s.child;case 12:return ni(r,s,s.pendingProps.children,d),s.child;case 10:e:{if(h=s.type._context,E=s.pendingProps,S=s.memoizedProps,y=E.value,Vt(nh,h._currentValue),h._currentValue=y,S!==null)if(Tr(S.value,y)){if(S.children===E.children&&!Si.current){s=oo(r,s,d);break e}}else for(S=s.child,S!==null&&(S.return=s);S!==null;){var D=S.dependencies;if(D!==null){y=S.child;for(var P=D.firstContext;P!==null;){if(P.context===h){if(S.tag===1){P=to(-1,d&-d),P.tag=2;var V=S.updateQueue;if(V!==null){V=V.shared;var X=V.pending;X===null?P.next=P:(P.next=X.next,X.next=P),V.pending=P}}S.lanes|=d,P=S.alternate,P!==null&&(P.lanes|=d),i_(S.return,d,s),D.lanes|=d;break}P=P.next}}else if(S.tag===10)y=S.type===s.type?null:S.child;else if(S.tag===18){if(y=S.return,y===null)throw Error(de(341));y.lanes|=d,D=y.alternate,D!==null&&(D.lanes|=d),i_(y,d,s),y=S.sibling}else y=S.child;if(y!==null)y.return=S;else for(y=S;y!==null;){if(y===s){y=null;break}if(S=y.sibling,S!==null){S.return=y.return,y=S;break}y=y.return}S=y}ni(r,s,E.children,d),s=s.child}return s;case 9:return E=s.type,h=s.pendingProps.children,Wa(s,d),E=nr(E),h=h(E),s.flags|=1,ni(r,s,h,d),s.child;case 14:return h=s.type,E=Er(h,s.pendingProps),E=Er(h.type,E),MO(r,s,h,E,d);case 15:return jN(r,s,s.type,s.pendingProps,d);case 17:return h=s.type,E=s.pendingProps,E=s.elementType===h?E:Er(h,E),xu(r,s),s.tag=1,vi(h)?(r=!0,Zu(s)):r=!1,Wa(s,d),fN(s,h,E),o_(s,h,E,d),c_(null,s,h,!0,r,d);case 19:return HN(r,s,d);case 22:return FN(r,s,d)}throw Error(de(156,s.tag))};function sb(r,s){return P0(r,s)}function XB(r,s,d,h){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function er(r,s,d,h){return new XB(r,s,d,h)}function ug(r){return r=r.prototype,!(!r||!r.isReactComponent)}function QB(r){if(typeof r=="function")return ug(r)?1:0;if(r!=null){if(r=r.$$typeof,r===b_)return 11;if(r===D_)return 14}return 2}function Yo(r,s){var d=r.alternate;return d===null?(d=er(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&14680064,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d}function Fu(r,s,d,h,E,S){var y=2;if(h=r,typeof r=="function")ug(r)&&(y=1);else if(typeof r=="string")y=5;else e:switch(r){case Oa:return Ns(d.children,E,S,s);case N_:y=8,E|=8;break;case NE:return r=er(12,d,s,E|2),r.elementType=NE,r.lanes=S,r;case bE:return r=er(13,d,s,E),r.elementType=bE,r.lanes=S,r;case DE:return r=er(19,d,s,E),r.elementType=DE,r.lanes=S,r;case m0:return Ih(d,E,S,s);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case p0:y=10;break e;case f0:y=9;break e;case b_:y=11;break e;case D_:y=14;break e;case Lo:y=16,h=null;break e}throw Error(de(130,r==null?r:typeof r,""))}return s=er(y,d,s,E),s.elementType=r,s.type=h,s.lanes=S,s}function Ns(r,s,d,h){return r=er(7,r,h,s),r.lanes=d,r}function Ih(r,s,d,h){return r=er(22,r,h,s),r.elementType=m0,r.lanes=d,r.stateNode={isHidden:!1},r}function CE(r,s,d){return r=er(6,r,null,s),r.lanes=d,r}function AE(r,s,d){return s=er(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}function $B(r,s,d,h,E){this.tag=s,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sE(0),this.expirationTimes=sE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sE(0),this.identifierPrefix=h,this.onRecoverableError=E,this.mutableSourceEagerHydrationData=null}function hg(r,s,d,h,E,S,y,D,P){return r=new $B(r,s,d,D,P),s===1?(s=1,S===!0&&(s|=8)):s=0,S=er(3,null,null,s),r.current=S,S.stateNode=r,S.memoizedState={element:h,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},J_(S),r}function ZB(r,s,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:h==null?null:""+h,children:r,containerInfo:s,implementation:d}}function ab(r){if(!r)return Jo;r=r._reactInternals;e:{if(Us(r)!==r||r.tag!==1)throw Error(de(170));var s=r;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(vi(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(de(171))}if(r.tag===1){var d=r.type;if(vi(d))return sN(r,d,s)}return s}function cb(r,s,d,h,E,S,y,D,P){return r=hg(d,h,!0,r,E,S,y,D,P),r.context=ab(null),d=r.current,h=ii(),E=zo(d),S=to(h,E),S.callback=s??null,Ho(d,S,E),r.current.lanes=E,Nd(r,E,h),Ti(r,h),r}function Ch(r,s,d,h){var E=s.current,S=ii(),y=zo(E);return d=ab(d),s.context===null?s.context=d:s.pendingContext=d,s=to(S,y),s.payload={element:r},h=h===void 0?null:h,h!==null&&(s.callback=h),r=Ho(E,s,y),r!==null&&(vr(r,E,y,S),Lu(r,E,y)),y}function hh(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function YO(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function pg(r,s){YO(r,s),(r=r.alternate)&&YO(r,s)}function e3(){return null}var db=typeof reportError=="function"?reportError:function(r){console.error(r)};function fg(r){this._internalRoot=r}Ah.prototype.render=fg.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(de(409));Ch(r,s,null,null)};Ah.prototype.unmount=fg.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Ls(function(){Ch(null,r,null,null)}),s[io]=null}};function Ah(r){this._internalRoot=r}Ah.prototype.unstable_scheduleHydration=function(r){if(r){var s=j0();r={blockedOn:null,target:r,priority:s};for(var d=0;d<Uo.length&&s!==0&&s<Uo[d].priority;d++);Uo.splice(d,0,r),d===0&&B0(r)}};function mg(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function wh(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function qO(){}function t3(r,s,d,h,E){if(E){if(typeof h=="function"){var S=h;h=function(){var V=hh(y);S.call(V)}}var y=cb(s,h,r,0,null,!1,!1,"",qO);return r._reactRootContainer=y,r[io]=y.current,gd(r.nodeType===8?r.parentNode:r),Ls(),y}for(;E=r.lastChild;)r.removeChild(E);if(typeof h=="function"){var D=h;h=function(){var V=hh(P);D.call(V)}}var P=hg(r,0,!1,null,null,!1,!1,"",qO);return r._reactRootContainer=P,r[io]=P.current,gd(r.nodeType===8?r.parentNode:r),Ls(function(){Ch(s,P,d,h)}),P}function Oh(r,s,d,h,E){var S=d._reactRootContainer;if(S){var y=S;if(typeof E=="function"){var D=E;E=function(){var P=hh(y);D.call(P)}}Ch(s,y,r,E)}else y=t3(d,s,r,E,h);return hh(y)}x0=function(r){switch(r.tag){case 3:var s=r.stateNode;if(s.current.memoizedState.isDehydrated){var d=Qc(s.pendingLanes);d!==0&&(L_(s,d|1),Ti(s,on()),!(pt&6)&&(Qa=on()+500,$o()))}break;case 13:Ls(function(){var h=ro(r,1);if(h!==null){var E=ii();vr(h,r,1,E)}}),pg(r,1)}};M_=function(r){if(r.tag===13){var s=ro(r,134217728);if(s!==null){var d=ii();vr(s,r,134217728,d)}pg(r,134217728)}};V0=function(r){if(r.tag===13){var s=zo(r),d=ro(r,s);if(d!==null){var h=ii();vr(d,r,s,h)}pg(r,s)}};j0=function(){return At};F0=function(r,s){var d=At;try{return At=r,s()}finally{At=d}};BE=function(r,s,d){switch(s){case"input":if(LE(r,d),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<d.length;s++){var h=d[s];if(h!==r&&h.form===r.form){var E=gh(h);if(!E)throw Error(de(90));_0(h),LE(h,E)}}}break;case"textarea":S0(r,d);break;case"select":s=d.value,s!=null&&ja(r,!!d.multiple,s,!1)}};A0=cg;w0=Ls;var n3={usingClientEntryPoint:!1,Events:[Dd,Pa,gh,I0,C0,cg]},qc={findFiberByHostInstance:Cs,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},i3={bundleType:qc.bundleType,version:qc.version,rendererPackageName:qc.rendererPackageName,rendererConfig:qc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:so.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=b0(r),r===null?null:r.stateNode},findFiberByHostInstance:qc.findFiberByHostInstance||e3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ou=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ou.isDisabled&&Ou.supportsFiber)try{fh=Ou.inject(i3),Vr=Ou}catch{}}ji.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=n3;ji.createPortal=function(r,s){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!mg(s))throw Error(de(200));return ZB(r,s,null,d)};ji.createRoot=function(r,s){if(!mg(r))throw Error(de(299));var d=!1,h="",E=db;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(h=s.identifierPrefix),s.onRecoverableError!==void 0&&(E=s.onRecoverableError)),s=hg(r,1,!1,null,null,d,!1,h,E),r[io]=s.current,gd(r.nodeType===8?r.parentNode:r),new fg(s)};ji.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(de(188)):(r=Object.keys(r).join(","),Error(de(268,r)));return r=b0(s),r=r===null?null:r.stateNode,r};ji.flushSync=function(r){return Ls(r)};ji.hydrate=function(r,s,d){if(!wh(s))throw Error(de(200));return Oh(null,r,s,!0,d)};ji.hydrateRoot=function(r,s,d){if(!mg(r))throw Error(de(405));var h=d!=null&&d.hydratedSources||null,E=!1,S="",y=db;if(d!=null&&(d.unstable_strictMode===!0&&(E=!0),d.identifierPrefix!==void 0&&(S=d.identifierPrefix),d.onRecoverableError!==void 0&&(y=d.onRecoverableError)),s=cb(s,null,r,1,d??null,E,!1,S,y),r[io]=s.current,gd(r),h)for(r=0;r<h.length;r++)d=h[r],E=d._getVersion,E=E(d._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[d,E]:s.mutableSourceEagerHydrationData.push(d,E);return new Ah(s)};ji.render=function(r,s,d){if(!wh(s))throw Error(de(200));return Oh(null,r,s,!1,d)};ji.unmountComponentAtNode=function(r){if(!wh(r))throw Error(de(40));return r._reactRootContainer?(Ls(function(){Oh(null,null,r,!1,function(){r._reactRootContainer=null,r[io]=null})}),!0):!1};ji.unstable_batchedUpdates=cg;ji.unstable_renderSubtreeIntoContainer=function(r,s,d,h){if(!wh(d))throw Error(de(200));if(r==null||r._reactInternals===void 0)throw Error(de(38));return Oh(r,s,d,!1,h)};ji.version="18.2.0-next-9e3b772b8-20220608";function lb(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(lb)}catch(r){console.error(r)}}lb(),c0.exports=ji;var r3=c0.exports,JO=r3;wE.createRoot=JO.createRoot,wE.hydrateRoot=JO.hydrateRoot;var ub={exports:{}};(function(r,s){(function(d,h){r.exports=h()})(eE,function(){function d(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in e)){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(e)}var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof eE<"u"?eE:typeof self<"u"?self:{},E=function(e){try{return!!e()}catch{return!0}},S=!E(function(){var e=function(){}.bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=S,D=Function.prototype,P=D.bind,V=D.call,X=y&&P.bind(V,V),W=y?function(e){return e&&X(e)}:function(e){return e&&function(){return V.apply(e,arguments)}},B=W({}.isPrototypeOf),fe=function(e){return e&&e.Math==Math&&e},Y=fe(typeof globalThis=="object"&&globalThis)||fe(typeof window=="object"&&window)||fe(typeof self=="object"&&self)||fe(typeof h=="object"&&h)||function(){return this}()||Function("return this")(),q=S,ce=Function.prototype,M=ce.apply,L=ce.call,j=typeof Reflect=="object"&&Reflect.apply||(q?L.bind(M):function(){return L.apply(M,arguments)}),z=function(e){return typeof e=="function"},ae={},ie=!E(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Ee=S,Ce=Function.prototype.call,nt=Ee?Ce.bind(Ce):function(){return Ce.apply(Ce,arguments)},Ze={},si={}.propertyIsEnumerable,ao=Object.getOwnPropertyDescriptor,Zo=ao&&!si.call({1:2},1);Ze.f=Zo?function(e){var t=ao(this,e);return!!t&&t.enumerable}:si;var rr,xs,or=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Vs=W,ye=Vs({}.toString),He=Vs("".slice),Ge=function(e){return He(ye(e),8,-1)},Yt=W,sn=E,js=Ge,sr=Y.Object,tc=Yt("".split),ar=sn(function(){return!sr("z").propertyIsEnumerable(0)})?function(e){return js(e)=="String"?tc(e,""):sr(e)}:sr,Fs=Y.TypeError,kd=function(e){if(e==null)throw Fs("Can't call method on "+e);return e},fb=ar,mb=kd,co=function(e){return fb(mb(e))},Eb=z,Bi=function(e){return typeof e=="object"?e!==null:Eb(e)},lo={},Nh=lo,bh=Y,_b=z,Eg=function(e){return _b(e)?e:void 0},Rr=function(e,t){return arguments.length<2?Eg(Nh[e])||Eg(bh[e]):Nh[e]&&Nh[e][t]||bh[e]&&bh[e][t]},es=Rr("navigator","userAgent")||"",_g=Y,Dh=es,gg=_g.process,Sg=_g.Deno,vg=gg&&gg.versions||Sg&&Sg.version,Tg=vg&&vg.v8;Tg&&(xs=(rr=Tg.split("."))[0]>0&&rr[0]<4?1:+(rr[0]+rr[1])),!xs&&Dh&&(!(rr=Dh.match(/Edge\/(\d+)/))||rr[1]>=74)&&(rr=Dh.match(/Chrome\/(\d+)/))&&(xs=+rr[1]);var Bs=xs,Rg=Bs,gb=E,Ph=!!Object.getOwnPropertySymbols&&!gb(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Rg&&Rg<41}),yg=Ph&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Sb=Rr,vb=z,Tb=B,Rb=yg,yb=Y.Object,kh=Rb?function(e){return typeof e=="symbol"}:function(e){var t=Sb("Symbol");return vb(t)&&Tb(t.prototype,yb(e))},Ib=Y.String,Ld=function(e){try{return Ib(e)}catch{return"Object"}},Cb=z,Ab=Ld,wb=Y.TypeError,Fr=function(e){if(Cb(e))return e;throw wb(Ab(e)+" is not a function")},Ob=Fr,Lh=function(e,t){var n=e[t];return n==null?void 0:Ob(n)},Mh=nt,Uh=z,xh=Bi,Nb=Y.TypeError,Md={exports:{}},Ig=Y,bb=Object.defineProperty,Db=function(e,t){try{bb(Ig,e,{value:t,configurable:!0,writable:!0})}catch{Ig[e]=t}return t},Cg="__core-js_shared__",Vh=Y[Cg]||Db(Cg,{}),Ag=Vh;(Md.exports=function(e,t){return Ag[e]||(Ag[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var Pb=kd,kb=Y.Object,uo=function(e){return kb(Pb(e))},Lb=uo,Mb=W({}.hasOwnProperty),Zn=Object.hasOwn||function(e,t){return Mb(Lb(e),t)},Ub=W,xb=0,Vb=Math.random(),jb=Ub(1 .toString),jh=function(e){return"Symbol("+(e===void 0?"":e)+")_"+jb(++xb+Vb,36)},Fb=Y,Bb=Md.exports,wg=Zn,Gb=jh,Og=Ph,Ng=yg,nc=Bb("wks"),ts=Fb.Symbol,bg=ts&&ts.for,Wb=Ng?ts:ts&&ts.withoutSetter||Gb,an=function(e){if(!wg(nc,e)||!Og&&typeof nc[e]!="string"){var t="Symbol."+e;Og&&wg(ts,e)?nc[e]=ts[e]:nc[e]=Ng&&bg?bg(t):Wb(t)}return nc[e]},Hb=nt,Dg=Bi,Pg=kh,Kb=Lh,zb=function(e,t){var n,i;if(t==="string"&&Uh(n=e.toString)&&!xh(i=Mh(n,e))||Uh(n=e.valueOf)&&!xh(i=Mh(n,e))||t!=="string"&&Uh(n=e.toString)&&!xh(i=Mh(n,e)))return i;throw Nb("Can't convert object to primitive value")},Yb=an,qb=Y.TypeError,Jb=Yb("toPrimitive"),Xb=function(e,t){if(!Dg(e)||Pg(e))return e;var n,i=Kb(e,Jb);if(i){if(t===void 0&&(t="default"),n=Hb(i,e,t),!Dg(n)||Pg(n))return n;throw qb("Can't convert object to primitive value")}return t===void 0&&(t="number"),zb(e,t)},Qb=kh,Ud=function(e){var t=Xb(e,"string");return Qb(t)?t:t+""},kg=Bi,Fh=Y.document,$b=kg(Fh)&&kg(Fh.createElement),Bh=function(e){return $b?Fh.createElement(e):{}},Zb=Bh,Lg=!ie&&!E(function(){return Object.defineProperty(Zb("div"),"a",{get:function(){return 7}}).a!=7}),eD=ie,tD=nt,nD=Ze,iD=or,rD=co,oD=Ud,sD=Zn,aD=Lg,Mg=Object.getOwnPropertyDescriptor;ae.f=eD?Mg:function(e,t){if(e=rD(e),t=oD(t),aD)try{return Mg(e,t)}catch{}if(sD(e,t))return iD(!tD(nD.f,e,t),e[t])};var cD=E,dD=z,lD=/#|\.prototype\./,ic=function(e,t){var n=hD[uD(e)];return n==fD||n!=pD&&(dD(t)?cD(t):!!t)},uD=ic.normalize=function(e){return String(e).replace(lD,".").toLowerCase()},hD=ic.data={},pD=ic.NATIVE="N",fD=ic.POLYFILL="P",Ug=ic,mD=Fr,ED=S,_D=W(W.bind),rc=function(e,t){return mD(e),t===void 0?e:ED?_D(e,t):function(){return e.apply(t,arguments)}},cr={},xg=ie&&E(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Vg=Y,gD=Bi,SD=Vg.String,vD=Vg.TypeError,dr=function(e){if(gD(e))return e;throw vD(SD(e)+" is not an object")},TD=ie,RD=Lg,yD=xg,xd=dr,jg=Ud,ID=Y.TypeError,Gh=Object.defineProperty,CD=Object.getOwnPropertyDescriptor,AD="enumerable",wD="configurable",OD="writable";cr.f=TD?yD?function(e,t,n){if(xd(e),t=jg(t),xd(n),typeof e=="function"&&t==="prototype"&&"value"in n&&OD in n&&!n.writable){var i=CD(e,t);i&&i.writable&&(e[t]=n.value,n={configurable:wD in n?n.configurable:i.configurable,enumerable:AD in n?n.enumerable:i.enumerable,writable:!1})}return Gh(e,t,n)}:Gh:function(e,t,n){if(xd(e),t=jg(t),xd(n),RD)try{return Gh(e,t,n)}catch{}if("get"in n||"set"in n)throw ID("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var ND=cr,bD=or,ns=ie?function(e,t,n){return ND.f(e,t,bD(1,n))}:function(e,t,n){return e[t]=n,e},Vd=Y,DD=j,PD=W,kD=z,LD=ae.f,MD=Ug,Gs=lo,UD=rc,Ws=ns,Fg=Zn,xD=function(e){var t=function(n,i,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,o)}return DD(e,this,arguments)};return t.prototype=e.prototype,t},Dn=function(e,t){var n,i,o,a,c,l,u,p,f=e.target,m=e.global,v=e.stat,R=e.proto,w=m?Vd:v?Vd[f]:(Vd[f]||{}).prototype,A=m?Gs:Gs[f]||Ws(Gs,f,{})[f],O=A.prototype;for(o in t)n=!MD(m?o:f+(v?".":"#")+o,e.forced)&&w&&Fg(w,o),c=A[o],n&&(l=e.noTargetGet?(p=LD(w,o))&&p.value:w[o]),a=n&&l?l:t[o],n&&typeof c==typeof a||(u=e.bind&&n?UD(a,Vd):e.wrap&&n?xD(a):R&&kD(a)?PD(a):a,(e.sham||a&&a.sham||c&&c.sham)&&Ws(u,"sham",!0),Ws(A,o,u),R&&(Fg(Gs,i=f+"Prototype")||Ws(Gs,i,{}),Ws(Gs[i],o,a),e.real&&O&&!O[o]&&Ws(O,o,a)))},VD=Math.ceil,jD=Math.floor,Wh=function(e){var t=+e;return t!=t||t===0?0:(t>0?jD:VD)(t)},FD=Wh,BD=Math.min,GD=function(e){return e>0?BD(FD(e),9007199254740991):0},ho=function(e){return GD(e.length)},WD=Fr,HD=uo,KD=ar,zD=ho,YD=Y.TypeError,Bg=function(e){return function(t,n,i,o){WD(n);var a=HD(t),c=KD(a),l=zD(a),u=e?l-1:0,p=e?-1:1;if(i<2)for(;;){if(u in c){o=c[u],u+=p;break}if(u+=p,e?u<0:l<=u)throw YD("Reduce of empty array with no initial value")}for(;e?u>=0:l>u;u+=p)u in c&&(o=n(o,c[u],u,a));return o}},qD={left:Bg(!1),right:Bg(!0)},JD=E,Hh=function(e,t){var n=[][e];return!!n&&JD(function(){n.call(null,t||function(){throw 1},1)})},jd=Ge(Y.process)=="process",XD=qD.left,Gg=Bs,QD=jd;Dn({target:"Array",proto:!0,forced:!Hh("reduce")||!QD&&Gg>79&&Gg<83},{reduce:function(e){var t=arguments.length;return XD(this,e,t,t>1?arguments[1]:void 0)}});var $D=lo,po=function(e){return $D[e+"Prototype"]},ZD=po("Array").reduce,eP=B,tP=ZD,Kh=Array.prototype,Wg=function(e){var t=e.reduce;return e===Kh||eP(Kh,e)&&t===Kh.reduce?tP:t},fo=Wg;let Hg=!0,Kg=!0;function Fd(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function is(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,o=i.addEventListener;i.addEventListener=function(c,l){if(c!==t)return o.apply(this,arguments);const u=p=>{const f=n(p);f&&(l.handleEvent?l.handleEvent(f):l(f))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,u),o.apply(this,[c,u])};const a=i.removeEventListener;i.removeEventListener=function(c,l){if(c!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(l))return a.apply(this,arguments);const u=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[c,u])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function nP(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Hg=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function iP(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Kg=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function zg(){if(typeof window=="object"){if(Hg)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function zh(e,t){Kg&&console.warn(e+" is deprecated, please use "+t+" instead.")}function rP(e){const t={browser:null,version:null};if(e===void 0||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Fd(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Fd(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Fd(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function Yg(e){return Object.prototype.toString.call(e)==="[object Object]"}function qg(e){var t;return Yg(e)?fo(t=Object.keys(e)).call(t,function(n,i){const o=Yg(e[i]),a=o?qg(e[i]):e[i],c=o&&!Object.keys(a).length;return a===void 0||c?n:Object.assign(n,{[i]:a})},{}):e}function Jg(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const a=[];return e.forEach(c=>{c.type==="track"&&c.trackIdentifier===t.id&&a.push(c)}),a.forEach(c=>{e.forEach(l=>{l.type===i&&l.trackId===c.id&&function u(p,f,m){f&&!m.has(f.id)&&(m.set(f.id,f),Object.keys(f).forEach(v=>{v.endsWith("Id")?u(p,p.get(f[v]),m):v.endsWith("Ids")&&f[v].forEach(R=>{u(p,p.get(R),m)})}))}(e,l,o)})}),o}var oP=Md.exports,sP=jh,Xg=oP("keys"),Bd=function(e){return Xg[e]||(Xg[e]=sP(e))},aP=!E(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),cP=Y,dP=Zn,lP=z,uP=uo,hP=aP,Qg=Bd("IE_PROTO"),Yh=cP.Object,pP=Yh.prototype,qh=hP?Yh.getPrototypeOf:function(e){var t=uP(e);if(dP(t,Qg))return t[Qg];var n=t.constructor;return lP(n)&&t instanceof n?n.prototype:t instanceof Yh?pP:null},$g=Y,fP=z,mP=$g.String,EP=$g.TypeError,_P=W,gP=dr,SP=function(e){if(typeof e=="object"||fP(e))return e;throw EP("Can't set "+mP(e)+" as a prototype")},vP=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=_P(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch{}return function(i,o){return gP(i),SP(o),t?e(i,o):i.__proto__=o,i}}():void 0),Gd={},TP=Wh,RP=Math.max,yP=Math.min,Jh=function(e,t){var n=TP(e);return n<0?RP(n+t,0):yP(n,t)},IP=co,CP=Jh,AP=ho,Zg=function(e){return function(t,n,i){var o,a=IP(t),c=AP(a),l=CP(i,c);if(e&&n!=n){for(;c>l;)if((o=a[l++])!=o)return!0}else for(;c>l;l++)if((e||l in a)&&a[l]===n)return e||l||0;return!e&&-1}},wP={includes:Zg(!0),indexOf:Zg(!1)},Wd={},Xh=Zn,OP=co,NP=wP.indexOf,bP=Wd,eS=W([].push),tS=function(e,t){var n,i=OP(e),o=0,a=[];for(n in i)!Xh(bP,n)&&Xh(i,n)&&eS(a,n);for(;t.length>o;)Xh(i,n=t[o++])&&(~NP(a,n)||eS(a,n));return a},Qh=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],DP=tS,PP=Qh.concat("length","prototype");Gd.f=Object.getOwnPropertyNames||function(e){return DP(e,PP)};var $h={};$h.f=Object.getOwnPropertySymbols;var kP=Rr,LP=Gd,MP=$h,UP=dr,xP=W([].concat),VP=kP("Reflect","ownKeys")||function(e){var t=LP.f(UP(e)),n=MP.f;return n?xP(t,n(e)):t},nS=Zn,jP=VP,FP=ae,BP=cr,Zh={},GP=tS,WP=Qh,ep=Object.keys||function(e){return GP(e,WP)},HP=ie,KP=xg,zP=cr,YP=dr,qP=co,JP=ep;Zh.f=HP&&!KP?Object.defineProperties:function(e,t){YP(e);for(var n,i=qP(t),o=JP(t),a=o.length,c=0;a>c;)zP.f(e,n=o[c++],i[n]);return e};var Hd,iS=Rr("document","documentElement"),XP=dr,QP=Zh,rS=Qh,$P=Wd,ZP=iS,ek=Bh,oS=Bd("IE_PROTO"),tp=function(){},sS=function(e){return"<script>"+e+"<\/script>"},aS=function(e){e.write(sS("")),e.close();var t=e.parentWindow.Object;return e=null,t},Kd=function(){try{Hd=new ActiveXObject("htmlfile")}catch{}var e,t;Kd=typeof document<"u"?document.domain&&Hd?aS(Hd):((t=ek("iframe")).style.display="none",ZP.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write(sS("document.F=Object")),e.close(),e.F):aS(Hd);for(var n=rS.length;n--;)delete Kd.prototype[rS[n]];return Kd()};$P[oS]=!0;var zd=Object.create||function(e,t){var n;return e!==null?(tp.prototype=XP(e),n=new tp,tp.prototype=null,n[oS]=e):n=Kd(),t===void 0?n:QP.f(n,t)},tk=W("".replace),nk=String(Error("zxcasd").stack),cS=/\n\s*at [^:]*:[^\n]*/,ik=cS.test(nk),rk=Bi,ok=ns,Hs={},sk=Hs,ak=an("iterator"),ck=Array.prototype,dS={};dS[an("toStringTag")]="z";var np=String(dS)==="[object z]",dk=Y,lk=np,uk=z,Yd=Ge,hk=an("toStringTag"),pk=dk.Object,fk=Yd(function(){return arguments}())=="Arguments",mo=lk?Yd:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,a){try{return o[a]}catch{}}(t=pk(e),hk))=="string"?n:fk?Yd(t):(i=Yd(t))=="Object"&&uk(t.callee)?"Arguments":i},mk=mo,lS=Lh,Ek=Hs,_k=an("iterator"),uS=function(e){if(e!=null)return lS(e,_k)||lS(e,"@@iterator")||Ek[mk(e)]},gk=nt,Sk=Fr,vk=dr,Tk=Ld,Rk=uS,yk=Y.TypeError,Ik=nt,hS=dr,Ck=Lh,Ak=rc,wk=nt,Ok=dr,Nk=Ld,bk=function(e){return e!==void 0&&(sk.Array===e||ck[ak]===e)},Dk=ho,pS=B,Pk=function(e,t){var n=arguments.length<2?Rk(e):t;if(Sk(n))return vk(gk(n,e));throw yk(Tk(e)+" is not iterable")},kk=uS,fS=function(e,t,n){var i,o;hS(e);try{if(!(i=Ck(e,"return"))){if(t==="throw")throw n;return n}i=Ik(i,e)}catch(a){o=!0,i=a}if(t==="throw")throw n;if(o)throw i;return hS(i),n},Lk=Y.TypeError,qd=function(e,t){this.stopped=e,this.result=t},mS=qd.prototype,Jd=function(e,t,n){var i,o,a,c,l,u,p,f=n&&n.that,m=!(!n||!n.AS_ENTRIES),v=!(!n||!n.IS_ITERATOR),R=!(!n||!n.INTERRUPTED),w=Ak(t,f),A=function(U){return i&&fS(i,"normal",U),new qd(!0,U)},O=function(U){return m?(Ok(U),R?w(U[0],U[1],A):w(U[0],U[1])):R?w(U,A):w(U)};if(v)i=e;else{if(!(o=kk(e)))throw Lk(Nk(e)+" is not iterable");if(bk(o)){for(a=0,c=Dk(e);c>a;a++)if((l=O(e[a]))&&pS(mS,l))return l;return new qd(!1)}i=Pk(e,o)}for(u=i.next;!(p=wk(u,i)).done;){try{l=O(p.value)}catch(U){fS(i,"throw",U)}if(typeof l=="object"&&l&&pS(mS,l))return l}return new qd(!1)},Mk=mo,Uk=Y.String,Ks=function(e){if(Mk(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Uk(e)},xk=Ks,Vk=or,jk=!E(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Vk(1,7)),e.stack!==7)}),Fk=Dn,Bk=Y,Gk=B,Wk=qh,Xd=vP,Hk=function(e,t,n){for(var i=jP(t),o=BP.f,a=FP.f,c=0;c<i.length;c++){var l=i[c];nS(e,l)||n&&nS(n,l)||o(e,l,a(t,l))}},ES=zd,Qd=ns,ip=or,Kk=function(e,t){if(ik&&typeof e=="string")for(;t--;)e=tk(e,cS,"");return e},zk=function(e,t){rk(t)&&"cause"in t&&ok(e,"cause",t.cause)},Yk=Jd,qk=function(e,t){return e===void 0?arguments.length<2?"":t:xk(e)},Jk=jk,Xk=an("toStringTag"),$d=Bk.Error,Qk=[].push,oc=function(e,t){var n,i=arguments.length>2?arguments[2]:void 0,o=Gk(rp,this);Xd?n=Xd(new $d,o?Wk(this):rp):(n=o?this:ES(rp),Qd(n,Xk,"Error")),t!==void 0&&Qd(n,"message",qk(t)),Jk&&Qd(n,"stack",Kk(n.stack,1)),zk(n,i);var a=[];return Yk(e,Qk,{that:a}),Qd(n,"errors",a),n};Xd?Xd(oc,$d):Hk(oc,$d,{name:!0});var rp=oc.prototype=ES($d.prototype,{constructor:ip(1,oc),message:ip(1,""),name:ip(1,"AggregateError")});Fk({global:!0},{AggregateError:oc});var $k=z,op=Vh,Zk=W(Function.toString);$k(op.inspectSource)||(op.inspectSource=function(e){return Zk(e)});var Zd,sc,el,sp=op.inspectSource,eL=z,tL=sp,_S=Y.WeakMap,nL=eL(_S)&&/native code/.test(tL(_S)),gS=Y,ap=W,iL=Bi,rL=ns,cp=Zn,dp=Vh,oL=Bd,sL=Wd,SS="Object already initialized",lp=gS.TypeError,aL=gS.WeakMap;if(nL||dp.state){var rs=dp.state||(dp.state=new aL),cL=ap(rs.get),vS=ap(rs.has),dL=ap(rs.set);Zd=function(e,t){if(vS(rs,e))throw new lp(SS);return t.facade=e,dL(rs,e,t),t},sc=function(e){return cL(rs,e)||{}},el=function(e){return vS(rs,e)}}else{var zs=oL("state");sL[zs]=!0,Zd=function(e,t){if(cp(e,zs))throw new lp(SS);return t.facade=e,rL(e,zs,t),t},sc=function(e){return cp(e,zs)?e[zs]:{}},el=function(e){return cp(e,zs)}}var os,TS,RS,tl={set:Zd,get:sc,has:el,enforce:function(e){return el(e)?sc(e):Zd(e,{})},getterFor:function(e){return function(t){var n;if(!iL(t)||(n=sc(t)).type!==e)throw lp("Incompatible receiver, "+e+" required");return n}}},up=ie,lL=Zn,yS=Function.prototype,uL=up&&Object.getOwnPropertyDescriptor,hp=lL(yS,"name"),IS={EXISTS:hp,PROPER:hp&&function(){}.name==="something",CONFIGURABLE:hp&&(!up||up&&uL(yS,"name").configurable)},hL=ns,nl=function(e,t,n,i){i&&i.enumerable?e[t]=n:hL(e,t,n)},pL=E,fL=z,mL=zd,CS=qh,EL=nl,pp=an("iterator"),AS=!1;[].keys&&("next"in(RS=[].keys())?(TS=CS(CS(RS)))!==Object.prototype&&(os=TS):AS=!0);var _L=os==null||pL(function(){var e={};return os[pp].call(e)!==e});fL((os=_L?{}:mL(os))[pp])||EL(os,pp,function(){return this});var wS={IteratorPrototype:os,BUGGY_SAFARI_ITERATORS:AS},gL=mo,SL=np?{}.toString:function(){return"[object "+gL(this)+"]"},vL=np,TL=cr.f,RL=ns,yL=Zn,IL=SL,OS=an("toStringTag"),ac=function(e,t,n,i){if(e){var o=n?e:e.prototype;yL(o,OS)||TL(o,OS,{configurable:!0,value:t}),i&&!vL&&RL(o,"toString",IL)}},CL=wS.IteratorPrototype,AL=zd,wL=or,OL=ac,NL=Hs,bL=function(){return this},DL=Dn,PL=nt,kL=function(e,t,n,i){var o=t+" Iterator";return e.prototype=AL(CL,{next:wL(+!i,n)}),OL(e,o,!1,!0),NL[o]=bL,e},LL=qh,ML=ac,NS=nl,bS=Hs,UL=IS.PROPER,il=wS.BUGGY_SAFARI_ITERATORS,fp=an("iterator"),DS="keys",rl="values",PS="entries",xL=function(){return this},kS=function(e,t,n,i,o,a,c){kL(n,t,i);var l,u,p,f=function(U){if(U===o&&A)return A;if(!il&&U in R)return R[U];switch(U){case DS:case rl:case PS:return function(){return new n(this,U)}}return function(){return new n(this)}},m=t+" Iterator",v=!1,R=e.prototype,w=R[fp]||R["@@iterator"]||o&&R[o],A=!il&&w||f(o),O=t=="Array"&&R.entries||w;if(O&&(l=LL(O.call(new e)))!==Object.prototype&&l.next&&(ML(l,m,!0,!0),bS[m]=xL),UL&&o==rl&&w&&w.name!==rl&&(v=!0,A=function(){return PL(w,this)}),o)if(u={values:f(rl),keys:a?A:f(DS),entries:f(PS)},c)for(p in u)(il||v||!(p in R))&&NS(R,p,u[p]);else DL({target:t,proto:!0,forced:il||v},u);return c&&R[fp]!==A&&NS(R,fp,A,{name:o}),bS[t]=A,u},VL=co,LS=Hs,MS=tl;cr.f;var jL=kS,US="Array Iterator",FL=MS.set,BL=MS.getterFor(US);jL(Array,"Array",function(e,t){FL(this,{type:US,target:VL(e),index:0,kind:t})},function(){var e=BL(this),t=e.target,n=e.kind,i=e.index++;return!t||i>=t.length?(e.target=void 0,{value:void 0,done:!0}):n=="keys"?{value:i,done:!1}:n=="values"?{value:t[i],done:!1}:{value:[i,t[i]],done:!1}},"values"),LS.Arguments=LS.Array;var xS=Y.Promise,GL=nl,WL=Rr,HL=cr,KL=ie,VS=an("species"),zL=B,YL=Y.TypeError,jS=an("iterator"),FS=!1;try{var qL=0,BS={next:function(){return{done:!!qL++}},return:function(){FS=!0}};BS[jS]=function(){return this},Array.from(BS,function(){throw 2})}catch{}var JL=W,XL=E,GS=z,QL=mo,$L=sp,WS=function(){},ZL=[],HS=Rr("Reflect","construct"),mp=/^\s*(?:class|function)\b/,e1=JL(mp.exec),t1=!mp.exec(WS),cc=function(e){if(!GS(e))return!1;try{return HS(WS,ZL,e),!0}catch{return!1}},KS=function(e){if(!GS(e))return!1;switch(QL(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return t1||!!e1(mp,$L(e))}catch{return!0}};KS.sham=!0;var dc,Ys,zS,Ep,_p=!HS||XL(function(){var e;return cc(cc.call)||!cc(Object)||!cc(function(){e=!0})||e})?KS:cc,n1=_p,i1=Ld,r1=Y.TypeError,YS=dr,o1=function(e){if(n1(e))return e;throw r1(i1(e)+" is not a constructor")},s1=an("species"),qS=function(e,t){var n,i=YS(e).constructor;return i===void 0||(n=YS(i)[s1])==null?t:o1(n)},gp=W([].slice),JS=/(?:ipad|iphone|ipod).*applewebkit/i.test(es),Ri=Y,a1=j,c1=rc,XS=z,d1=Zn,l1=E,QS=iS,u1=gp,$S=Bh,h1=JS,p1=jd,Sp=Ri.setImmediate,vp=Ri.clearImmediate,f1=Ri.process,Tp=Ri.Dispatch,m1=Ri.Function,ZS=Ri.MessageChannel,E1=Ri.String,Rp=0,lc={},_1="onreadystatechange";try{dc=Ri.location}catch{}var yp=function(e){if(d1(lc,e)){var t=lc[e];delete lc[e],t()}},Ip=function(e){return function(){yp(e)}},ev=function(e){yp(e.data)},tv=function(e){Ri.postMessage(E1(e),dc.protocol+"//"+dc.host)};Sp&&vp||(Sp=function(e){var t=u1(arguments,1);return lc[++Rp]=function(){a1(XS(e)?e:m1(e),void 0,t)},Ys(Rp),Rp},vp=function(e){delete lc[e]},p1?Ys=function(e){f1.nextTick(Ip(e))}:Tp&&Tp.now?Ys=function(e){Tp.now(Ip(e))}:ZS&&!h1?(Ep=(zS=new ZS).port2,zS.port1.onmessage=ev,Ys=c1(Ep.postMessage,Ep)):Ri.addEventListener&&XS(Ri.postMessage)&&!Ri.importScripts&&dc&&dc.protocol!=="file:"&&!l1(tv)?(Ys=tv,Ri.addEventListener("message",ev,!1)):Ys=_1 in $S("script")?function(e){QS.appendChild($S("script")).onreadystatechange=function(){QS.removeChild(this),yp(e)}}:function(e){setTimeout(Ip(e),0)});var uc,ss,hc,qs,Cp,Ap,wp,nv,iv={set:Sp,clear:vp},g1=Y,S1=/ipad|iphone|ipod/i.test(es)&&g1.Pebble!==void 0,v1=/web0s(?!.*chrome)/i.test(es),as=Y,rv=rc,T1=ae.f,Op=iv.set,R1=JS,y1=S1,I1=v1,Np=jd,ov=as.MutationObserver||as.WebKitMutationObserver,sv=as.document,av=as.process,ol=as.Promise,cv=T1(as,"queueMicrotask"),dv=cv&&cv.value;dv||(uc=function(){var e,t;for(Np&&(e=av.domain)&&e.exit();ss;){t=ss.fn,ss=ss.next;try{t()}catch(n){throw ss?qs():hc=void 0,n}}hc=void 0,e&&e.enter()},R1||Np||I1||!ov||!sv?!y1&&ol&&ol.resolve?((wp=ol.resolve(void 0)).constructor=ol,nv=rv(wp.then,wp),qs=function(){nv(uc)}):Np?qs=function(){av.nextTick(uc)}:(Op=rv(Op,as),qs=function(){Op(uc)}):(Cp=!0,Ap=sv.createTextNode(""),new ov(uc).observe(Ap,{characterData:!0}),qs=function(){Ap.data=Cp=!Cp}));var C1=dv||function(e){var t={fn:e,next:void 0};hc&&(hc.next=t),ss||(ss=t,qs()),hc=t},Js={},lv=Fr,A1=function(e){var t,n;this.promise=new e(function(i,o){if(t!==void 0||n!==void 0)throw TypeError("Bad Promise constructor");t=i,n=o}),this.resolve=lv(t),this.reject=lv(n)};Js.f=function(e){return new A1(e)};var w1=dr,O1=Bi,N1=Js,uv=function(e,t){if(w1(e),O1(t)&&t.constructor===e)return t;var n=N1.f(e);return(0,n.resolve)(t),n.promise},b1=Y,sl=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},hv=function(){this.head=null,this.tail=null};hv.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var bp,pv,Dp,D1=typeof window=="object",al=Dn,Br=Y,P1=Rr,Eo=nt,Pp=xS,k1=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:GL(e,i,t[i],n);return e},L1=ac,M1=function(e){var t=WL(e),n=HL.f;KL&&t&&!t[VS]&&n(t,VS,{configurable:!0,get:function(){return this}})},kp=Fr,cl=z,U1=Bi,x1=function(e,t){if(zL(t,e))return e;throw YL("Incorrect invocation")},V1=sp,fv=Jd,j1=function(e,t){if(!t&&!FS)return!1;var n=!1;try{var i={};i[jS]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},F1=qS,mv=iv.set,Lp=C1,B1=uv,G1=function(e,t){var n=b1.console;n&&n.error&&(arguments.length==1?n.error(e):n.error(e,t))},Ev=Js,Mp=sl,W1=hv,Up=tl,H1=Ug,K1=D1,dl=jd,_v=Bs,z1=an("species"),yr="Promise",gv=Up.getterFor(yr),Y1=Up.set,q1=Up.getterFor(yr),J1=Pp&&Pp.prototype,Ir=Pp,ll=J1,Sv=Br.TypeError,xp=Br.document,Vp=Br.process,Xs=Ev.f,X1=Xs,Q1=!!(xp&&xp.createEvent&&Br.dispatchEvent),vv=cl(Br.PromiseRejectionEvent),Tv="unhandledrejection",ul=H1(yr,function(){var e=V1(Ir),t=e!==String(Ir);if(!t&&_v===66||!ll.finally)return!0;if(_v>=51&&/native code/.test(e))return!1;var n=new Ir(function(o){o(1)}),i=function(o){o(function(){},function(){})};return(n.constructor={})[z1]=i,!(n.then(function(){})instanceof i)||!t&&K1&&!vv}),$1=ul||!j1(function(e){Ir.all(e).catch(function(){})}),Rv=function(e){var t;return!(!U1(e)||!cl(t=e.then))&&t},yv=function(e,t){var n,i,o,a=t.value,c=t.state==1,l=c?e.ok:e.fail,u=e.resolve,p=e.reject,f=e.domain;try{l?(c||(t.rejection===2&&eM(t),t.rejection=1),l===!0?n=a:(f&&f.enter(),n=l(a),f&&(f.exit(),o=!0)),n===e.promise?p(Sv("Promise-chain cycle")):(i=Rv(n))?Eo(i,n,u,p):u(n)):p(a)}catch(m){f&&!o&&f.exit(),p(m)}},Iv=function(e,t){e.notified||(e.notified=!0,Lp(function(){for(var n,i=e.reactions;n=i.get();)yv(n,e);e.notified=!1,t&&!e.rejection&&Z1(e)}))},Cv=function(e,t,n){var i,o;Q1?((i=xp.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Br.dispatchEvent(i)):i={promise:t,reason:n},!vv&&(o=Br["on"+e])?o(i):e===Tv&&G1("Unhandled promise rejection",n)},Z1=function(e){Eo(mv,Br,function(){var t,n=e.facade,i=e.value;if(Av(e)&&(t=Mp(function(){dl?Vp.emit("unhandledRejection",i,n):Cv(Tv,n,i)}),e.rejection=dl||Av(e)?2:1,t.error))throw t.value})},Av=function(e){return e.rejection!==1&&!e.parent},eM=function(e){Eo(mv,Br,function(){var t=e.facade;dl?Vp.emit("rejectionHandled",t):Cv("rejectionhandled",t,e.value)})},Qs=function(e,t,n){return function(i){e(t,i,n)}},$s=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Iv(e,!0))},jp=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Sv("Promise can't be resolved itself");var i=Rv(t);i?Lp(function(){var o={done:!1};try{Eo(i,t,Qs(jp,o,e),Qs($s,o,e))}catch(a){$s(o,a,e)}}):(e.value=t,e.state=1,Iv(e,!1))}catch(o){$s({done:!1},o,e)}}};ul&&(ll=(Ir=function(e){x1(this,ll),kp(e),Eo(bp,this);var t=gv(this);try{e(Qs(jp,t),Qs($s,t))}catch(n){$s(t,n)}}).prototype,(bp=function(e){Y1(this,{type:yr,done:!1,notified:!1,parent:!1,reactions:new W1,rejection:!1,state:0,value:void 0})}).prototype=k1(ll,{then:function(e,t){var n=q1(this),i=Xs(F1(this,Ir));return n.parent=!0,i.ok=!cl(e)||e,i.fail=cl(t)&&t,i.domain=dl?Vp.domain:void 0,n.state==0?n.reactions.add(i):Lp(function(){yv(i,n)}),i.promise},catch:function(e){return this.then(void 0,e)}}),pv=function(){var e=new bp,t=gv(e);this.promise=e,this.resolve=Qs(jp,t),this.reject=Qs($s,t)},Ev.f=Xs=function(e){return e===Ir||e===Dp?new pv(e):X1(e)}),al({global:!0,wrap:!0,forced:ul},{Promise:Ir}),L1(Ir,yr,!1,!0),M1(yr),Dp=P1(yr),al({target:yr,stat:!0,forced:ul},{reject:function(e){var t=Xs(this);return Eo(t.reject,void 0,e),t.promise}}),al({target:yr,stat:!0,forced:!0},{resolve:function(e){return B1(this===Dp?Ir:this,e)}}),al({target:yr,stat:!0,forced:$1},{all:function(e){var t=this,n=Xs(t),i=n.resolve,o=n.reject,a=Mp(function(){var c=kp(t.resolve),l=[],u=0,p=1;fv(e,function(f){var m=u++,v=!1;p++,Eo(c,t,f).then(function(R){v||(v=!0,l[m]=R,--p||i(l))},o)}),--p||i(l)});return a.error&&o(a.value),n.promise},race:function(e){var t=this,n=Xs(t),i=n.reject,o=Mp(function(){var a=kp(t.resolve);fv(e,function(c){Eo(a,t,c).then(n.resolve,i)})});return o.error&&i(o.value),n.promise}});var tM=nt,nM=Fr,iM=Js,rM=sl,oM=Jd;Dn({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=iM.f(t),i=n.resolve,o=n.reject,a=rM(function(){var c=nM(t.resolve),l=[],u=0,p=1;oM(e,function(f){var m=u++,v=!1;p++,tM(c,t,f).then(function(R){v||(v=!0,l[m]={status:"fulfilled",value:R},--p||i(l))},function(R){v||(v=!0,l[m]={status:"rejected",reason:R},--p||i(l))})}),--p||i(l)});return a.error&&o(a.value),n.promise}});var sM=Fr,aM=Rr,cM=nt,dM=Js,lM=sl,uM=Jd,wv="No one promise resolved";Dn({target:"Promise",stat:!0},{any:function(e){var t=this,n=aM("AggregateError"),i=dM.f(t),o=i.resolve,a=i.reject,c=lM(function(){var l=sM(t.resolve),u=[],p=0,f=1,m=!1;uM(e,function(v){var R=p++,w=!1;f++,cM(l,t,v).then(function(A){w||m||(m=!0,o(A))},function(A){w||m||(w=!0,u[R]=A,--f||a(new n(u,wv)))})}),--f||a(new n(u,wv))});return c.error&&a(c.value),i.promise}});var Ov=xS,hM=Rr,pM=z,fM=qS,Nv=uv;Dn({target:"Promise",proto:!0,real:!0,forced:!!Ov&&E(function(){Ov.prototype.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=fM(this,hM("Promise")),n=pM(e);return this.then(n?function(i){return Nv(t,e()).then(function(){return i})}:e,n?function(i){return Nv(t,e()).then(function(){throw i})}:e)}});var Fp=W,mM=Wh,EM=Ks,_M=kd,gM=Fp("".charAt),bv=Fp("".charCodeAt),SM=Fp("".slice),Dv=function(e){return function(t,n){var i,o,a=EM(_M(t)),c=mM(n),l=a.length;return c<0||c>=l?e?"":void 0:(i=bv(a,c))<55296||i>56319||c+1===l||(o=bv(a,c+1))<56320||o>57343?e?gM(a,c):i:e?SM(a,c,c+2):o-56320+(i-55296<<10)+65536}},vM={codeAt:Dv(!1),charAt:Dv(!0)}.charAt,TM=Ks,Pv=tl,RM=kS,kv="String Iterator",yM=Pv.set,IM=Pv.getterFor(kv);RM(String,"String",function(e){yM(this,{type:kv,string:TM(e),index:0})},function(){var e,t=IM(this),n=t.string,i=t.index;return i>=n.length?{value:void 0,done:!0}:(e=vM(n,i),t.index+=e.length,{value:e,done:!1})});var CM=lo.Promise,AM={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},wM=Y,OM=mo,NM=ns,Lv=Hs,Mv=an("toStringTag");for(var Bp in AM){var Uv=wM[Bp],Gp=Uv&&Uv.prototype;Gp&&OM(Gp)!==Mv&&NM(Gp,Mv,Bp),Lv[Bp]=Lv.Array}var xv=CM,re=xv;const Vv=zg;function jv(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const p=typeof c[u]=="object"?c[u]:{ideal:c[u]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const f=function(m,v){return m?m+v.charAt(0).toUpperCase()+v.slice(1):v==="deviceId"?"sourceId":v};if(p.ideal!==void 0){l.optional=l.optional||[];let m={};typeof p.ideal=="number"?(m[f("min",u)]=p.ideal,l.optional.push(m),m={},m[f("max",u)]=p.ideal,l.optional.push(m)):(m[f("",u)]=p.ideal,l.optional.push(m))}p.exact!==void 0&&typeof p.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[f("",u)]=p.exact):["min","max"].forEach(m=>{p[m]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[f(m,u)]=p[m])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},o=function(c,l){if(t.version>=61)return l(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const u=function(p,f,m){f in p&&!(m in p)&&(p[m]=p[f],delete p[f])};u((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const p=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let f;if(delete c.video.facingMode,u.exact==="environment"||u.ideal==="environment"?f=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(m=>{let v=(m=m.filter(R=>R.kind==="videoinput")).find(R=>f.some(w=>R.label.toLowerCase().includes(w)));return!v&&m.length&&f.includes("back")&&(v=m[m.length-1]),v&&(c.video.deviceId=u.exact?{exact:v.deviceId}:{ideal:v.deviceId}),c.video=i(c.video),Vv("chrome: "+JSON.stringify(c)),l(c)})}c.video=i(c.video)}return Vv("chrome: "+JSON.stringify(c)),l(c)},a=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(c,l,u){o(c,p=>{n.webkitGetUserMedia(p,l,f=>{u&&u(a(f))})})}.bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return o(l,u=>c(u).then(p=>{if(u.audio&&!p.getAudioTracks().length||u.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return p},p=>re.reject(a(p))))}}}function Fv(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Bv(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.track.id):{track:i.track};const a=new Event("track");a.track=i.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(i=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(c=>c.track&&c.track.id===i.id):{track:i};const a=new Event("track");a.track=i,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else is(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Gv(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=o.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,l){let u=o.apply(this,arguments);return u||(u=t(this,c),this._senders.push(u)),u};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){a.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],i.apply(this,[o]),o.getTracks().forEach(a=>{const c=this._senders.find(l=>l.track===a);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Wv(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const a=function(l){const u={};return l.result().forEach(p=>{const f={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach(m=>{f[m]=p.stat(m)}),u[f.id]=f}),u},c=function(l){return new Map(Object.keys(l).map(u=>[u,l[u]]))};if(arguments.length>=2){const l=function(u){i(c(a(u)))};return t.apply(this,[l,n])}return new re((l,u)=>{t.apply(this,[function(p){l(c(a(p)))},u])}).then(i,o)}}function Hv(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>Jg(a,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),is(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Jg(o,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,o,a;return this.getSenders().forEach(c=>{c.track===n&&(i?a=!0:i=c)}),this.getReceivers().forEach(c=>(c.track===n&&(o?a=!0:o=c),c.track===n)),a||i&&o?re.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():re.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Kv(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(u=>{if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(u=>c.indexOf(u)===-1);this._shimmedLocalStreams[a.id]=[a].concat(l)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],i.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(a);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),o.apply(this,arguments)}}function zv(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Kv(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const p=n.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(f=>this._reverseStreams[f.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(f=>{if(this.getSenders().find(m=>m.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){const f=new e.MediaStream(p.getTracks());this._streams[p.id]=f,this._reverseStreams[f.id]=p,p=f}i.apply(this,[p])};const o=e.RTCPeerConnection.prototype.removeStream;function a(p,f){let m=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(v=>{const R=p._reverseStreams[v],w=p._streams[R.id];m=m.replace(new RegExp(w.id,"g"),R.id)}),new RTCSessionDescription({type:f.type,sdp:m})}function c(p,f){let m=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(v=>{const R=p._reverseStreams[v],w=p._streams[R.id];m=m.replace(new RegExp(R.id,"g"),w.id)}),new RTCSessionDescription({type:f.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},e.RTCPeerConnection.prototype.addTrack=function(p,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(w=>w===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(w=>w.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[f.id];if(R)R.addTrack(p),re.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const w=new e.MediaStream([p]);this._streams[f.id]=w,this._reverseStreams[w.id]=f,this.addStream(w)}return this.getSenders().find(w=>w.track===p)},["createOffer","createAnswer"].forEach(function(p){const f=e.RTCPeerConnection.prototype[p],m={[p](){const v=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[R=>{const w=a(this,R);v[0].apply(null,[w])},R=>{v[1]&&v[1].apply(null,R)},arguments[2]]):f.apply(this,arguments).then(R=>a(this,R))}};e.RTCPeerConnection.prototype[p]=m[p]});const l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=c(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};const u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const p=u.get.apply(this);return p.type===""?p:a(this,p)}}),e.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(v=>p.track===v)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wp(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function Yv(e,t){is(e,"negotiationneeded",n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n})}var qv=Object.freeze({__proto__:null,shimMediaStream:Fv,shimOnTrack:Bv,shimGetSendersWithDtmf:Gv,shimGetStats:Wv,shimSenderReceiverGetStats:Hv,shimAddTrackRemoveTrackWithNative:Kv,shimAddTrackRemoveTrack:zv,shimPeerConnection:Wp,fixNegotiationNeeded:Yv,shimGetUserMedia:jv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(i=>{const o=n.video&&n.video.width,a=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},o&&(n.video.mandatory.maxWidth=o),a&&(n.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function Jv(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,a,c){zh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(a,c)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),o(c.audio,"autoGainControl","mozAutoGainControl"),o(c.audio,"noiseSuppression","mozNoiseSuppression")),a(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const l=c.apply(this,arguments);return o(l,"mozAutoGainControl","autoGainControl"),o(l,"mozNoiseSuppression","noiseSuppression"),l}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),o(l,"autoGainControl","mozAutoGainControl"),o(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function Xv(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Hp(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const a=e.RTCPeerConnection.prototype[o],c={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=c[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,a,c]=arguments;return i.apply(this,[o||null]).then(l=>{if(t.version<53&&!a)try{l.forEach(u=>{u.type=n[u.type]||u.type})}catch(u){if(u.name!=="TypeError")throw u;l.forEach((p,f)=>{l.set(f,Object.assign({},p,{type:n[p.type]||p.type}))})}return l}).then(a,c)}}function Qv(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):re.resolve(new Map)}}function $v(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),is(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Zv(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){zh("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function eT(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function tT(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(i){const{sender:a}=o,c=a.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(c).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function nT(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function iT(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?re.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function rT(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?re.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var oT=Object.freeze({__proto__:null,shimOnTrack:Xv,shimPeerConnection:Hp,shimSenderGetStats:Qv,shimReceiverGetStats:$v,shimRemoveStream:Zv,shimRTCDataChannel:eT,shimAddTransceiver:tT,shimGetParameters:nT,shimCreateOffer:iT,shimCreateAnswer:rT,shimGetUserMedia:Jv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,re.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function sT(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>t.call(this,i,n)),n.getVideoTracks().forEach(i=>t.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return o&&o.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function aT(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,this.dispatchEvent(a)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,n.dispatchEvent(a)})}),t.apply(n,arguments)}}}function cT(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(u,p){const f=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[f]);return p?(m.then(u,p),re.resolve()):m},t.createAnswer=function(u,p){const f=arguments.length>=2?arguments[2]:arguments[0],m=i.apply(this,[f]);return p?(m.then(u,p),re.resolve()):m};let l=function(u,p,f){const m=o.apply(this,[u]);return f?(m.then(p,f),re.resolve()):m};t.setLocalDescription=l,l=function(u,p,f){const m=a.apply(this,[u]);return f?(m.then(p,f),re.resolve()):m},t.setRemoteDescription=l,l=function(u,p,f){const m=c.apply(this,[u]);return f?(m.then(p,f),re.resolve()):m},t.addIceCandidate=l}function dT(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>i(lT(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,i,o){t.mediaDevices.getUserMedia(n).then(i,o)}.bind(t))}function lT(e){return e&&e.video!==void 0?Object.assign({},e,{video:qg(e.video)}):e}function uT(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const o=[];for(let a=0;a<n.iceServers.length;a++){let c=n.iceServers[a];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(zh("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,o.push(c)):o.push(n.iceServers[a])}n.iceServers=o}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function hT(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function pT(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function fT(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var mT=Object.freeze({__proto__:null,shimLocalStreamsAPI:sT,shimRemoteStreamsAPI:aT,shimCallbacksAPI:cT,shimGetUserMedia:dT,shimConstraints:lT,shimRTCIceServerUrls:uT,shimTrackEventTransceiver:hT,shimCreateOfferLegacy:pT,shimAudioContext:fT}),bM=`	
\v\f\r                　\u2028\u2029\uFEFF`,DM=kd,PM=Ks,ET=W("".replace),hl=`[	
\v\f\r                　\u2028\u2029\uFEFF]`,kM=RegExp("^"+hl+hl+"*"),LM=RegExp(hl+hl+"*$"),Kp=function(e){return function(t){var n=PM(DM(t));return 1&e&&(n=ET(n,kM,"")),2&e&&(n=ET(n,LM,"")),n}},MM={start:Kp(1),end:Kp(2),trim:Kp(3)},UM=IS.PROPER,xM=E,_T=bM,VM=MM.trim;Dn({target:"String",proto:!0,forced:function(e){return xM(function(){return!!_T[e]()||"​᠎"[e]()!=="​᠎"||UM&&_T[e].name!==e})}("trim")},{trim:function(){return VM(this)}});var jM=po("String").trim,FM=B,BM=jM,zp=String.prototype,Gr=function(e){var t=e.trim;return typeof e=="string"||e===zp||FM(zp,e)&&t===zp.trim?BM:t},Yp={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return Gr(n).call(n).split(`
`).map(i=>Gr(i).call(i))},t.splitSections=function(n){return n.split(`
m=`).map((i,o)=>{var a;return Gr(a=o>0?"m="+i:i).call(a)+`\r
`})},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter(o=>o.indexOf(i)===0)},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let a=8;a<i.length;a+=2)switch(i[a]){case"raddr":o.relatedAddress=i[a+1];break;case"rport":o.relatedPort=parseInt(i[a+1],10);break;case"tcptype":o.tcpType=i[a+1];break;case"ufrag":o.ufrag=i[a+1],o.usernameFragment=i[a+1];break;default:o[i[a]]===void 0&&(o[i[a]]=i[a+1])}return o},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const o=n.component;o==="rtp"?i.push(1):o==="rtcp"?i.push(2):i.push(o),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const a=n.type;return i.push("typ"),i.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substr(14).split(" ")},t.parseRtpMap=function(n){let i=n.substr(9).split(" ");const o={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),o.name=i[0],o.clockRate=parseInt(i[1],10),o.channels=i.length===3?parseInt(i[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){const i=n.substr(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1]}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},t.parseFmtp=function(n){const i={};let o;const a=n.substr(n.indexOf(" ")+1).split(";");for(let u=0;u<a.length;u++){var c,l;o=Gr(c=a[u]).call(c).split("="),i[Gr(l=o[0]).call(l)]=o[1]}return i},t.writeFmtp=function(n){let i="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?a.push(c+"="+n.parameters[c]):a.push(c)}),i+="a=fmtp:"+o+" "+a.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substr(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{i+="a=rtcp-fb:"+o+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),o={ssrc:parseInt(n.substr(7,i-7),10)},a=n.indexOf(":",i);return a>-1?(o.attribute=n.substr(i+1,a-i-1),o.value=n.substr(a+1)):o.attribute=n.substr(i+1),o},t.parseSsrcGroup=function(n){const i=n.substr(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(o=>parseInt(o,10))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substr(6)},t.parseFingerprint=function(n){const i=n.substr(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let o="a=setup:"+i+`\r
`;return n.fingerprints.forEach(a=>{o+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),o},t.parseCryptoLine=function(n){const i=n.substr(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substr(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const o=t.matchPrefix(n+i,"a=ice-ufrag:")[0],a=t.matchPrefix(n+i,"a=ice-pwd:")[0];return o&&a?{usernameFragment:o.substr(12),password:a.substr(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");for(let a=3;a<o.length;a++){const c=o[a],l=t.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const u=t.parseRtpMap(l),p=t.matchPrefix(n,"a=fmtp:"+c+" ");switch(u.parameters=p.length?t.parseFmtp(p[0]):{},u.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(t.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase())}}}return t.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(t.parseExtmap(a))}),i},t.writeRtpDescription=function(n,i){let o="";o+="m="+n+" ",o+=i.codecs.length>0?"9":"0",o+=" UDP/TLS/RTP/SAVPF ",o+=i.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(c=>{o+=t.writeRtpMap(c),o+=t.writeFmtp(c),o+=t.writeRtcpFb(c)});let a=0;return i.codecs.forEach(c=>{c.maxptime>a&&(a=c.maxptime)}),a>0&&(o+="a=maxptime:"+a+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(c=>{o+=t.writeExtmap(c)}),o},t.parseRtpEncodingParameters=function(n){const i=[],o=t.parseRtpParameters(n),a=o.fecMechanisms.indexOf("RED")!==-1,c=o.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(n,"a=ssrc:").map(v=>t.parseSsrcMedia(v)).filter(v=>v.attribute==="cname"),u=l.length>0&&l[0].ssrc;let p;const f=t.matchPrefix(n,"a=ssrc-group:FID").map(v=>v.substr(17).split(" ").map(R=>parseInt(R,10)));f.length>0&&f[0].length>1&&f[0][0]===u&&(p=f[0][1]),o.codecs.forEach(v=>{if(v.name.toUpperCase()==="RTX"&&v.parameters.apt){let R={ssrc:u,codecPayloadType:parseInt(v.parameters.apt,10)};u&&p&&(R.rtx={ssrc:p}),i.push(R),a&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},i.push(R))}}),i.length===0&&u&&i.push({ssrc:u});let m=t.matchPrefix(n,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substr(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substr(5),10)*.95-16e3:void 0,i.forEach(v=>{v.maxBitrate=m})),i},t.parseRtcpParameters=function(n){const i={},o=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];o&&(i.cname=o.value,i.ssrc=o.ssrc);const a=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=a.length>0,i.compound=a.length===0;const c=t.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const o=t.matchPrefix(n,"a=msid:");if(o.length===1)return i=o[0].substr(7).split(" "),{stream:i[0],track:i[1]};const a=t.matchPrefix(n,"a=ssrc:").map(c=>t.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");return a.length>0?(i=a[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:");let a;o.length>0&&(a=parseInt(o[0].substr(19),10)),isNaN(a)&&(a=65536);const c=t.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substr(12),10),protocol:i.fmt,maxMessageSize:a};const l=t.matchPrefix(n,"a=sctpmap:");if(l.length>0){const u=l[0].substr(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:a}}},t.writeSctpDescription=function(n,i){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&o.push("a=max-message-size:"+i.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(n,i,o){let a;const c=i!==void 0?i:2;return a=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+a+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const o=t.splitLines(n);for(let a=0;a<o.length;a++)switch(o[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[a].substr(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substr(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let o=0;o<i.length;o++)if(i[o].length<2||i[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(Yp);var Zs=Yp.exports,GM=Object.freeze(d({__proto__:null,default:Zs},[Yp.exports]));function pl(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),o=Zs.parseCandidate(n.candidate),a=Object.assign(i,o);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,is(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function qp(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||is(e,"icecandidate",t=>{if(t.candidate){const n=Zs.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function fl(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const u=Zs.splitSections(l.sdp);return u.shift(),u.some(p=>{const f=Zs.parseMLine(p);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},i=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const p=parseInt(u[1],10);return p!=p?-1:p},o=function(l){let u=65536;return t.browser==="firefox"&&(u=t.version<57?l===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),u},a=function(l,u){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const f=Zs.matchPrefix(l.sdp,"a=max-message-size:");return f.length>0?p=parseInt(f[0].substr(19),10):t.browser==="firefox"&&u!==-1&&(p=2147483637),p},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),u=o(l),p=a(arguments[0],l);let f;f=u===0&&p===0?Number.POSITIVE_INFINITY:u===0||p===0?Math.max(u,p):Math.min(u,p);const m={};Object.defineProperty(m,"maxMessageSize",{get:()=>f}),this._sctp=m}return c.apply(this,arguments)}}function ml(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,o){const a=i.send;i.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(i.readyState==="open"&&o.sctp&&l>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return a.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},is(e,"datachannel",i=>(t(i.channel,i.target),i))}function Jp(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const a=o.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const c=new Event("connectionstatechange",o);a.dispatchEvent(c)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Xp(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(a=>Gr(a).call(a)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function El(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?re.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),re.resolve())})}function _l(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var WM=Object.freeze({__proto__:null,shimRTCIceCandidate:pl,shimRTCIceCandidateRelayProtocol:qp,shimMaxMessageSize:fl,shimSendThrowTypeError:ml,shimConnectionState:Jp,removeExtmapAllowMixed:Xp,shimAddIceCandidateNullOrEmpty:El,shimParameterlessSetLocalDescription:_l});let gn,qe;(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=zg,i=rP(e),o={browserDetails:i,commonShim:WM,extractVersion:Fd,disableLog:nP,disableWarnings:iP,sdp:GM};switch(i.browser){case"chrome":if(!qv||!Wp||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=qv,El(e,i),_l(e),jv(e,i),Fv(e),Wp(e,i),Bv(e),zv(e,i),Gv(e),Wv(e),Hv(e),Yv(e,i),pl(e),qp(e),Jp(e),fl(e,i),ml(e),Xp(e,i);break;case"firefox":if(!oT||!Hp||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=oT,El(e,i),_l(e),Jv(e,i),Hp(e,i),Xv(e),Zv(e),Qv(e),$v(e),eT(e),tT(e),nT(e),iT(e),rT(e),pl(e),Jp(e),fl(e,i),ml(e);break;case"safari":if(!mT||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=mT,El(e,i),_l(e),uT(e),pT(e),cT(e),sT(e),aT(e),hT(e),dT(e),fT(e),pl(e),qp(e),fl(e,i),ml(e),Xp(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(gn||(gn={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(qe||(qe={}));var Qp={exports:{}};(function(e,t){(function(n,i){var o="function",a="undefined",c="object",l="string",u="major",p="model",f="name",m="type",v="vendor",R="version",w="architecture",A="console",O="mobile",U="tablet",x="smarttv",Q="wearable",pe="embedded",Z="Amazon",ee="Apple",J="ASUS",se="BlackBerry",tt="Firefox",Ae="Google",lt="Huawei",it="LG",wt="Microsoft",nn="Motorola",Ct="Opera",Yn="Samsung",F="Sharp",K="Sony",ne="Xiaomi",ve="Zebra",je="Facebook",$="Chromium OS",g="Mac OS",C=function(St){for(var kt={},rt=0;rt<St.length;rt++)kt[St[rt].toUpperCase()]=St[rt];return kt},b=function(St,kt){return typeof St===l&&G(kt).indexOf(G(St))!==-1},G=function(St){return St.toLowerCase()},Te=function(St,kt){if(typeof St===l)return St=St.replace(/^\s\s*/,""),typeof kt===a?St:St.substring(0,350)},st=function(St,kt){for(var rt,xn,Lr,vt,Ve,qn,Po=0;Po<kt.length&&!Ve;){var fr=kt[Po],Fw=kt[Po+1];for(rt=xn=0;rt<fr.length&&!Ve&&fr[rt];)if(Ve=fr[rt++].exec(St))for(Lr=0;Lr<Fw.length;Lr++)qn=Ve[++xn],typeof(vt=Fw[Lr])===c&&vt.length>0?vt.length===2?typeof vt[1]==o?this[vt[0]]=vt[1].call(this,qn):this[vt[0]]=vt[1]:vt.length===3?typeof vt[1]!==o||vt[1].exec&&vt[1].test?this[vt[0]]=qn?qn.replace(vt[1],vt[2]):i:this[vt[0]]=qn?vt[1].call(this,qn,vt[2]):i:vt.length===4&&(this[vt[0]]=qn?vt[3].call(this,qn.replace(vt[1],vt[2])):i):this[vt]=qn||i;Po+=2}},rn=function(St,kt){for(var rt in kt)if(typeof kt[rt]===c&&kt[rt].length>0){for(var xn=0;xn<kt[rt].length;xn++)if(b(kt[rt][xn],St))return rt==="?"?i:rt}else if(b(kt[rt],St))return rt==="?"?i:rt;return St},Qi={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},bo={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[R,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[R,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,R],[/opios[\/ ]+([\w\.]+)/i],[R,[f,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[R,[f,Ct]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[f,R],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[R,[f,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[R,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[R,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[R,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[R,[f,"IE"]],[/yabrowser\/([\w\.]+)/i],[R,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure Browser"],R],[/\bfocus\/([\w\.]+)/i],[R,[f,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[R,[f,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[R,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[R,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[R,[f,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[R,[f,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[R,[f,tt]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 Browser"],R],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],R],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,R],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,je],R],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,R],[/\bgsa\/([\w\.]+) .*safari\//i],[R,[f,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[R,[f,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,"Chrome WebView"],R],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[R,[f,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,R],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[R,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[R,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[R,rn,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,R],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],R],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[R,[f,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,R],[/(cobalt)\/([\w\.]+)/i],[f,[R,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[w,"amd64"]],[/(ia32(?=;))/i],[[w,G]],[/((?:i[346]|x)86)[;\)]/i],[[w,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[w,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[w,"armhf"]],[/windows (ce|mobile); ppc;/i],[[w,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[w,/ower/,"",G]],[/(sun4\w)[;\)]/i],[[w,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[w,G]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[v,Yn],[m,U]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[v,Yn],[m,O]],[/\((ip(?:hone|od)[\w ]*);/i],[p,[v,ee],[m,O]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[v,ee],[m,U]],[/(macintosh);/i],[p,[v,ee]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[v,F],[m,O]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[v,lt],[m,U]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[v,lt],[m,O]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[v,ne],[m,O]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[v,ne],[m,U]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[v,"OPPO"],[m,O]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[v,"Vivo"],[m,O]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[v,"Realme"],[m,O]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[v,nn],[m,O]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[v,nn],[m,U]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[v,it],[m,U]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[v,it],[m,O]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[v,"Lenovo"],[m,U]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[v,"Nokia"],[m,O]],[/(pixel c)\b/i],[p,[v,Ae],[m,U]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[v,Ae],[m,O]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[v,K],[m,O]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[v,K],[m,U]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[v,"OnePlus"],[m,O]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[v,Z],[m,U]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[v,Z],[m,O]],[/(playbook);[-\w\),; ]+(rim)/i],[p,v,[m,U]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[v,se],[m,O]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[v,J],[m,U]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[v,J],[m,O]],[/(nexus 9)/i],[p,[v,"HTC"],[m,U]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[v,[p,/_/g," "],[m,O]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[v,"Acer"],[m,U]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[v,"Meizu"],[m,O]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[v,p,[m,O]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[v,p,[m,U]],[/(surface duo)/i],[p,[v,wt],[m,U]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[v,"Fairphone"],[m,O]],[/(u304aa)/i],[p,[v,"AT&T"],[m,O]],[/\bsie-(\w*)/i],[p,[v,"Siemens"],[m,O]],[/\b(rct\w+) b/i],[p,[v,"RCA"],[m,U]],[/\b(venue[\d ]{2,7}) b/i],[p,[v,"Dell"],[m,U]],[/\b(q(?:mv|ta)\w+) b/i],[p,[v,"Verizon"],[m,U]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[v,"Barnes & Noble"],[m,U]],[/\b(tm\d{3}\w+) b/i],[p,[v,"NuVision"],[m,U]],[/\b(k88) b/i],[p,[v,"ZTE"],[m,U]],[/\b(nx\d{3}j) b/i],[p,[v,"ZTE"],[m,O]],[/\b(gen\d{3}) b.+49h/i],[p,[v,"Swiss"],[m,O]],[/\b(zur\d{3}) b/i],[p,[v,"Swiss"],[m,U]],[/\b((zeki)?tb.*\b) b/i],[p,[v,"Zeki"],[m,U]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[v,"Dragon Touch"],p,[m,U]],[/\b(ns-?\w{0,9}) b/i],[p,[v,"Insignia"],[m,U]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[v,"NextBook"],[m,U]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[v,"Voice"],p,[m,O]],[/\b(lvtel\-)?(v1[12]) b/i],[[v,"LvTel"],p,[m,O]],[/\b(ph-1) /i],[p,[v,"Essential"],[m,O]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[v,"Envizen"],[m,U]],[/\b(trio[-\w\. ]+) b/i],[p,[v,"MachSpeed"],[m,U]],[/\btu_(1491) b/i],[p,[v,"Rotor"],[m,U]],[/(shield[\w ]+) b/i],[p,[v,"Nvidia"],[m,U]],[/(sprint) (\w+)/i],[v,p,[m,O]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[v,wt],[m,O]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[v,ve],[m,U]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[v,ve],[m,O]],[/smart-tv.+(samsung)/i],[v,[m,x]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[v,Yn],[m,x]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[v,it],[m,x]],[/(apple) ?tv/i],[v,[p,"Apple TV"],[m,x]],[/crkey/i],[[p,"Chromecast"],[v,Ae],[m,x]],[/droid.+aft(\w)( bui|\))/i],[p,[v,Z],[m,x]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[v,F],[m,x]],[/(bravia[\w ]+)( bui|\))/i],[p,[v,K],[m,x]],[/(mitv-\w{5}) bui/i],[p,[v,ne],[m,x]],[/Hbbtv.*(technisat) (.*);/i],[v,p,[m,x]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[v,Te],[p,Te],[m,x]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,x]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[v,p,[m,A]],[/droid.+; (shield) bui/i],[p,[v,"Nvidia"],[m,A]],[/(playstation [345portablevi]+)/i],[p,[v,K],[m,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[v,wt],[m,A]],[/((pebble))app/i],[v,p,[m,Q]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[v,ee],[m,Q]],[/droid.+; (glass) \d/i],[p,[v,Ae],[m,Q]],[/droid.+; (wt63?0{2,3})\)/i],[p,[v,ve],[m,Q]],[/(quest( 2| pro)?)/i],[p,[v,je],[m,Q]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[v,[m,pe]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[m,O]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[m,U]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,U]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,O]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[v,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[R,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[R,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[f,R],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[R,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,R],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[R,rn,Qi]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[R,rn,Qi]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[R,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,g],[R,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[R,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,R],[/\(bb(10);/i],[R,[f,se]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[R,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[R,[f,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[R,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[R,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[R,[f,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,$],R],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,R],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],R],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[f,R]]},Li=function(St,kt){if(typeof St===c&&(kt=St,St=i),!(this instanceof Li))return new Li(St,kt).getResult();var rt=typeof n!==a&&n.navigator?n.navigator:i,xn=St||(rt&&rt.userAgent?rt.userAgent:""),Lr=rt&&rt.userAgentData?rt.userAgentData:i,vt=kt?function(Ve,qn){var Po={};for(var fr in Ve)qn[fr]&&qn[fr].length%2==0?Po[fr]=qn[fr].concat(Ve[fr]):Po[fr]=Ve[fr];return Po}(bo,kt):bo;return this.getBrowser=function(){var Ve={};return Ve.name=i,Ve.version=i,st.call(Ve,xn,vt.browser),Ve.major=function(qn){return typeof qn===l?qn.replace(/[^\d\.]/g,"").split(".")[0]:i}(Ve.version),rt&&rt.brave&&typeof rt.brave.isBrave==o&&(Ve.name="Brave"),Ve},this.getCPU=function(){var Ve={};return Ve.architecture=i,st.call(Ve,xn,vt.cpu),Ve},this.getDevice=function(){var Ve={};return Ve.vendor=i,Ve.model=i,Ve.type=i,st.call(Ve,xn,vt.device),!Ve.type&&Lr&&Lr.mobile&&(Ve.type=O),Ve.model=="Macintosh"&&rt&&typeof rt.standalone!==a&&rt.maxTouchPoints&&rt.maxTouchPoints>2&&(Ve.model="iPad",Ve.type=U),Ve},this.getEngine=function(){var Ve={};return Ve.name=i,Ve.version=i,st.call(Ve,xn,vt.engine),Ve},this.getOS=function(){var Ve={};return Ve.name=i,Ve.version=i,st.call(Ve,xn,vt.os),!Ve.name&&Lr&&Lr.platform!="Unknown"&&(Ve.name=Lr.platform.replace(/chrome os/i,$).replace(/macos/i,g)),Ve},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return xn},this.setUA=function(Ve){return xn=typeof Ve===l&&Ve.length>350?Te(Ve,350):Ve,this},this.setUA(xn),this};Li.VERSION="0.7.34",Li.BROWSER=C([f,R,u]),Li.CPU=C([w]),Li.DEVICE=C([p,v,m,A,O,x,U,Q,pe]),Li.ENGINE=Li.OS=C([f,R]),e.exports&&(t=e.exports=Li),t.UAParser=Li;var Do=typeof n!==a&&(n.jQuery||n.Zepto);if(Do&&!Do.ua){var Ca=new Li;Do.ua=Ca.getResult(),Do.ua.get=function(){return Ca.getUA()},Do.ua.set=function(St){Ca.setUA(St);var kt=Ca.getResult();for(var rt in kt)Do.ua[rt]=kt[rt]}}})(typeof window=="object"?window:h)})(Qp,Qp.exports);const $p=new Qp.exports;let Gi,Wr=$p.getResult();function Xe(e){return e&&$p.setUA(e),Wr=$p.getResult(),{name:HM(Wr),version:KM(Wr),os:zM(Wr),osVersion:Wr.os.version}}function HM(e){if(e.engine.name==="Blink"&&e.browser.name!=="WeChat")return qe.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return qe.CHROME;case"Safari":case"Mobile Safari":return qe.SAFARI;case"Edge":return qe.EDGE;case"Firefox":return qe.FIREFOX;case"QQBrowser":return qe.QQ;case"Opera":return qe.OPERA;case"WeChat":return qe.WECHAT;default:return e.browser.name||""}}function KM(e){let t;return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",t.split(".")[0]}function zM(e){switch(e.os.name){case"Windows":return e.os.version?e.os.name+" "+e.os.version:e.os.name;default:return e.os.name||""}}function gl(){const e=Xe();return!!(Wr.engine.name==="WebKit"&&e.os===gn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==qe.SAFARI||In()&&e.name!==qe.SAFARI)}function YM(){const e=Xe();if(gl()){if(e.os===gn.MAC_OS)return!0;if(e.os===gn.IOS){const t=Wr.os.version&&Wr.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function qM(){return Wr.engine.name==="WebKit"}function Zp(){return Xe().name===qe.CHROME}function yn(){return Xe().name===qe.SAFARI}function Tt(){return Xe().name===qe.FIREFOX}function In(){return Xe().os===gn.IOS}function ef(e){const t=Xe();return!(t.name!==qe.CHROME||!t.osVersion)&&Number(t.version)>=e}function gT(e){const t=Xe();return!(t.name!==qe.EDGE||!t.osVersion)&&Number(t.version)>=e}function ST(e){const t=Xe();return!(t.name!==qe.OPERA||!t.osVersion)&&Number(t.version)>=e}function vT(){const e=Xe();return!(e.name!==qe.CHROME||!e.osVersion)&&Number(e.version)<=90}function TT(){const e=Xe();if(e.os!==gn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function ea(){const e=Xe();if(e.os!==gn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function RT(){const e=Xe();if(e.os!==gn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])===0}function yT(){const e=Xe();if(e.os!==gn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function tf(){const e=Xe();if(e.os!==gn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=2}function Cr(){return yn()&&navigator.maxTouchPoints>0}function IT(){return Xe().name===qe.WECHAT}function CT(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function cs(){const e=Xe();return e.name===qe.EDGE||e.name===qe.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function nf(){return Xe().os===gn.ANDROID}function pc(){const e=Xe();return e.os==="Android"&&(e.name==="Chrome"||e.name===qe.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"})(Gi||(Gi={}));var AT={exports:{}},JM=Dn,XM=ie,wT=cr.f;JM({target:"Object",stat:!0,forced:Object.defineProperty!==wT,sham:!XM},{defineProperty:wT});var OT=lo.Object,QM=AT.exports=function(e,t,n){return OT.defineProperty(e,t,n)};OT.defineProperty.sham&&(QM.sham=!0);var NT=AT.exports;function _(e,t,n){return t in e?NT(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var rf,of={exports:{}},bT=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}},$M=bT,sf=Object.prototype.toString,af=(rf=Object.create(null),function(e){var t=sf.call(e);return rf[t]||(rf[t]=t.slice(8,-1).toLowerCase())});function ds(e){return e=e.toLowerCase(),function(t){return af(t)===e}}function cf(e){return Array.isArray(e)}function Sl(e){return e===void 0}var DT=ds("ArrayBuffer");function PT(e){return e!==null&&typeof e=="object"}function vl(e){if(af(e)!=="object")return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}var ZM=ds("Date"),eU=ds("File"),tU=ds("Blob"),nU=ds("FileList");function df(e){return sf.call(e)==="[object Function]"}var iU=ds("URLSearchParams");function lf(e,t){if(e!=null)if(typeof e!="object"&&(e=[e]),cf(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var uf,rU=(uf=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(e){return uf&&e instanceof uf}),Pn={isArray:cf,isArrayBuffer:DT,isBuffer:function(e){return e!==null&&!Sl(e)&&e.constructor!==null&&!Sl(e.constructor)&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||sf.call(e)===t||df(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&DT(e.buffer)},isString:function(e){return typeof e=="string"},isNumber:function(e){return typeof e=="number"},isObject:PT,isPlainObject:vl,isUndefined:Sl,isDate:ZM,isFile:eU,isBlob:tU,isFunction:df,isStream:function(e){return PT(e)&&df(e.pipe)},isURLSearchParams:iU,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:lf,merge:function e(){var t={};function n(a,c){vl(t[c])&&vl(a)?t[c]=e(t[c],a):vl(a)?t[c]=e({},a):cf(a)?t[c]=a.slice():t[c]=a}for(var i=0,o=arguments.length;i<o;i++)lf(arguments[i],n);return t},extend:function(e,t,n){return lf(t,function(i,o){e[o]=n&&typeof i=="function"?$M(i,n):i}),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e},inherits:function(e,t,n,i){e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var i,o,a,c={};t=t||{};do{for(o=(i=Object.getOwnPropertyNames(e)).length;o-- >0;)c[a=i[o]]||(t[a]=e[a],c[a]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:af,kindOfTest:ds,endsWith:function(e,t,n){e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;var i=e.indexOf(t,n);return i!==-1&&i===n},toArray:function(e){if(!e)return null;var t=e.length;if(Sl(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:rU,isFileList:nU},ta=Pn;function kT(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var LT=function(e,t,n){if(!t)return e;var i;if(n)i=n(t);else if(ta.isURLSearchParams(t))i=t.toString();else{var o=[];ta.forEach(t,function(c,l){c!=null&&(ta.isArray(c)?l+="[]":c=[c],ta.forEach(c,function(u){ta.isDate(u)?u=u.toISOString():ta.isObject(u)&&(u=JSON.stringify(u)),o.push(kT(l)+"="+kT(u))}))}),i=o.join("&")}if(i){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},oU=Pn;function Tl(){this.handlers=[]}Tl.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},Tl.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},Tl.prototype.forEach=function(e){oU.forEach(this.handlers,function(t){t!==null&&e(t)})};var sU=Tl,aU=Pn,MT=Pn;function na(e,t,n,i,o){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),o&&(this.response=o)}MT.inherits(na,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var UT=na.prototype,xT={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){xT[e]={value:e}}),Object.defineProperties(na,xT),Object.defineProperty(UT,"isAxiosError",{value:!0}),na.from=function(e,t,n,i,o,a){var c=Object.create(UT);return MT.toFlatObject(e,c,function(l){return l!==Error.prototype}),na.call(c,e.message,t,n,i,o),c.name=e.name,a&&Object.assign(c,a),c};var ia=na,VT={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},lr=Pn,jT=function(e,t){t=t||new FormData;var n=[];function i(o){return o===null?"":lr.isDate(o)?o.toISOString():lr.isArrayBuffer(o)||lr.isTypedArray(o)?typeof Blob=="function"?new Blob([o]):Buffer.from(o):o}return function o(a,c){if(lr.isPlainObject(a)||lr.isArray(a)){if(n.indexOf(a)!==-1)throw Error("Circular reference detected in "+c);n.push(a),lr.forEach(a,function(l,u){if(!lr.isUndefined(l)){var p,f=c?c+"."+u:u;if(l&&!c&&typeof l=="object"){if(lr.endsWith(u,"{}"))l=JSON.stringify(l);else if(lr.endsWith(u,"[]")&&(p=lr.toArray(l)))return void p.forEach(function(m){!lr.isUndefined(m)&&t.append(f,i(m))})}o(l,f)}}),n.pop()}else t.append(c,i(a))}(e),t},hf=ia,Rl=Pn,cU=Rl.isStandardBrowserEnv()?{write:function(e,t,n,i,o,a){var c=[];c.push(e+"="+encodeURIComponent(t)),Rl.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),Rl.isString(i)&&c.push("path="+i),Rl.isString(o)&&c.push("domain="+o),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},dU=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},lU=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},FT=function(e,t){return e&&!dU(t)?lU(e,t):t},pf=Pn,uU=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],BT=Pn,hU=BT.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(o){var a=o;return t&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(o){var a=BT.isString(o)?i(o):o;return a.protocol===e.protocol&&a.host===e.host}}():function(){return!0},ff=ia;function GT(e){ff.call(this,e??"canceled",ff.ERR_CANCELED),this.name="CanceledError"}Pn.inherits(GT,ff,{__CANCEL__:!0});var yl=GT,fc=Pn,pU=function(e,t,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new hf("Request failed with status code "+n.status,[hf.ERR_BAD_REQUEST,hf.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)},fU=cU,mU=LT,EU=FT,_U=function(e){var t,n,i,o={};return e&&pf.forEach(e.split(`
`),function(a){if(i=a.indexOf(":"),t=pf.trim(a.substr(0,i)).toLowerCase(),n=pf.trim(a.substr(i+1)),t){if(o[t]&&uU.indexOf(t)>=0)return;o[t]=t==="set-cookie"?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}}),o},gU=hU,SU=VT,Hr=ia,vU=yl,TU=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},RU=function(e){return new Promise(function(t,n){var i,o=e.data,a=e.headers,c=e.responseType;function l(){e.cancelToken&&e.cancelToken.unsubscribe(i),e.signal&&e.signal.removeEventListener("abort",i)}fc.isFormData(o)&&fc.isStandardBrowserEnv()&&delete a["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var p=e.auth.username||"",f=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.Authorization="Basic "+btoa(p+":"+f)}var m=EU(e.baseURL,e.url);function v(){if(u){var A="getAllResponseHeaders"in u?_U(u.getAllResponseHeaders()):null,O={data:c&&c!=="text"&&c!=="json"?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:A,config:e,request:u};pU(function(U){t(U),l()},function(U){n(U),l()},O),u=null}}if(u.open(e.method.toUpperCase(),mU(m,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=v:u.onreadystatechange=function(){u&&u.readyState===4&&(u.status!==0||u.responseURL&&u.responseURL.indexOf("file:")===0)&&setTimeout(v)},u.onabort=function(){u&&(n(new Hr("Request aborted",Hr.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new Hr("Network Error",Hr.ERR_NETWORK,e,u,u)),u=null},u.ontimeout=function(){var A=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",O=e.transitional||SU;e.timeoutErrorMessage&&(A=e.timeoutErrorMessage),n(new Hr(A,O.clarifyTimeoutError?Hr.ETIMEDOUT:Hr.ECONNABORTED,e,u)),u=null},fc.isStandardBrowserEnv()){var R=(e.withCredentials||gU(m))&&e.xsrfCookieName?fU.read(e.xsrfCookieName):void 0;R&&(a[e.xsrfHeaderName]=R)}"setRequestHeader"in u&&fc.forEach(a,function(A,O){o===void 0&&O.toLowerCase()==="content-type"?delete a[O]:u.setRequestHeader(O,A)}),fc.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),c&&c!=="json"&&(u.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&u.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(i=function(A){u&&(n(!A||A&&A.type?new vU:A),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(i),e.signal&&(e.signal.aborted?i():e.signal.addEventListener("abort",i))),o||(o=null);var w=TU(m);w&&["http","https","file"].indexOf(w)===-1?n(new Hr("Unsupported protocol "+w+":",Hr.ERR_BAD_REQUEST,e)):u.send(o)})},Cn=Pn,WT=function(e,t){aU.forEach(e,function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])})},HT=ia,yU=jT,IU={"Content-Type":"application/x-www-form-urlencoded"};function KT(e,t){!Cn.isUndefined(e)&&Cn.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var zT,Il={transitional:VT,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(zT=RU),zT),transformRequest:[function(e,t){if(WT(t,"Accept"),WT(t,"Content-Type"),Cn.isFormData(e)||Cn.isArrayBuffer(e)||Cn.isBuffer(e)||Cn.isStream(e)||Cn.isFile(e)||Cn.isBlob(e))return e;if(Cn.isArrayBufferView(e))return e.buffer;if(Cn.isURLSearchParams(e))return KT(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,i=Cn.isObject(e),o=t&&t["Content-Type"];if((n=Cn.isFileList(e))||i&&o==="multipart/form-data"){var a=this.env&&this.env.FormData;return yU(n?{"files[]":e}:e,a&&new a)}return i||o==="application/json"?(KT(t,"application/json"),function(c,l,u){if(Cn.isString(c))try{return(l||JSON.parse)(c),Cn.trim(c)}catch(p){if(p.name!=="SyntaxError")throw p}return(u||JSON.stringify)(c)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Il.transitional,n=t&&t.silentJSONParsing,i=t&&t.forcedJSONParsing,o=!n&&this.responseType==="json";if(o||i&&Cn.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?HT.from(a,HT.ERR_BAD_RESPONSE,this,null,this.response):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Cn.forEach(["delete","get","head"],function(e){Il.headers[e]={}}),Cn.forEach(["post","put","patch"],function(e){Il.headers[e]=Cn.merge(IU)});var mf=Il,CU=Pn,AU=mf,YT=function(e){return!(!e||!e.__CANCEL__)},qT=Pn,Ef=function(e,t,n){var i=this||AU;return CU.forEach(n,function(o){e=o.call(i,e,t)}),e},wU=YT,OU=mf,NU=yl;function _f(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new NU}var yi=Pn,JT=function(e,t){t=t||{};var n={};function i(p,f){return yi.isPlainObject(p)&&yi.isPlainObject(f)?yi.merge(p,f):yi.isPlainObject(f)?yi.merge({},f):yi.isArray(f)?f.slice():f}function o(p){return yi.isUndefined(t[p])?yi.isUndefined(e[p])?void 0:i(void 0,e[p]):i(e[p],t[p])}function a(p){if(!yi.isUndefined(t[p]))return i(void 0,t[p])}function c(p){return yi.isUndefined(t[p])?yi.isUndefined(e[p])?void 0:i(void 0,e[p]):i(void 0,t[p])}function l(p){return p in t?i(e[p],t[p]):p in e?i(void 0,e[p]):void 0}var u={url:a,method:a,data:a,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:l};return yi.forEach(Object.keys(e).concat(Object.keys(t)),function(p){var f=u[p]||o,m=f(p);yi.isUndefined(m)&&f!==l||(n[p]=m)}),n},XT="0.27.2",bU=XT,_o=ia,gf={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){gf[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});var QT={};gf.transitional=function(e,t,n){function i(o,a){return"[Axios v"+bU+"] Transitional option '"+o+"'"+a+(n?". "+n:"")}return function(o,a,c){if(e===!1)throw new _o(i(a," has been removed"+(t?" in "+t:"")),_o.ERR_DEPRECATED);return t&&!QT[a]&&(QT[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,a,c)}};var $T=Pn,DU=LT,ZT=sU,eR=function(e){return _f(e),e.headers=e.headers||{},e.data=Ef.call(e,e.data,e.headers,e.transformRequest),e.headers=qT.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),qT.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||OU.adapter)(e).then(function(t){return _f(e),t.data=Ef.call(e,t.data,t.headers,e.transformResponse),t},function(t){return wU(t)||(_f(e),t&&t.response&&(t.response.data=Ef.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},Cl=JT,PU=FT,tR={assertOptions:function(e,t,n){if(typeof e!="object")throw new _o("options must be an object",_o.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(e),o=i.length;o-- >0;){var a=i[o],c=t[a];if(c){var l=e[a],u=l===void 0||c(l,a,e);if(u!==!0)throw new _o("option "+a+" must be "+u,_o.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new _o("Unknown option "+a,_o.ERR_BAD_OPTION)}},validators:gf},ra=tR.validators;function oa(e){this.defaults=e,this.interceptors={request:new ZT,response:new ZT}}oa.prototype.request=function(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},(t=Cl(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;n!==void 0&&tR.assertOptions(n,{silentJSONParsing:ra.transitional(ra.boolean),forcedJSONParsing:ra.transitional(ra.boolean),clarifyTimeoutError:ra.transitional(ra.boolean)},!1);var i=[],o=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(t)===!1||(o=o&&m.synchronous,i.unshift(m.fulfilled,m.rejected))});var a,c=[];if(this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)}),!o){var l=[eR,void 0];for(Array.prototype.unshift.apply(l,i),l=l.concat(c),a=Promise.resolve(t);l.length;)a=a.then(l.shift(),l.shift());return a}for(var u=t;i.length;){var p=i.shift(),f=i.shift();try{u=p(u)}catch(m){f(m);break}}try{a=eR(u)}catch(m){return Promise.reject(m)}for(;c.length;)a=a.then(c.shift(),c.shift());return a},oa.prototype.getUri=function(e){e=Cl(this.defaults,e);var t=PU(e.baseURL,e.url);return DU(t,e.params,e.paramsSerializer)},$T.forEach(["delete","get","head","options"],function(e){oa.prototype[e]=function(t,n){return this.request(Cl(n||{},{method:e,url:t,data:(n||{}).data}))}}),$T.forEach(["post","put","patch"],function(e){function t(n){return function(i,o,a){return this.request(Cl(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}oa.prototype[e]=t(),oa.prototype[e+"Form"]=t(!0)});var kU=oa,LU=yl;function sa(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(i){t=i});var n=this;this.promise.then(function(i){if(n._listeners){var o,a=n._listeners.length;for(o=0;o<a;o++)n._listeners[o](i);n._listeners=null}}),this.promise.then=function(i){var o,a=new Promise(function(c){n.subscribe(c),o=c}).then(i);return a.cancel=function(){n.unsubscribe(o)},a},e(function(i){n.reason||(n.reason=new LU(i),t(n.reason))})}sa.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},sa.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},sa.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}},sa.source=function(){var e;return{token:new sa(function(t){e=t}),cancel:e}};var MU=sa,UU=Pn,nR=Pn,xU=bT,Al=kU,VU=JT,ai=function e(t){var n=new Al(t),i=xU(Al.prototype.request,n);return nR.extend(i,Al.prototype,n),nR.extend(i,n),i.create=function(o){return e(VU(t,o))},i}(mf);ai.Axios=Al,ai.CanceledError=yl,ai.CancelToken=MU,ai.isCancel=YT,ai.VERSION=XT,ai.toFormData=jT,ai.AxiosError=ia,ai.Cancel=ai.CanceledError,ai.all=function(e){return Promise.all(e)},ai.spread=function(e){return function(t){return e.apply(null,t)}},ai.isAxiosError=function(e){return UU.isObject(e)&&e.isAxiosError===!0},of.exports=ai,of.exports.default=ai;var Wi=of.exports;class jU{constructor(t){_(this,"logger",void 0),_(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}class Rt{constructor(){_(this,"_events",{}),_(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const i=this._events[t],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(c=>c);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];for(let c=0;c<n.length;c+=1){const l=n[c];l.once&&this.off(t,l.listener),l.listener.apply(this,o||[])}}_indexOfListener(t,n){let i=t.length;for(;i--;)if(t[i].listener===n)return i;return-1}}const wl=new class extends Rt{reportLogUploadError(e){this.emit("REPORT_LOG_UPLOAD",e)}};let I;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION"})(I||(I={}));class N extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),_(this,"code",void 0),_(this,"message",void 0),_(this,"data",void 0),_(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return t==="error"&&T.error(this.toString()),t==="warning"&&T.warning(this.toString()),this}throw(){throw this.print(),this}}const jt={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Sf(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ar(e,t,n,i){const o=Object.assign({},jt,i);let a=o.timeout;const c=async()=>{await function(p){return new re(f=>{window.setTimeout(f,p)})}(a),a*=o.timeoutFactor,a=Math.min(o.maxRetryTimeout,a)};let l=!1;const u=new re(async(p,f)=>{t=t||(()=>!1),n=n||(()=>!0);for(let m=0;m<o.maxRetryCount;m+=1){if(l)return f(new N(I.OPERATION_ABORTED));try{const v=await e();if(!t(v,m)||m+1===o.maxRetryCount)return p(v);await c()}catch(v){if(!n(v,m)||m+1===o.maxRetryCount)return f(v);await c()}}});return u.cancel=()=>l=!0,u}function vf(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function iR(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Ii={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Ol=Date.now(),mc=e=>{for(const t in Ii)if(Object.prototype.hasOwnProperty.call(Ii,t)&&Ii[t]===e)return t;return"DEFAULT"},T=new class{constructor(){_(this,"proxyServerURL",void 0),_(this,"logLevel",Ii.DEBUG),_(this,"uploadState","collecting"),_(this,"uploadLogWaitingList",[]),_(this,"uploadLogUploadingList",[]),_(this,"uploadErrorCount",0),_(this,"currentLogID",0),_(this,"url",void 0),_(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ii.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ii.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ii.WARNING].concat(t);this.log.apply(this,i)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ii.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[Ii.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){et("UPLOAD_LOG",!0)}disableLogUpload(){et("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new jU(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Ol<100)return void setTimeout(()=>{this.log(...t)},Date.now()-Ol);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=vf()+" Agora-SDK [".concat(mc(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const o=vf()+" %cAgora-SDK [".concat(mc(i),"]:");let a=[];if(!k("USE_NEW_LOG"))switch(i){case Ii.DEBUG:a=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case Ii.INFO:a=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case Ii.WARNING:a=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case Ii.ERROR:a=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Ol<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-Ol);const i=Math.max(0,Math.min(4,t[0]));t[0]=vf()+" Agora-SDK [".concat(mc(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!k("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=iR()+" Agora-SDK [".concat(mc(e),"]:"):n[0]=iR()+" Agora-SDK [".concat(mc(e),"]:");let o="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),o+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Ci,process_id:k("PROCESS_ID"),payload:JSON.stringify(e)};return Ar(async()=>{const n=await Wi.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(k("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(k("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}},()=>(this.uploadLogUploadingList=[],!1),n=>(n.response?wl.reportLogUploadError({status:n.response.status,data:n.response.data,headers:n.response.headers,message:n.message}):n.request?wl.reportLogUploadError({status:n.request.status,message:n.message}):wl.reportLogUploadError({status:-1,message:n.message}),!0),{timeout:k("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:k("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,k("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},Tf="v4.17.2-0-gb960eec4-dirty(4/20/2023, 10:39:51 AM)",Ci=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const i=t[1],o=t[2];return"".concat(i,".").concat(o)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],o=n[2];return"".concat(i,".").concat(100*(Number(o)+1))}return"4.0.0.999"}("4.17.2"),Rf=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),rR=["CHINA","GLOBAL"],ci=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),o=[];for(let l=0;l<6;l++)o.push("1");const a=o.join(""),c={};return c[e]=i,c[t]=a,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ci;const FU={"90p":Me(160,90),"90p_1":Me(160,90),"120p":Me(160,120,15,30,65),"120p_1":Me(160,120,15,30,65),"120p_3":Me(120,120,15,30,50),"120p_4":Me(212,120),"180p":Me(320,180,15,30,140),"180p_1":Me(320,180,15,30,140),"180p_3":Me(180,180,15,30,100),"180p_4":Me(240,180,15,30,120),"240p":Me(320,240,15,40,200),"240p_1":Me(320,240,15,40,200),"240p_3":Me(240,240,15,40,140),"240p_4":Me(424,240,15,40,220),"360p":Me(640,360,15,80,400),"360p_1":Me(640,360,15,80,400),"360p_3":Me(360,360,15,80,260),"360p_4":Me(640,360,30,80,600),"360p_6":Me(360,360,30,80,400),"360p_7":Me(480,360,15,80,320),"360p_8":Me(480,360,30,80,490),"360p_9":Me(640,360,15,80,800),"360p_10":Me(640,360,24,80,800),"360p_11":Me(640,360,24,80,1e3),"480p":Me(640,480,15,100,500),"480p_1":Me(640,480,15,100,500),"480p_2":Me(640,480,30,100,1e3),"480p_3":Me(480,480,15,100,400),"480p_4":Me(640,480,30,100,750),"480p_6":Me(480,480,30,100,600),"480p_8":Me(848,480,15,100,610),"480p_9":Me(848,480,30,100,930),"480p_10":Me(640,480,10,100,400),"720p":Me(1280,720,15,120,1130),"720p_1":Me(1280,720,15,120,1130),"720p_2":Me(1280,720,30,120,2e3),"720p_3":Me(1280,720,30,120,1710),"720p_5":Me(960,720,15,120,910),"720p_6":Me(960,720,30,120,1380),"1080p":Me(1920,1080,15,120,2080),"1080p_1":Me(1920,1080,15,120,2080),"1080p_2":Me(1920,1080,30,120,3e3),"1080p_3":Me(1920,1080,30,120,3150),"1080p_5":Me(1920,1080,60,120,4780),"1440p":Me(2560,1440,30,120,4850),"1440p_1":Me(2560,1440,30,120,4850),"1440p_2":Me(2560,1440,60,120,7350),"4k":Me(3840,2160,30,120,8910),"4k_1":Me(3840,2160,30,120,8910),"4k_3":Me(3840,2160,60,120,13500)},BU={"480p":Hi(640,480,5),"480p_1":Hi(640,480,5),"480p_2":Hi(640,480,30),"480p_3":Hi(640,480,15),"720p":Hi(1280,720,5),"720p_1":Hi(1280,720,5),"720p_2":Hi(1280,720,30),"720p_3":Hi(1280,720,15),"1080p":Hi(1920,1080,5),"1080p_1":Hi(1920,1080,5),"1080p_2":Hi(1920,1080,30),"1080p_3":Hi(1920,1080,15)},GU={"1SL1TL":If(1,1),"3SL3TL":If(3,3),"2SL3TL":If(2,3)};function ls(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},FU[e]):e}function yf(e){return typeof e=="string"?Object.assign({},BU[e]):e}function Nl(e){return typeof e=="string"?Object.assign({},GU[e]):e}const WU={speech_low_quality:aa(16e3,!1),speech_standard:aa(32e3,!1,18),music_standard:aa(48e3,!1),standard_stereo:aa(48e3,!0,56),high_quality:aa(48e3,!1,128),high_quality_stereo:aa(48e3,!0,192)};function bl(e){return typeof e=="string"?Object.assign({},WU[e]):e}function et(e,t,n){Object.keys(Bn).includes(e)&&(!n&&Object.keys(us).includes(e)||(Bn[e]=t))}function k(e){return Bn[e]}const Bn={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:rR,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},us={};function aa(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Me(e,t,n,i,o){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:o}}function Hi(e,t,n,i,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:o}}function If(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}Rf||(Bn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Bn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Bn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Bn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Bn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Bn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Bn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Bn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Bn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Bn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Bn.AREAS=["NORTH_AMERICA","OVERSEA"]);const HU=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],hs=[],Ec=[];function ps(e,t){return!!t&&hs.some(n=>n.uid===e&&n.channelName===t)}var KU=Ud,zU=cr,YU=or,Cf=function(e,t,n){var i=KU(t);i in e?zU.f(e,i,YU(0,n)):e[i]=n},oR=Jh,qU=ho,JU=Cf,XU=Y.Array,QU=Math.max,sR=function(e,t,n){for(var i=qU(e),o=oR(t,i),a=oR(n===void 0?i:n,i),c=XU(QU(a-o,0)),l=0;o<a;o++,l++)JU(c,l,e[o]);return c.length=l,c},aR=sR,$U=Math.floor,Af=function(e,t){var n=e.length,i=$U(n/2);return n<8?ZU(e,t):ex(e,Af(aR(e,0,i),t),Af(aR(e,i),t),t)},ZU=function(e,t){for(var n,i,o=e.length,a=1;a<o;){for(i=a,n=e[a];i&&t(e[i-1],n)>0;)e[i]=e[--i];i!==a++&&(e[i]=n)}return e},ex=function(e,t,n,i){for(var o=t.length,a=n.length,c=0,l=0;c<o||l<a;)e[c+l]=c<o&&l<a?i(t[c],n[l])<=0?t[c++]:n[l++]:c<o?t[c++]:n[l++];return e},tx=Af,cR=es.match(/firefox\/(\d+)/i),nx=!!cR&&+cR[1],ix=/MSIE|Trident/.test(es),dR=es.match(/AppleWebKit\/(\d+)\./),rx=!!dR&&+dR[1],ox=Dn,lR=W,sx=Fr,ax=uo,cx=ho,uR=Ks,wf=E,dx=tx,lx=Hh,hR=nx,ux=ix,pR=Bs,fR=rx,go=[],mR=lR(go.sort),hx=lR(go.push),px=wf(function(){go.sort(void 0)}),fx=wf(function(){go.sort(null)}),mx=lx("sort"),ER=!wf(function(){if(pR)return pR<70;if(!(hR&&hR>3)){if(ux)return!0;if(fR)return fR<603;var e,t,n,i,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)go.push({k:t+i,v:n})}for(go.sort(function(a,c){return c.v-a.v}),i=0;i<go.length;i++)t=go[i].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});ox({target:"Array",proto:!0,forced:px||!fx||!mx||!ER},{sort:function(e){e!==void 0&&sx(e);var t=ax(this);if(ER)return e===void 0?mR(t):mR(t,e);var n,i,o=[],a=cx(t);for(i=0;i<a;i++)i in t&&hx(o,t[i]);for(dx(o,function(c){return function(l,u){return u===void 0?-1:l===void 0?1:c!==void 0?+c(l,u)||0:uR(l)>uR(u)?1:-1}}(e)),n=o.length,i=0;i<n;)t[i]=o[i++];for(;i<a;)delete t[i++];return t}});var Ex=po("Array").sort,_x=B,gx=Ex,Of=Array.prototype,Nf=function(e){var t=e.sort;return e===Of||_x(Of,e)&&t===Of.sort?gx:t};function _c(e,t){if(typeof e!="boolean")throw new N(I.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function qt(e,t,n){if(!n.includes(e))throw new N(I.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function dt(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e<n||e>i||o&&!Sx(e))throw new N(I.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function bf(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new N(I.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&dt(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&dt(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&dt(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&dt(e.ideal,"".concat(t,".ideal"),1,1/0)}else dt(e,t,1,1/0)}function cn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new N(I.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!_R(e,n,i,o))throw new N(I.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(o?" ASCII characters only.":""))}function Kr(e,t){if(!Array.isArray(e))throw new N(I.INVALID_PARAMS,"".concat(t," should be an array"))}function Df(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw T.error("Invalid Channel Name ".concat(e)),new N(I.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Pf(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||_R(e,1,255)))throw T.error("Invalid UID ".concat(e," ").concat(typeof e)),new N(I.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&T.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function ut(e){return e==null}function _R(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||vx(e))}function Sx(e){return typeof e=="number"&&e%1==0}function vx(e){if(typeof e!="string")return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}let gR,SR,dn;(function(e){e.FREE="free",e.UPLOADING="uploading"})(gR||(gR={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(SR||(SR={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(dn||(dn={}));const kf={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function Tx(e){return cn(e.reportId,"params.reportId",0,100,!1),cn(e.category,"params.category",0,100,!1),cn(e.event,"params.event",0,100,!1),cn(e.label,"params.label",0,100,!1),dt(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const Rx={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let ln,Et,vR,Lf,Lt,mt,fs,zr,ca,gc,di,un,me,Mf,Ke,Pe,kn,Je,le,ge,Gn,be,TR,Wn;function RR(e){return dt(e.timeout,"config.timeout",0,1e5),dt(e.timeoutFactor,"config.timeoutFactor",0,100,!1),dt(e.maxRetryCount,"config.maxRetryConfig",0,1/0),dt(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function yx(e){return qt(e.codec,"config.codec",["vp8","vp9","av1","h264"]),qt(e.mode,"config.mode",["rtc","live"]),e.audioCodec!==void 0&&qt(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),e.proxyServer!==void 0&&cn(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&yR(e.turnServer),e.httpRetryConfig!==void 0&&RR(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&RR(e.websocketRetryConfig),!0}function Sc(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function yR(e){return cn(e.turnServerURL,"turnServerURL"),cn(e.username,"username"),cn(e.password,"password"),e.udpport&&dt(e.udpport,"udpport",1,99999,!0),e.forceturn&&_c(e.forceturn,"forceturn"),e.security&&_c(e.security,"security"),e.tcpport&&dt(e.tcpport,"tcpport",1,99999,!0),!0}function IR(e){return e.level!==void 0&&qt(e.level,"level",[1,2,3]),!0}(function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics"})(ln||(ln={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed"}(Et||(Et={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(vR||(vR={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(Lf||(Lf={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(Lt||(Lt={})),function(e){e.TRACER="tracer"}(mt||(mt={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(fs||(fs={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(zr||(zr={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(ca||(ca={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(gc||(gc={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(di||(di={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(un||(un={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(me||(me={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(Mf||(Mf={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(Ke||(Ke={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result"}(Pe||(Pe={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(kn||(kn={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(Je||(Je={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback"}(le||(le={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter"}(ge||(ge={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(Gn||(Gn={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(be||(be={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(TR||(TR={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(Wn||(Wn={}));const Uf={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},xf={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},CR={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Ix={uplinkNetworkQuality:0,downlinkNetworkQuality:0},AR={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Oe,Mt,So;(function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(Oe||(Oe={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(Mt||(Mt={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(So||(So={}));const Cx={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Vf={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function jf(e,t){cn(e.url,"".concat(t,".url"),1,1e3,!1),ut(e.x)||dt(e.x,"".concat(t,".x"),0,1e4),ut(e.y)||dt(e.y,"".concat(t,".y"),0,1e4),ut(e.width)||dt(e.width,"".concat(t,".width"),0,1e4),ut(e.height)||dt(e.height,"".concat(t,".height"),0,1e4),ut(e.zOrder)||dt(e.zOrder,"".concat(t,".zOrder"),0,255),ut(e.alpha)||dt(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Ax={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},wx={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let Ki,da,yt,wR,An,ur,Ln,vo,Ut,ft,Ot,Dl,Se,Ft,Ff,Bf,To,la,Ue;function OR(e){if(!e.channelName)throw new N(I.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new N(I.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&cn(e.token,"info.token",1,2047),Pf(e.uid),Df(e.channelName),!0}function NR(e){return qt(e,"mediaSource",["screen","window","application"]),!0}(function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Ki||(Ki={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(da||(da={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(yt||(yt={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(wR||(wR={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(An||(An={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(ur||(ur={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Ln||(Ln={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(vo||(vo={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(Ut||(Ut={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(ft||(ft={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data"}(Ot||(Ot={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(Dl||(Dl={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(Se||(Se={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(Ft||(Ft={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(Ff||(Ff={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(Bf||(Bf={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(To||(To={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(la||(la={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(Ue||(Ue={}));const Ox=[Ue.AFRICA,Ue.ASIA,Ue.CHINA,Ue.EUROPE,Ue.GLOBAL,Ue.INDIA,Ue.JAPAN,Ue.NORTH_AMERICA,Ue.OCEANIA,Ue.OVERSEA,Ue.SOUTH_AMERICA];let Jt;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"})(Jt||(Jt={}));const Pl={CHINA:{},ASIA:{CODE:Jt.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Jt.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Jt.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Jt.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Jt.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Jt.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Jt.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Jt.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Jt.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Jt.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Jt.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Jt.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Jt.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let vc,bR,we,oe,Bt,Fe,Sn,Ro,hn,Hn,li,ui,xt,wr,_t;Rf&&(Pl.CHINA={CODE:Jt.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(vc||(vc={}));class kl extends Rt{constructor(t,n){super(),_(this,"onICEConnectionStateChange",void 0),_(this,"onConnectionStateChange",void 0),_(this,"onDTLSTransportStateChange",void 0),_(this,"onDTLSTransportError",void 0),_(this,"onICETransportStateChange",void 0),_(this,"onFirstAudioReceived",void 0),_(this,"onFirstVideoReceived",void 0),_(this,"onFirstAudioDecoded",void 0),_(this,"onFirstVideoDecoded",void 0),_(this,"onFirstVideoDecodedTimeout",void 0),_(this,"onSelectedLocalCandidateChanged",void 0),_(this,"onSelectedRemoteCandidateChanged",void 0),_(this,"establishPromise",void 0)}}(function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"})(bR||(bR={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(we||(we={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(oe||(oe={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(Bt||(Bt={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState"}(Fe||(Fe={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(Sn||(Sn={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(Ro||(Ro={})),function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(hn||(hn={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(Hn||(Hn={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(li||(li={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(ui||(ui={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(xt||(xt={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(wr||(wr={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(_t||(_t={}));const wn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1};function Zt(){return wn}let Ht;(function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Ht||(Ht={}));var Nx=Ge,Tc=Array.isArray||function(e){return Nx(e)=="Array"},bx=Y,DR=Tc,Dx=_p,Px=Bi,kx=an("species"),PR=bx.Array,Lx=function(e){var t;return DR(e)&&(t=e.constructor,(Dx(t)&&(t===PR||DR(t.prototype))||Px(t)&&(t=t[kx])===null)&&(t=void 0)),t===void 0?PR:t},kR=function(e,t){return new(Lx(e))(t===0?0:t)},Mx=rc,Ux=ar,xx=uo,Vx=ho,jx=kR,LR=W([].push),yo=function(e){var t=e==1,n=e==2,i=e==3,o=e==4,a=e==6,c=e==7,l=e==5||a;return function(u,p,f,m){for(var v,R,w=xx(u),A=Ux(w),O=Mx(p,f),U=Vx(A),x=0,Q=m||jx,pe=t?Q(u,U):n||c?Q(u,0):void 0;U>x;x++)if((l||x in A)&&(R=O(v=A[x],x,w),e))if(t)pe[x]=R;else if(R)switch(e){case 3:return!0;case 5:return v;case 6:return x;case 2:LR(pe,v)}else switch(e){case 4:return!1;case 7:LR(pe,v)}return a?-1:i||o?o:pe}},MR={forEach:yo(0),map:yo(1),filter:yo(2),some:yo(3),every:yo(4),find:yo(5),findIndex:yo(6),filterReject:yo(7)},Fx=MR.forEach,UR=Hh("forEach")?[].forEach:function(e){return Fx(this,e,arguments.length>1?arguments[1]:void 0)};Dn({target:"Array",proto:!0,forced:[].forEach!=UR},{forEach:UR});var Bx=po("Array").forEach,Gx=mo,Wx=Zn,Hx=B,Kx=Bx,Gf=Array.prototype,zx={DOMTokenList:!0,NodeList:!0},Yx=function(e){var t=e.forEach;return e===Gf||Hx(Gf,e)&&t===Gf.forEach||Wx(zx,Gx(e))?Kx:t},qx=uo,xR=ep;Dn({target:"Object",stat:!0,forced:E(function(){xR(1)})},{keys:function(e){return xR(qx(e))}});var Jx=lo.Object.keys,Xx=Wg,Qx=Dn,$x=Tc,Zx=W([].reverse),VR=[1,2];Qx({target:"Array",proto:!0,forced:String(VR)===String(VR.reverse())},{reverse:function(){return $x(this)&&(this.length=this.length),Zx(this)}});var eV=po("Array").reverse,tV=B,nV=eV,Wf=Array.prototype,iV=function(e){var t=e.reverse;return e===Wf||tV(Wf,e)&&t===Wf.reverse?nV:t},rV=E,oV=Bs,sV=an("species"),jR=function(e){return oV>=51||!rV(function(){var t=[];return(t.constructor={})[sV]=function(){return{foo:1}},t[e](Boolean).foo!==1})},aV=Dn,cV=Y,FR=Tc,dV=_p,lV=Bi,BR=Jh,uV=ho,hV=co,pV=Cf,fV=an,mV=gp,EV=jR("slice"),_V=fV("species"),Hf=cV.Array,gV=Math.max;aV({target:"Array",proto:!0,forced:!EV},{slice:function(e,t){var n,i,o,a=hV(this),c=uV(a),l=BR(e,c),u=BR(t===void 0?c:t,c);if(FR(a)&&(n=a.constructor,(dV(n)&&(n===Hf||FR(n.prototype))||lV(n)&&(n=n[_V])===null)&&(n=void 0),n===Hf||n===void 0))return mV(a,l,u);for(i=new(n===void 0?Hf:n)(gV(u-l,0)),o=0;l<u;l++,o++)l in a&&pV(i,o,a[l]);return i.length=o,i}});var SV=po("Array").slice,vV=B,TV=SV,Kf=Array.prototype,RV=function(e){var t=e.slice;return e===Kf||vV(Kf,e)&&t===Kf.slice?TV:t};function H(e,t,n,i,o){var a,c,l,u={};return Yx(a=Jx(i)).call(a,function(p){u[p]=i[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Xx(c=iV(l=RV(n).call(n)).call(l)).call(c,function(p,f){return f(e,t,p)||p},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0&&(NT(e,t,u),u=null),u}var yV=po("Array").keys,IV=mo,CV=Zn,AV=B,wV=yV,zf=Array.prototype,OV={DOMTokenList:!0,NodeList:!0},ms=function(e){var t=e.keys;return e===zf||AV(zf,e)&&t===zf.keys||CV(OV,IV(e))?wV:t};function GR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function WR(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GR(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GR(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Ll=0,Yf=0;function hr(e,t,n,i){return new re((o,a)=>{t.timeout=t.timeout||k("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Ll+=Ea(t.data)):n&&(t.data.size?Ll+=t.data.size:t.data instanceof FormData?Ll+=function(c){let l=0;return/DingTalk/i.test(navigator.userAgent)&&c.realFormData&&(c=c.realFormData),c.forEach(u=>{l+=typeof u=="string"?Ea(u):u.size}),l+138}(t.data):Ll+=Ea(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Wi.request(t).then(c=>{typeof c.data=="string"?Yf+=Ea(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Yf+=c.data.byteLength:Yf+=Ea(JSON.stringify(c.data)),i&&o({data:c.data,headers:c.headers}),o(c.data)}).catch(c=>{Wi.isCancel(c)?a(new N(I.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?a(new N(I.NETWORK_TIMEOUT,c.message)):c.response?a(new N(I.NETWORK_RESPONSE_ERROR,c.response.status)):a(new N(I.NETWORK_ERROR,c.message))})})}async function NV(e,t){const n=new Blob([t.data],{type:"buffer"});return await hr(e,WR(WR({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Nt=new class extends Rt{set networkState(e){T.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(Ro.NETWORK_STATE_CHANGE,e,this._networkState),e===Sn.ONLINE?this.emit(Ro.ONLINE):e===Sn.OFFLINE&&(this.onlineWaiter=new re(t=>{this.once(Ro.ONLINE,()=>{this.onlineWaiter=void 0,t(Sn.ONLINE)})}),this.emit(Ro.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}constructor(){super(),_(this,"_moduleName","network-indicator"),_(this,"_networkState",Sn.ONLINE),_(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Sn.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Sn.OFFLINE})}};let qf=!1;const hi=new class extends Rt{constructor(){super(...arguments),_(this,"onAutoplayFailed",void 0),_(this,"onAudioAutoplayFailed",void 0)}};function HR(){if(Xe(),!qf){const e=t=>{t.preventDefault(),qf=!1,pc()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};qf=!0,pc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),hi.onAutoplayFailed?hi.onAutoplayFailed():hi.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),hi.emit("autoplay-failed")}}function Jf(e){return new TextEncoder().encode(e)}const KR=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},bV=async e=>function(t,n){let i="";return new Uint8Array(t).forEach(o=>{i+=o.toString(n).padStart(2,"0")}),i}(await crypto.subtle.digest("SHA-256",Jf(e)),16);function zR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?zR(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zR(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function _e(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const o=i.value;if(typeof o=="function"){const a=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];let p=l;if(e.argsMap)try{p=e.argsMap(this,...l)}catch(m){T.warning(m),p=[]}try{JSON.stringify(p)}catch{T.warning("arguments for method ".concat(a,".").concat(n," not serializable for apiInvoke.")),p=[]}const f=(e.report||ue).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(n),options:p,tag:mt.TRACER,reportResult:e.reportResult},e.throttleTime);try{const m=o.apply(this,l);return m instanceof re?m.then(v=>(f.onSuccess(e.reportResult&&v),v)).catch(v=>{throw f.onError(v),v}):(f.onSuccess(e.reportResult&&m),m)}catch(m){throw f.onError(m),m}}}return i}}const ue=new class{constructor(){_(this,"baseInfoMap",new Map),_(this,"proxyServer",void 0),_(this,"clientList",hs),_(this,"eventUploadTimer",void 0),_(this,"setSessionIdTimer",void 0),_(this,"url",void 0),_(this,"backupUrl",void 0),_(this,"_appId",void 0),_(this,"keyEventUploadPendingItems",[]),_(this,"normalEventUploadPendingItems",[]),_(this,"apiInvokeUploadPendingItems",[]),_(this,"apiInvokeCount",0),_(this,"ltsList",[]),_(this,"lastSendNormalEventTime",Date.now()),_(this,"customReportCounterTimer",void 0),_(this,"customReportCount",0),_(this,"extApiInvoke",async e=>{for(const t of e){const n=Ne(Ne({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:mt.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),k("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),k("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void T.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),i=t.startTime;t.startTime=n,T.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-i,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,a=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null}),c=!!k("SHOW_REPORT_INVOKER_LOG");c&&T.info("".concat(t.name," start"),t.options);let l=!1;fn(t.timeout).then(()=>{l||(this.sendApiInvoke(Ne(Ne({},a()),{},{error:I.API_INVOKE_TIMEOUT,success:!1})),T.debug("".concat(t.name," timeout")))});const u=new N(I.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:p=>{const f=()=>{if(l)throw u;return l=!0,this.sendApiInvoke(Ne(Ne({},a()),{},{success:!0},t.reportResult&&{result:p})),c&&T.info("".concat(t.name," onSuccess")),p};return n?aI(f,t.name+"Success",n,()=>l=!0):f()},onError:p=>{const f=()=>{if(l)throw p;l=!0,this.sendApiInvoke(Ne(Ne({},a()),{},{success:!1,error:p})),c&&T.info("".concat(t.name," onFailure"),p.toString())};return n?aI(f,t.name+"Error",n,()=>l=!0):f()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const o=Object.assign({},{willUploadConsoleLog:k("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Rf?"global":"oversea",areas:k("AREAS")&&k("AREAS").join(",")},t.extend),a=Date.now(),c=Ne(Ne({},i),{},{eventType:ln.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:Tf,lts:a,elapse:a-n,extend:JSON.stringify(o),mode:t.mode,process:k("PROCESS_ID"),appType:k("APP_TYPE"),success:!0,version:Ci});this.send({type:Et.SESSION,data:c},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne({},i),{},{eventType:ln.JOIN_CHOOSE_SERVER,lts:o,eventElapse:o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:Et.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne({},i),{},{eventType:ln.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Et.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const o=Date.now(),{firstSuccess:a,avoidJoinStartTime:c,isProxy:l,addr:u}=t,p=o-(a&&c?c:n.startTime),f=Ne(Ne({},i),{},{eventType:ln.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:p,eventElapse:o-t.lts,firstSuccess:a,signalChannel:t.signalChannel}),m=f.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),a)this.send({type:Et.JOIN_GATEWAY,data:f},!0);else{let v;if(u)if(l){const w=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),A=u.match(/p=[0-9]{1,6}/g);v={isSuccess:m,gatewayIp:w&&w.length?w[0].split("=")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split("=")[1]:"",isProxy:l?1:0}}else{const w=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),A=u.match(/:[0-9]{1,6}/g);v={isSuccess:m,gatewayIp:w&&w.length?w[0].split("//")[1].replace(/-/g,"."):"",port:A&&A.length?A[0].split(":")[1]:"",isProxy:l?1:0}}else v={isSuccess:m,gatewayIp:"",port:"",isProxy:l?1:0};delete f.success,delete f.eventType,delete f.firstSuccess,f.vid=Number(f.vid);const R=Object.assign({},f,v,{eventType:ln.REJOIN_GATEWAY});this.send({type:Et.RE_JOIN_GATEWAY,data:R},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),o=Ne(Ne({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:Et.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne({},i),{},{eventType:ln.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Et.PUBLISH,data:a},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),c=Ne(Ne({},o),{},{eventType:ln.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?c.peerSuid=t.peerid:c.peer=t.peerid,this.send({type:Et.SUBSCRIBE,data:c},!0)}wsCompressorInit(e){var t;const n=[...ms(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(i);if(!o)return;const a=o.info,c=Date.now(),l=Ne(Ne({},a),{},{eventType:ln.WS_COMPRESSOR_INIT,lts:c,eventElapse:e.eventElapse,elapse:c-o.startTime,status:e.status?1:2});this.send({type:Et.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ne(Ne(Ne({},a),i),{},{elapse:c-o.startTime,eventType:t,lts:c,firstDecodeFrame:Math.max(c-o.startTime,0),apEnd:Math.max(i.apEnd-o.startTime,0),apStart:Math.max(i.apStart-o.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-o.startTime,0),joinGwStart:Math.max(i.joinGwStart-o.startTime,0),pcEnd:Math.max(i.pcEnd-o.startTime,0),pcStart:Math.max(i.pcStart-o.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-o.startTime,0),subscriberStart:Math.max(i.subscriberStart-o.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-o.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ne(Ne(Ne({},a),i),{},{elapse:c-o.startTime,eventType:t,lts:c});this.send({type:n,data:l},!0)}onGatewayStream(e,t,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ne(Ne(Ne({},a),i),{},{eventType:t,lts:c});this.send({type:n,data:l},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne({},i),{},{eventType:ln.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:Et.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne({},i),{},{eventType:ln.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Et.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne({},i),{},{eventType:ln.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Et.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(e){this.proxyServer=e,e?T.debug("reportProxyServerurl: ".concat(e)):T.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Et.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now();(function(a,c,l){const u=a[c];if(!u||typeof u!="string")return[a];a[c]="";const p=Ea(JSON.stringify(a));let f=0;const m=[];let v=0;for(let R=0;R<u.length;R++)v+=u.charCodeAt(R)<=127?1:3,v<=l-p||(m[m.length]=gs(gs({},a),{},{[c]:u.substring(f,R)}),f=R,v=u.charCodeAt(R)<=127?1:3);return f!==u.length-1&&(m[m.length]=gs(gs({},a),{},{[c]:u.substring(f)})),m})(Ne(Ne(Ne({},i),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:Et.WORKER_EVENT,data:a},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne(Ne({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:Et.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne(Ne({},i),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:Et.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,o=Date.now(),a=Ne(Ne(Ne({},i),t),{},{elapse:o-n.startTime,lts:o});this.send({type:Et.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>k("CUSTOM_REPORT_LIMIT"))throw new N(I.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),i=t.map(o=>({type:Et.USER_ANALYTICS,data:Ne(Ne({sid:e},o),{},{lts:n})}));try{k("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(o){throw T.error("send custom report message failed",o.toString()),new N(I.CUSTOM_REPORT_SEND_FAILED,o.message)}}autoplayFailed(e,t,n,i){if(!e)return;const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,c=Date.now(),l=Ne(Ne({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:c,elapse:c-o.startTime,cbRegistered:hi.onAutoplayFailed||hi.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});this.send({type:Et.AUTOPLAY_FAILED,data:l},!0)}sendApiInvoke(e){const t=k("NOT_REPORT_EVENT");if(e.tag&&t.includes&&t.includes(e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:o,cid:a}=n.info;e.lts=e.lts||Date.now();let c;if(e.error)if(e.error instanceof N){const{code:u,message:p}=e.error;c=u||p||e.error.toString()}else c=e.error.toString();const l={invokeId:e.invokeId,sid:e.sid,cname:i,cid:a,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?c:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Et.API_INVOKE,data:l},!1),!0}appendSessionId(){this.clientList.forEach(e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const i=this.apiInvokeUploadPendingItems.shift();i&&(i.sid=e._sessionId,this.sendApiInvoke(Object.assign({},i)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>k("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const a=e.shift();n.length<20?n.push(a):i.push(a)}e.push(...i);for(const a of[...n]){var o;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),Nf(o=this.ltsList).call(o,(c,l)=>c-l))}return t||(this.lastSendNormalEventTime=Date.now()),k("ENABLE_EVENT_REPORT")&&n.length&&(k("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((a=>c=>{k("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>k("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-k("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){Nt.networkState===Sn.OFFLINE&&await re.race([Nt.onlineWaiter,fn(2*jt.maxRetryTimeout)]);const t=o=>{let a=new Uint8Array;return o.forEach(c=>{const l=Jf(JSON.stringify(c.data)),u=new ArrayBuffer(5),p=(m=>{let v=0;return Object.entries(Et).forEach(R=>{let[w,A]=R;A===m.type&&(v=Lf[w])}),v})(c),f=new DataView(u);f.setUint16(0,l.byteLength,!0),f.setUint8(2,255&p),f.setUint8(3,p>>>8&255),f.setUint8(4,p>>>16&255),a=KR(a,new Uint8Array(u)),a=KR(a,l)}),a},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(k("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(k("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await hr(i,{timeout:1e4,data:t(e),headers:Ne(Ne({token:"32f24ab2ddb74f508aa9286c356cec84",biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(o===1)throw a;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(a=>JSON.stringify(a)),vid:(a=>{const c=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return c&&c.info.vid&&+c.info.vid||0})(e[0])};Nt.networkState===Sn.OFFLINE&&await re.race([Nt.onlineWaiter,fn(2*jt.maxRetryTimeout)]);const i=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("EVENT_REPORT_DOMAIN"),"&p=").concat(k("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(k("EVENT_REPORT_DOMAIN"),":").concat(k("STATS_COLLECTOR_PORT")).concat(i));for(let a=0;a<2;a+=1){a===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(k("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(k("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(k("STATS_COLLECTOR_PORT")).concat(i)));try{t?await NV(o,{timeout:1e4,data:n}):await hr(o,{timeout:1e4,data:n})}catch(c){if(a===1)throw c;continue}return}}createBaseInfo(e,t){const n=Object.assign({},Rx);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:mt.TRACER}).onSuccess()}};wl.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Nt.networkState,ue.reportApiInvoke(null,{name:"logUploadError",options:e,tag:mt.TRACER})});class YR extends Rt{constructor(t,n){super(),_(this,"trackMediaType",void 0),_(this,"_ID",void 0),_(this,"_hints",[]),_(this,"_isClosed",!1),_(this,"_originMediaStreamTrack",void 0),_(this,"_mediaStreamTrack",void 0),_(this,"_external",{}),this._ID=n||ht(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(i){Ec.includes(i)||Ec.push(i)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const n=ue.reportApiInvoke(null,{name:Lt.GET_MEDIA_STREAM_TRACK,options:[],tag:mt.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")}return this._mediaStreamTrack}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,function(t){const n=Ec.indexOf(t);n!==-1&&Ec.splice(n,1)}(this),this.emit(To.CLOSED)}}let Kt,DV=1;class On{constructor(t){_(this,"lockingPromise",re.resolve()),_(this,"locks",0),_(this,"name",""),_(this,"lockId",void 0),this.lockId=DV++,t&&(this.name=t),T.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let n;this.locks+=1,T.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const i=new re(a=>{n=()=>{this.locks-=1,T.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),a()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),o}}function ua(e,t){return function(n,i,o){const a=o.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const l=await c.lock("From ".concat(e,".").concat(i));try{for(var u=arguments.length,p=new Array(u),f=0;f<u;f++)p[f]=arguments[f];return await a.apply(this,p)}finally{l()}},o}}class Xf extends YR{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,n){super(t,n),_(this,"_enabled",!0),_(this,"_muted",!1),_(this,"_isExternalTrack",!1),_(this,"_isClosed",!1),_(this,"_enabledMutex",void 0),_(this,"processor",void 0),_(this,"_processorContext",void 0),_(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new On("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(Se.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gt(this,Se.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(To.TRACK_ENDED)}stateCheck(t,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),_c(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new N(I.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new N(I.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function qR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}(function(e){e.IOS_15_INTERRUPTION_START="ios15-interruption-start",e.IOS_15_INTERRUPTION_END="ios15-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"})(Kt||(Kt={}));const JR=window.AudioContext||window.webkitAudioContext;let pi=null;const xe=new class extends Rt{constructor(){super(...arguments),_(this,"prevState",void 0),_(this,"curState",void 0),_(this,"currentTime",void 0),_(this,"currentTimeStuckAt",void 0),_(this,"interruptDetectorTrack",void 0),_(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(Kt.IOS_15_INTERRUPTION_START)}),_(this,"onLocalAudioTrackUnmute",async()=>{T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(pi&&await pi.suspend(),this.emit(Kt.IOS_15_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){T.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){T.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function PV(){if(!JR)return void T.error("your browser is not support web audio");T.info("create audio context");const e=function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?qR(Object(i),!0).forEach(function(o){_(t,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):qR(Object(i)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(i,o))})}return t}({},k("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(e)),pi=new JR(e),xe.curState=pi.state,pi.onstatechange=()=>{xe.prevState=xe.curState,xe.curState=pi?pi.state:void 0,(In()||Cr())&&xe.prevState==="running"&&xe.curState==="interrupted"&&(T.info("ios-interruption-start"),xe.emit(Kt.IOS_INTERRUPTION_START)),(In()||Cr())&&xe.prevState==="interrupted"&&xe.curState==="running"&&(T.info("ios-interruption-end"),xe.emit(Kt.IOS_INTERRUPTION_END)),xe.prevState!==xe.curState&&(T.debug("AudioContext State Change","".concat(xe.prevState,"=>").concat(xe.curState)),xe.emit(Kt.STATE_CHANGE))},setInterval(()=>{var t;const n=(t=pi)===null||t===void 0?void 0:t.currentTime;xe.currentTime!==n?(xe.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),xe.currentTimeStuckAt=void 0),xe.currentTime=n):(n!==xe.currentTimeStuckAt&&(ue.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:mt.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),xe.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,o=!1,a=!1,c=!1;function l(O){t.state==="running"?u(!1):In()||Cr()?t.state==="suspended"&&(u(!0),O&&t.resume().then(f,f)):t.state!=="closed"&&(u(!0),O&&t.resume().then(f,f))}function u(O){if(o!==O){o=O;for(let U=0,x=n;U<x.length;U+=1){const Q=x[U];O?window.addEventListener(Q,m,{capture:!0,passive:!0}):window.removeEventListener(Q,m,{capture:!0,passive:!0})}}}function p(){l(!0)}function f(){l(!1)}function m(){l(!0)}function v(O){if(!c)if(i.paused)if(O){R(!1),c=!0;let U;try{U=i.play(),U?U.then(w,w):(i.addEventListener("playing",w),i.addEventListener("abort",w),i.addEventListener("error",w))}catch{w()}}else R(!0);else R(!1)}function R(O){if(a!==O){a=O;for(let U=0,x=n;U<x.length;U++){const Q=x[U];O?window.addEventListener(Q,A,{capture:!0,passive:!0}):window.removeEventListener(Q,A,{capture:!0,passive:!0})}}}function w(){i.removeEventListener("playing",w),i.removeEventListener("abort",w),i.removeEventListener("error",w),c=!1,v(!1)}function A(){v(!0)}if(In()){const O=t.createMediaStreamDestination(),U=document.createElement("div");U.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=U.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=O.stream,v(!0)}xe.on(Kt.STATE_CHANGE,p),l(!1)}(pi)}function ha(){if(!pi){if(PV(),!pi)throw new N(I.NOT_SUPPORTED,"can not create audio context");return pi}return pi}function XR(){return!!pi}function Es(e){if(function(){if(Qf!==null)return Qf;const i=ha(),o=i.createBufferSource(),a=i.createGain(),c=i.createGain();o.connect(a),o.connect(c),o.disconnect(a);let l=!1;try{o.disconnect(a)}catch{l=!0}return o.disconnect(),Qf=l,l}())return;const t=e.connect,n=e.disconnect;e.connect=(i,o,a)=>(e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,o,a)):t.call(e,i,o)),e),e.disconnect=(i,o,a)=>{n.call(e),i?sm(e._inputNodes,i):e._inputNodes=[];for(const c of e._inputNodes)t.call(e,c)}}let Qf=null;function QR(e,t){let n=!1;const i=1/t;if(k("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*i)}else{const o=ha();let a=o.createGain();a.gain.value=0,a.connect(o.destination);const c=()=>{if(n)return void(a=null);const l=o.createOscillator();l.onended=c,l.connect(a),l.start(0),l.stop(o.currentTime+i),e(o.currentTime)};c()}return()=>{n=!0}}class $R{constructor(){_(this,"context",void 0),_(this,"analyserNode",void 0),_(this,"sourceNode",void 0),this.context=ha(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||In()||Cr()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let o=0;o<t.length;++o)t[o]=i[o]/128-1}const n=fo(t).call(t,(i,o)=>i+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class ZR extends Rt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),_(this,"outputNode",void 0),_(this,"outputTrack",void 0),_(this,"isPlayed",!1),_(this,"sourceNode",void 0),_(this,"context",void 0),_(this,"audioBufferNode",void 0),_(this,"destNode",void 0),_(this,"audioOutputLevel",0),_(this,"volumeLevelAnalyser",void 0),_(this,"_processedNode",void 0),_(this,"playNode",void 0),_(this,"isDestroyed",!1),_(this,"onNoAudioInput",void 0),_(this,"isNoAudioInput",!1),_(this,"_noAudioInputCount",0),this.context=ha(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Es(this.outputNode),this.volumeLevelAnalyser=new $R}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Wn.ON_AUDIO_BUFFER,function(i){for(let o=0;o<i.outputBuffer.numberOfChannels;o+=1){const a=i.outputBuffer.getChannelData(o);for(let c=0;c<a.length;c+=1)a[c]=0}return i.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Zt().webAudioMediaStreamDest)throw new N(I.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Yi(()=>{xe.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;In()||Cr()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let o=!1;for(let a=0;a<i.length;a++)i[a]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await fn(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class $f extends ZR{get isFreeze(){return!1}constructor(t,n,i){var o;if(super(),_(this,"sourceNode",void 0),_(this,"track",void 0),_(this,"clonedTrack",void 0),_(this,"audioElement",void 0),_(this,"isCurrentTrackCloned",!1),_(this,"isRemoteTrack",!1),_(this,"originVolumeLevelAnalyser",void 0),_(this,"rebuildWebAudio",async()=>{if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;const u=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(u),Es(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),Es(this.outputNode),this.emit(Wn.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=u,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new N(I.UNEXPECTED_ERROR);this.track=t;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),Es(this.sourceNode),i){const l=i.clone();l.enabled=!0,this.clonedTrack=l,T.debug("create an unmuted track ".concat(l.id," from the original track ").concat(i.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([l]));Es(u),this.originVolumeLevelAnalyser=new $R,this.originVolumeLevelAnalyser.updateSource(u)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const c=Xe();n&&c.os===gn.IOS&&Number((o=c.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(xe.on(Kt.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Es(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Wn.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),xe.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Es(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function ey(e,t){const n=(o,a)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||a:o:a,i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function kV(e){const t=await ty(e.mediaSource),n=await function(i){return new re((o,a)=>{const c=document.createElement("div");c.innerText="share screen",c.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const l=document.createElement("div");l.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const u=document.createElement("div");u.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",u.setAttribute("style","height: 12%;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const f=document.createElement("div");f.setAttribute("style","text-align: right; padding: 16px 0;");const m=document.createElement("button");m.innerHTML="cancel",m.setAttribute("style","width: 85px;"),m.onclick=()=>{document.body.removeChild(v);const R=new Error("NotAllowedError");R.name="NotAllowedError",a(R)},f.appendChild(m),l.appendChild(u),l.appendChild(p),l.appendChild(f);const v=document.createElement("div");v.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),v.appendChild(c),v.appendChild(l),document.body.appendChild(v),i.map(R=>{if(R.id){const w=document.createElement("div");w.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let A=R.thumbnail;const{width:O}=A.getSize();O>1920&&(A=A.resize({width:1920})),w.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+A.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(R.name.replace(/[\u00A0-\u9999<>\&]/g,function(U){return"&#"+U.charCodeAt(0)+";"})+"</span>"),w.onclick=()=>{document.body.removeChild(v),o(R.id)},p.appendChild(w)}})})}(t);return await ey(n,e)}async function ty(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=ny();if(!n)throw new N(I.ELECTRON_IS_NULL);let i=null;try{var o;i=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new re((a,c)=>{n.desktopCapturer.getSources({types:t},(l,u)=>{l?c(l):a(u)})}));try{return await i}catch(a){throw new N(I.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}let Ml=null;function ny(){if(Ml)return Ml;try{return Ml=window.require("electron"),Ml}catch{return null}}function iy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}const Zf=new On("safari");let ry=!1,oy=!1;async function zi(e,t){let n=0,i=null;for(;n<2;)try{i=await LV(e,t,n>0);break}catch(o){if(o instanceof N)throw T.error("[".concat(t,"] ").concat(o.toString())),o;const a=Ul(o.name||o.code||o,o.message);if(a.code===I.MEDIA_OPTION_INVALID){T.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await fn(500);continue}throw T.error("[".concat(t,"] ").concat(a.toString())),a}if(!i)throw new N(I.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function LV(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new N(I.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=Zt(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return T.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(ny())e.screen.sourceId?pa(o,await ey(e.screen.sourceId,e.screen)):pa(o,await kV(e.screen));else if(Zp()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new N(I.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const v=await(c=e.screen.extensionId,l=t,new re((R,w)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},A=>{if(!A||!A.streamId)return T.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),A),void w(new N(I.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));R(A.streamId)})}catch(A){T.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),A.toString()),w(new N(I.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=v,pa(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var a;e.screen.mediaSource&&NR(e.screen.mediaSource);const v={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(a=e.screen.displaySurface)!==null&&a!==void 0?a:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:R,surfaceSwitching:w,systemAudio:A}=e.screen,O={selfBrowserSurface:R,surfaceSwitching:w,systemAudio:A};!R&&delete O.selfBrowserSurface,!w&&delete O.surfaceSwitching,!A&&delete O.systemAudio,T.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:v,audio:!!e.screenAudio,controls:O})),pa(o,await navigator.mediaDevices.getDisplayMedia(function(U){for(var x=1;x<arguments.length;x++){var Q=arguments[x]!=null?arguments[x]:{};x%2?iy(Object(Q),!0).forEach(function(pe){_(U,pe,Q[pe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(U,Object.getOwnPropertyDescriptors(Q)):iy(Object(Q)).forEach(function(pe){Object.defineProperty(U,pe,Object.getOwnPropertyDescriptor(Q,pe))})}return U}({video:v,audio:!!e.screenAudio},O)))}else{if(!Tt())throw T.error("[".concat(t,"] This browser does not support screenSharing")),new N(I.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&NR(e.screen.mediaSource);const v={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};T.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(v))),pa(o,await navigator.mediaDevices.getUserMedia(v))}}var c,l;if(!e.video&&!e.audio)return o;let u={video:e.video,audio:e.audio},p=k("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),u=function v(R,w){if(!cI(R)||!cI(w)||Array.isArray(R)&&!Array.isArray(w)||!Array.isArray(R)&&Array.isArray(w))return w;if(Array.isArray(w)&&Array.isArray(R)){const A=[...R];for(let O=0;O<w.length;O++)A[O]=v(R[O],w[O]);return A}{const A=gs({},R);for(const O in w)Object.prototype.hasOwnProperty.call(w,O)&&(Object.prototype.hasOwnProperty.call(R,O)?A[O]=v(R[O],w[O]):A[O]=w[O]);return A}}(u,p)}catch{}T.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(u)),Xe();let f,m=null;(yn()||In()||gl())&&(m=await Zf.lock());try{f=await navigator.mediaDevices.getUserMedia(u)}catch(v){throw m&&m(),v}return u.audio&&(ry=!0),u.video&&(oy=!0),pa(o,f),m&&m(),o}function Ul(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new N(I.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new N(I.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new N(I.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new N(I.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new N(I.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new N(I.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return T.error("getUserMedia unexpected error",e),new N(I.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function pa(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],o=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(i&&e.removeTrack(i),e.addTrack(a)),o&&(n&&e.removeTrack(n),e.addTrack(o))}const fi=new class extends Rt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(zr.STATE_CHANGE,e),this._state=e)}constructor(){super(),_(this,"_state",fs.IDLE),_(this,"isAccessMicrophonePermission",!1),_(this,"isAccessCameraPermission",!1),_(this,"lastAccessMicrophonePermission",!1),_(this,"lastAccessCameraPermission",!1),_(this,"checkdeviceMatched",!1),_(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(k("ENUMERATE_DEVICES_INTERVAL")||nf()&&cs())&&this.updateDevicesInfo()},k("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>T.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new N(I.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),o=this.checkMediaDeviceInfoIsOk(i);let a=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;o.audio&&(a=!1),o.video&&(c=!1);let l=null,u=null,p=null;if(!n&&(a||c)){if(Zf.isLocked&&(T.debug("[device manager] wait GUM lock"),(await Zf.lock())(),T.debug("[device manager] GUM unlock")),ry&&(a=!1,this.isAccessMicrophonePermission=!0),oy&&(c=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",e,t,a,c),a&&c){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(f){const m=Ul(f.name||f.code||f,f.message);if(m.code===I.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(a){try{l=await navigator.mediaDevices.getUserMedia({audio:e})}catch(f){const m=Ul(f.name||f.code||f,f.message);if(m.code===I.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({video:t})}catch(f){const m=Ul(f.name||f.code||f,f.message);if(m.code===I.PERMISSION_DENIED)throw m;T.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",e,"cam permission",t)}try{const f=await navigator.mediaDevices.enumerateDevices();return l&&l.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),p&&p.getTracks().forEach(m=>m.stop()),l=null,u=null,p=null,f}catch(f){return l&&l.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),p&&p.getTracks().forEach(m=>m.stop()),l=null,u=null,p=null,new N(I.ENUMERATE_DEVICES_FAILED,f.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new N(I.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=fs.INITING;try{await this.updateDevicesInfo(),this.state=fs.INITEND}catch(e){throw T.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=fs.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new N(I.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const o=e.find(c=>c.kind==="audioinput"&&c.deviceId==="default"),a=e.find(c=>c.kind==="audiooutput"&&c.deviceId==="default");o&&a?a.groupId===o.groupId?T.debug("[device-check] default input ".concat(o.label," and output ").concat(a.label," is the same group")):T.warning("[device-check] default input ".concat(o.label," and output ").concat(a.label," is not the same group")):T.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(o=>{if(!o.deviceId)return;const a=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const c={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),c),n.push(c)}a&&(a.updateAt=t)}),this.deviceInfoMap.forEach((o,a)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state!==fs.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(zr.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(zr.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(zr.PLAYOUT_DEVICE_CHANGED,o)}}),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(o=>o.kind==="audioinput"),n=e.filter(o=>o.kind==="videoinput"),i={audio:!1,video:!1};for(const o of t)if(o.label&&o.deviceId){i.audio=!0;break}for(const o of n)if(o.label&&o.deviceId){i.video=!0;break}return i}},MV=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ei=new class{constructor(){_(this,"onAutoplayFailed",void 0),_(this,"elementMap",new Map),_(this,"elementStateMap",new Map),_(this,"elementsNeedToResume",[]),_(this,"sinkIdMap",new Map),_(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=this.elementStateMap.get(t),o=n.srcObject.getAudioTracks()[0];ea()?o&&o.readyState==="live"&&xe.curState==="running"&&(T.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):i&&i==="paused"&&o&&o.readyState==="live"&&xe.curState==="running"&&(T.debug("auto resume after interruption for iOS"),n.play())})}),_(this,"autoResumeAfterInterruptionOnIOS15",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),xe.on(Kt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),xe.on(Kt.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),xe.on(Kt.STATE_CHANGE,()=>{In()&&xe.prevState==="suspended"&&xe.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new N(I.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,dn.INIT),this.setVolume(t,n);const a=this.sinkIdMap.get(t);if(a)try{o.setSinkId(a).catch(l=>{T.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){T.warning("[".concat(t,"] set sink id failed"),l.toString())}const c=o.play();c&&c.then&&c.catch(l=>{i&&ue.autoplayFailed(i,"audio",l.message,t),T.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),Yi(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),HR()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){MV.forEach(n=>{t.addEventListener(n,i=>{const o=this.elementStateMap.get(e),a=i.type==="pause"?"paused":i.type;if(T.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(a)),i.type==="error"){const c=t==null?void 0:t.error;c&&T.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,a)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new re(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{pc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function It(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new N(I.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];const l=i.apply(this,a);return l instanceof re?new re((u,p)=>{l.then(u).catch(p)}):l}),n}}var UV=po("Array").values,xV=mo,VV=Zn,jV=B,FV=UV,em=Array.prototype,BV={DOMTokenList:!0,NodeList:!0},Or=function(e){var t=e.values;return e===em||jV(em,e)&&t===em.values||VV(BV,xV(e))?FV:t};function sy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function xl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sy(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sy(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class ay extends Rt{constructor(t){super(),_(this,"name","VideoProcessorDestination"),_(this,"ID","0"),_(this,"_source",void 0),_(this,"videoContext",void 0),_(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new N(I.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new N(I.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(hn.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(hn.ON_TRACK,void 0)}}class cy extends Rt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),_(this,"constraintsMap",new Map),_(this,"statsRegistry",[]),_(this,"usageRegistry",[]),_(this,"trackId",void 0),_(this,"direction",void 0),_(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await mn(this,Hn.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),gt(this,Hn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Or(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return T.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),gt(this,Hn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Or(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:i,type:o,stats:c})}catch(c){T.error(new N(I.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof re&&(i=await i),t.push(xl(xl({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class dy extends Rt{constructor(t){super(),_(this,"name","AudioProcessorDestination"),_(this,"ID","0"),_(this,"inputTrack",void 0),_(this,"inputNode",void 0),_(this,"audioProcessorContext",void 0),_(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new N(I.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new N(I.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(hn.ON_TRACK,void 0),this.emit(hn.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(hn.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(hn.ON_NODE,this.inputNode))}}class ly extends Rt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),_(this,"constraintsMap",new Map),_(this,"statsRegistry",[]),_(this,"audioContext",void 0),_(this,"trackId",void 0),_(this,"direction",void 0),_(this,"usageRegistry",[]),_(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return mn(this,Hn.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),gt(this,Hn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Or(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),gt(this,Hn.REQUEST_UPDATE_CONSTRAINTS,Array.from(Or(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:o,cb:a}of this.statsRegistry)try{const c=a();t.push({processorID:n,processorName:i,type:o,stats:c})}catch(c){T.error(new N(I.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof re&&(i=await i),t.push(xl(xl({},i),{},{direction:this.direction}))}catch(i){T.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class tm extends Rt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),_(this,"context",void 0),_(this,"processSourceNode",void 0),_(this,"outputTrack",void 0),_(this,"processedNode",void 0),_(this,"clonedTrack",void 0),_(this,"outputNode",void 0),this.outputNode=new GV}setVolume(){}createOutputTrack(){throw new N(I.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class GV{disconnect(){}connect(){}}let Vl,fa=null;class WV{constructor(){_(this,"state","open"),_(this,"trigger",void 0),_(this,"tasks",[]),T.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",T.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(t=>t.key),"]")),this.trigger=void 0,this.tasks.forEach(t=>{let{func:n}=t;return n()}),this.tasks.length=0,T.debug("[macro-task-queue] is closed.")})}enqueue(t,n){this.state!=="closed"&&(this.tasks.push({key:t,func:n}),T.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")))}runTask(t){if(this.state==="closed")return;const n=this.tasks.findIndex(i=>i.key===t);if(n!==-1){const i=this.tasks.splice(n,1);T.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")),i[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,T.debug("[macro-task-queue] is closed."))}}function nm(e){return function(t,n,i){var o;const a=(o=i.value)!==null&&o!==void 0?o:i.get,c=function(){fa&&fa.state==="open"&&fa.runTask(e);for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];return a==null?void 0:a.apply(this,...u)};return i.value?i.value=c:i.get=c,i}}var uy,hy,py,fy,my,Ey,_y,gy,Sy,vy,Ty,Ry,yy,Iy,Cy,Ay,wy,Oy,Ny,by,Dy,ze,Py,ky,Ly,My,Uy,xy,Nr,Vy,jy,Fy,By,Gy,Wy,Hy,Ky,zy,Yy,Kn;function qy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function im(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qy(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qy(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})(Vl||(Vl={}));let pn=(uy=nm("INIT_WEBAUDIO"),hy=nm("INIT_WEBAUDIO"),py=nm("INIT_WEBAUDIO"),fy=_e({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),my=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),Ey=It(),_y=ua("LocalAudioTrack","_enabledMutex"),gy=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),Sy=It(),vy=ua("LocalAudioTrack","_enabledMutex"),Ty=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),Ry=It(),yy=It(),Iy=It(),Cy=_e({argsMap:e=>[e.getTrackId()]}),Ay=It(),wy=_e({argsMap:e=>[e.getTrackId()]}),Oy=It(),Ny=_e({argsMap:e=>[e.getTrackId()]}),by=_e({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Dy=_e({argsMap:e=>[e.getTrackId()]}),H((ze=class extends Xf{get _source(){return this._trackSource}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get processorDestination(){return this._processorDestination}set processorDestination(e){this._processorDestination=e}get isPlaying(){return this._useAudioElement?ei.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i,o){super(e,n),_(this,"trackMediaType","audio"),_(this,"_encoderConfig",void 0),_(this,"_trackSource",void 0),_(this,"_enabled",!0),_(this,"_volume",100),_(this,"_useAudioElement",!1),_(this,"_bypassWebAudio",!1),_(this,"processor",void 0),_(this,"_processorContext",void 0),_(this,"_processorDestination",void 0),_(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i;const a=()=>{this.processorContext=new ly(this._source.context,this.getTrackId(),"local"),this.processorDestination=new dy(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Wn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},c=o&&yn()&&!XR();k("DISABLE_WEBAUDIO")?(this._source=new tm,this._useAudioElement=!0,this._bypassWebAudio=!0):c?this._source=new tm:(this._source=new $f(e,!1,this._getOriginVolumeLevel?e:void 0),k("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),a(),!k("DISABLE_WEBAUDIO")&&c&&(fa||(fa=new WV),fa).enqueue("INIT_WEBAUDIO",()=>{this._source=new $f(e,!1,this._getOriginVolumeLevel?e:void 0),k("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),a(),this.emit(Vl.UPDATE_TRACK_SOURCE)})}setVolume(e){dt(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ei.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,gt(this,Se.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement)throw new N(I.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ei.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await gt(this,Se.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await gt(this,Se.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await gt(this,Se.NEED_MUTE_TRACK,this):await gt(this,Se.NEED_UNMUTE_TRACK,this))}getStats(){return Rc(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),br(this,Se.GET_STATS)||im({},Uf)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Wn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Wn.ON_AUDIO_BUFFER),this._source.on(Wn.ON_AUDIO_BUFFER,n=>e(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ei.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ei.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ei.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gt(this,Se.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return re.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new N(I.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new N(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(hn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await gt(this,Se.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gt(this,Se.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(hn.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(hn.ON_TRACK),this.processorDestination.removeAllListeners(hn.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Hn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Hn.REQUEST_CONSTRAINTS)}}).prototype,"_source",[uy],Object.getOwnPropertyDescriptor(ze.prototype,"_source"),ze.prototype),H(ze.prototype,"processorContext",[hy],Object.getOwnPropertyDescriptor(ze.prototype,"processorContext"),ze.prototype),H(ze.prototype,"processorDestination",[py],Object.getOwnPropertyDescriptor(ze.prototype,"processorDestination"),ze.prototype),H(ze.prototype,"setVolume",[fy],Object.getOwnPropertyDescriptor(ze.prototype,"setVolume"),ze.prototype),H(ze.prototype,"setPlaybackDevice",[my,Ey],Object.getOwnPropertyDescriptor(ze.prototype,"setPlaybackDevice"),ze.prototype),H(ze.prototype,"setEnabled",[_y,gy,Sy],Object.getOwnPropertyDescriptor(ze.prototype,"setEnabled"),ze.prototype),H(ze.prototype,"setMuted",[vy,Ty,Ry],Object.getOwnPropertyDescriptor(ze.prototype,"setMuted"),ze.prototype),H(ze.prototype,"getStats",[yy],Object.getOwnPropertyDescriptor(ze.prototype,"getStats"),ze.prototype),H(ze.prototype,"setAudioFrameCallback",[Iy],Object.getOwnPropertyDescriptor(ze.prototype,"setAudioFrameCallback"),ze.prototype),H(ze.prototype,"play",[Cy,Ay],Object.getOwnPropertyDescriptor(ze.prototype,"play"),ze.prototype),H(ze.prototype,"stop",[wy,Oy],Object.getOwnPropertyDescriptor(ze.prototype,"stop"),ze.prototype),H(ze.prototype,"close",[Ny],Object.getOwnPropertyDescriptor(ze.prototype,"close"),ze.prototype),H(ze.prototype,"pipe",[by],Object.getOwnPropertyDescriptor(ze.prototype,"pipe"),ze.prototype),H(ze.prototype,"unpipe",[Dy],Object.getOwnPropertyDescriptor(ze.prototype,"unpipe"),ze.prototype),ze),jl=(Py=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),ky=It(),Ly=ua("MicrophoneAudioTrack","_enabledMutex"),My=_e({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Uy=It(),xy=_e({argsMap:e=>[e.getTrackId()]}),H((Nr=class extends pn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?bl(t.encoderConfig):{},i,k("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),_(this,"_config",void 0),_(this,"_deviceName","default"),_(this,"_constraints",void 0),_(this,"_originalConstraints",void 0),_(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),ea()&&xe.bindInterruptDetectorTrack(this),this.on(Vl.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),XR()&&this.bindProcessorContextEvents()}async setDevice(e){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await fi.getDeviceById(e),n={};n.audio=im({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await zi(n,this.getTrackId())}catch(o){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await zi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await fi.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}T.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await gt(this,Se.NEED_DISABLE_TRACK,this)}catch(c){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const o=im({},this._constraints),a=fi.searchDeviceIdByName(this._deviceName);a&&!o.deviceId&&(o.deviceId=a);try{n||(this._enabled=!0);const c=await zi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await gt(this,Se.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}T.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),ea()&&xe.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((In()||Cr())&&this._enabled&&!this._isClosed&&xe.duringInterruption){const e=async()=>{xe.off(Kt.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};xe.on(Kt.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(To.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=fi.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await zi({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(Hn.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),t()}catch(i){n(i)}}),this.processorContext.on(Hn.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[Py,ky],Object.getOwnPropertyDescriptor(Nr.prototype,"setDevice"),Nr.prototype),H(Nr.prototype,"setEnabled",[Ly,My,Uy],Object.getOwnPropertyDescriptor(Nr.prototype,"setEnabled"),Nr.prototype),H(Nr.prototype,"close",[xy],Object.getOwnPropertyDescriptor(Nr.prototype,"close"),Nr.prototype),Nr),HV=(Vy=_e({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),jy=It(),Fy=_e({argsMap:e=>[e.getTrackId()]}),By=It(),Gy=_e({argsMap:e=>[e.getTrackId()]}),Wy=It(),Hy=_e({argsMap:e=>[e.getTrackId()]}),Ky=It(),zy=_e({argsMap:e=>[e.getTrackId()]}),Yy=It(),H((Kn=class extends pn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),_(this,"source",void 0),_(this,"_bufferSource",void 0),this.source=e,this._bufferSource=t,this._bufferSource.on(Wn.AUDIO_SOURCE_STATE_CHANGE,o=>{this.emit(To.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}}).prototype,"startProcessAudioBuffer",[Vy,jy],Object.getOwnPropertyDescriptor(Kn.prototype,"startProcessAudioBuffer"),Kn.prototype),H(Kn.prototype,"pauseProcessAudioBuffer",[Fy,By],Object.getOwnPropertyDescriptor(Kn.prototype,"pauseProcessAudioBuffer"),Kn.prototype),H(Kn.prototype,"seekAudioBuffer",[Gy,Wy],Object.getOwnPropertyDescriptor(Kn.prototype,"seekAudioBuffer"),Kn.prototype),H(Kn.prototype,"resumeProcessAudioBuffer",[Hy,Ky],Object.getOwnPropertyDescriptor(Kn.prototype,"resumeProcessAudioBuffer"),Kn.prototype),H(Kn.prototype,"stopProcessAudioBuffer",[zy,Yy],Object.getOwnPropertyDescriptor(Kn.prototype,"stopProcessAudioBuffer"),Kn.prototype),Kn);class Ai extends pn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=ha().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ht(8,"track-mix-")),_(this,"trackList",void 0),_(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(T.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):T.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){T.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}sm(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}}class KV extends Rt{constructor(){super(...arguments),_(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(o&&(o.result.push(i),o.result.length>=5)){const a=o.result.includes(!0);o.isPrevNormal&&!a&&this.emit("exception",Jy[t],t,n),!o.isPrevNormal&&a&&this.emit("exception",Jy[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=a,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Ai&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=qr(n._encoderConfig.frameRate));const o=t.captureFrameRate;return!i||!o||!(i>10&&o<5||i<10&&i>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Ai&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const Jy={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},wi=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function Xy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function _s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xy(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xy(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class ma{constructor(t){_(this,"store",void 0),_(this,"onStatsException",void 0),_(this,"onUploadPublishDuration",void 0),_(this,"localStats",new Map),_(this,"remoteStats",new Map),_(this,"updateStatsInterval",void 0),_(this,"trafficStats",void 0),_(this,"trafficStatsPeerList",[]),_(this,"uplinkStats",void 0),_(this,"exceptionMonitor",void 0),_(this,"p2pChannel",void 0),_(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new KV,this.exceptionMonitor.on("exception",(n,i,o)=>{this.onStatsException&&this.onStatsException(n,i,o)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(oe.LocalAudioTrack)||_s({},Uf)}getLocalVideoTrackStats(){return this.localStats.get(oe.LocalVideoTrack)||_s({},xf)}getRemoteAudioTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return l&&(c.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(t){var o;const a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;a&&(i[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{audioStats:l}]=a;l&&(i[c]=n(c,l))});return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{networkStats:c}]=o;c&&(n[a]=c)});return n}getRemoteVideoTrackStats(t){const n=(a,c)=>{if(!this.trafficStats)return c;const l=this.trafficStats.peer_delay.find(u=>u.peer_uid===a);return l&&(c.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(t){var o;const a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;a&&(i[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[c,{videoStats:l}]=a;l&&(i[c]=n(c,l))});return i}getRTCStats(){let t=0,n=0,i=0,o=0;const a=this.localStats.get(oe.LocalAudioTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const c=this.localStats.get(oe.LocalVideoTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const l=this.localStats.get(oe.LocalVideoLowTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(p=>{let{audioStats:f,videoStats:m}=p;f&&(i+=f.receiveBytes,o+=f.receiveBitrate),m&&(i+=m.receiveBytes,o+=m.receiveBitrate)});let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var i;const o=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),a=o!=null&&o.videoSSRC?wi.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,c=o!=null&&o.audioSSRC?wi.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>c?a:c),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const o=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,a=!i||n.framesDecodeCount>i.framesDecodeCount;return o||!a}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[i,o]=n;switch(i){case oe.LocalVideoTrack:case oe.LocalVideoLowTrack:{const a=o,c=_s({},xf),l=t.getStats(),u=t.getLocalMedia(i);if(l){const p=l.videoSend.find(f=>f.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(p){const f=t.getLocalVideoSize(),m=t.getEncoderConfig(oe.LocalVideoTrack);p.codec!=="H264"&&p.codec!=="VP8"&&p.codec!=="VP9"&&p.codec!=="AV1X"&&p.codec!=="AV1"||(c.codecType=p.codec),c.sendBytes=p.bytes,c.sendBitrate=a?8*Math.max(0,c.sendBytes-a.sendBytes):0,p.inputFrame?(c.captureFrameRate=p.inputFrame.frameRate,c.captureResolutionHeight=p.inputFrame.height,c.captureResolutionWidth=p.inputFrame.width):f&&(c.captureResolutionWidth=f.width,c.captureResolutionHeight=f.height),p.sentFrame?(c.sendFrameRate=p.sentFrame.frameRate,c.sendResolutionHeight=p.sentFrame.height,c.sendResolutionWidth=p.sentFrame.width):f&&(c.sendResolutionWidth=f.width,c.sendResolutionHeight=f.height),p.avgEncodeMs&&(c.encodeDelay=p.avgEncodeMs),m&&m.bitrateMax&&(c.targetSendBitrate=1e3*m.bitrateMax),c.sendPackets=p.packets,c.sendPacketsLost=p.packetsLost,c.totalDuration=a?a.totalDuration+1:1,c.totalFreezeTime=a?a.totalFreezeTime:0,this.isLocalVideoFreeze(p)&&(c.totalFreezeTime+=1)}this.trafficStats&&(c.sendPacketsLost=this.trafficStats.B_pvlr4/100)}this.localStats.set(i,c),c&&u&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,u.track,c);break}case oe.LocalAudioTrack:{const a=o,c=_s({},Uf),l=t.getStats(),u=t.getLocalMedia(i);if(l){const p=l.audioSend.find(f=>f.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(p){if(p.codec!=="opus"&&p.codec!=="aac"&&p.codec!=="PCMU"&&p.codec!=="PCMA"&&p.codec!=="G722"||(c.codecType=p.codec),p.inputLevel)c.sendVolumeLevel=Math.round(32767*p.inputLevel);else{const f=t.getLocalAudioVolume();f&&(c.sendVolumeLevel=Math.round(32767*f))}c.sendBytes=p.bytes,c.sendPackets=p.packets,c.sendPacketsLost=p.packetsLost,c.sendBitrate=a?8*Math.max(0,c.sendBytes-a.sendBytes):0}}this.trafficStats&&(c.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(oe.LocalAudioTrack,c),c&&u&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,u.track,c);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{let[i,{videoStats:o,audioStats:a,videoPcStats:c}]=n;const l=a,u=o,p=c,f=_s({},CR),m=_s({},AR),v=_s({},Ix),{audioTrack:R,videoTrack:w,audioSSRC:A,videoSSRC:O}=t.getRemoteMedia(i),U=t.getStats(),x=U==null?void 0:U.audioRecv.find(Z=>Z.ssrc===A),Q=U==null?void 0:U.videoRecv.find(Z=>Z.ssrc===O),pe=this.trafficStats&&this.trafficStats.peer_delay.find(Z=>Z.peer_uid===i);if(x&&(x.codec!=="opus"&&x.codec!=="aac"&&x.codec!=="PCMU"&&x.codec!=="PCMA"&&x.codec!=="G722"||(f.codecType=x.codec),x.outputLevel?f.receiveLevel=Math.round(32767*x.outputLevel):R&&(f.receiveLevel=Math.round(32767*R.getVolumeLevel())),f.receiveBytes=x.bytes,f.receivePackets=x.packets,f.receivePacketsLost=x.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.receiveBitrate=l?8*Math.max(0,f.receiveBytes-l.receiveBytes):0,f.totalDuration=l?l.totalDuration+1:1,f.totalFreezeTime=l?l.totalFreezeTime:0,f.freezeRate=f.totalFreezeTime/f.totalDuration,f.receiveDelay=x.jitterBufferMs,f.totalDuration>10&&ma.isRemoteAudioFreeze(R)&&(f.totalFreezeTime+=1)),Q){Q.codec!=="H264"&&Q.codec!=="VP8"&&Q.codec!=="VP9"&&Q.codec!=="AV1X"&&Q.codec!=="AV1"||(m.codecType=Q.codec),m.receiveBytes=Q.bytes,m.receiveBitrate=u?8*Math.max(0,m.receiveBytes-u.receiveBytes):0,m.decodeFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,m.renderFrameRate=Q.decodeFrameRate<0?0:Q.decodeFrameRate,Q.outputFrame&&(m.renderFrameRate=Q.outputFrame.frameRate),Q.receivedFrame?(m.receiveFrameRate=Q.receivedFrame.frameRate,m.receiveResolutionHeight=Q.receivedFrame.height,m.receiveResolutionWidth=Q.receivedFrame.width):w&&(m.receiveResolutionHeight=w._videoHeight||0,m.receiveResolutionWidth=w._videoWidth||0),Q.framesRateFirefox!==void 0&&(m.receiveFrameRate=Math.round(Q.framesRateFirefox)),m.receivePackets=Q.packets,m.receivePacketsLost=Q.packetsLost,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.totalDuration=u?u.totalDuration+1:1,m.totalFreezeTime=u?u.totalFreezeTime:0,m.receiveDelay=Q.jitterBufferMs||0;const Z=!!O&&t.getRemoteVideoIsReady(O);w&&Z&&ma.isRemoteVideoFreeze(w,Q,p)&&(m.totalFreezeTime+=1),m.freezeRate=m.totalFreezeTime/m.totalDuration}pe&&(f.end2EndDelay=pe.B_ad,m.end2EndDelay=pe.B_vd,f.transportDelay=pe.B_ed,m.transportDelay=pe.B_ed,f.currentPacketLossRate=pe.B_ealr4/100,m.currentPacketLossRate=pe.B_evlr4/100,v.uplinkNetworkQuality=pe.B_punq?pe.B_punq:0,v.downlinkNetworkQuality=pe.B_pdnq?pe.B_pdnq:0),this.remoteStats.set(i,{audioStats:f,videoStats:m,videoPcStats:Q,networkStats:v}),R&&this.exceptionMonitor.setRemoteAudioStats(R,f),w&&this.exceptionMonitor.setRemoteVideoStats(w,m)})}}const Yr=new class extends Rt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),_(this,"_lastHiddenTime",0),_(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function Qy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Fl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qy(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qy(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Bl(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(k("TURN_DOMAIN")):(T.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function $y(e,t){var n,i;const o=k("GATEWAY_DOMAINS");let a=o[1]&&t.indexOf(o[1])!==-1?1:0;e.addresses=e.addresses||[];const c=e.addresses.map(u=>u.domain_prefix?{address:"".concat(u.domain_prefix,".").concat(o[a++%o.length],":").concat(u.port)}:u.ip.match(/^[\.\:\d]+$/)?{ip:u.ip,port:u.port,address:"".concat(u.ip.replace(/[^\d]/g,"-"),".").concat(o[a++%o.length],":").concat(u.port)}:(T.info("Cannot recognized as IP address ".concat(u.ip,". Used As Host instead")),{ip:u.ip,port:u.port,address:"".concat(u.ip,":").concat(u.port)}));if((n=e.detail)!==null&&n!==void 0&&n[18]&&typeof((i=e.detail)===null||i===void 0?void 0:i[18])=="string"){const u=e.detail[18],p=u==null?void 0:u.split(";");for(let f=0;f<p.length;f++){var l;const m=Gr(l=p[f]).call(l);c[f]&&m&&(c[f].ip6=m)}}return{gatewayAddrs:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function qr(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function Zy(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(qr(t.width),"x").concat(qr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function eI(e,t,n){var i,o,a,c,l,u,p,f;const m=t.videoSend.find(O=>O.ssrc===e);if(!m)return null;const v={id:ht(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:m.ssrc.toString()},R=(i=(o=(a=m.inputFrame)===null||a===void 0?void 0:a.height)!==null&&o!==void 0?o:n==null?void 0:n._videoHeight)!==null&&i!==void 0?i:0,w=(c=(l=(u=m.inputFrame)===null||u===void 0?void 0:u.width)!==null&&l!==void 0?l:n==null?void 0:n._videoWidth)!==null&&c!==void 0?c:0,A=(p=(f=m.inputFrame)===null||f===void 0?void 0:f.frameRate)!==null&&p!==void 0?p:0;return R&&(v.A_fhi=R+""),w&&(v.A_fwi=w+""),A&&(v.A_fri=A+""),v}function tI(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function rm(e,t){let n,i,o;switch(t){case Ht.CHOOSE_SERVER:n=4096,i="choose server";break;case Ht.CLOUD_PROXY:n=1048576,i="proxy";break;case Ht.CLOUD_PROXY_5:n=4194304,i="proxy5";break;case Ht.CLOUD_PROXY_FALLBACK:n=4194310,i="proxy fallback";break;default:throw new N(I.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(a=>{a.buffer&&a.buffer.flag===n&&(o={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(c=>Fl(Fl({},c),{},{ticket:a.buffer.cert})),server_ts:e.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:Fl(Fl({},a.buffer.detail),e.detail),flag:a.buffer.flag,opid:e.opid,cert:a.buffer.cert})}),!o)throw new N(I.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return o}async function zV(e,t){return await re.all(e.addresses.map(async n=>({address:Bl(n.ip),tcpport:n.port,udpport:n.port,username:t&&k("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():ci.username,password:t&&k("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await bV(t.toString()):ci.password})))}function YV(e,t){const n=t._videoWidth||t.getMediaStreamTrack(!0).getSettings().width;return n||T.warning("cannot get original video track's width, default scale down 4 times for low stream"),n?n/qr(e.width):4}function Gl(e){let{candidateType:t,relayProtocol:n,type:i,address:o,port:a,protocol:c}=e;return i==="local-candidate"?{candidateType:t,relayProtocol:n,protocol:c}:{candidateType:t,relayProtocol:n,address:o,port:a,protocol:c}}function nI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function gs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nI(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Ea(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function fn(e){return new re(t=>{window.setTimeout(t,e)})}function qV(e){const t=new N(I.TIMEOUT,"timeout");return new re((n,i)=>{window.setTimeout(()=>i(t),e)})}function ht(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+ht(e-n.length,"")}function om(){return ht(32,"").toUpperCase()}const Wl=()=>{};function iI(e){return new re((t,n)=>{let i=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const a=In()?"canplay":"playing";o.addEventListener(a,()=>{const c=o.videoWidth,l=o.videoHeight;!c&&Tt()||(i=!0,o.srcObject=null,o.remove(),t([c,l]))}),o.srcObject=new MediaStream([e]),o.play().catch(Wl),setTimeout(()=>{i||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function _a(e){return re.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}function mn(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return e.getListeners(t).length===0?re.reject(new N(I.UNEXPECTED_ERROR,"can not emit promise")):new re((a,c)=>{e.emit(t,...i,a,c)})}function gt(e,t){if(e.getListeners(t).length===0)return re.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return mn(e,t,...i)}function br(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return Ss(e,t,...i)}function Ss(e,t){let n=null,i=null;for(var o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];if(e.emit(t,...a,l=>{n=l},l=>{i=l}),i!==null)throw i;if(n===null)throw new N(I.UNEXPECTED_ERROR,"handler is not sync");return n}function sm(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function rI(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Yi(e){re.resolve().then(e)}function bt(e){return JSON.parse(JSON.stringify(e))}const oI={};function Rc(e,t){oI[t]||(oI[t]=!0,e())}function am(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function Hl(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}const sI=new class{constructor(){_(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var o=arguments.length,a=new Array(o>4?o-4:0),c=4;c<o;c++)a[c-4]=arguments[c];if(this.fnMap.has(t)){const l=this.fnMap.get(t);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);const u=window.setTimeout(()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:a,skipFn:i})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,gs(gs({},l),{},{fn:e,args:a,skipFn:i}))}else{const l=window.setTimeout(()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:a,skipFn:i})}}},aI=sI.throttleByKey.bind(sI),yc=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:o,promisesCollector:a}=e,c=0;const l=t;let u,p=0;const f=async()=>{const m=(()=>{const v=c*l,R=v+l;return n.slice(v,R).map(i)})();a&&a.push(...m);try{u=await _a(m)}catch(v){if(p+=l,c++,!(p>=n.length))return void await f();o(v)}m.forEach(v=>v.cancel())};return await f(),u};function cI(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}const JV={[ca.ACCESS_POINT]:{[un.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[un.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[un.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[un.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[un.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[un.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[un.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[un.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[un.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[un.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[un.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[un.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[un.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[un.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[un.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[un.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[un.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[un.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ca.UNILBS]:{[di.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[di.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[di.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[di.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[di.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[di.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[di.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[di.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[di.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[di.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[di.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[di.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ca.STRING_UID_ALLOCATOR]:{[gc.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[gc.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[gc.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Kl(e){const t=JV[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===ca.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const XV={[me.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[me.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[me.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[me.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[me.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[me.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[me.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[me.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[me.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[me.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[me.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[me.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[me.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[me.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[me.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[me.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[me.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[me.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[me.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[me.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[me.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[me.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[me.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[me.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[me.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[me.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[me.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[me.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[me.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[me.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[me.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[me.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[me.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[me.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[me.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[me.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[me.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[me.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[me.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[me.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[me.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[me.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[me.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[me.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[me.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[me.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[me.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[me.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[me.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[me.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[me.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[me.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[me.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[me.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[me.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[me.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[me.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[me.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[me.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[me.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[me.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[me.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[me.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[me.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Ic(e){return XV[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function dI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class ga extends Rt{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Oe.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Oe.CONNECTED):this._state==="closed"?this.emit(Oe.CLOSED):this._state==="failed"&&this.emit(Oe.FAILED))}resetReconnectCount(t){T.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4?arguments[4]:void 0;super(),_(this,"connectionID",0),_(this,"currentURLIndex",0),_(this,"urls",void 0),_(this,"_reconnectMode","tryNext"),_(this,"reconnectReason",void 0),_(this,"_initMutex",new On("websocket")),_(this,"name",void 0),_(this,"_state","closed"),_(this,"reconnectInterrupter",void 0),_(this,"websocket",void 0),_(this,"retryConfig",void 0),_(this,"reconnectCount",0),_(this,"forceCloseTimeout",5e3),_(this,"onlineReconnectListener",void 0),_(this,"useCompress",void 0),_(this,"tryDoubleDomain",!1),_(this,"wsInflateLength",0),_(this,"wsDeflateLength",0),_(this,"closeEstablishingWs",()=>{}),_(this,"store",void 0),_(this,"joinChannelServiceRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(f){for(var m=1;m<arguments.length;m++){var v=arguments[m]!=null?arguments[m]:{};m%2?dI(Object(v),!0).forEach(function(R){_(f,R,v[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(v)):dI(Object(v)).forEach(function(R){Object.defineProperty(f,R,Object.getOwnPropertyDescriptor(v,R))})}return f}({},n),this.useCompress=i,this.tryDoubleDomain=o;const{timeout:c,timeoutFactor:l}=n,u=Math.max(300,Math.floor(3*c/5)),p=Math.max(1.2,Math.floor(8*l)/10);Sn.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p),Nt.on(Ro.NETWORK_STATE_CHANGE,(f,m)=>{f!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(f)),f===Sn.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l))})}getConnection(){return this.websocket||void 0}init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=n;const i=(o,a)=>{this.urls=t;const c=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(c).then(o).catch(a),this.once(Oe.CLOSED,()=>a(new N(I.WS_DISCONNECT))),this.once(Oe.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new re((a,c)=>{i(a,c)}).then(()=>{o()}).catch(()=>{o()}))}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout(()=>i.close(),500):i.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((i=this.store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinChannelServiceRecordIndex));const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new N(I.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new N(I.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t,n){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new re((i,o)=>{var a;const c=f=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),f),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i()},l=async f=>{if(T.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const m=br(this,Oe.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,v=await this.reconnectWithAction(m);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!v)return o(new N(I.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),void this.close(!0);i()}else o(new N(I.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close()},u=f=>{this.emit(Oe.ON_MESSAGE,f)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),k("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=k("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url: ").concat(t));const p=(a=this.store)===null||a===void 0?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(t,!!n,p).then(f=>{var m;this.websocket=f,c&&c(f.url),f.onclose=l,f.onmessage=u,(m=this.store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this.joinChannelServiceRecordIndex=p}).catch(f=>{var m;if((m=this.store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:f instanceof N&&f.code===I.WS_ABORT?"aborted":"error",errors:[f]},p),this.state!=="closed"){if(f instanceof N&&f.code===I.WS_ERR){const v=new N(I.WS_ERR,"init websocket failed! Error: ".concat(f.toString()));return T.error("[".concat(this.name,"]").concat(v)),void o(v)}l&&l(f)}else o(new N(I.WS_DISCONNECT,"websocket is closed: ".concat(f.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||Nt.networkState!==Sn.OFFLINE||(this.onlineReconnectListener=Nt.onlineWaiter&&Nt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let i=!0;if(this.reconnectInterrupter=()=>{i=!1},n){const c=Sf(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await re.race([fn(c),this.onlineReconnectListener||new re(()=>{})])}if(this.state==="closed"||!i)return!1;this.reconnectCount+=1;const o=async(c,l)=>{this.emit(Oe.RECONNECT_CREATE_CONNECTION,l),await this.createWebSocketConnection(c)};try{if(t==="retry"){const c=this.urls[this.currentURLIndex];this.emit(Oe.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const c=this.urls[this.currentURLIndex];this.emit(Oe.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="recover"){T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Oe.RECONNECT_WAITTING_FINISH,t),this.urls=await mn(this,Oe.REQUEST_NEW_URLS),this.currentURLIndex=0;const c=this.urls[this.currentURLIndex];await o(c,t)}return!0}catch(c){var a;return T.error("[".concat(this.name,"] reconnect failed"),c.toString()),c!=null&&(a=c.data)!==null&&a!==void 0&&a.desc&&Array.isArray(c.data.desc)&&c.data.desc.length&&c.data.desc.includes("dynamic key expired")?(this.emit(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}async chooseBestWebsocketConnection(t,n,i){return new re((o,a)=>{let c=!1;const l=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),l.forEach(A=>{A.onclose=null,A.onopen=null,A.onmessage=null,A.close()}),a(new N(I.WS_ABORT,"choose best websocket aborted"))};const u=k("GATEWAY_DOMAINS");let p;const f=t.indexOf("?h="),m=u.find(A=>f!==-1?t.includes(A,f):t.includes(A));T.debug("[choose-best-ws] currentDomain: ",m,", domains: ",u);let v=!this.tryDoubleDomain||n||!m;if(!v&&m){var R;const A=Date.now();try{u.forEach(O=>{const U=f===-1?t.replace(m,O):t.substr(0,f)+t.substr(f).replace(m,O),x=new WebSocket(U);x.binaryType="arraybuffer",l.push(x),T.debug("[choose-best-ws] ws is connecting:",x.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(U=>U.close());l.length;)l.pop();v=!0}(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:l.map(O=>O.url),service:"gateway"},i),l.forEach(O=>{O.onopen=()=>{if(c)return;const U=Date.now()-A;T.debug("[choose-best-ws] ws open cost ".concat(U,"ms")),l.filter(x=>x!==O).forEach(x=>{T.debug("[choose-best-ws]close backup websocket: ".concat(x.url)),x.close()}),c=!0,o(O)},O.onclose=U=>{p=U,!c&&(l.find(x=>!(x.readyState===WebSocket.CLOSED||x.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),c=!0,a(p)))},O.onmessage=U=>{T.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(U.data))}}),fn(this.forceCloseTimeout).then(()=>{l.forEach(O=>{O.readyState!==WebSocket.OPEN&&O.close()})})}if(v){var w;let A;T.debug("[choose-best-ws] use single url: ",t),(w=this.store)===null||w===void 0||w.recordJoinChannelService({urls:[t],service:"gateway"},i);try{A=new WebSocket(t),l.push(A),A.binaryType="arraybuffer"}catch(O){const U=new N(I.WS_ERR,"init websocket failed! Error: ".concat(O.toString()));return T.error("[".concat(this.name,"]").concat(U)),void a(U)}A.onopen=()=>{o(A)},A.onclose=O=>{a(O)},A.onmessage=O=>{T.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(O.data))},fn(this.forceCloseTimeout).then(()=>{A&&A.readyState!==WebSocket.OPEN&&A.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class lI{constructor(t){_(this,"input",[]),_(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:fo(t=this.input).call(t,(n,i)=>n+i)/this.input.length}}class uI extends Rt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Je.CONNECTED?this.emit(le.WS_CONNECTED):t===Je.RECONNECTING?this.emit(le.WS_RECONNECTING,this._websocketReconnectReason):t===Je.CLOSED&&this.emit(le.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),_(this,"_disconnectedReason",void 0),_(this,"_websocketReconnectReason",void 0),_(this,"_connectionState",Je.CLOSED),_(this,"reconnectToken",void 0),_(this,"websocket",void 0),_(this,"openConnectionTime",void 0),_(this,"clientId",void 0),_(this,"lastMsgTime",Date.now()),_(this,"uploadCache",[]),_(this,"uploadCacheInterval",void 0),_(this,"rttRolling",new lI(5)),_(this,"pingpongTimer",void 0),_(this,"wsInflateDataTimer",void 0),_(this,"pingpongTimeoutCount",0),_(this,"joinResponse",void 0),_(this,"multiIpOption",void 0),_(this,"initError",void 0),_(this,"spec",void 0),_(this,"store",void 0),_(this,"onWebsocketMessage",i=>{if(i.data instanceof ArrayBuffer)return void this.emit(le.ON_BINARY_DATA,i.data);const o=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===be.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===be.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Ke.UID_BANNED);break;case 15:this.close(Ke.IP_BANNED);break;case 16:this.close(Ke.CHANNEL_BANNED)}if(o._type===be.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case me.ERR_LICENSE_MISSING:this.close(Ke.LICENSE_MISSING);break;case me.ERR_LICENSE_EXPIRED:this.close(Ke.LICENSE_EXPIRED);break;case me.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ke.LICENSE_MINUTES_EXCEEDED);break;case me.ERR_LICENSE_PERIOD_INVALID:this.close(Ke.LICENSE_PERIOD_INVALID);break;case me.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ke.LICENSE_MULTIPLE_SDK_SERVICE);break;case me.ERR_LICENSE_ILLEGAL:this.close(Ke.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new ga("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Je.CONNECTED&&this.reconnect("retry",kn.OFFLINE)})}async request(t,n,i,o){const a=ht(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,u=()=>new re((w,A)=>{if(this.connectionState===Je.CONNECTED)return w();const O=()=>{this.off(le.WS_CLOSED,U),w()},U=()=>{this.off(le.WS_CONNECTED,O),A(new N(I.WS_ABORT))};this.once(le.WS_CONNECTED,O),this.once(le.WS_CLOSED,U),t!==ge.PUBLISH&&t!==ge.SUBSCRIBE&&t!==ge.UNSUBSCRIBE&&t!==ge.UNPUBLISH&&t!==ge.CONTROL&&t!==ge.RESTART_ICE||this.once(le.DISCONNECT_P2P,()=>{A(new N(I.DISCONNECT_P2P))}),t!==ge.PUBLISH&&t!==ge.RESTART_ICE||this.once(le.ABORT_P2P_EXECUTION,()=>{A(new N(I.DISCONNECT_P2P))})});if(this.connectionState!==Je.CONNECTING&&this.connectionState!==Je.RECONNECTING||t===ge.JOIN||t===ge.REJOIN||await u(),this.websocket.sendMessage(c,!0),o)return;const p=new re((w,A)=>{let O=!1;const U=(Q,pe)=>{O=!0,w({isSuccess:Q==="success",message:pe||{}}),this.off(le.WS_CLOSED,x),this.off(le.WS_RECONNECTING,x),this.emit(le.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),U);const x=()=>{A(new N(I.WS_ABORT,"type: ".concat(t))),this.off(le.WS_CLOSED,x),this.off(le.WS_RECONNECTING,x),this.off("res-@".concat(a),U)};this.once(le.WS_CLOSED,x),this.once(le.WS_RECONNECTING,x),fn(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(T.warning("ws request timeout, type: ".concat(t)),this.emit(le.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await p}catch(w){if(this.connectionState===Je.CLOSED||t===ge.LEAVE)throw new N(I.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():t===ge.JOIN||t===ge.REJOIN?null:(await u(),await this.request(t,n))}if(f.isSuccess)return f.message;const m=Number(f.message.error_code||f.message.code),v=Ic(m),R=new N(I.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(f.message.error_str),{code:m,data:f.message});return v.action==="success"?f.message:(T.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(v.desc,", action: ").concat(v.action)),m===me.ERR_TOO_MANY_BROADCASTERS?((t===ge.JOIN||t===ge.REJOIN)&&(this.initError=R,this.close()),R.throw()):v.action==="failed"?R.throw():v.action==="quit"?(this.initError=R,this.close(),R.throw()):(m===me.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",kn.MULTI_IP)):this.reconnect(v.action,kn.SERVER_ERROR),t===ge.JOIN||t===ge.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new re(i=>{const o=a=>{(!n||n(a))&&(this.off(t,o),i(a))};this.on(t,o)})}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const a=k("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Je.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},k("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new re((i,o)=>{this.once(le.WS_CONNECTED,()=>i(this.joinResponse)),this.once(le.WS_CLOSED,()=>o(this.initError||new N(I.WS_ABORT))),this.connectionState=Je.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(T.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),o(new N(I.INIT_WEBSOCKET_TIMEOUT)))},k("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ke.LEAVE,this.connectionState=Je.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===Ke.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new ga("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(le.ABORT_P2P_EXECUTION);const t=await mn(this,le.REQUEST_JOIN_INFO),n=await this.request(ge.JOIN,t);if(!n)return this.emit(le.REPORT_JOIN_GATEWAY,I.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(le.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Je.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new N(I.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ss(this,le.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ge.REJOIN,t);return!!n&&(this.connectionState=Je.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(be.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(be.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(be.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(be.MUTE_AUDIO,{uid:i.uid}):this.emit(be.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(be.MUTE_VIDEO,{uid:i.uid}):this.emit(be.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(be.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(be.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(be.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(be.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(be.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ic(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ke.UID_BANNED),void this.close()):void this.reconnect(n.action,kn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=k("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>k("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",kn.TIMEOUT):this.request(ge.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),k("REPORT_STATS")&&this.send(ge.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Gn.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Oe.RECONNECT_WAITTING_FINISH,t=>{this.emit(le.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Oe.RECONNECT_CREATE_CONNECTION,t=>{this.emit(le.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Oe.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Oe.CLOSED,()=>{this.connectionState=Je.CLOSED}),this.websocket.on(Oe.FAILED,()=>{this._disconnectedReason=Ke.NETWORK_ERROR,this.connectionState=Je.CLOSED}),this.websocket.on(Oe.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Je.CONNECTED?this.connectionState=Je.RECONNECTING:this.connectionState=Je.CONNECTING}),this.websocket.on(Oe.WILL_RECONNECT,(t,n)=>{if(Ss(this,le.IS_P2P_DISCONNECTED)&&t==="retry")return T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(T.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P)),n(t)}),this.websocket.on(Oe.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",kn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(le.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof N&&t.code===I.UNEXPECTED_RESPONSE&&t.data.code===me.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",kn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",kn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Oe.REQUEST_NEW_URLS,(t,n)=>{mn(this,le.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(be.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function hI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}class QV extends Rt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(_t.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(_t.CONNECTED):this._state==="closed"?this.emit(_t.CLOSED):this._state==="failed"&&this.emit(_t.FAILED))}constructor(t,n,i,o){super(),_(this,"connectionID",0),_(this,"currentURLIndex",0),_(this,"reconnectReason",void 0),_(this,"_reconnectMode","tryNext"),_(this,"_initMutex",void 0),_(this,"_name",void 0),_(this,"_state","closed"),_(this,"_reconnectInterrupter",void 0),_(this,"_url",void 0),_(this,"_retryConfig",void 0),_(this,"_reconnectCount",0),_(this,"_forceCloseTimeout",5e3),_(this,"_onlineReconnectListener",void 0),_(this,"_closeEstablishingTransmitter",()=>{}),_(this,"_store",void 0),_(this,"_joinChannelServiceRecordIndex",void 0),_(this,"_transmitter",void 0),_(this,"_useCompress",void 0),_(this,"_inflateLength",0),_(this,"_deflateLength",0),this._store=o,this._name=t,this._retryConfig=function(a){for(var c=1;c<arguments.length;c++){var l=arguments[c]!=null?arguments[c]:{};c%2?hI(Object(l),!0).forEach(function(u){_(a,u,l[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):hI(Object(l)).forEach(function(u){Object.defineProperty(a,u,Object.getOwnPropertyDescriptor(l,u))})}return a}({},n),this._useCompress=i}resetReconnectCount(t){T.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const i=this._transmitter;n?setTimeout(()=>i.close(),500):i.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void T.warning("[".concat(this._name,"] can not reconnect, no websocket"));var i;t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((i=this._store)===null||i===void 0||i.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const o=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),o&&o.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function pI(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const i=e.getUint32(t,n),o=e.getUint32(t+4,n),a=+!!n,c=+!n;return BigInt(i*c+o*a)<<BigInt(32)|BigInt(i*a+o*c)}function fI(e,t,n,i){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,i);const o=Number(n>>BigInt(32)),a=Number(n&BigInt(4294967295));i?(e.setUint32(t+4,o,i),e.setUint32(t,a,i)):(e.setUint32(t,o,i),e.setUint32(t+4,a,i))}let Oi;(function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"})(Oi||(Oi={}));class $V{constructor(t,n,i){_(this,"version",1),_(this,"initialRTO",void 0),_(this,"maxBatchAckCount",void 0),_(this,"maxRTO",void 0),_(this,"initialRTT",void 0),_(this,"ID",void 0),_(this,"rtt",void 0),_(this,"packetNumber",1),_(this,"rtoRatioMap",new Map),_(this,"timeoutMap",new Map),_(this,"unorderedPacketQueue",[]),_(this,"batchAckPacketQueue",[]),_(this,"lastOrderedPacketNumber",0),_(this,"batchAckTimer",void 0),_(this,"sendImpl",void 0),_(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=ht(7,"transmitter-"),this.initialRTO=(i==null?void 0:i.initialRTO)!==void 0?i.initialRTO:k("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:k("TRANSMITTER_INITIAL_RTT"),this.rtt=(i==null?void 0:i.initialRTT)!==void 0?i.initialRTT:k("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(i==null?void 0:i.maxBatchAckCount)!==void 0?i.maxBatchAckCount:k("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(i==null?void 0:i.maxRTO)!==void 0?i.maxRTO:k("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Oi.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Oi.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const i=new ArrayBuffer(n.length+15),o=new DataView(i);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.packetNumber),fI(o,7,BigInt(t.sendTs)),new Uint8Array(o.buffer).set(n,15),i}case Oi.Ack:{const n=new ArrayBuffer(16),i=new DataView(n);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.maxAckPacketNumber),i.setUint8(7,t.shift),fI(i,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),i=n.getUint16(0),o=n.getUint8(2);switch(o){case Oi.Default:{const a=n.getUint32(3),c=pI(n,7),l=t.slice(15),u=new TextDecoder().decode(l);return{version:i,type:o,packetNumber:a,sendTs:Number(c),payload:u}}case Oi.Ack:{const a=n.getUint32(3),c=n.getUint8(7),l=pI(n,8);return{version:i,type:o,maxAckPacketNumber:a,shift:c,ackSendTs:Number(l)}}default:throw T.error("[".concat(this.ID,"] Unrecognized packet type ").concat(o)),new Error("Unrecognized packet type ".concat(o))}}sendMessage(t){const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const i=this.calculateRTO(n),o=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,o),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===Oi.Default?this.ack(n):n.type===Oi.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,i]=t;window.clearTimeout(i)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),i=window.setTimeout(()=>{this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,i),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const i=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),i>this.maxRTO?this.maxRTO:i}}updateRTT(t,n){const i=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-i-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Oi.Ack,version:this.version};this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Oi.Ack,version:this.version};this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Oi.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Oi.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const i=this.timeoutMap.get(n);i!==void 0&&window.clearTimeout(i),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class mI extends QV{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),_(this,"_initMutex",void 0),_(this,"_reconnectInterrupter",void 0),_(this,"_url",void 0),_(this,"_transmitter",void 0),_(this,"_addresses",void 0),_(this,"_reliableTransmission",void 0),this._initMutex=new On("datachannel");const{timeout:i,timeoutFactor:o}=n,a=Math.max(300,Math.floor(3*i/5)),c=Math.max(1.2,Math.floor(8*o)/10);Sn.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c),Nt.on(Ro.NETWORK_STATE_CHANGE,(l,u)=>{l!==u&&(this.resetReconnectCount("network state change: ".concat(u," -> ").concat(l)),l===Sn.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=c):(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const i=(o,a)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(l=>l.fingerprint||k("FINGERPRINT"));const c=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(c).then(o).catch(a),this.once(_t.CLOSED,()=>a(new N(I.WS_DISCONNECT))),this.once(_t.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new re((a,c)=>{i(a,c)}).then(()=>{o()}).catch(()=>{o()}))}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new N(I.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(i){throw new N(I.WS_ERR,"send datachannel signal message error"+i.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new re((n,i)=>{var o;const a=()=>{T.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},c=async f=>{var m;if((m=this._closeEstablishingTransmitter)===null||m===void 0||m.call(this),T.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const v=br(this,_t.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,R=await this.reconnectWithAction(v);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!R)return i(new N(I.WS_DISCONNECT,"datachannel reconnect failed: ".concat(f.code))),void this.close(!0);n()}else i(new N(I.WS_DISCONNECT,"datachannel close: ".concat(f.code))),this.close()},l=f=>{var m;(m=this._reliableTransmission)===null||m===void 0||m.onData(f.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),T.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const u=(o=this._store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),p=Date.now();mn(this,_t.TO_CONNECT_DATACHANNEL,t).then(f=>{var m,v;if(!f)throw new Error("transmissonInfo not exist yet");const{transmitter:R,close:w}=f;this._transmitter=R,(m=this._store)===null||m===void 0||m.signalChannelOpen();const A=Date.now()-p;T.debug("[choose dc] dc open cost ".concat(A,"ms")),this._reliableTransmission=new $V(O=>{var U;this._transmitter&&this._transmitter.readyState==="open"&&((U=this._transmitter)===null||U===void 0||U.send(O))},O=>{typeof O=="string"&&this.emit(_t.ON_MESSAGE,O)}),this._closeEstablishingTransmitter=()=>{var O;(O=this._reliableTransmission)===null||O===void 0||O.close(),this._reliableTransmission=void 0,w()},a&&a(),R.onclose=c,R.onmessage=l,(v=this._store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this._joinChannelServiceRecordIndex=u}).catch(f=>{var m;if((m=this._store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:f instanceof N&&f.code===I.WS_ABORT?"aborted":"error",errors:[f]},u),this.state!=="closed"){if(f instanceof N&&f.code===I.WS_ERR){const v=new N(I.WS_ERR,"init datachannel failed! Error: ".concat(f.toString()));return T.error("[".concat(this._name,"]").concat(v)),void i(v)}c&&c(f)}else i(new N(I.WS_DISCONNECT,"datachannel is closed: ".concat(f.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||Nt.networkState!==Sn.OFFLINE||(this._onlineReconnectListener=Nt.onlineWaiter&&Nt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let i=!0;if(this._reconnectInterrupter=()=>{i=!1},n){const c=Sf(this._reconnectCount,this._retryConfig);T.debug("[".concat(this._name,"] wait ").concat(c,"ms to reconnect datachannel, mode: ").concat(t)),await re.race([fn(c),this._onlineReconnectListener||new re(()=>{})])}if(this.state==="closed"||!i)return!1;this._reconnectCount+=1;const o=async(c,l)=>{this.emit(_t.RECONNECT_CREATE_CONNECTION,l),await this.createTransmitterConnection(c)};try{if(t==="retry"){const c=this._addresses[this.currentURLIndex];this.emit(_t.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let l=this.currentURLIndex;l<this._addresses.length;l++){if(this._addresses[l].fingerprint||k("FINGERPRINT")){this.currentURLIndex=l;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return T.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);T.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const c=this._addresses[this.currentURLIndex];this.emit(_t.RECONNECT_WAITTING_FINISH,t),await o(c,t)}else t==="recover"&&(T.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(_t.RECONNECT_WAITTING_FINISH,t),this.emit(_t.FAILBACK));return!0}catch(c){var a;return T.error("[".concat(this._name,"] reconnect failed"),c.toString()),c!=null&&(a=c.data)!==null&&a!==void 0&&a.desc&&Array.isArray(c.data.desc)&&c.data.desc.length&&c.data.desc.includes("dynamic key expired")?(this.emit(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class Jr extends Rt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Je.CONNECTED?this.emit(le.WS_CONNECTED):t===Je.RECONNECTING?this.emit(le.WS_RECONNECTING,this._websocketReconnectReason):t===Je.CLOSED&&this.emit(le.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),_(this,"_disconnectedReason",void 0),_(this,"_websocketReconnectReason",void 0),_(this,"_connectionState",Je.CLOSED),_(this,"reconnectToken",void 0),_(this,"websocket",void 0),_(this,"openConnectionTime",void 0),_(this,"clientId",void 0),_(this,"lastMsgTime",Date.now()),_(this,"uploadCache",[]),_(this,"uploadCacheInterval",void 0),_(this,"rttRolling",new lI(5)),_(this,"pingpongTimer",void 0),_(this,"inflateDataTimer",void 0),_(this,"pingpongTimeoutCount",0),_(this,"joinResponse",void 0),_(this,"multiIpOption",void 0),_(this,"initError",void 0),_(this,"spec",void 0),_(this,"store",void 0),_(this,"onWebsocketMessage",i=>{if(i instanceof ArrayBuffer)return void this.emit(le.ON_BINARY_DATA,i);const o=JSON.parse(i);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")&&(this.emit(o._type,o._message),o._type===be.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===be.ON_USER_BANNED))switch(o._message.error_code){case 14:this.close(Ke.UID_BANNED);break;case 15:this.close(Ke.IP_BANNED);break;case 16:this.close(Ke.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new mI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Je.CONNECTED&&this.reconnect("retry",wr.OFFLINE)})}async request(t,n,i,o){const a=ht(6,""),c={_id:a,_type:t,_message:n},l=this.websocket.connectionID,u=()=>new re((w,A)=>{if(this.connectionState===Je.CONNECTED)return w();const O=()=>{this.off(le.WS_CLOSED,U),w()},U=()=>{this.off(le.WS_CONNECTED,O),A(new N(I.WS_ABORT))};this.once(le.WS_CONNECTED,O),this.once(le.WS_CLOSED,U),t!==ge.PUBLISH&&t!==ge.SUBSCRIBE&&t!==ge.UNSUBSCRIBE&&t!==ge.UNPUBLISH&&t!==ge.CONTROL&&t!==ge.RESTART_ICE||this.once(le.DISCONNECT_P2P,()=>{A(new N(I.DISCONNECT_P2P))}),t!==ge.PUBLISH&&t!==ge.RESTART_ICE||this.once(le.ABORT_P2P_EXECUTION,()=>{A(new N(I.DISCONNECT_P2P))})});if(this.connectionState!==Je.CONNECTING&&this.connectionState!==Je.RECONNECTING||t===ge.JOIN||t===ge.REJOIN||await u(),t===ge.LEAVE&&(this.websocket.unbindDcCloseEventListener(),o=!0),this.websocket.sendMessage(c,!0,!1),o)return;const p=new re((w,A)=>{let O=!1;const U=(Q,pe)=>{O=!0,w({isSuccess:Q==="success",message:pe||{}}),this.off(le.WS_CLOSED,x),this.off(le.WS_RECONNECTING,x),this.emit(le.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),U);const x=()=>{A(new N(I.WS_ABORT,"type: ".concat(t))),this.off(le.WS_CLOSED,x),this.off(le.WS_RECONNECTING,x),this.off("res-@".concat(a),U)};this.once(le.WS_CLOSED,x),this.once(le.WS_RECONNECTING,x),fn(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||O||(T.warning("dc request timeout, type: ".concat(t)),this.emit(le.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await p}catch(w){if(this.connectionState===Je.CLOSED||t===ge.LEAVE)throw new N(I.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?w.throw():t===ge.JOIN||t===ge.REJOIN?null:(await u(),await this.request(t,n))}if(f.isSuccess)return f.message;const m=Number(f.message.error_code||f.message.code),v=Ic(m),R=new N(I.UNEXPECTED_RESPONSE,"".concat(v.desc,": ").concat(f.message.error_str),{code:m,data:f.message});return v.action==="success"?f.message:(T.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(m,", message: ").concat(v.desc,", action: ").concat(v.action)),m===me.ERR_TOO_MANY_BROADCASTERS?((t===ge.JOIN||t===ge.REJOIN)&&(this.initError=R,this.close()),R.throw()):v.action==="failed"?R.throw():v.action==="quit"?(this.initError=R,this.close(),R.throw()):(m===me.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",wr.MULTI_IP)):this.reconnect(v.action,wr.SERVER_ERROR),t===ge.JOIN||t===ge.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new re(i=>{const o=a=>{(!n||n(a))&&(this.off(t,o),i(a))};this.on(t,o)})}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const a=k("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Je.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)},k("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new re((i,o)=>{this.once(le.WS_CONNECTED,()=>i(this.joinResponse)),this.once(le.WS_CLOSED,()=>o(this.initError||new N(I.WS_ABORT))),this.connectionState=Je.CONNECTING,this.websocket.init(t).catch(o),this.websocket.once(_t.FAILBACK,()=>{this.openConnectionTime===void 0&&o(new N(I.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(T.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),o(new N(I.INIT_DATACHANNEL_TIMEOUT)))},k("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ke.LEAVE,this.connectionState=Je.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Ke.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new mI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(le.ABORT_P2P_EXECUTION);const t=await mn(this,le.DATACHANNEL_CONNECTING),n=await this.request(ge.JOIN,t);if(!n)return this.emit(le.REPORT_JOIN_GATEWAY,I.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(le.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Je.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new N(I.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ss(this,le.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ge.REJOIN,t);return!!n&&(this.connectionState=Je.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(i=>{this.emit(be.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(be.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(be.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(be.MUTE_AUDIO,{uid:i.uid}):this.emit(be.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(be.MUTE_VIDEO,{uid:i.uid}):this.emit(be.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(be.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(be.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(be.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(be.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(be.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);const n=Ic(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ke.UID_BANNED),void this.close()):void this.reconnect(n.action,wr.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=k("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>k("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",wr.TIMEOUT):this.request(ge.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),k("REPORT_STATS")&&this.send(ge.PING_BACK,{pingpongElapse:i})}).catch(i=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(Gn.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(_t.RECONNECT_WAITTING_FINISH,t=>{this.emit(le.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(_t.RECONNECT_CREATE_CONNECTION,t=>{this.emit(le.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(_t.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_t.CLOSED,()=>{this.connectionState=Je.CLOSED}),this.websocket.on(_t.FAILED,()=>{this._disconnectedReason=Ke.NETWORK_ERROR,this.connectionState=Je.CLOSED}),this.websocket.on(_t.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Je.CONNECTED?this.connectionState=Je.RECONNECTING:this.connectionState=Je.CONNECTING}),this.websocket.on(_t.WILL_RECONNECT,(t,n)=>{if(Ss(this,le.IS_P2P_DISCONNECTED)&&t==="retry")return T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(T.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(le.NEED_RENEW_SESSION),this.emit(le.DISCONNECT_P2P)),n(t)}),this.websocket.on(_t.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",wr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(le.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof N&&t.code===I.UNEXPECTED_RESPONSE&&t.data.code===me.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",wr.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",wr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(_t.REQUEST_NEW_URLS,(t,n)=>{mn(this,le.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(_t.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(be.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(_t.TO_CONNECT_DATACHANNEL,async(t,n,i)=>mn(this,le.DATACHANNEL_PRECONNECT,t).then(n).catch(i)),this.websocket.on(_t.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(le.DATACHANNEL_FAILBACK)})}}function EI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Dr(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?EI(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const cm=new Map;class ZV extends Rt{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(ft.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(ft.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),_(this,"store",void 0),_(this,"joinInfo",void 0),_(this,"key",void 0),_(this,"signal",void 0),_(this,"role",void 0),_(this,"inChannelInfo",{joinAt:null,duration:0}),_(this,"spec",void 0),_(this,"_state","DISCONNECTED"),_(this,"_statsCollector",void 0),_(this,"_disconnectedReason",void 0),_(this,"isSignalRecover",!1),_(this,"hasChangeBGPAddress",!1),_(this,"trafficStatsInterval",void 0),_(this,"networkQualityInterval",void 0),_(this,"_joinGatewayStartTime",0),_(this,"_signalTimeout",!1),_(this,"_clientRoleOptions",void 0),_(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useDataChannel?new Jr(Dr(Dr({},n),{},{retryConfig:n.websocketRetryConfig}),t):new uI(Dr(Dr({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,i){if(this.signal instanceof Jr){let u=!1;t.cloudProxyServer!=="disabled"?(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),u=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),u=!0):t.apResponse.addresses.some(p=>p.fingerprint)||k("FINGERPRINT")||(T.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),u=!0),u&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let a=cm.get(t.cname);if(a||(a=new Map,cm.set(t.cname,a)),this._isProactiveJoin=!0,a.has(t.uid)){const u=new N(I.UID_CONFLICT);throw ue.joinGateway(t.sid,{lts:o,succ:!1,ec:u.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof Jr?"1":"0"}),this._isProactiveJoin=!1,u}a.set(t.uid,!0),this.joinInfo=t,this.key=n;let c=0;this.joinGatewayStartTime=o;const l=t.proxyServer;try{let u;if(T.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof Jr?"datachannel":"websocket"," join uid ").concat(c)),this.signal instanceof Jr)u=await this.signal.init(t.apResponse.addresses,i);else{const p=t.proxyServer,f=p?t.gatewayAddrs.map(m=>{const v=m.address.split(":");return"wss://".concat(p,"/ws/?h=").concat(v[0],"&p=").concat(v[1])}):t.gatewayAddrs.map(m=>"wss://".concat(m.address));u=await this.signal.init(f,i)}c=u.uid,T.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof Jr?"datachannel":"websocket"," join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){throw u&&u.code===I.INIT_WEBSOCKET_TIMEOUT?(T.warning("[".concat(this.store.clientId,"] User join failed"),u.toString()),u):u&&u.code===I.INIT_DATACHANNEL_TIMEOUT?(T.warning("[".concat(this.store.clientId,"] User join datachannel failed"),u.toString()),this.resetSignal(),u):(T.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),ue.joinGateway(t.sid,{lts:o,succ:!1,ec:u.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:this.signal instanceof Jr?"1":"0"}),this._isProactiveJoin=!1,a.delete(t.uid),this.signal.close(),u)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ft.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ft.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ft.NETWORK_QUALITY,{uplinkNetworkQuality:tI(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:tI(this._statsCollector.trafficStats.B_dnq)}):this.emit(ft.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ke.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Je.CONNECTED||await function(i,o){return o===1/0?i:re.race([i,qV(o)])}(this.signal.request(ge.LEAVE,void 0,!0),3e3)}catch(i){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Ke.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:k("PUB_EXTEND"),twcc:!!k("PUBLISH_TWCC")};try{return(await this.signal.request(ge.PUBLISH,o,!0))._message}catch(a){if(i&&a.data&&a.data.code===me.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw a}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ge.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){T.warning("unpublish warning: ",i)}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!k("SUBSCRIBE_TWCC"),extend:k("SUB_EXTEND"),ssrcId:n.ssrcId};try{return(await this.signal.request(ge.SUBSCRIBE,o,!0))._message}catch(a){if(i&&a.data&&a.data.code===me.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw a}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1};try{return await this.signal.request(ge.SUBSCRIBE_STREAMS,i,!0)}catch(o){if(n&&o.data&&o.data.code===me.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const n=function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let o=i.frameRate,a=i.width,c=i.height,l=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(l=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,o||(l=!1)),l?{stream_type:0,width:a,height:c,fps:o,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0}(t);if(n)return this.signal.request(ge.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(ge.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){T.warning("unsubscribe warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(ge.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){T.warning("unsubscribeAll warning: ",n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(ge.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ge.GATEWAY_INFO)}renewToken(t){return this.signal.request(ge.RENEW_TOKEN,t)}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=t);let i;i=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(ge.SET_CLIENT_ROLE,{role:t,level:i,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(ge.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ge.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(ge.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(ge.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Dr({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ge.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=cm.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:ci.username,password:ci.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Dr(Dr({},ci),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(ge.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.peer_delay.forEach(n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);i&&i.B_st!==n.B_st&&Yi(()=>{this.emit(ft.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new N(I.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let i=k("REPORT_APP_SCENARIO");if(typeof i!="string")try{i=JSON.stringify(i)}catch{i=void 0}i&&i.length>128&&(i=void 0);const o=Dr({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ci,browser:navigator.userAgent,process_id:k("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:k("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:i,attributes:{userAttributes:{enablePublishedUserList:k("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:k("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof k("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?k("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof k("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?k("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof k("ENABLE_USER_LICENSE_CHECK")=="boolean"?k("ENABLE_USER_LICENSE_CHECK"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,k("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new N(I.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(le.WS_RECONNECT_WAITTING_FINISH,t=>{["tryNext","recover"].includes(t)&&this.joinInfo&&ue.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(le.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(le.WS_RECONNECTING,t=>{this.joinInfo&&ue.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||kn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ue.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(le.WS_CLOSED,t=>{let n;switch(t){case Ke.LEAVE:n=kn.LEAVE;break;case Ke.UID_BANNED:case Ke.IP_BANNED:case Ke.CHANNEL_BANNED:case Ke.SERVER_ERROR:n=kn.SERVER_ERROR;break;case Ke.FALLBACK:n=kn.FALLBACK;break;case Ke.LICENSE_MISSING:case Ke.LICENSE_EXPIRED:case Ke.LICENSE_MINUTES_EXCEEDED:case Ke.LICENSE_PERIOD_INVALID:case Ke.LICENSE_MULTIPLE_SDK_SERVICE:case Ke.LICENSE_ILLEGAL:n=t;break;default:n=kn.NETWORK_ERROR}T.debug("[signal] websocket closed, reason: ".concat(n||"undefined -> "+kn.NETWORK_ERROR)),this.joinInfo&&ue.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ke.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Ke.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(le.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),ue.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Jr?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));et("EVENT_REPORT_DOMAIN",t[1]),et("EVENT_REPORT_BACKUP_DOMAIN",t[1]),et("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(be.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(le.REQUEST_RECOVER,(t,n,i)=>{if(!this.joinInfo)return i(new N(I.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,mn(this,ft.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)}),this.signal.on(le.REQUEST_JOIN_INFO,async t=>{var n;this.updateTurnConfigFromSignal();const{iceParameters:i,dtlsParameters:o,rtpCapabilities:a}=await mn(this,ft.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:a,version:"2"}}))}),this.signal.on(le.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(le.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&(ue.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Jr?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(le.IS_P2P_DISCONNECTED,t=>{t(Ss(this,ft.IS_P2P_DISCONNECTED))}),this.signal.on(le.DISCONNECT_P2P,()=>{this.emit(ft.DISCONNECT_P2P)}),this.signal.on(le.NEED_RENEW_SESSION,()=>{this.emit(ft.NEED_RENEW_SESSION)}),this.signal.on(le.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(le.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(le.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(ft.JOIN_RESPONSE,t,n)}),this.signal.on(le.DATACHANNEL_PRECONNECT,async(t,n,i)=>{this.updateTurnConfigFromSignal();const o=this.getCurrentGatewayAddress();return mn(this,ft.DATACHANNEL_PRECONNECT,t,o).then(n).catch(i)}),this.signal.on(le.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=await mn(this,ft.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:o,version:"2"}}))}),this.signal.on(le.DATACHANNEL_FAILBACK,()=>{T.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(ft.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(ge.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw T.warning("unsubscribe warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(ge.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw T.warning("unpublish warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map(i=>({stream_id:i.stream_id,stream_type:i.stream_type}))};try{await this.signal.request(ge.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw T.warning("massUnsubscribe warning",i),i}}async muteLocal(t,n){const i={action:t.find(o=>o.stream_type===Ut.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ge.CONTROL,i,!0,!0)}catch(o){throw T.warning("gateway unmuteLocal warning: ",o),o}}async unmuteLocal(t,n){const i={action:t.find(o=>o.stream_type===Ut.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ge.CONTROL,i,!0,!0)}catch(o){throw T.warning("gateway muteLocal warning: ",o),o}}uploadStats(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ge.RESTART_ICE,n,!0)}catch(i){throw T.warning("P2PChannel.restartICE warning: ",i),i}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,kn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!k("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ge.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ke.FALLBACK)),this.store.useDataChannel=!1,this.signal=new uI(Dr(Dr({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(ft.RESET_SIGNAL,Dl.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(F){var K=0;return function(){return K<F.length?{done:!1,value:F[K++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(F,K,ne){return F==Array.prototype||F==Object.prototype||(F[K]=ne.value),F},i,o=function(F){F=[typeof globalThis=="object"&&globalThis,F,typeof window=="object"&&window,typeof self=="object"&&self,typeof h=="object"&&h];for(var K=0;K<F.length;++K){var ne=F[K];if(ne&&ne.Math==Math)return ne}throw Error("Cannot find global object")}(this);function a(F,K){if(K)e:{var ne=o;F=F.split(".");for(var ve=0;ve<F.length-1;ve++){var je=F[ve];if(!(je in ne))break e;ne=ne[je]}(K=K(ve=ne[F=F[F.length-1]]))!=ve&&K!=null&&n(ne,F,{configurable:!0,writable:!0,value:K})}}function c(F){return(F={next:F})[Symbol.iterator]=function(){return this},F}function l(F){var K=typeof Symbol<"u"&&Symbol.iterator&&F[Symbol.iterator];return K?K.call(F):{next:t(F)}}if(a("Symbol",function(F){function K(je,$){this.A=je,n(this,"description",{configurable:!0,writable:!0,value:$})}if(F)return F;K.prototype.toString=function(){return this.A};var ne="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ve=0;return function je($){if(this instanceof je)throw new TypeError("Symbol is not a constructor");return new K(ne+($||"")+"_"+ve++,$)}}),a("Symbol.iterator",function(F){if(F)return F;F=Symbol("Symbol.iterator");for(var K="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ne=0;ne<K.length;ne++){var ve=o[K[ne]];typeof ve=="function"&&typeof ve.prototype[F]!="function"&&n(ve.prototype,F,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return F}),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var u;e:{var p={};try{p.__proto__={a:!0},u=p.a;break e}catch{}u=!1}i=u?function(F,K){if(F.__proto__=K,F.__proto__!==K)throw new TypeError(F+" is not extensible");return F}:null}var f=i;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function v(F){if(F.m)throw new TypeError("Generator is already running");F.m=!0}function R(F,K){return F.h=3,{value:K}}function w(F){this.g=new m,this.G=F}function A(F,K,ne,ve){try{var je=K.call(F.g.j,ne);if(!(je instanceof Object))throw new TypeError("Iterator result "+je+" is not an object");if(!je.done)return F.g.m=!1,je;var $=je.value}catch(g){return F.g.j=null,F.g.s(g),O(F)}return F.g.j=null,ve.call(F.g,$),O(F)}function O(F){for(;F.g.h;)try{var K=F.G(F.g);if(K)return F.g.m=!1,{value:K.value,done:!1}}catch(ne){F.g.v=void 0,F.g.s(ne)}if(F.g.m=!1,F.g.l){if(K=F.g.l,F.g.l=null,K.F)throw K.D;return{value:K.return,done:!0}}return{value:void 0,done:!0}}function U(F){this.next=function(K){return F.o(K)},this.throw=function(K){return F.s(K)},this.return=function(K){return function(ne,ve){v(ne.g);var je=ne.g.j;return je?A(ne,"return"in je?je.return:function($){return{value:$,done:!0}},ve,ne.g.return):(ne.g.return(ve),O(ne))}(F,K)},this[Symbol.iterator]=function(){return this}}function x(F,K){return K=new U(new w(K)),f&&F.prototype&&f(K,F.prototype),K}if(m.prototype.o=function(F){this.v=F},m.prototype.s=function(F){this.l={D:F,F:!0},this.h=this.C||this.u},m.prototype.return=function(F){this.l={return:F},this.h=this.u},w.prototype.o=function(F){return v(this.g),this.g.j?A(this,this.g.j.next,F,this.g.o):(this.g.o(F),O(this))},w.prototype.s=function(F){return v(this.g),this.g.j?A(this,this.g.j.throw,F,this.g.o):(this.g.s(F),O(this))},a("Array.prototype.entries",function(F){return F||function(){return function(K,ne){K instanceof String&&(K+="");var ve=0,je=!1,$={next:function(){if(!je&&ve<K.length){var g=ve++;return{value:ne(g,K[g]),done:!1}}return je=!0,{done:!0,value:void 0}}};return $[Symbol.iterator]=function(){return $},$}(this,function(K,ne){return[K,ne]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var Q=function(F,K){for(var ne=0;ne<F.length;ne++)K(F[ne])},pe=function(F){return F.replace(/\r?\n|\r/g,`\r
`)},Z=function(F,K,ne){return K instanceof Blob?(ne=ne!==void 0?ne+"":typeof K.name=="string"?K.name:"blob",K.name===ne&&Object.prototype.toString.call(K)!=="[object Blob]"||(K=new File([K],ne)),[String(F),K]):[String(F),String(K)]},ee=function(F,K){if(F.length<K)throw new TypeError(K+" argument required, but only "+F.length+" present.")},J=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,se=J.FormData,tt=J.XMLHttpRequest&&J.XMLHttpRequest.prototype.send,Ae=J.Request&&J.fetch,lt=J.navigator&&J.navigator.sendBeacon,it=J.Element&&J.Element.prototype,wt=J.Symbol&&Symbol.toStringTag;wt&&(Blob.prototype[wt]||(Blob.prototype[wt]="Blob"),"File"in J&&!File.prototype[wt]&&(File.prototype[wt]="File"));try{new File([],"")}catch{J.File=function(K,ne,ve){return K=new Blob(K,ve||{}),Object.defineProperties(K,{name:{value:ne},lastModified:{value:+(ve&&ve.lastModified!==void 0?new Date(ve.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),wt&&Object.defineProperty(K,wt,{value:"File"}),K}}var nn=function(F){return F.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ct=function(F){this.i=[];var K=this;F&&Q(F.elements,function(ne){if(ne.name&&!ne.disabled&&ne.type!=="submit"&&ne.type!=="button"&&!ne.matches("form fieldset[disabled] *"))if(ne.type==="file"){var ve=ne.files&&ne.files.length?ne.files:[new File([],"",{type:"application/octet-stream"})];Q(ve,function(je){K.append(ne.name,je)})}else ne.type==="select-multiple"||ne.type==="select-one"?Q(ne.options,function(je){!je.disabled&&je.selected&&K.append(ne.name,je.value)}):ne.type==="checkbox"||ne.type==="radio"?ne.checked&&K.append(ne.name,ne.value):(ve=ne.type==="textarea"?pe(ne.value):ne.value,K.append(ne.name,ve))})};if((e=Ct.prototype).append=function(F,K,ne){ee(arguments,2),this.i.push(Z(F,K,ne))},e.delete=function(F){ee(arguments,1);var K=[];F=String(F),Q(this.i,function(ne){ne[0]!==F&&K.push(ne)}),this.i=K},e.entries=function F(){var K,ne=this;return x(F,function(ve){if(ve.h==1&&(K=0),ve.h!=3)return K<ne.i.length?ve=R(ve,ne.i[K]):(ve.h=0,ve=void 0),ve;K++,ve.h=2})},e.forEach=function(F,K){ee(arguments,1);for(var ne=l(this),ve=ne.next();!ve.done;ve=ne.next()){var je=l(ve.value);ve=je.next().value,je=je.next().value,F.call(K,je,ve,this)}},e.get=function(F){ee(arguments,1);var K=this.i;F=String(F);for(var ne=0;ne<K.length;ne++)if(K[ne][0]===F)return K[ne][1];return null},e.getAll=function(F){ee(arguments,1);var K=[];return F=String(F),Q(this.i,function(ne){ne[0]===F&&K.push(ne[1])}),K},e.has=function(F){ee(arguments,1),F=String(F);for(var K=0;K<this.i.length;K++)if(this.i[K][0]===F)return!0;return!1},e.keys=function F(){var K,ne,ve,je,$=this;return x(F,function(g){if(g.h==1&&(K=l($),ne=K.next()),g.h!=3)return ne.done?void(g.h=0):(ve=ne.value,je=l(ve),R(g,je.next().value));ne=K.next(),g.h=2})},e.set=function(F,K,ne){ee(arguments,2),F=String(F);var ve=[],je=Z(F,K,ne),$=!0;Q(this.i,function(g){g[0]===F?$&&($=!ve.push(je)):ve.push(g)}),$&&ve.push(je),this.i=ve},e.values=function F(){var K,ne,ve,je,$=this;return x(F,function(g){if(g.h==1&&(K=l($),ne=K.next()),g.h!=3)return ne.done?void(g.h=0):(ve=ne.value,(je=l(ve)).next(),R(g,je.next().value));ne=K.next(),g.h=2})},Ct.prototype._asNative=function(){for(var F=new se,K=l(this),ne=K.next();!ne.done;ne=K.next()){var ve=l(ne.value);ne=ve.next().value,ve=ve.next().value,F.append(ne,ve)}return F},Ct.prototype._blob=function(){var F="----formdata-polyfill-"+Math.random(),K=[],ne="--"+F+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(ve,je){return typeof ve=="string"?K.push(ne+nn(pe(je))+`"\r
\r
`+pe(ve)+`\r
`):K.push(ne+nn(pe(je))+'"; filename="'+nn(ve.name)+`"\r
Content-Type: `+(ve.type||"application/octet-stream")+`\r
\r
`,ve,`\r
`)}),K.push("--"+F+"--"),new Blob(K,{type:"multipart/form-data; boundary="+F})},Ct.prototype[Symbol.iterator]=function(){return this.entries()},Ct.prototype.toString=function(){return"[object FormData]"},it&&!it.matches&&(it.matches=it.matchesSelector||it.mozMatchesSelector||it.msMatchesSelector||it.oMatchesSelector||it.webkitMatchesSelector||function(F){for(var K=(F=(this.document||this.ownerDocument).querySelectorAll(F)).length;0<=--K&&F.item(K)!==this;);return-1<K}),wt&&(Ct.prototype[wt]="FormData"),tt){var Yn=J.XMLHttpRequest.prototype.setRequestHeader;J.XMLHttpRequest.prototype.setRequestHeader=function(F,K){Yn.call(this,F,K),F.toLowerCase()==="content-type"&&(this.B=!0)},J.XMLHttpRequest.prototype.send=function(F){F instanceof Ct?(F=F._blob(),this.B||this.setRequestHeader("Content-Type",F.type),tt.call(this,F)):tt.call(this,F)}}Ae&&(J.fetch=function(F,K){return K&&K.body&&K.body instanceof Ct&&(K.body=K.body._blob()),Ae.call(this,F,K)}),lt&&(J.navigator.sendBeacon=function(F,K){return K instanceof Ct&&(K=K._asNative()),lt.call(this,F,K)}),J.FormData=Ct}})();const zl=()=>{const e=k("AREAS");return e.length===0&&e.push(Ue.GLOBAL),fo(e).call(e,(t,n,i)=>{const o=_I(n);return o?i===0?o:"".concat(t,",").concat(o):t},"")},_I=e=>e===Ue.OVERSEA?"".concat(Jt.ASIA,",").concat(Jt.EUROPE,",").concat(Jt.AFRICA,",").concat(Jt.NORTH_AMERICA,",").concat(Jt.SOUTH_AMERICA,",").concat(Jt.OCEANIA):Jt[e],e2=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const i=Pl[n],o=Object.keys(i);o&&o.map(a=>{a!=="CODE"&&(t[a]=t[a].concat(i[a]))})}),t},Yl={GLOBAL:{ASIA:[Ue.CHINA,Ue.JAPAN,Ue.INDIA,Ue.KOREA,Ue.HKMC],EUROPE:[],NORTH_AMERICA:[Ue.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dm=Object.keys(Yl[Ue.GLOBAL]),gI=[Ue.CHINA,Ue.NORTH_AMERICA,Ue.EUROPE,Ue.ASIA,Ue.JAPAN,Ue.INDIA,Ue.OCEANIA,Ue.SOUTH_AMERICA,Ue.AFRICA,Ue.KOREA,Ue.HKMC,Ue.US],t2=function(e,t){let n=[];if(e.includes(Ue.GLOBAL)){const a=[Ue.GLOBAL,Ue.OVERSEA],c=Object.keys(Pl);if(t===Ue.GLOBAL)throw new N(I.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Ue.CHINA)n=[Ue.OVERSEA];else if(o=t,dm.includes(o)){const l=(i=t,Yl[Ue.GLOBAL][i]||[]),u=[...a,t,...l];n=c.filter(p=>!u.includes(p))}else if(function(l){let u=!1;return dm.forEach(p=>{Yl[Ue.GLOBAL][p].includes(l)&&(u=!0)}),u}(t)){const l=function(p){let f;return dm.forEach(m=>{Yl[Ue.GLOBAL][m].includes(p)&&(f=m)}),f}(t),u=[...a,l,t];n=c.filter(p=>!u.includes(p))}else n=e;n=function(l){const u=[];return gI.forEach(p=>{l.includes(p)&&u.push(p)}),u.concat(l.filter(p=>!gI.includes(p)))}(n)}else n=e;var i,o;return n};function SI(e){if(!e&&k("AREAS").includes(Ue.EXTENSIONS))return T.debug("update area from ap : reset"),void lm(rR,!0);if(!k("AREAS").includes(Ue.GLOBAL)||!e)return;let t=Pl.EXTENSIONS;t&&(t={CODE:_I(Ue.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},T.debug("update area from ap success: ".concat(e,",config is "),t),et("AREAS",[Ue.EXTENSIONS],!0),Object.keys(t).map(n=>{n==="LOG_UPLOAD_SERVER"||n==="EVENT_REPORT_DOMAIN"||n==="EVENT_REPORT_BACKUP_DOMAIN"||n==="PROXY_SERVER_TYPE3"?et(n,t[n][0]):et(n,t[n])}))}function lm(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=ue.reportApiInvoke(null,{name:Lt.SET_AREA,options:e,tag:mt.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach(a=>{if(!Ox.includes(a))throw new N(I.INVALID_PARAMS,"invalid area code")}),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:a,excludedArea:c}=e;if(!a)throw new N(I.INVALID_PARAMS,"area code is needed");let l=a;typeof a=="string"&&(l=[a]),i=c?t2(l,c):l}if(!t){if(us.AREAS){const a=new N(I.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void T.warning("setArea is prohibited because of config-distribute")}if(i.includes(Ue.GLOBAL)&&k("AREAS")===Ue.EXTENSIONS){const a=new N(I.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void T.warning("setArea is prohibited because of ap extensions")}}et("AREAS",i,t);const o=e2(i);Object.keys(o).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?et(a,o[a][0]):et(a,o[a])}),T.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function vI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function TI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vI(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let um=1;function n2(e,t,n,i,o){um+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:um,requestId:um,version:Ci,cname:n.cname},c={service_name:t,json_body:JSON.stringify(a)};let l,u,p=e[0];return Ar(async()=>{l=Date.now();const f=await hr(p,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-l,f.code!==0){const R=new N(I.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:u});throw T.error(R.toString()),R}const m=JSON.parse(f.json_body);if(m.code!==200){const R=new N(I.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:u});throw T.error(R.toString()),R}if(!m.servers||m.servers.length===0){const R=new N(I.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:u});throw T.error(R.toString()),R}const v=function(R,w){return{addressList:R.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(k("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(w))),workerToken:R.workerToken,vid:R.vid}}(m,t);return k("LIVE_STREAMING_ADDRESS")&&(v.addressList=k("LIVE_STREAMING_ADDRESS")instanceof Array?k("LIVE_STREAMING_ADDRESS"):[k("LIVE_STREAMING_ADDRESS")]),TI(TI({},v),{},{responseTime:u})},(f,m)=>(ue.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(f.addressList),firstSuccess:m===0,responseTime:u,serverIp:e[m%e.length]}),!1),(f,m)=>(ue.apworkerEvent(n.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:t,responseTime:u,serverIp:e[m%e.length]}),!!(f.code!==I.OPERATION_ABORTED&&f.code!==I.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(p=e[(m+1)%e.length],!0)),o)}let hm=1;function RI(e,t,n,i){let{url:o,areaCode:a}=e;const c=Date.now();let l;const[u,p]=AI(t,a,[Ht.CHOOSE_SERVER]);let f=Nt.networkState;return Ar(async()=>{f&&Nt.networkState===Sn.OFFLINE&&Nt.onlineWaiter&&await re.race([Nt.onlineWaiter,fn(i&&i.maxRetryTimeout||jt.maxRetryTimeout)]),f=Nt.networkState;const{data:m,headers:v}=await hr(o,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=v.http3==="1"?1:-1,ue.reportResourceTiming(o,t.sid),II(m,o,t,c,[Ht.CHOOSE_SERVER],l);const R=rm(m,Ht.CHOOSE_SERVER);return CI(R),$y(R,o)},m=>(m&&ue.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,opid:p,serverList:m.gatewayAddrs.map(v=>v.address),ec:null,cid:m.cid.toString(),uid:m.uid.toString(),csIp:m.csIp,unilbsServerIds:[Ht.CHOOSE_SERVER].toString(),isHttp3:l}),!1),m=>m.code!==I.OPERATION_ABORTED&&(m.code===I.CAN_NOT_GET_GATEWAY_SERVER?m.data.retry:(ue.joinChooseServer(t.sid,{lts:c,succ:!1,csAddr:o,serverList:null,opid:p,ec:m.code,csIp:m.data&&m.data.csIp,unilbsServerIds:[Ht.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:f}),isHttp3:l}),T.warning("[".concat(t.clientId,"] Choose server network error, retry"),m),!0)),i)}function yI(e,t,n,i){let o,{url:a,areaCode:c,serviceIds:l}=e;const u=Date.now(),[p,f]=AI(t,c,l);let m;return Ar(async()=>{m&&Nt.networkState===Sn.OFFLINE&&Nt.onlineWaiter&&await re.race([Nt.onlineWaiter,fn(i&&i.maxRetryTimeout||jt.maxRetryTimeout)]),m=Nt.networkState;const{data:v,headers:R}=await hr(a,{data:p,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=R.http3==="1"?1:-1,ue.reportResourceTiming(a,t.sid),II(v,a,t,u,l,o);const w=rm(v,Ht.CHOOSE_SERVER),A=rm(v,t.cloudProxyServer==="proxy5"?Ht.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ht.CLOUD_PROXY:Ht.CLOUD_PROXY_FALLBACK);return CI(w),{gatewayInfo:$y(w,a),proxyInfo:A,url:a}},v=>(v.gatewayInfo&&ue.joinChooseServer(t.sid,{lts:u,succ:!0,csAddr:a,serverList:v.gatewayInfo.gatewayAddrs.map(R=>R.address),ec:null,opid:f,cid:v.gatewayInfo.cid.toString(),uid:v.gatewayInfo.uid.toString(),csIp:v.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:o}),v.proxyInfo&&ue.joinWebProxyAP(t.sid,{lts:u,sucess:1,apServerAddr:a,turnServerAddrList:v.proxyInfo.addresses.map(R=>R.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),v=>v.code!==I.OPERATION_ABORTED&&(v.code===I.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(ue.joinWebProxyAP(t.sid,{lts:u,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:v.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:m})}),T.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),v),!0)),i)}const II=(e,t,n,i,o,a)=>{const c=[],l=u=>{u.flag===4096?ue.joinChooseServer(n.sid,{lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:u.error.message,csIp:u.error.data&&u.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:a}):u.flag!==1048576&&u.flag!==4194304&&u.flag!==4194310||ue.joinWebProxyAP(n.sid,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:u.error.code,eventType:n.cloudProxyServer,unilbsServerIds:o.toString()})};if(e.response_body.forEach(u=>{const p=u.buffer.code;if(u.uri===23&&p===0&&!u.buffer.edges_services)if(u.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),u.buffer.edges_services=[];else{const f={error:new N(I.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:u.buffer.flag};c.push(f),l(f)}if(p!==0){const f=Kl(p),m={error:new N(I.CAN_NOT_GET_GATEWAY_SERVER,f.desc,{desc:f.desc,retry:f.retry,csIp:e.detail[502]}),flag:u.buffer.flag};u.buffer.flag===4194310?T.warning(m.error.toString()):c.push(m),l(m)}}),c.length)throw T.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(c.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message,", retry: ").concat(u.error.data.retry)).join(" | "))),new N(I.CAN_NOT_GET_GATEWAY_SERVER,c.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message)).join(" | "),{retry:!!c.find(u=>u.error.data.retry),csIp:e.detail[502],desc:[...new Set(c.map(u=>{var p,f;return u==null||(p=u.error)===null||p===void 0||(f=p.data)===null||f===void 0?void 0:f.desc}).filter(u=>!!u))]})},CI=e=>{var t,n,i,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new N(I.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if((t=e.detail)!==null&&t!==void 0&&t[23]&&typeof((n=e.detail)===null||n===void 0?void 0:n[23])=="string"?SI(e.detail[23].toLowerCase()):SI(),(i=e.detail)!==null&&i!==void 0&&i[19]&&typeof((o=e.detail)===null||o===void 0?void 0:o[19])=="string"){const c=e.detail[19],l=c==null?void 0:c.split(";");for(let u=0;u<l.length;u++){var a;const p=Gr(a=l[u]).call(a);e.addresses[u]&&l&&(e.addresses[u].fingerprint=p)}}if(k("GATEWAY_ADDRESS")&&k("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",k("GATEWAY_ADDRESS"));const c=k("GATEWAY_ADDRESS").map(l=>{var u,p;const f=(u=(p=e.addresses.find(m=>m.ip===l.ip&&m.port===l.port))===null||p===void 0?void 0:p.fingerprint)!==null&&u!==void 0?u:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:f}});e.addresses=c}},i2=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=Kl(n.buffer.code);throw new N(I.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",t),new N(I.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},AI=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:k("USE_NEW_TOKEN")?"1":void 0,22:t},key:e.token,service_ids:n,uid:e.uid||0}}]};o.request_bodies.forEach(c=>{e.multiIP&&e.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(o)),[a,i]},r2=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(i)),[o,n]};let pm=0;async function fm(e,t,n,i){return{gatewayInfo:await async function(a,c,l,u){let p=null;const f=[],m=async()=>{const R=k("WEBCS_DOMAIN").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(O=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:zl()})),w=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),A=await yc({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(T.debug("[".concat(a.clientId,"] Connect to choose_server:"),O.url),RI(O,a,c,l)),allFailedhandler:O=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},w),O[0]},promisesCollector:f});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},w),A},v=async()=>{if(await fn(1e3),p!==null)return p;const R=k("WEBCS_DOMAIN_BACKUP_LIST").map(O=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(O+"/api/v2/transpond/webrtc?v=2"):"https://".concat(O,"/api/v2/transpond/webrtc?v=2"),areaCode:zl()})),w=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),A=await yc({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(T.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),O.url),RI(O,a,c,l)),allFailedhandler:O=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},w),O[0]},promisesCollector:f});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},w),A};try{return p=await _a([m(),v()]),f.length&&f.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),p}catch(R){throw R[0]}}(e,t,n,i)}}async function wI(e,t,n,i,o){const a=e.cloudProxyServer;if(a==="disabled"){if(!i)return;if(e.useLocalAccessPoint)return await fm(e,t,n,o);if(k("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:p,proxyInfo:f}=await NI(e,t,n,o);return e.turnServer&&e.turnServer.mode!=="auto"||(e.turnServer={mode:"manual",servers:f.map(m=>({turnServerURL:m.address,tcpport:m.tcpport||ci.tcpport,udpport:m.udpport||ci.udpport,username:m.username||ci.username,password:m.password||ci.password,forceturn:!1,security:!0}))}),{gatewayInfo:p}}return await fm(e,t,n,o)}const{proxyInfo:c,gatewayInfo:l}=await NI(e,t,n,o),u={gatewayInfo:l};return e.turnServer={mode:"manual",servers:c.map(p=>({turnServerURL:p.address,tcpport:a==="proxy3"?void 0:p.tcpport?p.tcpport:ci.tcpport,udpport:a==="proxy4"?void 0:p.udpport?p.udpport:ci.udpport,username:p.username||ci.username,password:p.password||ci.password,forceturn:a!=="proxy4",security:a==="proxy5"}))},T.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),u}async function OI(e,t,n,i,o){const a=k("ACCOUNT_REGISTER").slice(0,k("AJAX_REQUEST_CONCURRENT"));let c=[];c=t.proxyServer?a.map(u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1")):a.map(u=>"https://".concat(u,"/api/v1"));const l=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const u=await async function(p,f,m,v,R){const w=Date.now(),A={sid:m.sid,opid:10,appid:m.appId,string_uid:f};let O=p[0];const U=await Ar(()=>hr(O+"".concat(O.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:v,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(x,Q)=>{if(x.code===0){if(x.uid<=0||x.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(f," => ").concat(x.uid),x),ue.reqUserAccount(A.sid,{lts:w,success:!1,serverAddr:O,stringUid:A.string_uid,uid:x.uid,errorCode:I.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new N(I.INVALID_UINT_UID_FROM_STRING_UID);return ue.reqUserAccount(A.sid,{lts:w,success:!0,serverAddr:O,stringUid:A.string_uid,uid:x.uid,errorCode:null,extend:A}),!1}const pe=Kl(x.code);return pe.retry&&(O=p[(Q+1)%p.length]),ue.reqUserAccount(A.sid,{lts:w,success:!1,serverAddr:O,stringUid:A.string_uid,uid:x.uid,errorCode:pe.desc,extend:A}),pe.retry},(x,Q)=>x.code!==I.OPERATION_ABORTED&&(ue.reqUserAccount(A.sid,{lts:w,success:!1,serverAddr:O,stringUid:A.string_uid,uid:null,errorCode:x.code,extend:A}),O=p[(Q+1)%p.length],!0),R);if(U.code!==0){const x=Kl(U.code);throw new N(I.UNEXPECTED_RESPONSE,x.desc)}return U}(c,e,t,n,i);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},l),u.uid}catch(u){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},l),u}}async function o2(e,t,n){const i=k("CDS_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1"):"https://".concat(l,"/api/v1?action=config")).map(l=>function(u,p,f,m){const v=Xe(),R={flag:64,cipher_method:0,features:{device:v.name,system:v.os,system_general:navigator.userAgent,vendor:p.appId,version:Ci,cname:p.cname,sid:p.sid,session_id:p.sid,detail:"",proxyServer:p.proxyServer}};return Ar(()=>hr(u,{data:R,timeout:1e3,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,w=>w.code!==I.OPERATION_ABORTED,m)}(l,e,t,n));let o=null,a=null,c={};try{o=await _a(i)}catch(l){if(l.code===I.OPERATION_ABORTED)throw l;a=l}if(i.forEach(l=>l.cancel()),ue.reportApiInvoke(e.sid,{name:Lt.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{c=function(l){if(!l.test_tags)return{};const u=l.test_tags,p=Object.keys(u),f={};return p.forEach(m=>{var v;const R=Gr(v=m.slice(4)).call(v),w=JSON.parse(u[m])[1];f[R]=w}),f}(o)}catch{}return c}async function NI(e,t,n,i){const o=k("PROXY_SERVER_TYPE3"),a=(R,w,A)=>{let O=A||o;return Array.isArray(O)&&(O=w%2==0?o[1]:o[0]),"https://".concat(O,"/ap/?url=").concat(R)};let c=null;const l=[],u=async()=>{const R=k("WEBCS_DOMAIN").slice(0,k("AJAX_REQUEST_CONCURRENT")).map((O,U)=>{let x;return x=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(O,"/api/v2/transpond/webrtc?v=2"),U,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):a("".concat(O,"/api/v2/transpond/webrtc?v=2"),U),{url:x,areaCode:zl(),serviceIds:[Ht.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Ht.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Ht.CLOUD_PROXY:Ht.CLOUD_PROXY_FALLBACK]}}),w=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),A=await yc({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(T.debug("[".concat(e.clientId,"] Connect to choose_server:"),O.url),yI(O,e,t,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},w),O[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},w),A},p=async()=>{if(await fn(1e3),c!==null)return c;const R=k("WEBCS_DOMAIN_BACKUP_LIST").map((O,U)=>{let x;return x=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(O,"/api/v2/transpond/webrtc?v=2"),U,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(O,"/api/v2/transpond/webrtc?v=2"):a("".concat(O,"/api/v2/transpond/webrtc?v=2"),U),{url:x,areaCode:zl(),serviceIds:[Ht.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Ht.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Ht.CLOUD_PROXY:Ht.CLOUD_PROXY_FALLBACK]}}),w=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(O=>O.url)}),A=await yc({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:O=>(T.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),O.url),yI(O,e,t,n)),allFailedhandler:O=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:O},w),O[0]},promisesCollector:l});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},w),A};let f,m,v;try{({gatewayInfo:f,proxyInfo:m,url:v}=await _a([u(),p()]))}catch(R){throw R[0]}if(l.length&&l.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),!f||!m)throw new N(I.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=v,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&v){const R=/^https?:\/\/(.+?)(\/.*)?$/.exec(v)[1];o.includes(R)&&(e.proxyServer=R,T.setProxyServer(R),ue.setProxyServer(R))}return c={gatewayInfo:f,proxyInfo:await zV(m,f.uid)},c}async function bI(e,t,n,i){const o=k("UAP_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await n2(o,e,t,n,i)}async function s2(e,t,n){const i=k("UAP_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")).map(o=>function(a,c,l,u){const p={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:Ci,cname:c.cname,uid:c.uid.toString(),requestId:hm,seq:hm};hm+=1;const f={service_name:"tele_channel",json_body:JSON.stringify(p)};return Ar(async()=>{const m=await hr(a,{data:f,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(m.code!==0){const R=new N(I.UNEXPECTED_RESPONSE,"cross channel ap error, code"+m.code,{retry:!0});throw T.error(R.toString()),R}const v=JSON.parse(m.json_body);if(v.code!==200){const R=new N(I.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(v.code,", reason: ").concat(v.reason));throw T.error(R.toString()),R}if(!v.servers||v.servers.length===0){const R=new N(I.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(R.toString()),R}return{vid:v.vid,workerToken:v.workerToken,addressList:(k("CHANNEL_MEDIA_RELAY_SERVERS")||v.servers).map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(k("WORKER_DOMAIN"),":").concat(R.wss))}},void 0,m=>!!(m.code!==I.OPERATION_ABORTED&&m.code!==I.UNEXPECTED_RESPONSE||m.data&&m.data.retry),u)}(o,e,t,n));try{const o=await _a(i);return i.forEach(a=>a.cancel()),o}catch(o){throw o[0]}}async function a2(e,t,n){let i=null;const o=[],a=async c=>{const l=k(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2"));return c&&(await fn(1e3),i!==null)?i:await yc({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:u=>(T.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),u),function(p,f,m,v){const[R]=r2(f,[Ht.CHOOSE_SERVER]);let w=Nt.networkState;return Ar(async()=>{w&&Nt.networkState===Sn.OFFLINE&&Nt.onlineWaiter&&await re.race([Nt.onlineWaiter,fn(v&&v.maxRetryTimeout||jt.maxRetryTimeout)]),w=Nt.networkState;const A=await hr(p,{data:R,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return i2(A,p)},()=>!1,A=>A.code!==I.OPERATION_ABORTED&&(A.code===I.UPDATE_TICKET_FAILED?A.data.retry:(T.warning("[".concat(f.clientId,"] update ticket network error, retry"),A),!0)),v)}(u,e,t,n)),allFailedhandler:u=>{throw u[0]},promisesCollector:o})};try{return i=await _a([a(!1),a(!0)]),o.length&&o.forEach(c=>c.cancel&&typeof c.cancel=="function"&&c.cancel()),i}catch(c){throw c[0]}}function DI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function PI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DI(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class c2 extends Rt{constructor(){super(),_(this,"configs",void 0),_(this,"joinInfo",void 0),_(this,"cancelToken",void 0),_(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),_(this,"interval",void 0),_(this,"mutex",new On("config-distribute")),_(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),k("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},k("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,ue.reportApiInvoke(null,{options:void 0,name:Lt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:mt.TRACER}).onSuccess(JSON.stringify(us))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await o2(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(i){const o=new N(I.NETWORK_RESPONSE_ERROR,i);T.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(vc.UPDATE_BITRATE_LIMIT,t):this.emit(vc.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&PI({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const i=Nf(n=Object.keys(t).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(n);for(let a=0;a<i.length;a++)for(let c=i.length-1;c>a;c--){const l=i[c];if(typeof t[l].__priority=="number"){const u=t[l].__priority,p=i[c-1];if(typeof t[p].__priority=="number"){if(!(u>t[p].__priority))continue;{const f=l;i[c]=i[c-1],i[c-1]=f}}else{const f=l;i[c]=i[c-1],i[c-1]=f}}}const o={};i.forEach(a=>{const c=t[a],l=c.__expires;Object.keys(c).forEach(u=>{u==="__priority"||u==="__expires"||Object.prototype.hasOwnProperty.call(o,u)||(o[u]=PI({value:c[u]},l&&{expires:l}))})});try{const a=JSON.stringify(o),c=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",c),T.debug("Caching global parameters ".concat(a))}catch(a){T.error("Error caching global parameters:",a.message)}}}function kI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Cc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kI(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class d2 extends Rt{constructor(t,n,i,o){super(),_(this,"spec",void 0),_(this,"token",void 0),_(this,"websocket",void 0),_(this,"pingpongTimer",void 0),_(this,"reconnectMode","retry"),_(this,"serviceMode",void 0),_(this,"reqId",0),_(this,"commandReqId",0),_(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),_(this,"handleWebSocketMessage",a=>{if(!a.data)return;const c=JSON.parse(a.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):this.serviceMode===Mt.INJECT?this.emit(Ki.INJECT_STREAM_STATUS,c):(ue.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Mt.TRANSCODE?1:2}),this.emit(Ki.PUBLISH_STREAM_STATUS,c))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new ga("live-streaming",i),this.websocket.on(Oe.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Oe.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Oe.REQUEST_NEW_URLS,(a,c)=>{mn(this,Ki.REQUEST_NEW_ADDRESS).then(a).catch(c)}),this.websocket.on(Oe.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,i,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const a=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new N(I.UNEXPECTED_ERROR);const l=Cc({command:t,sdkVersion:Ci==="4.17.2"?"0.0.1":Ci,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new N(I.WS_DISCONNECT);const u=()=>new re((v,R)=>{this.websocket.once(Oe.CLOSED,()=>R(new N(I.WS_ABORT))),this.websocket.once(Oe.CONNECTED,v)});this.websocket.state!=="connected"&&await u(),l.clientRequest&&(l.clientRequest.workerToken=this.token);const p=new re((v,R)=>{const w=()=>{R(new N(I.WS_ABORT))};this.websocket.once(Oe.RECONNECTING,w),this.websocket.once(Oe.CLOSED,w),this.once("@".concat(c,"-").concat(this.spec.sid),A=>{v(A)})});o&&ue.workerEvent(this.spec.sid,Cc(Cc({},o),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const f=Date.now();this.websocket.sendMessage(l);let m=null;try{m=await p}catch(v){if(this.websocket.state==="closed")throw v;return await u(),await this.request(t,n,i)}return o&&ue.workerEvent(this.spec.sid,Cc(Cc({},o),{},{requestId:a,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-f})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Ci==="4.17.2"?"0.0.1":Ci;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case yt.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case yt.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case yt.LIVE_STREAM_RESPONSE_BAD_STREAM:case yt.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new N(I.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case yt.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case yt.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new N(I.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case yt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new N(I.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ki.WARNING,n,t.serverResponse.url)}case yt.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new N(I.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ki.WARNING,n,t.serverResponse.url)}case yt.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case yt.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new N(I.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case yt.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new N(I.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ki.WARNING,n,t.serverResponse.url)}case yt.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case yt.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case yt.LIVE_STREAM_RESPONSE_WORKER_LOST:case yt.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case yt.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case yt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case yt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case yt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case yt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new N(I.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Wl)},6e3)}}function LI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Mn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LI(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class l2 extends Rt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jt,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:jt;super(),_(this,"onLiveStreamWarning",void 0),_(this,"onLiveStreamError",void 0),_(this,"onInjectStatusChange",void 0),_(this,"spec",void 0),_(this,"retryTimeout",1e4),_(this,"connection",void 0),_(this,"httpRetryConfig",void 0),_(this,"wsRetryConfig",void 0),_(this,"streamingTasks",new Map),_(this,"isStartingStreamingTask",!1),_(this,"taskMutex",new On("live-streaming")),_(this,"cancelToken",Wi.CancelToken.source()),_(this,"transcodingConfig",void 0),_(this,"injectConfig",Mn({},wx)),_(this,"injectLoopTimes",0),_(this,"uapResponse",void 0),_(this,"lastTaskId",1),_(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=Mn(Mn({},Ax),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(c=>Mn(Mn(Mn({},Cx),c),{},{zOrder:c.zOrder?c.zOrder+1:1}))),function(c){ut(c.width)||dt(c.width,"config.width",0,1e4),ut(c.height)||dt(c.height,"config.height",0,1e4),ut(c.videoBitrate)||dt(c.videoBitrate,"config.videoBitrate",1,1e6),ut(c.videoFrameRate)||dt(c.videoFrameRate,"config.videoFrameRate"),ut(c.lowLatency)||_c(c.lowLatency,"config.lowLatency"),ut(c.audioSampleRate)||qt(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ut(c.audioBitrate)||dt(c.audioBitrate,"config.audioBitrate",1,128),ut(c.audioChannels)||qt(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),ut(c.videoGop)||dt(c.videoGop,"config.videoGop"),ut(c.videoCodecProfile)||qt(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ut(c.userCount)||dt(c.userCount,"config.userCount",0,17),ut(c.backgroundColor)||dt(c.backgroundColor,"config.backgroundColor",0,16777215),ut(c.userConfigExtraInfo)||cn(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!ut(c.transcodingUsers)&&(Kr(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach((l,u)=>{Pf(l.uid),ut(l.x)||dt(l.x,"transcodingUser[".concat(u,"].x"),0,1e4),ut(l.y)||dt(l.y,"transcodingUser[".concat(u,"].y"),0,1e4),ut(l.width)||dt(l.width,"transcodingUser[".concat(u,"].width"),0,1e4),ut(l.height)||dt(l.height,"transcodingUser[".concat(u,"].height"),0,1e4),ut(l.zOrder)||dt(l.zOrder-1,"transcodingUser[".concat(u,"].zOrder"),0,100),ut(l.alpha)||dt(l.alpha,"transcodingUser[".concat(u,"].alpha"),0,1,!1)})),ut(c.watermark)||jf(c.watermark,"watermark"),ut(c.backgroundImage)||jf(c.backgroundImage,"backgroundImage"),c.images&&!ut(c.images)&&(Kr(c.images,"config.images"),c.images.forEach((l,u)=>{jf(l,"images[".concat(u,"]"))}))}(n);const i=[];n.images&&i.push(...n.images.map(c=>Mn(Mn(Mn({},Vf),c),{},{zOrder:255}))),n.backgroundImage&&(i.push(Mn(Mn(Mn({},Vf),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(Mn(Mn(Mn({},Vf),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(c=>Mn({},c)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(c=>typeof c.uid=="number"?re.resolve(c.uid):OI(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await re.all(o)).forEach((c,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=c)}),this.transcodingConfig=n,this.connection)try{var a;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Or(a=this.streamingTasks).call(a)).map(l=>l.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,c).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(u=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)})})}}setInjectStreamConfig(t,n){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=n}async startLiveStreamingTask(t,n,i){var o;if(Array.from(Or(o=this.streamingTasks).call(o)).find(u=>u.mode===Mt.INJECT)&&n===Mt.INJECT)return new N(I.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===Mt.TRANSCODE)throw new N(I.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const c=await this.taskMutex.lock();if(!this.connection&&i)return void c();if(this.streamingTasks.get(t)&&!i)return c(),new N(I.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(u){throw c(),u}switch(n){case Mt.TRANSCODE:a.transcodingConfig=Mn({},this.transcodingConfig);break;case Mt.RAW:break;case Mt.INJECT:a={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const l=this.lastTaskId++;try{const u=new re((f,m)=>{fn(this.retryTimeout).then(()=>{if(i)return m(i);const v=this.statusError.get(t);return v?(this.statusError.delete(t),m(v)):void 0})}),p=await re.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:n===Mt.TRANSCODE?1:2,requestByUser:!i,tid:l.toString()}),u]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(t,{clientRequest:a,mode:n,url:t,taskId:l}),c()}catch(u){if(c(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||i)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,u)):await this.startLiveStreamingTask(t,n,u)}}stopLiveStreamingTask(t){return new re((n,i)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new N(I.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=o.mode;o.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:a===Mt.INJECT?"UninjectStream":"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:a===Mt.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(c=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&a!==Mt.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),a===Mt.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(So.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(i)})}async controlInjectStream(t,n,i,o){const a=this.streamingTasks.get(t);if(!a||!this.connection||a.mode!==Mt.INJECT)throw new N(I.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:i,position:o}})).serverResponse}resetAllTask(){var t;const n=Array.from(Or(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Wi.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new N(I.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await mn(this,da.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new d2(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Ki.WARNING,(i,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,i)),this.connection.on(Ki.PUBLISH_STREAM_STATUS,i=>this.handlePublishStreamServer(i)),this.connection.on(Ki.INJECT_STREAM_STATUS,i=>this.handleInjectStreamServerStatus(i)),this.connection.on(Ki.REQUEST_NEW_ADDRESS,(i,o)=>{if(!this.connection)return o(new N(I.UNEXPECTED_ERROR,"can not get new live streaming address list"));mn(this,da.REQUEST_WORKER_MANAGER_LIST,t).then(a=>{this.uapResponse=a,i(a.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),o=t.reason;switch(t.code){case yt.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case yt.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case yt.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case yt.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new N(I.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return T.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case yt.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new N(I.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case yt.LIVE_STREAM_RESPONSE_WORKER_LOST:case yt.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(Or(a=this.streamingTasks).call(a));for(const l of c)l.abortTask?l.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new N(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(u=>{T.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,u)}));return}}}handleInjectStreamServerStatus(t){const n=Number(t.uid),i=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(So.INJECT_STREAM_STATUS_START_SUCCESS,n,i));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(So.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,i),void this.streamingTasks.delete(i);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(So.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,i),void this.streamingTasks.delete(i);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(So.INJECT_STREAM_STATUS_BROKEN,n,i),void this.streamingTasks.delete(i);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(So.INJECT_STREAM_STATUS_START_TIMEOUT,n,i),void this.streamingTasks.delete(i);default:return void T.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class MI{constructor(){_(this,"destChannelMediaInfos",new Map),_(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){OR(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){OR(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Df(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function UI(e){if(!(e instanceof MI))return new N(I.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new N(I.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new N(I.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class u2 extends Rt{constructor(t,n,i){super(),_(this,"ws",void 0),_(this,"requestId",1),_(this,"heartBeatTimer",void 0),_(this,"joinInfo",void 0),_(this,"clientId",void 0),_(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),_(this,"onClose",o=>{this.emit("close"),this.dispose()}),_(this,"onMessage",o=>{const a=JSON.parse(o.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=t,this.clientId=n,this.ws=new ga("cross-channel-".concat(this.clientId),i),this.ws.on(Oe.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Oe.CONNECTED,this.onOpen),this.ws.on(Oe.ON_MESSAGE,this.onMessage),this.ws.on(Oe.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new re((n,i)=>{const o=window.setTimeout(()=>{i(new N(I.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,a=>{window.clearTimeout(o),a.state&&a.state!==0?i(new N(I.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),i(new N(I.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new N(I.WS_DISCONNECT);const n=()=>new re((c,l)=>{this.ws.once(Oe.CLOSED,()=>l(new N(I.WS_ABORT))),this.ws.once(Oe.CONNECTED,c)});this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),o=new re((c,l)=>{const u=()=>{l(new N(I.WS_ABORT))};this.ws.once(Oe.RECONNECTING,u),this.ws.once(Oe.CLOSED,u),this.once("req_".concat(i),c),fn(3e3).then(()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(Oe.RECONNECTING,u),this.ws.off(Oe.CLOSED,u),l(new N(I.TIMEOUT,"cross channel ws request timeout"))})}),a=await o;if(!a||a.code!==200)throw new N(I.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(t){this.ws.removeAllListeners(Oe.REQUEST_NEW_URLS),this.ws.on(Oe.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class h2 extends Rt{set state(t){t!==this._state&&(t!==Ln.RELAY_STATE_FAILURE&&(this.errorCode=vo.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,o){super(),_(this,"joinInfo",void 0),_(this,"sid",void 0),_(this,"clientId",void 0),_(this,"cancelToken",Wi.CancelToken.source()),_(this,"workerToken",void 0),_(this,"requestId",0),_(this,"signal",void 0),_(this,"prevChannelMediaConfig",void 0),_(this,"httpRetryConfig",void 0),_(this,"_state",Ln.RELAY_STATE_IDLE),_(this,"errorCode",vo.RELAY_OK),_(this,"onStatus",a=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(a))),a&&a.command&&(a.command==="onAudioPacketReceived"&&this.emit("event",ur.PACKET_RECEIVED_AUDIO_FROM_SRC),a.command==="onVideoPacketReceived"&&this.emit("event",ur.PACKET_RECEIVED_VIDEO_FROM_SRC),a.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=vo.SRC_TOKEN_EXPIRED,this.state=Ln.RELAY_STATE_FAILURE),a.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=vo.DEST_TOKEN_EXPIRED,this.state=Ln.RELAY_STATE_FAILURE))}),_(this,"onReconnect",async()=>{T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ur.NETWORK_DISCONNECTED),this.state=Ln.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(a=>{this.state!==Ln.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",a.toString()),this.errorCode=vo.SERVER_CONNECTION_LOST,this.state=Ln.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=om(),this.signal=new u2(this.joinInfo,this.clientId,i),this.httpRetryConfig=o}async startChannelMediaRelay(t){if(this.state!==Ln.RELAY_STATE_IDLE)throw new N(I.INVALID_OPERATION);this.state=Ln.RELAY_STATE_CONNECTING,await this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new N(I.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new N(I.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new N(I.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Ln.RELAY_STATE_RUNNING)throw new N(I.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ln.RELAY_STATE_IDLE,this.dispose()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Wi.CancelToken.source(),this.state=Ln.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await s2(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",ur.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(An.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(An.SetSdkProfile,t);await this.signal.request(i),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(An.SetSourceChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ur.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(An.SetSourceUserId,t);await this.signal.request(a),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(An.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ur.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const l=this.genMessage(An.StartPacketTransfer,t);await this.signal.request(l),this.emit("event",ur.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ln.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(t){const n=this.genMessage(An.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",ur.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(An.StopPacketTransfer);await this.signal.request(t),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],o=[],a=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ci,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.17.2"&&(c.sdkVersion="0.0.1");let l=null,u=null;switch(t){case An.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case An.SetSourceChannel:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new N(I.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:u.channelName,token:u.token||this.joinInfo.appId},c;case An.SetSourceUserId:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new N(I.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:u.uid+""},c;case An.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new N(I.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{i.push(p.channelName),o.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"SetDestChannel",channelName:i,uid:o,token:a},c;case An.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case An.Reconnect:return c.clientRequest={command:"Reconnect"},c;case An.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case An.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new N(I.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(p=>{i.push(p.channelName),o.push(p.uid+""),a.push(p.token||this.joinInfo.appId)}),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:o,token:a},c}return c}}const mm=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new re((n,i)=>{t.toBlob(async o=>{if(t.remove(),o){const a=await xI(o);n({buffer:a,width:t.width,height:t.height})}else i(new N(I.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},xI=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};function VI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function jI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VI(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VI(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class Em{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){_(this,"trackId",void 0),_(this,"config",void 0),_(this,"onFirstVideoFrameDecoded",void 0),_(this,"freezeTimeCounterList",[]),_(this,"renderFreezeAccTime",0),_(this,"timeUpdatedCount",0),_(this,"freezeTime",0),_(this,"playbackTime",0),_(this,"lastTimeUpdatedTime",0),_(this,"autoplayFailed",!1),_(this,"videoTrack",void 0),_(this,"videoElement",void 0),_(this,"cacheVideoElement",void 0),_(this,"videoElementCheckInterval",void 0),_(this,"_videoElementStatus",dn.NONE),_(this,"isGettingVideoDimensions",!1),_(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),_(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&xe.curState==="running"&&(tf()?(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):yT()?(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):RT()&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))}),_(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=dn.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=dn.CANPLAY;break;case"stalled":this.videoElementStatus=dn.STALLED;break;case"suspend":this.videoElementStatus=dn.SUSPEND;break;case"pause":this.videoElementStatus=dn.PAUSED,In()||Cr()||yn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=dn.WAITING;break;case"abort":this.videoElementStatus=dn.ABORT;break;case"ended":this.videoElementStatus=dn.ENDED;break;case"emptied":this.videoElementStatus=dn.EMPTIED;break;case"error":{this.videoElementStatus=dn.ERROR;const i=this.videoElement.error;i&&T.error("[".concat(this.trackId,"] media error, code: ").concat(i.code,", message: ").concat(i.message));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const o=i-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,Yr.lastVisibleTime<Yr.lastHiddenTime||a<Yr.lastHiddenTime||a<Yr.lastVisibleTime)return;for(o>k("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),_(this,"autoResumeAfterInterruptionOnIOS15",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(tf()?(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):yT()?(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):RT()&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),xe.on(Kt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),xe.on(Kt.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&ue.autoplayFailed(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),o)});const i=Xe();if((i.name==="Safari"&&Number(i.version)===15||ea())&&n&&n.then&&n.catch){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,i.width,i.height),new re((a,c)=>{i.toBlob(async l=>{if(i.remove(),l){const u=await xI(l);a({buffer:u,width:i.width,height:i.height})}else c(new N(I.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await mm(t)}destroy(){xe.off(Kt.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),xe.off(Kt.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=dn.INIT,!this.videoElementCheckInterval&&(FI.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=dn.DESTROYED)},1e3),k("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let a;const c=(l,u)=>{if(this.videoElementStatus===dn.PLAYING){if(a){const m=u.presentationTime-a.presentationTime;m>k("VIDEO_FREEZE_DURATION")&&Yr.lastVisibleTime>=Yr.lastHiddenTime&&a.timestamp>Yr.lastVisibleTime&&a.timestamp>Yr.lastHiddenTime&&(this.renderFreezeAccTime+=m)}a=jI(jI({},u),{},{timestamp:l})}var p,f;k("ENABLE_VIDEO_FRAME_CALLBACK")&&((p=(f=this.videoElement).requestVideoFrameCallback)===null||p===void 0||p.call(f,c))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,c)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),nf()&&(this.videoElement.poster="noposter");const i=Xe();i.name==="Safari"&&Number(i.version)===15||ea()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Tt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Tt()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(a=>{T.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){FI.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=dn.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(i=>{T.error(i)}),this.autoplayFailed=!1,pc()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};pc()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),HR()}}const FI=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class BI extends Em{constructor(t){super(t),_(this,"container",void 0),_(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await mm(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",k("KEEP_LAST_FRAME")&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function ql(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=ls(e.encoderConfig);return t.width=n.width,t.height=n.height,!CT()&&n.frameRate&&(t.frameRate=n.frameRate),Xe().name===qe.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Tt()&&(t.frameRate={ideal:30,max:30}),t}function p2(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&Zp()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:i,surfaceSwitching:o,systemAudio:a}=e;(ef(107)||gT(107)||ST(93))&&(n&&(qt(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),i?(qt(i,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=i):t.selfBrowserSurface="include",o&&(qt(o,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=o)),(ef(105)||gT(105)||ST(91))&&a&&(qt(a,"systemAudio",["exclude","include"]),t.systemAudio=a),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const c=e.encoderConfig?yf(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:c?c.width:void 0,maxHeight:c?c.height:void 0},c&&(c.frameRate&&(typeof c.frameRate=="number"?(t.mandatory.maxFrameRate=c.frameRate,t.mandatory.minFrameRate=c.frameRate):(t.mandatory.maxFrameRate=c.frameRate.max||c.frameRate.ideal||c.frameRate.exact||void 0,t.mandatory.minFrameRate=c.frameRate.min||c.frameRate.ideal||c.frameRate.exact||void 0),t.frameRate=c.frameRate),c.width&&(t.width=c.width),c.height&&(t.height=c.height)),t}function GI(e){const t={};if(CT()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Zp()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=bl(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),nf()&&(t.sampleRate=void 0),t}var Sa,Jl;(function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"})(Sa||(Sa={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Jl||(Jl={}));var WI,HI,KI,zI,YI,qI,JI,XI,QI,$I,ZI,eC,tC,nC,iC,rC,oC,sC,aC,cC,dC,lC,uC,hC,De,pC,fC,mC,EC,_C,gC,SC,vC,Ni,TC=new class{constructor(){_(this,"_clientSize",null),_(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),_(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),_(this,"getStyle",e=>window.getComputedStyle(e,null)),_(this,"checkCssVisibleProperty",e=>{let t=!0;const n=this.getStyle(e),{display:i,visibility:o,opacity:a,filter:c}=n;return(i==="none"||["hidden","collapse"].includes(o)||Number(a)<.1)&&(t=!1),t?(c&&c.split(" ").filter(l=>{const u=l.split("(")[0];return["brightness","blur","opacity"].includes(u)}).map(l=>{const[u,p]=l.split(/\(|\)/);return[u,Number(p.match(/^[0-9\.]+/))]}).forEach(l=>{const[u,p]=l;switch(u){case"brightness":(p<.1||p>3)&&(t=!1);break;case"blur":p>3&&(t=!1);break;case"opacity":p<.1&&(t=!1)}}),t):!1}),_(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,i=!0;const o=c=>t(c);let a=e;for(;a&&i;)o(a)||(n=!1,i=!1),a=a.parentElement,a||(i=!1);return n}),_(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),_(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:i,right:o,top:a,bottom:c}=e.getBoundingClientRect(),l=this.getClientWidth(),u=this.getClientHeight();return{width:t,height:n,left:i,right:o,top:a,bottom:c,clientWidth:l,clientHeight:u,clientMin:Math.min(l,u)}}),_(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),_(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),_(this,"checkCoverForAPoint",(e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n}),_(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,o=e/6,a=t/6,c=[],l=10**6;for(let u=0;u<5;u++)for(let p=0;p<5;p++){const f=(n*l+(u===0?.1:u===4?(o*u*l-1e5)/l:o*u)*l)/l,m=(i*l+(p===0?.1:p===4?(a*p*l-1e5)/l:a*p)*l)/l;c.push({x:f,y:m})}return[...c]}),_(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),_(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),_(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:o,clientWidth:a,clientMin:c}=this._clientSize;let l,u,p,f;if(e<0)l=0;else{if(!(e<a))return!1;l=e}if(t<0)return!1;if(u=t<a?t:a,n<0)p=0;else{if(!(n<o))return!1;p=n}if(i<0)return!1;f=i<o?i:o;const m=u-l,v=f-p;return this.checkSizeIsVisible(m,v,c)}),_(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),_(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Sa.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Sa.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Sa.SIZE)}}return this.returnHiddenResult(Sa.STYLE)}return this.returnHiddenResult(Jl.UNMOUNTED)}return this.returnHiddenResult(Jl.INVALID_HTML_ELEMENT)}),_(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function RC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Ac(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RC(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RC(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Dt=(WI=_e({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),HI=It(),KI=_e({argsMap:e=>[e.getTrackId()]}),zI=ua("LocalVideoTrack","_enabledMutex"),YI=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),qI=It(),JI=ua("LocalVideoTrack","_enabledMutex"),XI=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),QI=It(),$I=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),ZI=It(),eC=It(),tC=_e({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),nC=It(),iC=It(),rC=It(),oC=It(),sC=It(),aC=It(),cC=It(),dC=_e({argsMap:(e,t)=>[e.getTrackId(),t.name]}),lC=_e({argsMap:e=>[e.getTrackId()]}),uC=_e({argsMap:e=>[e.getTrackId()]}),hC=_e({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),H((De=class hb extends Xf{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==dn.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,o,a,c){if(super(t,a),_(this,"trackMediaType","video"),_(this,"_player",void 0),_(this,"_videoVisibleTimer",null),_(this,"_previousVideoVisibleStatus",void 0),_(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_(this,"_encoderConfig",void 0),_(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),_(this,"_optimizationMode",void 0),_(this,"_videoHeight",void 0),_(this,"_videoWidth",void 0),_(this,"_forceBitrateLimit",void 0),_(this,"_enabled",!0),_(this,"processorDestination",void 0),_(this,"_processorContext",void 0),yn()){const{width:l,height:u}=t.getSettings();this._videoWidth=l,this._videoHeight=u}else this.updateMediaStreamTrackResolution();this._encoderConfig=n,this._scalabiltyMode=i,this._optimizationMode=o,this._hints=c||[],this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),n&&this._hints.indexOf(Ft.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this.processorContext=new cy(this.getTrackId(),"local"),this.processorDestination=new ay(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Ac(Ac(Ac({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new Em(i):this._player=new BI(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.emit(To.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},k("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await gt(this,Se.NEED_DISABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await gt(this,Se.NEED_ENABLE_TRACK,this)}catch(i){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await gt(this,Se.NEED_MUTE_TRACK,this):await gt(this,Se.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new N(I.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=ls(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=ql({encoderConfig:t});(yn()||In()||Cr())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const a=new N(I.UNEXPECTED_ERROR,o.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=t,this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await gt(this,Se.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw()}}getStats(){return Rc(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),br(this,Se.GET_STATS)||Ac({},xf)}async setBeautyEffect(t){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await mm(t)}clone(t,n,i,o){const a=this._mediaStreamTrack.clone();return new hb(a,t,n,i,o)}async setBitrateLimit(t){if(T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await gt(this,Se.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw()}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void T.error(I.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await gt(this,Se.SET_OPTIMIZATION_MODE,this)}catch(i){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return T.error(I.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){iI(this._originMediaStreamTrack).then(t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n}).catch(Wl)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const[o,a]=function(c,l,u){const p=k("BITRATE_ADAPTER_TYPE");let f;const m=200*Math.pow(u/15,.6)*Math.pow(c*l/640/360,.75),v=m;if(p==="STANDARD_BITRATE")f=4*m;else{if(p!=="COMPATIABLE_BITRATE")return;f=2*m}return[Math.floor(f),Math.floor(v)]}(t,n,i)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]")))}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:c}=o;if(this.isPlaying&&a instanceof HTMLVideoElement&&c instanceof HTMLElement){const l=TC.checkOneElementVisible(a),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const p=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(i){throw new N(I.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new N(I.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new N(I.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new N(I.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(hn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await gt(this,Se.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await gt(this,Se.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(hn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Hn.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Hn.REQUEST_CONSTRAINTS)}}).prototype,"play",[WI,HI],Object.getOwnPropertyDescriptor(De.prototype,"play"),De.prototype),H(De.prototype,"stop",[KI],Object.getOwnPropertyDescriptor(De.prototype,"stop"),De.prototype),H(De.prototype,"setEnabled",[zI,YI,qI],Object.getOwnPropertyDescriptor(De.prototype,"setEnabled"),De.prototype),H(De.prototype,"setMuted",[JI,XI,QI],Object.getOwnPropertyDescriptor(De.prototype,"setMuted"),De.prototype),H(De.prototype,"setEncoderConfiguration",[$I,ZI],Object.getOwnPropertyDescriptor(De.prototype,"setEncoderConfiguration"),De.prototype),H(De.prototype,"getStats",[eC],Object.getOwnPropertyDescriptor(De.prototype,"getStats"),De.prototype),H(De.prototype,"setBeautyEffect",[tC,nC],Object.getOwnPropertyDescriptor(De.prototype,"setBeautyEffect"),De.prototype),H(De.prototype,"getCurrentFrameData",[iC],Object.getOwnPropertyDescriptor(De.prototype,"getCurrentFrameData"),De.prototype),H(De.prototype,"getCurrentFrameImage",[rC],Object.getOwnPropertyDescriptor(De.prototype,"getCurrentFrameImage"),De.prototype),H(De.prototype,"setBitrateLimit",[oC],Object.getOwnPropertyDescriptor(De.prototype,"setBitrateLimit"),De.prototype),H(De.prototype,"setOptimizationMode",[sC],Object.getOwnPropertyDescriptor(De.prototype,"setOptimizationMode"),De.prototype),H(De.prototype,"setScalabiltyMode",[aC],Object.getOwnPropertyDescriptor(De.prototype,"setScalabiltyMode"),De.prototype),H(De.prototype,"updateMediaStreamTrackResolution",[cC],Object.getOwnPropertyDescriptor(De.prototype,"updateMediaStreamTrackResolution"),De.prototype),H(De.prototype,"pipe",[dC],Object.getOwnPropertyDescriptor(De.prototype,"pipe"),De.prototype),H(De.prototype,"unpipe",[lC],Object.getOwnPropertyDescriptor(De.prototype,"unpipe"),De.prototype),H(De.prototype,"close",[uC],Object.getOwnPropertyDescriptor(De.prototype,"close"),De.prototype),H(De.prototype,"replaceTrack",[hC],Object.getOwnPropertyDescriptor(De.prototype,"replaceTrack"),De.prototype),De),yC=(pC=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),fC=It(),mC=ua("CameraVideoTrack","_enabledMutex"),EC=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),_C=It(),gC=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),SC=It(),vC=_e({argsMap:e=>[e.getTrackId()]}),H((Ni=class extends Dt{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,i,o,a){super(e,ls(t.encoderConfig),i,o,a),_(this,"_config",void 0),_(this,"_originalConstraints",void 0),_(this,"_constraints",void 0),_(this,"_enabled",!0),_(this,"_deviceName","default"),_(this,"tryResumeVideoForIOS15WeChat",async()=>{ea()&&!tf()&&IT()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=ls(this._config.encoderConfig),xe.on(Kt.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),xe.on(Kt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),this.bindProcessorContextEvents()}async setDevice(e){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await fi.getDeviceById(e),n={};n.video=Ac({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await zi(n,this.getTrackId())}catch(o){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await zi({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await fi.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}T.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const n=await zi({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await gt(this,Se.NEED_ENABLE_TRACK,this)}catch(n){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await gt(this,Se.NEED_DISABLE_TRACK,this)}catch(n){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new N(I.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=ls(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const n=bt(this._config);n.encoderConfig=e;const i=ql(n);(yn()||In()||Cr())&&(i.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const a=new N(I.UNEXPECTED_ERROR,o.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,this._hints.indexOf(Ft.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await gt(this,Se.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((In()||Cr())&&this._enabled&&!this._isClosed&&xe.duringInterruption){const e=async()=>{xe.off(Kt.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};xe.on(Kt.IOS_INTERRUPTION_END,e)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(To.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=fi.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const i=await zi({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),xe.off(Kt.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),xe.off(Kt.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}bindProcessorContextEvents(){this.processorContext.on(Hn.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),t()}catch(i){n(i)}}),this.processorContext.on(Hn.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[pC,fC],Object.getOwnPropertyDescriptor(Ni.prototype,"setDevice"),Ni.prototype),H(Ni.prototype,"setEnabled",[mC,EC,_C],Object.getOwnPropertyDescriptor(Ni.prototype,"setEnabled"),Ni.prototype),H(Ni.prototype,"setEncoderConfiguration",[gC,SC],Object.getOwnPropertyDescriptor(Ni.prototype,"setEncoderConfiguration"),Ni.prototype),H(Ni.prototype,"close",[vC],Object.getOwnPropertyDescriptor(Ni.prototype,"close"),Ni.prototype),Ni);class _m{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(t,n){_(this,"uid",void 0),_(this,"_uintid",void 0),_(this,"_trust_in_room_",!0),_(this,"_trust_audio_enabled_state_",!0),_(this,"_trust_video_enabled_state_",!0),_(this,"_trust_audio_mute_state_",!0),_(this,"_trust_video_mute_state_",!0),_(this,"_audio_muted_",!1),_(this,"_video_muted_",!1),_(this,"_audio_enabled_",!0),_(this,"_video_enabled_",!0),_(this,"_audio_added_",!1),_(this,"_video_added_",!1),_(this,"_trust_video_stream_added_state_",!0),_(this,"_trust_audio_stream_added_state_",!0),_(this,"_audioTrack",void 0),_(this,"_videoTrack",void 0),_(this,"_audioSSRC",void 0),_(this,"_videoSSRC",void 0),_(this,"_audioOrtc",void 0),_(this,"_videoOrtc",void 0),_(this,"_cname",void 0),_(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=n}}var f2=xv,m2=Js,E2=sl;Dn({target:"Promise",stat:!0},{try:function(e){var t=m2.f(this),n=E2(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var gm=f2,_2=Dn,g2=Y,S2=E,v2=Tc,T2=Bi,R2=uo,y2=ho,IC=Cf,I2=kR,C2=jR,A2=Bs,CC=an("isConcatSpreadable"),AC=9007199254740991,wC="Maximum allowed index exceeded",OC=g2.TypeError,w2=A2>=51||!S2(function(){var e=[];return e[CC]=!1,e.concat()[0]!==e}),O2=C2("concat"),N2=function(e){if(!T2(e))return!1;var t=e[CC];return t!==void 0?!!t:v2(e)};_2({target:"Array",proto:!0,forced:!w2||!O2},{concat:function(e){var t,n,i,o,a,c=R2(this),l=I2(c,0),u=0;for(t=-1,i=arguments.length;t<i;t++)if(N2(a=t===-1?c:arguments[t])){if(u+(o=y2(a))>AC)throw OC(wC);for(n=0;n<o;n++,u++)n in a&&IC(l,u,a[n])}else{if(u>=AC)throw OC(wC);IC(l,u++,a)}return l.length=u,l}});var NC={},b2=Ge,D2=co,bC=Gd.f,P2=sR,DC=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];NC.f=function(e){return DC&&b2(e)=="Window"?function(t){try{return bC(t)}catch{return P2(DC)}}(e):bC(D2(e))};var wc={},k2=an;wc.f=k2;var PC=lo,L2=Zn,M2=wc,U2=cr.f,tn=function(e){var t=PC.Symbol||(PC.Symbol={});L2(t,e)||U2(t,e,{value:M2.f(e)})},va=Dn,Sm=Y,x2=Rr,V2=j,Oc=nt,j2=W,Ta=ie,vs=Ph,vm=E,En=Zn,F2=Tc,B2=z,G2=Bi,W2=B,Tm=kh,Rm=dr,H2=uo,Xl=co,ym=Ud,kC=Ks,Im=or,Nc=zd,LC=ep,K2=Gd,MC=NC,Cm=$h,UC=ae,xC=cr,z2=Zh,VC=Ze,Y2=gp,Am=nl,bc=Md.exports,jC=Wd,FC=jh,BC=an,q2=wc,J2=tn,X2=ac,GC=tl,Ql=MR.forEach,mi=Bd("hidden"),$l="Symbol",WC=BC("toPrimitive"),Q2=GC.set,HC=GC.getterFor($l),pr=Object.prototype,Io=Sm.Symbol,Ts=Io&&Io.prototype,KC=Sm.TypeError,wm=Sm.QObject,Dc=x2("JSON","stringify"),zC=UC.f,Co=xC.f,YC=MC.f,$2=VC.f,qC=j2([].push),Xr=bc("symbols"),Pc=bc("op-symbols"),Om=bc("string-to-symbol-registry"),Nm=bc("symbol-to-string-registry"),Z2=bc("wks"),bm=!wm||!wm.prototype||!wm.prototype.findChild,Dm=Ta&&vm(function(){return Nc(Co({},"a",{get:function(){return Co(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var i=zC(pr,t);i&&delete pr[t],Co(e,t,n),i&&e!==pr&&Co(pr,t,i)}:Co,Pm=function(e,t){var n=Xr[e]=Nc(Ts);return Q2(n,{type:$l,tag:e,description:t}),Ta||(n.description=t),n},Zl=function(e,t,n){e===pr&&Zl(Pc,t,n),Rm(e);var i=ym(t);return Rm(n),En(Xr,i)?(n.enumerable?(En(e,mi)&&e[mi][i]&&(e[mi][i]=!1),n=Nc(n,{enumerable:Im(0,!1)})):(En(e,mi)||Co(e,mi,Im(1,{})),e[mi][i]=!0),Dm(e,i,n)):Co(e,i,n)},km=function(e,t){Rm(e);var n=Xl(t),i=LC(n).concat(Lm(n));return Ql(i,function(o){Ta&&!Oc(JC,n,o)||Zl(e,o,n[o])}),e},JC=function(e){var t=ym(e),n=Oc($2,this,t);return!(this===pr&&En(Xr,t)&&!En(Pc,t))&&(!(n||!En(this,t)||!En(Xr,t)||En(this,mi)&&this[mi][t])||n)},XC=function(e,t){var n=Xl(e),i=ym(t);if(n!==pr||!En(Xr,i)||En(Pc,i)){var o=zC(n,i);return!o||!En(Xr,i)||En(n,mi)&&n[mi][i]||(o.enumerable=!0),o}},QC=function(e){var t=YC(Xl(e)),n=[];return Ql(t,function(i){En(Xr,i)||En(jC,i)||qC(n,i)}),n},Lm=function(e){var t=e===pr,n=YC(t?Pc:Xl(e)),i=[];return Ql(n,function(o){!En(Xr,o)||t&&!En(pr,o)||qC(i,Xr[o])}),i};if(vs||(Am(Ts=(Io=function(){if(W2(Ts,this))throw KC("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?kC(arguments[0]):void 0,t=FC(e),n=function(i){this===pr&&Oc(n,Pc,i),En(this,mi)&&En(this[mi],t)&&(this[mi][t]=!1),Dm(this,t,Im(1,i))};return Ta&&bm&&Dm(pr,t,{configurable:!0,set:n}),Pm(t,e)}).prototype,"toString",function(){return HC(this).tag}),Am(Io,"withoutSetter",function(e){return Pm(FC(e),e)}),VC.f=JC,xC.f=Zl,z2.f=km,UC.f=XC,K2.f=MC.f=QC,Cm.f=Lm,q2.f=function(e){return Pm(BC(e),e)},Ta&&Co(Ts,"description",{configurable:!0,get:function(){return HC(this).description}})),va({global:!0,wrap:!0,forced:!vs,sham:!vs},{Symbol:Io}),Ql(LC(Z2),function(e){J2(e)}),va({target:$l,stat:!0,forced:!vs},{for:function(e){var t=kC(e);if(En(Om,t))return Om[t];var n=Io(t);return Om[t]=n,Nm[n]=t,n},keyFor:function(e){if(!Tm(e))throw KC(e+" is not a symbol");if(En(Nm,e))return Nm[e]},useSetter:function(){bm=!0},useSimple:function(){bm=!1}}),va({target:"Object",stat:!0,forced:!vs,sham:!Ta},{create:function(e,t){return t===void 0?Nc(e):km(Nc(e),t)},defineProperty:Zl,defineProperties:km,getOwnPropertyDescriptor:XC}),va({target:"Object",stat:!0,forced:!vs},{getOwnPropertyNames:QC,getOwnPropertySymbols:Lm}),va({target:"Object",stat:!0,forced:vm(function(){Cm.f(1)})},{getOwnPropertySymbols:function(e){return Cm.f(H2(e))}}),Dc&&va({target:"JSON",stat:!0,forced:!vs||vm(function(){var e=Io();return Dc([e])!="[null]"||Dc({a:e})!="{}"||Dc(Object(e))!="{}"})},{stringify:function(e,t,n){var i=Y2(arguments),o=t;if((G2(t)||e!==void 0)&&!Tm(e))return F2(t)||(t=function(a,c){if(B2(o)&&(c=Oc(o,this,a,c)),!Tm(c))return c}),i[1]=t,V2(Dc,null,i)}}),!Ts[WC]){var ej=Ts.valueOf;Am(Ts,WC,function(e){return Oc(ej,this)})}X2(Io,$l),jC[mi]=!0,tn("asyncIterator"),tn("hasInstance"),tn("isConcatSpreadable"),tn("iterator"),tn("match"),tn("matchAll"),tn("replace"),tn("search"),tn("species"),tn("split"),tn("toPrimitive"),tn("toStringTag"),tn("unscopables"),ac(Y.JSON,"JSON",!0);var tj=lo.Symbol;tn("asyncDispose"),tn("dispose"),tn("matcher"),tn("metadata"),tn("observable"),tn("patternMatch"),tn("replaceAll");var $C=tj,ZC=wc.f("asyncIterator"),nj=ZC;function eA(e){this.wrapped=e}function kc(e){var t,n;function i(a,c){try{var l=e[a](c),u=l.value,p=u instanceof eA;gm.resolve(p?u.wrapped:u).then(function(f){p?i(a==="return"?"return":"next",f):o(l.done?"return":"normal",f)},function(f){i("throw",f)})}catch(f){o("throw",f)}}function o(a,c){switch(a){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(a,c){return new gm(function(l,u){var p={key:a,arg:c,resolve:l,reject:u,next:null};n?n=n.next=p:(t=n=p,i(a,c))})},typeof e.return!="function"&&(this.return=void 0)}function qi(e){return function(){return new kc(e.apply(this,arguments))}}function ke(e){return new eA(e)}kc.prototype[typeof $C=="function"&&nj||"@@asyncIterator"]=function(){return this},kc.prototype.next=function(e){return this._invoke("next",e)},kc.prototype.throw=function(e){return this._invoke("throw",e)},kc.prototype.return=function(e){return this._invoke("return",e)};var ij=wc.f("iterator");function Lc(e,t){var n={},i=!1;function o(a,c){return i=!0,c=new gm(function(l){l(e[a](c))}),{done:!1,value:t(c)}}return n[$C!==void 0&&ij||"@@iterator"]=function(){return this},n.next=function(a){return i?(i=!1,a):o("next",a)},typeof e.throw=="function"&&(n.throw=function(a){if(i)throw i=!1,a;return o("throw",a)}),typeof e.return=="function"&&(n.return=function(a){return i?(i=!1,a):o("return",a)}),n}var tA=ZC,Pt={exports:{}};function nA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function iA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Mm(e,t,n,i,o,a,c){let l=[],u=[],p=[],f=[],m=!1,v=!1;if(Pt.exports.parse(e).mediaDescriptions.forEach(R=>{c&&c!==R.attributes.direction||(R.media.mediaType!=="video"||m||(u=R.attributes.payloads,f=R.attributes.extmaps,m=!0),R.media.mediaType!=="audio"||v||(l=R.attributes.payloads,p=R.attributes.extmaps,v=!0))}),!f||u.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!p||l.length===0)throw new Error("Cannot get audio capabilities from SDP.");return u.forEach(R=>{var w;(w=R.rtpMap)!==null&&w!==void 0&&w.clockRate&&(R.rtpMap.clockRate=parseInt(R.rtpMap.clockRate))}),l.forEach(R=>{var w;(w=R.rtpMap)!==null&&w!==void 0&&w.clockRate&&(R.rtpMap.clockRate=parseInt(R.rtpMap.clockRate))}),t&&(l=l.filter(R=>{var w;return((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLowerCase())!=="rtx"}),u=u.filter(R=>{var w;return((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLowerCase())!=="rtx"})),n&&(u=u.filter(R=>{var w;return!/(red)|(ulpfec)|(flexfec)/i.test(((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName)||"")})),i&&(l=l.filter(R=>{var w;return!/(red)|(ulpfec)|(flexfec)/i.test(((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName)||"")})),o&&(o==null?void 0:o.length)>0&&(l=l.filter(R=>{var w;return o.includes(((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLowerCase())||"")})),a&&(a==null?void 0:a.length)>0&&(u=u.filter(R=>{var w;return a.includes(((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLowerCase())||"")})),{audioCodecs:l,videoCodecs:u,audioExtensions:p,videoExtensions:f}}function Rs(e){const t=Pt.exports.parse(e);let n,i;for(const o of t.mediaDescriptions){if(!n){const a=o.attributes.iceUfrag,c=o.attributes.icePwd;if(!a||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:c}}if(!i){const a=o.attributes.fingerprints;a.length>0&&(i={fingerprints:a})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function rA(e,t){const n=[],i=e.attributes.ssrcGroups.filter(c=>c.semantic==="FID"),o=e.attributes.ssrcGroups.find(c=>c.semantic==="SIM"),a=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(c=>{var l;const u=(l=i.find(p=>p.ssrcIds[0]===c))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:c,rtx:t?u:void 0})});else if(i.length>0){const c=i[0].ssrcIds[0],l=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:t?l:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function oA(e,t){const{cname:n}=e;let i;t&&t.ip&&typeof t.port=="number"?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):i=e.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}}));const o={fingerprints:e.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let c;switch(e.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}return{dtlsParameters:o,iceParameters:a,candidates:i,rtpCapabilities:Vm(e.rtpCapabilities),setup:c,cname:n}}function bi(e,t,n){const i=[],o=[];return e.forEach(a=>{let{ssrcId:c,rtx:l}=a;const u=ht(8,"track-"),p={ssrcId:c,attributes:iA({label:u,mslabel:n=n||ht(10,""),msid:"".concat(n," ").concat(u)},t&&{cname:t})};if(i.push(p),l!==void 0){const f={ssrcId:l,attributes:iA({label:u,mslabel:n,msid:"".concat(n," ").concat(u)},t&&{cname:t})};i.push(f),o.push({semantic:"FID",ssrcIds:[c,l]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(a=>{let{ssrcId:c}=a;return c})}),{ssrcs:i,ssrcGroups:o}}function Ra(e,t){t instanceof pn&&e.attributes.payloads.forEach(n=>{var i;const o=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=t._encoderConfig;a&&o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(a.bitrate&&!Tt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function Um(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function xm(e,t){if(!(t instanceof Dt&&t._encoderConfig&&t._hints.indexOf(Ft.SCREEN_TRACK)===-1))return;const n=t._encoderConfig;Zt().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(i=>{var o;["h264","vp8","vp9","av1"].includes(((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),Zt().supportMinBitrate&&!t._hints.includes(Ft.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(i=>{var o;["h264","vp8","vp9","av1"].includes(((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(k("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function sA(e){if(e.media.mediaType!=="video")return;const t=Xe();if(t.name!==qe.SAFARI&&t.os!==gn.IOS)return;const n=e.attributes.extmaps.findIndex(i=>/video-orientation/g.test(i.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function eu(e,t,n){if(!t)return;let i,o;if(e.media.mediaType==="video"?(i=n.videoExtensions,o=n.videoCodecs):(i=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){const a=i.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(e.attributes.extmaps.find(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(c,l){return l.filter(u=>!!c.find(p=>p.payloadType===u.payloadType&&!!p.rtcpFeedbacks.find(f=>f.type==="transport-cc")))}(o,e.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="transport-cc")||c.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){const a=i.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(e.attributes.extmaps.find(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(c,l){return l.filter(u=>!!c.find(p=>p.payloadType===u.payloadType&&!!p.rtcpFeedbacks.find(f=>f.type==="goog-remb")))}(o,e.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(l=>l.type==="goog-remb")||c.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const a=e.attributes.extmaps.findIndex(c=>c.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(c=>{const l=c.rtcpFeedbacks.findIndex(u=>u.type==="goog-remb");l!==-1&&c.rtcpFeedbacks.splice(l,1)})}}function aA(e,t,n){if(Tt()||e.media.mediaType!=="video"||!(t instanceof Dt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!k("SIMULCAST")||t._scalabiltyMode===void 0||t._scalabiltyMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabiltyMode.numSpatialLayers,o=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===o.ssrcId),c={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let l=1;l<i;l++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+l,attributes:bt(o.attributes)}),c.ssrcIds.push(o.ssrcId+l),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+l,attributes:bt(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+l,a.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(c)}async function cA(e,t,n,i,o){const a=new RTCPeerConnection;a.addTransceiver("video",{direction:"sendonly"}),a.addTransceiver("audio",{direction:"sendonly"}),a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"});const c=(await a.createOffer()).sdp,l=Mm(c,e,t,n,i,o,"sendonly"),u=Mm(c,e,t,n,i,o,"recvonly"),p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(tu(l,u,"videoExtensions",p,f,m),tu(l,u,"videoCodecs",p,f,m),tu(l,u,"audioExtensions",p,f,m),tu(l,u,"audioCodecs",p,f,m),k("RAISE_H264_BASELINE_PRIORITY")){const v=m.videoCodecs.findIndex(R=>{var w,A;return((w=R.rtpMap)===null||w===void 0?void 0:w.encodingName.toLocaleLowerCase())==="h264"&&((A=R.fmtp)===null||A===void 0?void 0:A.parameters["profile-level-id"])==="42001f"});if(v!==-1){const R=m.videoCodecs.findIndex(w=>{var A;return((A=w.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"});if(R<v){T.debug("raising H264 baseline profile priority");const w=m.videoCodecs[v];m.videoCodecs.splice(v,1),m.videoCodecs.splice(R,0,w)}R!==-1&&(f.videoCodecs=f.videoCodecs.filter(w=>{var A,O;return!(((A=w.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"&&((O=w.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])!=="42001f")})),R!==-1&&k("FILTER_SEND_H264_BASELINE")&&(p.videoCodecs=p.videoCodecs.filter(w=>{var A,O;return!(((A=w.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"&&((O=w.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])!=="42001f")}))}}try{a.close()}catch{}return{send:p,recv:f,sendrecv:m}}function tu(e,t,n,i,o,a){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return e[n].forEach(l=>{t[n].some((u,p)=>{if(l.entry===u.entry&&l.extensionName===u.extensionName)return c.push(p),!0})?a[n].push(l):i[n].push(l)}),void t[n].forEach((l,u)=>{c.indexOf(u)===-1&&o[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return e[n].forEach(l=>{t[n].some((u,p)=>{if(l.payloadType===u.payloadType&&JSON.stringify(l)===JSON.stringify(u))return c.push(p),!0})?a[n].push(l):i[n].push(l)}),void t[n].forEach((l,u)=>{c.indexOf(u)===-1&&o[n].push(l)})}}function Vm(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,a;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...i.audioCodecs],o.videoCodecs=[...t.videoCodecs,...i.videoCodecs],o.audioExtensions=[...t.audioExtensions,...i.audioExtensions],o.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):o=i,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...i.audioCodecs],a.videoCodecs=[...n.videoCodecs,...i.videoCodecs],a.audioExtensions=[...n.audioExtensions,...i.audioExtensions],a.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):a=i,{send:o,recv:a}}function Ao(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}(function(e,t){e.exports=(()=>{var n={8:(a,c,l)=>{l.r(c),l.d(c,{Parser:()=>lt,Printer:()=>Yn,parse:()=>ve,print:()=>je});const u=`
`,p="".concat("\r").concat(u),f=" ";let m;function v($){return $>="0"&&$<="9"}function R($){return $>="!"&&$<="~"}function w($){return R($)||$>=""&&$<="ÿ"}function A($){return $==="!"||$>="#"&&$<="'"||$>="*"&&$<="+"||$>="-"&&$<="."||$>="0"&&$<="9"||$>="A"&&$<="Z"||$>="^"&&$<="~"}function O($){return $>="1"&&$<="9"}function U($){return $>="A"&&$<="Z"||$>="a"&&$<="z"}function x($){return $==="d"||$==="h"||$==="m"||$==="s"}function Q($){return $>""&&$<"	"||$>"\v"&&$<"\f"||$>""&&$<"ÿ"}function pe($){return U($)||v($)||$==="+"||$==="/"}function Z($){return v($)||U($)||$==="+"||$==="/"||$==="-"||$==="_"}function ee($){return U($)||v($)||$==="+"||$==="/"}function J($,g){var C=Object.keys($);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols($);g&&(b=b.filter(function(G){return Object.getOwnPropertyDescriptor($,G).enumerable})),C.push.apply(C,b)}return C}function se($){for(var g=1;g<arguments.length;g++){var C=arguments[g]!=null?arguments[g]:{};g%2?J(Object(C),!0).forEach(function(b){tt($,b,C[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(C)):J(Object(C)).forEach(function(b){Object.defineProperty($,b,Object.getOwnPropertyDescriptor(C,b))})}return $}function tt($,g,C){return g in $?Object.defineProperty($,g,{value:C,enumerable:!0,configurable:!0,writable:!0}):$[g]=C,$}(function($){$.VERSION="v",$.ORIGIN="o",$.SESSION_NAME="s",$.INFORMATION="i",$.URI="u",$.EMAIL="e",$.PHONE="p",$.CONNECTION="c",$.BANDWIDTH="b",$.TIME="t",$.REPEAT="r",$.ZONE_ADJUSTMENTS="z",$.KEY="k",$.ATTRIBUTE="a",$.MEDIA="m"})(m||(m={}));class Ae{consumeText(g,C){let b=C;for(;b<g.length;){const G=g[b];if(G==="\0"||G==="\r"||G===u)break;b+=1}if(b-C==0)throw new Error("Invalid text, at ".concat(g));return b}consumeUnicastAddress(g,C,b){return this.consumeTill(g,C,f)}consumeOneOrMore(g,C,b){let G=C;for(;b(g[G]);)G++;if(G-C==0)throw new Error("Invalid rule at ".concat(C,"."));return G}consumeSpace(g,C){if(g[C]===f)return C+1;throw new Error("Invalid space at ".concat(C,"."))}consumeIP4Address(g,C){let b=C;for(let G=0;G<4;G++)if(b=this.consumeDecimalUChar(g,b),G!==3){if(g[b]!==".")throw new Error("Invalid IP4 address.");b++}return b}consumeDecimalUChar(g,C){let b=C;for(let Te=0;Te<3&&v(g[b]);Te++,b++);if(b-C==0)throw new Error("Invalid decimal uchar.");const G=parseInt(g.slice(C,b));if(G>=0&&G<=255)return b;throw new Error("Invalid decimal uchar")}consumeIP6Address(g,C){let b=this.consumeHexpart(g,C);return g[b]===":"&&(b+=1,b=this.consumeIP4Address(g,b)),b}consumeHexpart(g,C){let b=C;if(g[b]===":"&&g[b+1]===":"){b+=2;try{b=this.consumeHexseq(g,b)}catch{}return b}if(b=this.consumeHexseq(g,b),g[b]===":"&&g[b+1]===":"){b+=2;try{b=this.consumeHexseq(g,b)}catch{}return b}return b}consumeHexseq(g,C){let b=C;for(;b=this.consumeHex4(g,b),g[b]===":"&&g[b+1]!==":";)b+=1;return b}consumeHex4(g,C){let b=0;for(;b<4;b++)if(!((G=g[C+b])>="0"&&G<="9"||G>="a"&&G<="f"||G>="A"&&G<="F")){if(b===0)throw new Error("Invalid hex 4");break}var G;return C+b}consumeFQDN(g,C){let b=C;for(;v(g[b])||U(g[b])||g[b]==="-"||g[b]===".";)b+=1;if(b-C<4)throw new Error("Invalid FQDN");return b}consumeExtnAddr(g,C){return this.consumeOneOrMore(g,C,w)}consumeMulticastAddress(g,C,b){switch(b){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(g,C);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(g,C);default:try{return this.consumeFQDN(g,C)}catch{return this.consumeExtnAddr(g,C)}}}consumeIP6MulticastAddress(g,C){const b=this.consumeHexpart(g,C);return g[b]==="/"?this.consumeInteger(g,b+1):b}consumeIP4MulticastAddress(g,C){let b=C+3;const G=g.slice(C,b),Te=parseInt(G);if(Te<224||Te>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let st=0;st<3;st++){if(g[b]!==".")throw new Error("Invalid IP4 multicast address.");b+=1,b=this.consumeDecimalUChar(g,b)}return g[b]==="/"&&(b+=1),b=this.consumeTTL(g,b),g[b]==="/"&&(b=this.consumeInteger(g,b)),b}consumeInteger(g,C){if(!O(g[C]))throw new Error("Invalid integer.");for(C+=1;v(g[C]);)C+=1;return C}consumeTTL(g,C){if(g[C]==="0")return C+1;if(!O(g[C]))throw new Error("Invalid TTL.");C+=1;for(let b=0;b<2&&v(g[C]);b++)C+=1;return C}consumeToken(g,C){return this.consumeOneOrMore(g,C,A)}consumeTime(g,C){let b=C;if(g[b]==="0")return b+1;for(O(g[b])&&(b+=1);v(g[b]);)b++;if(b-C<10)throw new Error("Invalid time");return b}consumeAddress(g,C){return this.consumeTill(g,C,f)}consumeTypedTime(g,C){let b=C;return b=this.consumeOneOrMore(g,b,v),x(g[b])?b+1:b}consumeRepeatInterval(g,C){if(!O(g[C]))throw new Error("Invalid repeat interval");for(C+=1;v(g[C]);)C+=1;return x(g[C])&&(C+=1),C}consumePort(g,C){return this.consumeOneOrMore(g,C,v)}consume(g,C,b){for(let G=0;G<b.length;G++){if(C+G>=g.length)throw new Error("consume exceeding value length");if(g[C+G]!==b[G])throw new Error("consume ".concat(b," failed at ").concat(G))}return C+b.length}consumeTill(g,C,b){let G=C;for(;G<g.length&&(typeof b!="string"||g[G]!==b)&&(typeof b!="function"||!b(g[G]));)G++;return G}}class lt extends Ae{constructor(){super(),tt(this,"records",[]),tt(this,"currentLine",0)}parse(g){const C=this.probeEOL(g);this.records=g.split(C).filter(xn=>!!xn.trim()).map(this.parseLine),this.currentLine=0;const b=this.parseVersion(),G=this.parseOrigin(),Te=this.parseSessionName(),st=this.parseInformation(),rn=this.parseUri(),Qi=this.parseEmail(),bo=this.parsePhone(),Li=this.parseConnection(),Do=this.parseBandWidth(),Ca=this.parseTimeFields(),St=this.parseKey(),kt=this.parseSessionAttribute(),rt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:b,origin:G,sessionName:Te,information:st,uri:rn,emails:Qi,phones:bo,connection:Li,bandwidths:Do,timeFields:Ca,key:St,attributes:kt,mediaDescriptions:rt}}getCurrentRecord(){const g=this.records[this.currentLine];if(!g)throw new Error("Record doesn't exit.");return g}probeEOL(g){for(let C=0;C<g.length;C++)if(g[C]===u)return g[C-1]==="\r"?p:u;throw new Error("Invalid newline character.")}parseLine(g,C){if(g.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const b=g[0];if(g[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:b,value:g.slice(2),line:C,cur:0}}parseSessionAttribute(){const g=new wt;for(;this.currentLine<this.records.length;){const C=this.getCurrentRecord();if(C.type!==m.ATTRIBUTE)break;const b={attField:this.extractOneOrMore(C,G=>A(G)&&G!==":"),_cur:0};C.value[C.cur]===":"&&(C.cur+=1,b.attValue=this.extractOneOrMore(C,Q)),g.parse(b),this.currentLine++}return g.digest()}parseMediaAttributes(g){const C=new nn(g);for(;this.currentLine<this.records.length;){const b=this.getCurrentRecord();if(b.type!==m.ATTRIBUTE)break;const G={attField:this.extractOneOrMore(b,Te=>A(Te)&&Te!==":"),_cur:0};b.value[b.cur]===":"&&(b.cur+=1,G.attValue=this.extractOneOrMore(b,Q)),C.parse(G),this.currentLine++}return C.digest()}parseKey(){const g=this.getCurrentRecord();if(g.type===m.KEY){if(g.value==="prompt"||g.value==="clear:"||g.value==="base64:"||g.value==="uri:")return g.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const g=this.getCurrentRecord();if(g.type===m.ZONE_ADJUSTMENTS){const C=[];for(;;)try{const b=this.extract(g,this.consumeTime);this.consumeSpaceForRecord(g);let G=!1;g.value[g.cur]==="-"&&(G=!0,g.cur+=1);const Te=this.extract(g,this.consumeTypedTime);C.push({time:b,typedTime:Te,back:G})}catch{break}if(C.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,C}return[]}parseRepeat(){const g=[];for(;;){const C=this.getCurrentRecord();if(C.type!==m.REPEAT)break;{const b=this.extract(C,this.consumeRepeatInterval),G=this.parseTypedTime(C);g.push({repeatInterval:b,typedTimes:G}),this.currentLine++}}return g}parseTypedTime(g){const C=[];for(;;)try{this.consumeSpaceForRecord(g),C.push(this.extract(g,this.consumeTypedTime))}catch{break}if(C.length===0)throw new Error("Invalid typed time.");return C}parseTime(){const g=this.getCurrentRecord(),C=this.extract(g,this.consumeTime);this.consumeSpaceForRecord(g);const b=this.extract(g,this.consumeTime);return this.currentLine++,{startTime:C,stopTime:b}}parseBandWidth(){const g=[];for(;this.currentLine<this.records.length;){const C=this.getCurrentRecord();if(C.type!==m.BANDWIDTH)break;{const b=this.extractOneOrMore(C,A);if(C.value[C.cur]!==":")throw new Error("Invalid bandwidth field.");C.cur++;const G=this.extractOneOrMore(C,v);g.push({bwtype:b,bandwidth:G}),this.currentLine++}}return g}parseVersion(){const g=this.getCurrentRecord();if(g.type!==m.VERSION)throw new Error("first sdp record must be version");const C=g.value.slice(0,this.consumeOneOrMore(g.value,0,v));if(C.length!==g.value.length)throw new Error('invalid proto version, "v='.concat(g.value,'"'));return this.currentLine++,C}parseOrigin(){const g=this.getCurrentRecord();if(g.type!==m.ORIGIN)throw new Error("second line of sdp must be origin");const C=this.extractOneOrMore(g,w);this.consumeSpaceForRecord(g);const b=this.extractOneOrMore(g,v);this.consumeSpaceForRecord(g);const G=this.extractOneOrMore(g,v);this.consumeSpaceForRecord(g);const Te=this.extractOneOrMore(g,A);this.consumeSpaceForRecord(g);const st=this.extractOneOrMore(g,A);this.consumeSpaceForRecord(g);const rn=this.extract(g,this.consumeUnicastAddress);return this.currentLine++,{username:C,sessId:b,sessVersion:G,nettype:Te,addrtype:st,unicastAddress:rn}}parseSessionName(){const g=this.getCurrentRecord();if(g.type===m.SESSION_NAME){const C=this.extract(g,this.consumeText);return this.currentLine++,C}}parseInformation(){const g=this.getCurrentRecord();if(g.type!==m.INFORMATION)return;const C=this.extract(g,this.consumeText);return this.currentLine++,C}parseUri(){const g=this.getCurrentRecord();if(g.type===m.URI)return this.currentLine++,g.value}parseEmail(){const g=[];for(;;){const C=this.getCurrentRecord();if(C.type!==m.EMAIL)break;g.push(C.value),this.currentLine++}return g}parsePhone(){const g=[];for(;;){const C=this.getCurrentRecord();if(C.type!==m.PHONE)break;g.push(C.value),this.currentLine++}return g}parseConnection(){const g=this.getCurrentRecord();if(g.type===m.CONNECTION){const C=this.extractOneOrMore(g,A);this.consumeSpaceForRecord(g);const b=this.extractOneOrMore(g,A);this.consumeSpaceForRecord(g);const G=this.extract(g,this.consumeAddress);return this.currentLine++,{nettype:C,addrtype:b,address:G}}}parseMedia(){const g=this.getCurrentRecord(),C=this.extract(g,this.consumeToken);this.consumeSpaceForRecord(g);let b=this.extract(g,this.consumePort);g.value[g.cur]==="/"&&(g.cur+=1,b+=this.extract(g,this.consumeInteger)),this.consumeSpaceForRecord(g);const G=[];for(G.push(this.extract(g,this.consumeToken));g.value[g.cur]==="/";)g.cur+=1,G.push(this.extract(g,this.consumeToken));if(G.length===0)throw new Error("Invalid proto");const Te=this.parseFmt(g);return this.currentLine++,{mediaType:C,port:b,protos:G,fmts:Te}}parseTimeFields(){const g=[];for(;this.getCurrentRecord().type===m.TIME;){const C=this.parseTime(),b=this.parseRepeat(),G=this.parseZone();g.push({time:C,repeats:b,zones:G})}return g}parseMediaDescription(){const g=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.MEDIA;){const C=this.parseMedia(),b=this.parseInformation(),G=this.parseConnections(),Te=this.parseBandWidth(),st=this.parseKey(),rn=this.parseMediaAttributes(C);g.push({media:C,information:b,connections:G,bandwidths:Te,key:st,attributes:rn})}return g}parseConnections(){const g=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.CONNECTION;)g.push(this.parseConnection());return g}parseFmt(g){const C=[];for(;;)try{this.consumeSpaceForRecord(g),C.push(this.extract(g,this.consumeToken))}catch{break}if(C.length===0)throw new Error("Invalid fmts");return C}extract(g,C,...b){const G=C.call(this,g.value,g.cur,...b),Te=g.value.slice(g.cur,G);return g.cur=G,Te}extractOneOrMore(g,C){const b=this.consumeOneOrMore(g.value,g.cur,C),G=g.value.slice(g.cur,b);return g.cur=b,G}consumeSpaceForRecord(g){if(g.value[g.cur]!==f)throw new Error("Invalid space at ".concat(g.cur,"."));g.cur+=1}}class it extends Ae{constructor(...g){super(...g),tt(this,"attributes",void 0),tt(this,"digested",!1)}extractOneOrMore(g,C,b){const G=this.consumeOneOrMore(g.attValue,g._cur,C),Te=g.attValue.slice(g._cur,G),[st,rn]=b||[];if(typeof st=="number"&&Te.length<st)throw new Error("error in length, should be more or equal than ".concat(st," characters."));if(typeof rn=="number"&&Te.length>rn)throw new Error("error in length, should be less or equal than ".concat(rn," characters."));return g._cur=G,Te}consumeAttributeSpace(g){if(g.attValue[g._cur]!==f)throw new Error("Invalid space at ".concat(g._cur,"."));g._cur+=1}extract(g,C,...b){if(!g.attValue)throw new Error("Nothing to extract from attValue.");const G=C.call(this,g.attValue,g._cur,...b),Te=g.attValue.slice(g._cur,G);return g._cur=G,Te}atEnd(g){if(!g.attValue)throw new Error;return g._cur>=g.attValue.length}peekChar(g){if(!g.attValue)throw new Error;return g.attValue[g._cur]}peek(g,C){if(!g.attValue)throw new Error;for(let b=0;b<C.length;b++)if(C[b]!==g.attValue[g._cur+b])return!1;return!0}parseIceUfrag(g){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(g,pe,[4,256])}parseIcePwd(g){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(g,pe,[22,256])}parseIceOptions(g){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const C=[];for(;!this.atEnd(g);){C.push(this.extractOneOrMore(g,pe));try{this.consumeAttributeSpace(g)}catch(b){if(this.atEnd(g))break;throw b}}this.attributes.iceOptions=C}parseFingerprint(g){const C=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill);this.attributes.fingerprints.push({hashFunction:C,fingerprint:b})}parseExtmap(g){const C=this.extractOneOrMore(g,v);let b;this.peekChar(g)==="/"&&(this.extract(g,this.consume,"/"),b=this.extract(g,this.consumeToken)),this.consumeAttributeSpace(g);const G=this.extract(g,this.consumeTill,f),Te=se(se({entry:parseInt(C,10)},b&&{direction:b}),{},{extensionName:G});this.peekChar(g)===f&&(this.consumeAttributeSpace(g),Te.extensionAttributes=this.extract(g,this.consumeTill)),this.attributes.extmaps.push(Te)}parseSetup(g){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const C=this.extract(g,this.consumeTill);if(C!=="active"&&C!=="passive"&&C!=="actpass"&&C!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=C}}class wt extends it{constructor(...g){super(...g),tt(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(g){if(this.digested)throw new Error("already digested");try{switch(g.attField){case"group":this.parseGroup(g);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(g);break;case"ice-pwd":this.parseIcePwd(g);break;case"ice-options":this.parseIceOptions(g);break;case"fingerprint":this.parseFingerprint(g);break;case"setup":this.parseSetup(g);break;case"tls-id":this.parseTlsId(g);break;case"identity":this.parseIdentity(g);break;case"extmap":this.parseExtmap(g);break;case"msid-semantic":this.parseMsidSemantic(g);break;default:g.ignored=!0,this.attributes.unrecognized.push(g)}}catch(C){throw console.error("parsing session attribute ".concat(g.attField,' error, "a=').concat(g.attField,":").concat(g.attValue,'"')),C}if(!g.ignored&&g.attValue&&!this.atEnd(g))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(g){const C=this.extract(g,this.consumeToken),b=[];for(;!this.atEnd(g)&&this.peekChar(g)===f;)this.consumeAttributeSpace(g),b.push(this.extract(g,this.consumeToken));this.attributes.groups.push({semantic:C,identificationTag:b})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(g){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(g,Z)}parseIdentity(g){const C=this.extractOneOrMore(g,ee),b=[];for(;!this.atEnd(g)&&this.peekChar(g)===f;){this.consumeAttributeSpace(g);const G=this.extract(g,this.consumeToken);this.extract(g,this.consume,"=");const Te=this.extractOneOrMore(g,st=>st!==f&&Q(st));b.push({name:G,value:Te})}this.attributes.identities.push({assertionValue:C,extensions:b})}parseMsidSemantic(g){this.peekChar(g)===f&&this.consumeAttributeSpace(g);const C={semantic:this.extract(g,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(g)}catch{break}if(this.peekChar(g)==="*"){this.extract(g,this.consume,"*"),C.applyForAll=!0;break}{const b=this.extract(g,this.consumeTill,f);C.identifierList.push(b)}}this.attributes.msidSemantic=C}}class nn extends it{constructor(g){super(),tt(this,"attributes",void 0),g.protos.indexOf("RTP")!==-1||g.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(g){if(this.digested)throw new Error("already digested");try{switch(g.attField){case"extmap":this.parseExtmap(g);break;case"setup":this.parseSetup(g);break;case"ice-ufrag":this.parseIceUfrag(g);break;case"ice-pwd":this.parseIcePwd(g);break;case"ice-options":this.parseIceOptions(g);break;case"candidate":this.parseCandidate(g);break;case"remote-candidate":this.parseRemoteCandidate(g);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(g);break;case"rtpmap":this.parseRtpmap(g);break;case"ptime":this.parsePtime(g);break;case"maxptime":this.parseMaxPtime(g);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(g);break;case"ssrc":this.parseSSRC(g);break;case"fmtp":this.parseFmtp(g);break;case"rtcp-fb":this.parseRtcpFb(g);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(g);break;case"mid":this.parseMid(g);break;case"msid":this.parseMsid(g);break;case"imageattr":this.parseImageAttr(g);break;case"rid":this.parseRid(g);break;case"simulcast":this.parseSimulcast(g);break;case"sctp-port":this.parseSctpPort(g);break;case"max-message-size":this.parseMaxMessageSize(g);break;case"ssrc-group":this.parseSSRCGroup(g);break;default:g.ignored=!0,this.attributes.unrecognized.push(g)}}catch(C){throw console.error("parsing media attribute ".concat(g.attField,' error, "a=').concat(g.attField,":").concat(g.attValue,'"')),C}if(!g.ignored&&g.attValue&&!this.atEnd(g))throw new Error("attribute parsing error")}parseCandidate(g){const C=this.extractOneOrMore(g,pe,[1,32]);this.consumeAttributeSpace(g);const b=this.extractOneOrMore(g,v,[1,5]);this.consumeAttributeSpace(g);const G=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);const Te=this.extractOneOrMore(g,v,[1,10]);this.consumeAttributeSpace(g);const st=this.extract(g,this.consumeAddress);this.consumeAttributeSpace(g);const rn=this.extract(g,this.consumePort);this.consumeAttributeSpace(g),this.extract(g,this.consume,"typ"),this.consumeAttributeSpace(g);const Qi={foundation:C,componentId:b,transport:G,priority:Te,connectionAddress:st,port:rn,type:this.extract(g,this.consumeToken),extension:{}};for(this.peek(g," raddr")&&(this.extract(g,this.consume," raddr"),this.consumeAttributeSpace(g),Qi.relAddr=this.extract(g,this.consumeAddress)),this.peek(g," rport")&&(this.extract(g,this.consume," rport"),this.consumeAttributeSpace(g),Qi.relPort=this.extract(g,this.consumePort));this.peekChar(g)===f;){this.consumeAttributeSpace(g);const bo=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g),Qi.extension[bo]=this.extractOneOrMore(g,R)}this.attributes.candidates.push(Qi)}parseRemoteCandidate(g){const C=[];for(;;){const b=this.extractOneOrMore(g,v,[1,5]);this.consumeAttributeSpace(g);const G=this.extract(g,this.consumeAddress);this.consumeAttributeSpace(g);const Te=this.extract(g,this.consumePort);C.push({componentId:b,connectionAddress:G,port:Te});try{this.consumeAttributeSpace(g)}catch{break}}this.attributes.remoteCandidatesList.push(C)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(g){const C=this.extract(g,this.consumeToken);this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill,"/");this.extract(g,this.consume,"/");const G={encodingName:b,clockRate:this.extractOneOrMore(g,v)};this.atEnd(g)||this.peekChar(g)!=="/"||(this.extract(g,this.consume,"/"),G.encodingParameters=parseInt(this.extract(g,this.consumeTill),10));const Te=this.attributes.payloads.find(st=>st.payloadType===parseInt(C,10));Te?Te.rtpMap=G:this.attributes.payloads.push({payloadType:parseInt(C,10),rtpMap:G,rtcpFeedbacks:[]})}parsePtime(g){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(g,this.consumeTill)}parseMaxPtime(g){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(g,this.consumeTill)}parseDirection(g){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=g.attField}parseSSRC(g){const C=this.extractOneOrMore(g,v);this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill,":");let G;this.peekChar(g)===":"&&(this.extract(g,this.consume,":"),G=this.extract(g,this.consumeTill));const Te=this.attributes.ssrcs.find(st=>st.ssrcId===parseInt(C,10));Te?Te.attributes[b]=G:this.attributes.ssrcs.push({ssrcId:parseInt(C,10),attributes:{[b]:G}})}parseFmtp(g){const C=this.extract(g,this.consumeTill,f);this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill),G={};b.split(";").forEach(st=>{let[rn,Qi]=st.split("=");rn=rn.trim();const bo=typeof Qi=="string"?Qi.trim():null;typeof rn=="string"&&rn.length>0&&(G[rn]=bo)});const Te=this.attributes.payloads.find(st=>st.payloadType===parseInt(C,10));Te?Te.fmtp={parameters:G}:this.attributes.payloads.push({payloadType:parseInt(C,10),rtcpFeedbacks:[],fmtp:{parameters:G}})}parseFmtParameters(g){const C={},b=this.extract(g,this.consumeTill,"=");g._cur++;const G=this.extract(g,this.consumeTill,";");for(C[b]=G;g.attValue[g._cur]===";";){const Te=this.extract(g,this.consumeTill,"=");g._cur++;const st=this.extract(g,this.consumeTill,";");C[Te]=st}return C}parseRtcpFb(g){let C="";C=this.peekChar(g)==="*"?this.extract(g,this.consume,"*"):this.extract(g,this.consumeTill,f),this.consumeAttributeSpace(g);const b=this.extract(g,this.consumeTill,f);let G;switch(b){case"trr-int":G={type:b,interval:this.extract(g,this.consumeTill)};break;case"ack":case"nack":default:{const Te={type:b};this.peekChar(g)===f&&(this.consumeAttributeSpace(g),Te.parameter=this.extract(g,this.consumeToken),this.peekChar(g)===f&&(Te.additional=this.extract(g,this.consumeTill))),G=Te}}if(C==="*")this.attributes.rtcpFeedbackWildcards.push(G);else{const Te=this.attributes.payloads.find(st=>st.payloadType===parseInt(C,10));Te?Te.rtcpFeedbacks.push(G):this.attributes.payloads.push({payloadType:parseInt(C,10),rtcpFeedbacks:[G]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(g){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const C={port:this.extract(g,this.consumePort)};this.peekChar(g)===f&&(this.consumeAttributeSpace(g),C.netType=this.extractOneOrMore(g,A),this.consumeAttributeSpace(g),C.addressType=this.extractOneOrMore(g,A),this.consumeAttributeSpace(g),C.address=this.extract(g,this.consumeAddress)),this.attributes.rtcp=C}parseMsid(g){const C={id:this.extractOneOrMore(g,A,[1,64])};this.peekChar(g)===f&&(this.consumeAttributeSpace(g),C.appdata=this.extractOneOrMore(g,A,[1,64])),this.attributes.msids.push(C)}parseImageAttr(g){this.attributes.imageattr.push(g.attValue)}parseRid(g){const C=this.extractOneOrMore(g,G=>U(G)||v(G)||G==="_"||G==="-");this.consumeAttributeSpace(g);const b={id:C,direction:this.extract(g,this.consumeToken),params:[]};if(this.peekChar(g)===f){if(this.consumeAttributeSpace(g),this.peek(g,"pt=")){this.extract(g,this.consume,"pt=");const G=[];for(;;){const Te=this.extract(g,this.consumeToken);G.push(Te);try{this.extract(g,this.consume,",")}catch{break}}b.payloads=G,this.peekChar(g)===f&&this.extract(g,this.consume,f)}for(;;){const G=this.extract(g,this.consumeToken);switch(G){case"depend":{const Te={type:G,rids:this.extract(g,this.consume,"=").split(",")};b.params.push(Te);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const Te={type:G};this.peekChar(g)==="="&&(this.extract(g,this.consume,"="),Te.val=this.extract(g,this.consumeTill,";")),b.params.push(Te)}}try{this.extract(g,this.consume,";")}catch{break}}}this.attributes.rids.push(b)}parseSimulcast(g){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=g.attValue,this.extract(g,this.consumeTill)}parseSctpPort(g){this.attributes.sctpPort=this.extractOneOrMore(g,v,[1,5])}parseMaxMessageSize(g){this.attributes.maxMessageSize=this.extractOneOrMore(g,v,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(g){this.attributes.mid=this.extract(g,this.consumeToken)}parseSSRCGroup(g){const C=this.extract(g,this.consumeToken),b=[];for(;;)try{this.consumeAttributeSpace(g);const G=this.extract(g,this.consumeInteger);b.push(parseInt(G,10))}catch{break}this.attributes.ssrcGroups.push({semantic:C,ssrcIds:b})}}function Ct($,g,C){return g in $?Object.defineProperty($,g,{value:C,enumerable:!0,configurable:!0,writable:!0}):$[g]=C,$}class Yn{constructor(){Ct(this,"eol",p)}print(g,C){let b="";return C&&(this.eol=C),b+=this.printVersion(g.version),b+=this.printOrigin(g.origin),b+=this.printSessionName(g.sessionName),b+=this.printInformation(g.information),b+=this.printUri(g.uri),b+=this.printEmail(g.emails),b+=this.printPhone(g.phones),b+=this.printConnection(g.connection),b+=this.printBandwidth(g.bandwidths),b+=this.printTimeFields(g.timeFields),b+=this.printKey(g.key),b+=this.printSessionAttributes(g.attributes),b+=this.printMediaDescription(g.mediaDescriptions),b}printVersion(g){return"v=".concat(g).concat(this.eol)}printOrigin(g){return"o=".concat(g.username," ").concat(g.sessId," ").concat(g.sessVersion," ").concat(g.nettype," ").concat(g.addrtype," ").concat(g.unicastAddress).concat(this.eol)}printSessionName(g){return g?"s=".concat(g).concat(this.eol):""}printInformation(g){return g?"i=".concat(g).concat(this.eol):""}printUri(g){return g?"u=".concat(g).concat(this.eol):""}printEmail(g){let C="";for(const b of g)C+="e=".concat(b).concat(this.eol);return C}printPhone(g){let C="";for(const b of g)C+="e=".concat(b).concat(this.eol);return C}printConnection(g){return g?"c=".concat(g.nettype," ").concat(g.addrtype," ").concat(g.address).concat(this.eol):""}printBandwidth(g){let C="";for(const b of g)C+="b=".concat(b.bwtype,":").concat(b.bandwidth).concat(this.eol);return C}printTimeFields(g){let C="";for(const b of g){C+="t=".concat(b.time.startTime," ").concat(b.time.startTime).concat(this.eol);for(const G of b.repeats)C+="r=".concat(G.repeatInterval," ").concat(G.typedTimes.join(" ")).concat(this.eol);b.zoneAdjustments&&(C+="z=",C+="z=".concat(b.zoneAdjustments.map(G=>"".concat(G.time," ").concat(G.back?"-":""," ").concat(G.typedTime)).join(" ")).concat(this.eol),C+=this.eol)}return C}printKey(g){return g?"k=".concat(g).concat(this.eol):""}printAttributes(g){let C="";for(const b of g)C+="a=".concat(b.attField).concat(b.attValue?":".concat(b.attValue):"").concat(this.eol);return C}printMediaDescription(g){let C="";for(const b of g)C+=this.printMedia(b.media),C+=this.printInformation(b.information),C+=this.printConnections(b.connections),C+=this.printBandwidth(b.bandwidths),C+=this.printKey(b.key),C+=this.printMediaAttributes(b);return C}printConnections(g){let C="";for(const b of g)C+=this.printConnection(b);return C}printMedia(g){return"m=".concat(g.mediaType," ").concat(g.port," ").concat(g.protos.join("/")," ").concat(g.fmts.join(" ")).concat(this.eol)}printSessionAttributes(g){return new K(this.eol).print(g)}printMediaAttributes(g){return new ne(this.eol).print(g)}}class F{constructor(g){Ct(this,"eol",void 0),this.eol=g}printIceUfrag(g){return g===void 0?"":"a=ice-ufrag:".concat(g).concat(this.eol)}printIcePwd(g){return g===void 0?"":"a=ice-pwd:".concat(g).concat(this.eol)}printIceOptions(g){return g===void 0?"":"a=ice-options:".concat(g.join(f)).concat(this.eol)}printFingerprints(g){return g.length>0?g.map(C=>"a=fingerprint:".concat(C.hashFunction).concat(f).concat(C.fingerprint)).join(this.eol)+this.eol:""}printExtmap(g){return g.map(C=>"a=extmap:".concat(C.entry).concat(C.direction?"/".concat(C.direction):"").concat(f).concat(C.extensionName).concat(C.extensionAttributes?"".concat(f).concat(C.extensionAttributes):"").concat(this.eol)).join("")}printSetup(g){return g===void 0?"":"a=setup:".concat(g).concat(this.eol)}printUnrecognized(g){return g.map(C=>"a=".concat(C.attField).concat(C.attValue?":".concat(C.attValue):"").concat(this.eol)).join("")}}class K extends F{print(g){let C="";return C+=this.printGroups(g.groups),C+=this.printMsidSemantic(g.msidSemantic),C+=this.printIceLite(g.iceLite),C+=this.printIceUfrag(g.iceUfrag),C+=this.printIcePwd(g.icePwd),C+=this.printIceOptions(g.iceOptions),C+=this.printFingerprints(g.fingerprints),C+=this.printSetup(g.setup),C+=this.printTlsId(g.tlsId),C+=this.printIdentity(g.identities),C+=this.printExtmap(g.extmaps),C+=this.printUnrecognized(g.unrecognized),C}printGroups(g){let C="";return g.length>0&&(C+=g.map(b=>"a=group:".concat(b.semantic).concat(b.identificationTag.map(G=>"".concat(f).concat(G)).join("")).concat(this.eol)).join("")),C}printIceLite(g){return g===void 0?"":"a=ice-lite"+this.eol}printTlsId(g){return g?"a=tls-id:".concat(g).concat(this.eol):""}printIdentity(g){return g.length===0?"":g.map(C=>"a=identity:".concat(C.assertionValue).concat(C.extensions.map(b=>"".concat(f).concat(b.name).concat(b.value?"=".concat(b.value):"")))).join(this.eol)+this.eol}printMsidSemantic(g){if(!g)return"";let C="a=msid-semantic:".concat(g.semantic);return g.applyForAll?C+="".concat(f,"*"):g.identifierList.length>0&&(C+=g.identifierList.map(b=>"".concat(f).concat(b))),C+this.eol}}class ne extends F{print(g){const C=g.attributes;let b="";return b+=this.printRTCP(C.rtcp),b+=this.printIceUfrag(C.iceUfrag),b+=this.printIcePwd(C.icePwd),b+=this.printIceOptions(C.iceOptions),b+=this.printCandidates(C.candidates),b+=this.printRemoteCandidatesList(C.remoteCandidatesList),b+=this.printEndOfCandidates(C.endOfCandidates),b+=this.printFingerprints(C.fingerprints),b+=this.printSetup(C.setup),b+=this.printMid(C.mid),b+=this.printExtmap(C.extmaps),b+=this.printRTPRelated(C),b+=this.printPtime(C.ptime),b+=this.printMaxPtime(C.maxPtime),b+=this.printDirection(C.direction),b+=this.printSSRCGroups(C.ssrcGroups),b+=this.printSSRC(C.ssrcs),b+=this.printRTCPMux(C.rtcpMux),b+=this.printRTCPMuxOnly(C.rtcpMuxOnly),b+=this.printRTCPRsize(C.rtcpRsize),b+=this.printMSId(C.msids),b+=this.printImageattr(C.imageattr),b+=this.printRid(C.rids),b+=this.printSimulcast(C.simulcast),b+=this.printSCTPPort(C.sctpPort),b+=this.printMaxMessageSize(C.maxMessageSize),b+=this.printUnrecognized(C.unrecognized),b}printCandidates(g){return g.map(C=>"a=candidate:".concat(C.foundation).concat(f).concat(C.componentId).concat(f).concat(C.transport).concat(f).concat(C.priority).concat(f).concat(C.connectionAddress).concat(f).concat(C.port).concat(f,"typ").concat(f).concat(C.type).concat(C.relAddr?"".concat(f,"raddr").concat(f).concat(C.relAddr):"").concat(C.relPort?"".concat(f,"rport").concat(f).concat(C.relPort):"").concat(Object.keys(C.extension).map(b=>"".concat(f).concat(b).concat(f).concat(C.extension[b])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(g){return g.map(C=>"a=remote-candidates:".concat(C.join(f)).concat(this.eol)).join("")}printEndOfCandidates(g){return g===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(g){if(!g.payloads)return"";const C=g.payloads;let b="";b+=g.rtcpFeedbackWildcards.map(G=>this.printRTCPFeedback("*",G)).join("");for(const G of C)b+=this.printRtpMap(G.payloadType,G.rtpMap),b+=this.printFmtp(G.payloadType,G.fmtp),b+=G.rtcpFeedbacks.map(Te=>this.printRTCPFeedback(G.payloadType,Te)).join("");return b}printFmtp(g,C){if(!C)return"";const b=Object.keys(C.parameters);return b.length===1&&C.parameters[b[0]]===null?"a=fmtp:".concat(g).concat(f).concat(b[0]).concat(this.eol):"a=fmtp:".concat(g).concat(f).concat(Object.keys(C.parameters).map(G=>"".concat(G,"=").concat(C.parameters[G])).join(";")).concat(this.eol)}printRtpMap(g,C){return C?"a=rtpmap:".concat(g).concat(f).concat(C.encodingName,"/").concat(C.clockRate).concat(C.encodingParameters?"/".concat(C.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(g,C){let b="a=rtcp-fb:".concat(g).concat(f),G=C;switch(G.type){case"trr-int":b+="ttr-int".concat(f).concat(G.interval);break;case"ack":case"nack":default:G=G,b+="".concat(G.type),G.parameter&&(b+="".concat(f).concat(G.parameter),G.additional&&(b+="".concat(f).concat(G.additional)))}return b+this.eol}printPtime(g){return g===void 0?"":"a=ptime:".concat(g).concat(this.eol)}printMaxPtime(g){return g===void 0?"":"a=maxptime:".concat(g).concat(this.eol)}printDirection(g){return g===void 0?"":"a=".concat(g).concat(this.eol)}printSSRC(g){return g.map(C=>Object.keys(C.attributes).map(b=>"a=ssrc:".concat(C.ssrcId.toString(10)).concat(f).concat(b).concat(C.attributes[b]?":".concat(C.attributes[b]):"").concat(this.eol)).join("")).join("")}printRTCPMux(g){return g===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(g){return g===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(g){return g===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(g){if(g===void 0)return"";let C="a=rtcp:".concat(g.port);return g.netType&&(C+="".concat(f).concat(g.netType)),g.addressType&&(C+="".concat(f).concat(g.addressType)),g.address&&(C+="".concat(f).concat(g.address)),C+this.eol}printMSId(g){return g.map(C=>"a=msid:".concat(C.id).concat(C.appdata?"".concat(f).concat(C.appdata):"").concat(this.eol)).join("")}printImageattr(g){return g.map(C=>"a=imageattr:".concat(C).concat(this.eol)).join("")}printRid(g){return g.map(C=>{let b="a=rid:".concat(C.id).concat(f).concat(C.direction);return C.payloads&&(b+="".concat(f,"pt=").concat(C.payloads.join(","))),C.params.length>0&&(b+="".concat(f).concat(C.params.map(G=>G.type==="depend"?"depend=".concat(G.rids.join(",")):"".concat(G.type,"=").concat(G.val)).join(";"))),b+this.eol}).join("")}printSimulcast(g){return g===void 0?"":"a=simulcast:".concat(g).concat(this.eol)}printSCTPPort(g){return g===void 0?"":"a=sctp-port:".concat(g).concat(this.eol)}printMaxMessageSize(g){return g===void 0?"":"a=max-message-size:".concat(g).concat(this.eol)}printMid(g){return g===void 0?"":"a=mid:".concat(g).concat(this.eol)}printSSRCGroups(g){return g.map(C=>"a=ssrc-group:".concat(C.semantic).concat(C.ssrcIds.map(b=>"".concat(f).concat(b.toString(10))).join("")).concat(this.eol)).join("")}}function ve($){return new lt().parse($)}function je($,g){return new Yn().print($,g)}}},i={};function o(a){if(i[a])return i[a].exports;var c=i[a]={exports:{}};return n[a](c,c.exports,o),c.exports}return o.d=(a,c)=>{for(var l in c)o.o(c,l)&&!o.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:c[l]})},o.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),o.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},o(8)})()})(Pt);class rj{constructor(t){_(this,"sessionDesc",void 0),_(this,"localCapabilities",void 0),_(this,"rtpCapabilities",void 0),_(this,"candidates",void 0),_(this,"iceParameters",void 0),_(this,"dtlsParameters",void 0),_(this,"setup",void 0),_(this,"currentMidIndex",void 0),_(this,"cname",void 0),t=bt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,sdkCodec:u,cname:p}=t,f=Pt.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=o,this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=l,this.cname=p;for(let m=0;m<f.mediaDescriptions.length;m++){const v=f.mediaDescriptions[m];if(v.attributes.iceUfrag=n.iceUfrag,v.attributes.icePwd=n.icePwd,v.attributes.fingerprints=i.fingerprints,v.attributes.candidates=o,v.attributes.setup=c,v.media.mediaType==="video"){v.media.fmts=a.videoCodecs.map(w=>w.payloadType.toString(10));const R=a.videoCodecs.filter(w=>{var A;return(A=w.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase().includes(u)});if(R.length===0)throw new Error("Codec ".concat(u," not supported by remote SDP."));v.attributes.payloads=R,v.attributes.extmaps=a.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=a.audioCodecs.map(R=>R.payloadType.toString(10)),v.attributes.payloads=a.audioCodecs,v.attributes.extmaps=a.audioExtensions),f.mediaDescriptions[m]=this.mungMediaDesc(v)}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return Pt.exports.print(this.sessionDesc)}send(t,n,i){const{ssrcs:o,ssrcGroups:a}=bi(n,this.cname),c=this.sessionDesc.mediaDescriptions.find(p=>t===we.VIDEO?p.media.mediaType==="video":p.media.mediaType==="audio"),l=o[0].attributes.label,u=o[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(o),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(a),{id:l,mslabel:u}}batchSend(t){return t.map(n=>{let{kind:i,ssrcMsg:o}=n;return this.send(i,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const i=[],o=[],a=[];n.attributes.ssrcs.forEach(c=>{t.includes(c.attributes.label||"")?a.push(c):i.push(c)}),n.attributes.ssrcGroups.forEach(c=>{a.map(l=>l.ssrcId).includes(c.ssrcIds[0])||o.push(c)}),n.attributes.ssrcs=i,n.attributes.ssrcGroups=o})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach((o,a)=>{const c=o._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===c.kind),u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],o);this.sessionDesc.mediaDescriptions[l]=u})}stopReceiving(t){}restartICE(t){t=bt(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=bt(t);return Ra(i,n),xm(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const o=this.sessionDesc.mediaDescriptions.find(c=>t===we.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(o){const c=o.attributes.ssrcs.find(l=>l.attributes.label===n);var a;c&&(c.attributes.label=i,(a=c.attributes.msid)===null||a===void 0||a.replace(n,i))}}mungMediaDesc(t){const n=bt(t);return Um(n),function(i){const o=i.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(o),1),i.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}function Ji(e){if(Array.isArray(e))return e.map(n=>n);if(!dA(e))return e;const t={};for(const n in e)dA(e[n])||Array.isArray(e[n])?t[n]=Ji(e[n]):t[n]=e[n];return t}function dA(e){return!(typeof e!="object"||Array.isArray(e)||!e)}function oj(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}function sj(e){return window.RTCStatsReport?e.getStats()instanceof re:!1}class jm{constructor(t){_(this,"input",[]),_(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const lA={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Mc={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:lA,remoteCandidate:lA}},uA={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},hA={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},pA={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},fA={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};class Fm{constructor(t,n){_(this,"onFirstVideoReceived",void 0),_(this,"onFirstVideoDecoded",void 0),_(this,"onFirstAudioReceived",void 0),_(this,"onFirstVideoDecodedTimeout",void 0),_(this,"onFirstAudioDecoded",void 0),_(this,"onSelectedLocalCandidateChanged",void 0),_(this,"onSelectedRemoteCandidateChanged",void 0),_(this,"videoIsReady",!1),_(this,"videoIsReady2",{}),_(this,"pc",void 0),_(this,"options",void 0),_(this,"intervalTimer",void 0),_(this,"stats",Ji(Mc)),_(this,"isFirstVideoReceived",{}),_(this,"isFirstVideoDecoded",{}),_(this,"isFirstAudioReceived",{}),_(this,"isFirstAudioDecoded",{}),_(this,"isFirstVideoDecodedTimeout",{}),_(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,a=0,c=0,l=0;for(const u of i)t[u].forEach((p,f)=>{if(!this.lossRateWindowStats[n-1][u][f]||!this.lossRateWindowStats[0][u][f])return;const m=this.lossRateWindowStats[n-1][u][f].packets-this.lossRateWindowStats[0][u][f].packets,v=this.lossRateWindowStats[n-1][u][f].packetsLost-this.lossRateWindowStats[0][u][f].packetsLost;u==="videoSend"||u==="audioSend"?(o+=m,c+=v):(a+=m,l+=v),Number.isNaN(m)||Number.isNaN(m)?p.packetLostRate=0:p.packetLostRate=m<=0||v<=0?0:v/(m+v)});t.sendPacketLossRate=o<=0||c<=0?0:c/(o+c),t.recvPacketLossRate=a<=0||l<=0?0:l/(a+l)}}function mA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function aj(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class cj extends Fm{constructor(){super(...arguments),_(this,"_stats",Mc),_(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),n=this.statsResponsesToObjects(t);this._stats=Ji(Mc);const i=n.filter(a=>a.type==="ssrc");this.processSSRCStats(i);const o=n.find(a=>a.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{const i=n.id.includes("send");switch("".concat(n.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const o=Ji(hA);o.codec=n.googCodecName,o.adaptionChangeReason="none",n.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(n.googAvgEncodeMs),o.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.firsCount=Number(n.googFirReceived),o.nacksCount=Number(n.googNacksReceived),o.plisCount=Number(n.googPlisReceived),o.frameCount=Number(n.framesEncoded),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=Ji(uA),a=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(o.codec=n.googCodecName,o.targetDelayMs=Number(n.googTargetDelayMs),o.renderDelayMs=Number(n.googRenderDelayMs),o.currentDelayMs=Number(n.googCurrentDelayMs),o.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),o.decodeMs=Number(n.googDecodeMs),o.maxDecodeMs=Number(n.googMaxDecodeMs),o.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},o.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},o.decodeFrameRate=Number(n.googFrameRateDecoded),o.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},o.jitterBufferMs=Number(n.googJitterBufferMs),o.firsCount=Number(n.googFirsSent),o.nacksCount=Number(n.googNacksSent),o.plisCount=Number(n.googPlisSent),o.framesDecodeCount=Number(n.framesDecoded),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),a){const c=a.stats,l=Date.now()-a.lts;o.framesDecodeFreezeTime=c.framesDecodeFreezeTime,o.framesDecodeInterval=c.framesDecodeInterval,o.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(a.lts=Date.now(),o.framesDecodeInterval=l,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):o.framesDecodeCount<a.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:aj({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=Ji(fA);o.codec=n.googCodecName,o.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,o.decodingCNG=Number(n.googDecodingCNG),o.decodingCTN=Number(n.googDecodingCTN),o.decodingCTSG=Number(n.googDecodingCTSG),o.decodingNormal=Number(n.googDecodingNormal),o.decodingPLC=Number(n.googDecodingPLC),o.decodingPLCCNG=Number(n.googDecodingPLCCNG),o.expandRate=Number(n.googExpandRate),o.accelerateRate=Number(n.googAccelerateRate),o.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),o.speechExpandRate=Number(n.googSpeechExpandRate),o.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),o.jitterBufferMs=Number(n.googJitterBufferMs),o.jitterMs=Number(n.googJitterReceived),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),o.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=Ji(pA);o.codec=n.googCodecName,o.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,o.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new re((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(a=>{o[a]=i.stat(a)}),n.push(o)}),n}}function EA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Uc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?EA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class _A extends Fm{constructor(){super(...arguments),_(this,"_stats",Mc),_(this,"report",void 0),_(this,"lastDecodeVideoReceiverStats",new Map),_(this,"lastVideoFramesRecv",new Map),_(this,"lastVideoFramesSent",new Map),_(this,"lastVideoFramesDecode",new Map),_(this,"lastVideoJBDelay",new Map),_(this,"lastAudioJBDelay",new Map),_(this,"mediaBytesSent",new Map),_(this,"mediaBytesRetransmit",new Map),_(this,"mediaBytesTargetEncode",new Map),_(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ji(Mc),this.report.forEach(t=>{switch(t.type){case Gi.OUTBOUND:t.mediaType==="audio"?this.processAudioOutboundStats(t):t.mediaType==="video"&&this.processVideoOutboundStats(t);break;case Gi.INBOUND:t.mediaType==="audio"?this.processAudioInboundStats(t):t.mediaType==="video"&&this.processVideoInboundStats(t);break;case Gi.TRANSPORT:{const n=this.report.get(t.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case Gi.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===Gi.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===Gi.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===Gi.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Uc({},n),Uc({},this.stats.selectedCandidatePair.localCandidate)),t.type===Gi.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Uc({},n),Uc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(i=>i.ssrc===t.ssrc);n||(n=Ji(fA),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof t.concealedSamples=="number"&&(n.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let n=this._stats.videoRecv.find(c=>c.ssrc===t.ssrc);n||(n=Ji(uA),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),a=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const c=n.decodedFrame?n.decodedFrame.width:0,l=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,c,l),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const c=i.stats,l=a-i.lts;n.framesDecodeFreezeTime=c.framesDecodeFreezeTime,n.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=l,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<c.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(i.stats.framesDecodeCount>t.framesDecoded?n.qpSumPerFrame=t.qpSum/t.framesDecoded:n.qpSumPerFrame=(t.qpSum-i.qpSum)/(t.framesDecoded-i.stats.framesDecodeCount))}o&&a-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((a-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:a,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:a,rate:0}),t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:Uc({},n),lts:i?i.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);n||(n=Ji(hA),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(t.ssrc);if(i)i.add(t.bytesSent);else{const o=new jm(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const a=new jm(10);a.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,a)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const a=new jm(10);a.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,a)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)n.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const a=t.framesEncoded-o.lastFrameCount,c=t.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*c/a}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?n.qpSumPerFrame=t.qpSum/t.framesEncoded:n.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const o=this.findRemoteStatsId(t.ssrc,Gi.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(i=>i.ssrc===t.ssrc);if(n||(n=Ji(pA),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const i=this.findRemoteStatsId(t.ssrc,Gi.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(t,n){var i;const o=Array.from(Or(i=this.report).call(i)).find(a=>a.type===n&&a.ssrc===t);return o?o.id:null}processVideoMediaSource(t,n){const i=this.report.get(t);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(t,n){const i=this.report.get(t);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(t,n,i){var o,a,c;const l=n?this.report.get(n):void 0,u=(o=l==null?void 0:l.framesSent)!==null&&o!==void 0?o:t.framesSent;let p=(a=l==null?void 0:l.frameWidth)!==null&&a!==void 0?a:t.frameWidth,f=(c=l==null?void 0:l.frameHeight)!==null&&c!==void 0?c:t.frameHeight;if(typeof u!="number")return;u!==0||typeof p=="number"&&typeof f=="number"||(p=0,f=0);let m=0;const v=Date.now(),R=this.lastVideoFramesSent.get(i.ssrc);R&&v-R.lts>=800?(m=Math.round((u-R.count)/((v-R.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:v,rate:m})):R?m=R.rate:this.lastVideoFramesSent.set(i.ssrc,{count:u,lts:v,rate:0}),i.sentFrame={width:p,height:f,frameRate:Math.max(0,m)}}processVideoTrackReceiverStats(t,n,i){var o,a,c,l,u;const p=n?this.report.get(n):void 0,f=(o=p==null?void 0:p.framesReceived)!==null&&o!==void 0?o:t.framesReceived,m=(a=p==null?void 0:p.frameWidth)!==null&&a!==void 0?a:t.frameWidth,v=(c=p==null?void 0:p.frameHeight)!==null&&c!==void 0?c:t.frameHeight,R=(l=p==null?void 0:p.jitterBufferDelay)!==null&&l!==void 0?l:t.jitterBufferDelay,w=(u=p==null?void 0:p.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount;if(typeof f=="number"){const A=this.lastVideoFramesRecv.get(i.ssrc),O=Date.now();i.framesReceivedCount=f;let U=0;A&&O-A.lts>=800?(U=Math.round((f-A.count)/((O-A.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:f,lts:O,rate:U})):A?U=A.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:f,lts:O,rate:0}),i.receivedFrame={width:m||0,height:v||0,frameRate:U||0},i.decodedFrame={width:m||0,height:v||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:m||0,height:v||0,frameRate:i.decodeFrameRate||0}}if(R&&w){let A=this.lastVideoJBDelay.get(i.ssrc);this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:w}),A||(A={jitterBufferDelay:0,jitterBufferEmittedCount:0});const O=1e3*(R-A.jitterBufferDelay)/(w-A.jitterBufferEmittedCount);i.jitterBufferMs=O,i.currentDelayMs=Math.round(O)}}processAudioTrackSenderStats(t,n,i){var o,a,c,l;const u=n?this.report.get(n):void 0,p=(o=(a=u==null?void 0:u.echoReturnLoss)!==null&&a!==void 0?a:t.echoReturnLoss)!==null&&o!==void 0?o:0,f=(c=(l=u==null?void 0:u.echoReturnLossEnhancement)!==null&&l!==void 0?l:t.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;i.aecReturnLoss=p,i.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(t,n,i){var o,a,c,l,u,p,f;const m=n?this.report.get(n):void 0,v=(o=m==null?void 0:m.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,R=(a=m==null?void 0:m.totalSamplesReceived)!==null&&a!==void 0?a:t.totalSamplesReceived,w=(c=m==null?void 0:m.jitterBufferDelay)!==null&&c!==void 0?c:t.jitterBufferDelay,A=(l=m==null?void 0:m.jitterBufferEmittedCount)!==null&&l!==void 0?l:t.jitterBufferEmittedCount,O=(u=m==null?void 0:m.audioLevel)!==null&&u!==void 0?u:t==null?void 0:t.audioLevel,U=(p=m==null?void 0:m.totalSamplesDuration)!==null&&p!==void 0?p:t==null?void 0:t.totalSamplesDuration,x=(f=m==null?void 0:m.concealedSamples)!==null&&f!==void 0?f:t.concealedSamples;if(v&&R&&(i.accelerateRate=v/R),w&&A){let pe=this.lastAudioJBDelay.get(i.ssrc);this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:w,jitterBufferEmittedCount:A}),pe||(pe={jitterBufferDelay:0,jitterBufferEmittedCount:0});const Z=1e3*(w-pe.jitterBufferDelay)/(A-pe.jitterBufferEmittedCount);i.jitterBufferMs=Math.round(Z)}i.outputLevel=O;let Q=1920;U&&R&&(Q=R/U/50,i.receivedFrames=Math.round(R/Q)),x&&(i.droppedFrames=Math.round(x/Q))}processRemoteInboundStats(t,n){const i=this.report.get(t);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let t=0,n=null,i=null;this.mediaBytesSent.forEach(a=>{t+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{i=i===null?a.diffMean():i+a.diffMean()});const o=n!==null?t-n:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}}class dj extends Fm{updateStats(){return re.resolve()}}function Bm(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=oj();return a?a<76?new cj(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new _A(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):sj(e)?new _A(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o}):new dj(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:o})}var Qe;function gA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function SA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let xc=(H((Qe=class Zc extends kl{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,n){super(t,n),_(this,"store",void 0),_(this,"peerConnection",void 0),_(this,"remoteSDP",void 0),_(this,"initialOffer",void 0),_(this,"statsFilter",void 0),_(this,"useRTX",!1),_(this,"localCapabilities",void 0),_(this,"localCandidateCount",0),_(this,"allCandidatesReceived",!1),_(this,"establishPromise",void 0),_(this,"mutex",new On("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(Zc.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Bm(this.peerConnection,void 0,void 0,Tt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Rs(t.sdp),i=Mm(t.sdp,!this.useRTX,k("FILTER_VIDEO_FEC"),k("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=i,this.initialOffer=t,SA(SA({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new N(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,i,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new rj({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:c});const l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(t,n){var i=this;return qi(function*(){const o=yield ke(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=t.map(v=>i.peerConnection.addTrack(v._mediaStreamTrack)),c=yield ke(i.peerConnection.createOffer()),l=Pt.exports.parse(c.sdp),u=t.map(v=>{const R=v._mediaStreamTrack,w=l.mediaDescriptions.find(A=>A.attributes.mid===R.kind);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,O,U){const x=A.attributes.ssrcs.filter(pe=>pe.attributes.label===O),Q=A.attributes.ssrcGroups;if(x.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(Q&&x.length>1){const pe=Q.find(Z=>Z.ssrcIds.indexOf(x[0].ssrcId)!==-1);return pe?[{ssrcId:pe.ssrcIds[0],rtx:U?pe.ssrcIds[1]:void 0}]:[{ssrcId:x[0].ssrcId}]}return[{ssrcId:x[0].ssrcId}]}(w,R.id,i.useRTX)});let p;try{p=yield u}catch(v){throw a.forEach(R=>{yn()&&R.replaceTrack(null),i.peerConnection.removeTrack(R)}),v}const f=i.mungSendOfferSDP(c.sdp,t);i.remoteSDP.receive(t,n,p);const m=i.remoteSDP.toString();return yield ke(i.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield ke(i.applySendEncodings(a,t)),yield ke(i.peerConnection.setRemoteDescription({type:"answer",sdp:m})),t.map((v,R)=>{const w=v._mediaStreamTrack.id;return{localSSRC:u[R],id:w}})}catch(a){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{yn()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:a,mslabel:c}=this.remoteSDP.send(t,n,o),l=new re((f,m)=>{const v=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(a)))},1e4),R=w=>{const A=Xe();if((A.name==="Safari"&&Number(A.version)===11||In())&&w.track.id!==a&&w.streams[0].id===c){var O;const U=w.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(t,a,w.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(v),void f(U)}if(w.track.id===a)return this.peerConnection.removeEventListener("track",R),clearTimeout(v),void f(w.track)};this.peerConnection.addEventListener("track",R)}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await l,id:a}}catch(a){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(i=>{var o;return t.indexOf(((o=i.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(i=>{if(yn()&&i.track)i.track.enabled=!1;else{const o=i.getParameters();o.encodings.forEach(a=>a.active=!1),i.setParameters(o)}})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var c;return t.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if(yn()&&a.track)a.track.enabled=!0;else{const c=a.getParameters();c.encodings.forEach(l=>l.active=!0),await a.setParameters(c)}});const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(){var t=this;return qi(function*(){const n=yield ke(t.mutex.lock("From P2PConnection.restartICE"));try{const i=yield ke(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Rs(i.sdp),{remoteIceParameters:a}=yield o.iceParameters;if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");t.remoteSDP.restartICE(a);const c=t.remoteSDP.toString();yield ke(t.peerConnection.setLocalDescription(i)),yield ke(t.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(i){T.warning("restart ICE failed, abort operation",i)}finally{n()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new N(I.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===t});i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===n});i&&await i.replaceTrack(t._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Sc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Zc.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Zc.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Zt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let o=0;o<t.length;o++){var i;const a=t[o],c=n[o];if(!c)continue;const l={},u={};if(c instanceof Dt)switch(c._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;default:l.degradationPreference="balanced"}if(k("DSCP_TYPE")&&cs()){const m=k("DSCP_TYPE");["very-low","low","medium","high"].includes(m)&&(u.networkPriority=m)}const p=a.getParameters(),f=(i=p.encodings)===null||i===void 0?void 0:i[0];f&&Object.assign(f,u),Object.assign(p,l),await a.setParameters(p)}}catch{T.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n){const i=Pt.exports.parse(t);return n.forEach((o,a)=>{const c=o._mediaStreamTrack,l=i.mediaDescriptions.find(u=>u.attributes.mid===c.kind);l&&Ra(l,o)}),Pt.exports.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((a,c)=>{let{id:l,mslabel:u}=a;const{kind:p}=t[c];return new re((f,m)=>{const v=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(l)))},1e4),R=w=>{const A=Xe();if(A.name==="Safari"&&Number(A.version)===11&&w.track.id!==l&&w.streams[0].id===u){var O;const U=w.streams[0].getTracks()[0];return(O=this.remoteSDP)===null||O===void 0||O.updateTrackLabel(p,l,w.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(v),void f({track:U,id:l})}if(w.track.id===l)return this.peerConnection.removeEventListener("track",R),clearTimeout(v),void f({track:w.track,id:l})};this.peerConnection.addEventListener("track",R)})}),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await re.all(n)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Zt().supportPCSetConfiguration){const n=Zc.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"connect"),Qe.prototype),H(Qe.prototype,"stopSending",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"stopSending"),Qe.prototype),H(Qe.prototype,"receive",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"receive"),Qe.prototype),H(Qe.prototype,"stopReceiving",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"stopReceiving"),Qe.prototype),H(Qe.prototype,"muteRemote",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"muteRemote"),Qe.prototype),H(Qe.prototype,"unmuteRemote",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"unmuteRemote"),Qe.prototype),H(Qe.prototype,"muteLocal",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"muteLocal"),Qe.prototype),H(Qe.prototype,"unmuteLocal",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"unmuteLocal"),Qe.prototype),H(Qe.prototype,"close",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"close"),Qe.prototype),H(Qe.prototype,"updateEncoderConfig",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"updateEncoderConfig"),Qe.prototype),H(Qe.prototype,"updateSendParameters",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"updateSendParameters"),Qe.prototype),H(Qe.prototype,"replaceTrack",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"replaceTrack"),Qe.prototype),H(Qe.prototype,"getRemoteSSRC",[Di],Object.getOwnPropertyDescriptor(Qe.prototype,"getRemoteSSRC"),Qe.prototype),Qe);function Di(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}const nu="9",vA=4e4;class lj{get localCapabilities(){return bt(this._localCapabilities)}get rtpCapabilities(){return bt(this._rtpCapabilities)}get candidates(){return bt(this._candidates)}get iceParameters(){return bt(this._iceParameters)}get dtlsParameters(){return bt(this._dtlsParameters)}constructor(t){_(this,"sessionDesc",void 0),_(this,"_localCapabilities",void 0),_(this,"_rtpCapabilities",void 0),_(this,"_candidates",void 0),_(this,"_iceParameters",void 0),_(this,"_dtlsParameters",void 0),_(this,"setup",void 0),_(this,"currentMidIndex",void 0),_(this,"cname",void 0),_(this,"firefoxSsrcMidMap",new Map),t=bt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,cname:u}=t,p=Pt.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=l,this.setup=c,this.cname=u;const f=this.rtpCapabilities.send;for(const m of p.mediaDescriptions){if(m.attributes.iceUfrag=n.iceUfrag,m.attributes.icePwd=n.icePwd,m.attributes.fingerprints=i.fingerprints,m.attributes.candidates=o,m.attributes.setup=c,m.media.mediaType==="video"&&(m.media.fmts=f.videoCodecs.map(v=>v.payloadType.toString(10)),m.attributes.payloads=f.videoCodecs,m.attributes.extmaps=f.videoExtensions,k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:v,ssrcGroups:R}=bi([{ssrcId:vA,rtx:k("USE_RTX")?40001:void 0}],this.cname);m.attributes.ssrcs=v,m.attributes.ssrcGroups=R}if(m.media.mediaType==="audio"&&(m.media.fmts=f.audioCodecs.map(v=>v.payloadType.toString(10)),m.attributes.payloads=f.audioCodecs,m.attributes.extmaps=f.audioExtensions,Ao(m),k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:v,ssrcGroups:R}=bi([{ssrcId:2e4}],this.cname);m.attributes.ssrcs=v,m.attributes.ssrcGroups=R}}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}preloadRemoteMedia(){const t=k("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const n=this.candidates,i=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<t;c++){const l=2*c+2e4,u=2*c+vA,{ssrcs:p,ssrcGroups:f}=bi([{ssrcId:l}],this.cname),{ssrcs:m,ssrcGroups:v}=bi([{ssrcId:u,rtx:k("USE_RTX")?u+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:nu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:nu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Pt.exports.print(this.sessionDesc)}send(t,n,i,o){const{ssrcs:a,ssrcGroups:c}=bi(n,this.cname,k("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(a);if(l){if(Tt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),o&&(o.twcc||o.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,o),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,a);let p;return u===-1||u===1&&(yn()||vT())||TT()?(p=this.createOrRecycleSendMedia(t,a,c,"sendonly",o),this.updateBundleMids()):(p=bt(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,o)),Tt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:c,ssrcMsg:l,mslabel:u}=a;return this.send(c,l,u)}),i=[];let o=!1;return n.forEach(a=>{let{mid:c,needExchangeSDP:l}=a;l&&(o=!0),i.push(c)}),{mids:i,needExchangeSDP:o}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.mid==="0"||Tt()||TT()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,n,i,o){t.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,i,o[c])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(t){t=bt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Tt()){if(o){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(t,n,i,o,a,c){const l=t._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,p=this.localCapabilities.send;let f=[];if(l===we.VIDEO){var m,v;if(k("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(f=u.videoCodecs.filter(U=>{var x,Q;return(((x=U.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes(o)&&(U==null||(Q=U.fmtp)===null||Q===void 0?void 0:Q.parameters["profile-level-id"])===k("H264_PROFILE_LEVEL_ID")})),!f||((m=f)===null||m===void 0?void 0:m.length)===0){const U=p.videoCodecs.filter(x=>{var Q;return(((Q=x.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())||"").includes(o)});U.length!==0&&(f=u.videoCodecs.filter(x=>U.some(Q=>Q.payloadType===x.payloadType)))}if(k("USE_RTX")){const U=f.map(Q=>Q.payloadType.toString()),x=u.videoCodecs.filter(Q=>{var pe,Z;return((pe=Q.rtpMap)===null||pe===void 0?void 0:pe.encodingName)==="rtx"&&U.includes(((Z=Q.fmtp)===null||Z===void 0?void 0:Z.parameters.apt)||"")});f=[...f,...x]}f.length===0&&(T.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat((v=u.videoCodecs[0].rtpMap)===null||v===void 0?void 0:v.encodingName)),f=u.videoCodecs)}else f=u.audioCodecs.filter(U=>{var x;return(((x=U.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes(a)}),f.length===0&&(T.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),f=u.audioCodecs.filter(U=>{var x;return(((x=U.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes("opus")}));const R=l===we.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let A={media:{mediaType:l,port:nu,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};A=this.mungRecvMediaDsec(A,t,c);const O=this.findFirstClosedMedia(l);if(O){const U=this.sessionDesc.mediaDescriptions.indexOf(O);this.sessionDesc.mediaDescriptions[U]=A}else this.sessionDesc.mediaDescriptions.push(A);return A}createOrRecycleSendMedia(t,n,i,o,a){const c=this.rtpCapabilities.send,l=t===we.VIDEO?c.videoCodecs:c.audioCodecs,u=t===we.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let f={media:{mediaType:t,port:nu,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungSendMediaDesc(f,a);const m=this.findFirstClosedMedia(t);if(m){const v=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[v]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,i){const o=bt(t);return Um(o),Ra(o,n),xm(o,n),sA(o),eu(o,i,this.localCapabilities.send),o}mungSendMediaDesc(t,n){const i=bt(t);return eu(i,n,this.localCapabilities.recv),Ao(i),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Tt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var i,o;return((i=n.attributes)===null||i===void 0||(o=i.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var $e;function TA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function RA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?TA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let Vc=(H(($e=class ed extends kl{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n){super(t,n),_(this,"store",void 0),_(this,"peerConnection",void 0),_(this,"remoteSDP",void 0),_(this,"initialOffer",void 0),_(this,"transportEventReceiver",void 0),_(this,"statsFilter",void 0),_(this,"useRTX",k("USE_RTX")),_(this,"localCapabilities",void 0),_(this,"localCandidateCount",0),_(this,"allCandidatesReceived",!1),_(this,"establishPromise",void 0),_(this,"mutex",new On("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(ed.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Bm(this.peerConnection,void 0,void 0,Tt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Rs(t.sdp),i=await cA(!this.useRTX,k("FILTER_VIDEO_FEC"),k("FILTER_AUDIO_FEC"));return this.localCapabilities=Vm(i),this.initialOffer=t,RA(RA({},n),{},{rtpCapabilities:i,offerSDP:t.sdp})}catch(t){throw new N(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,i,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new lj({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:this.localCapabilities,cname:c});const l=this.remoteSDP.toString(),u=Pt.exports.parse(this.initialOffer.sdp),p=u.mediaDescriptions.find(R=>R.media.mediaType==="audio");p&&Ao(p);const f=Pt.exports.print(u),m=this.logSDPExchange(f||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),m==null||m(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l});const v=this.peerConnection.getTransceivers()[0];if(v!=null&&v.receiver&&this.tryBindTransportEvents(v.receiver),k("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const R=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:R});const w=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(w)}}catch(l){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(l.toString()))}}send(t,n,i){var o=this;return qi(function*(){const a=yield ke(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[];t.forEach(A=>{const O=o.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});c.push(O)}),Tt()&&k("SIMULCAST")===!0&&(yield ke(o.applySimulcastForFirefox(c,t)));const l=yield ke(o.peerConnection.createOffer()),u=o.remoteSDP.predictReceivingMids(t.length),p=o.mungSendOfferSDP(l.sdp,t,u),f=Pt.exports.parse(p),m=u.map(A=>{const O=f.mediaDescriptions.find(U=>U.attributes.mid===A);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return rA(O,o.useRTX)});let v;try{v=yield m}catch(A){v=[],o.remoteSDP.receive(t,n,i,v);const O=o.remoteSDP.toString();throw yield ke(o.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ke(o.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield ke(o.stopSending(u,!0)),A}o.remoteSDP.receive(t,n,i,v);const R=o.remoteSDP.toString(),w=o.logSDPExchange(p,"offer","local","send");return yield ke(o.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ke(o.applySimulcastEncodings(c,t)),yield ke(o.applySendEncodings(c,t)),w==null||w(R),yield ke(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),c.map((A,O)=>{const U=u[O];return{localSSRC:m[O],id:U,transceiver:A}})}catch(c){throw c instanceof N?c:new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(u=>{var p;u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,o);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[P2PConnection] receive ".concat(t," by exchanging SDP."))}else T.debug("[P2PConnection] receive ".concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a}}catch(a){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),T.debug("[P2PConnection] batchReceive by exchanging SDP.")}else T.debug("[P2PConnection] batchReceive no need to exchange SDP.");return n.map(o=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o}})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(){var t=this;return qi(function*(){const n=yield ke(t.mutex.lock("From P2PConnection.restartICE"));try{const i=yield ke(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Rs(i.sdp),{remoteIceParameters:a}=yield o.iceParameters;if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");t.remoteSDP.restartICE(a);const c=t.remoteSDP.toString(),l=t.logSDPExchange(i.sdp||"","offer","local","restartICE");yield ke(t.peerConnection.setLocalDescription(i)),l==null||l(c),yield ke(t.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(i){T.warning("restart ICE failed, abort operation",i)}finally{n()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new N(I.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Tt()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Sc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...ed.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...ed.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),k("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Bl(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!k("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){t.transport&&(this.transportEventReceiver=t,t.transport.onstatechange=()=>{var n,i;(n=t.transport)!==null&&n!==void 0&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.transport.state))},t.transport.onerror=n=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,n.error)},t.transport.iceTransport&&(t.transport.iceTransport.onstatechange=()=>{var n;const i=(n=t.transport)===null||n===void 0?void 0:n.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))}))}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(t,n){try{if(!Zt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let p=0;p<t.length;p++){const f=t[p],m=n[p];if(m&&m instanceof Dt){var i,o;if(this.isVP8Simulcast(m))continue;const v={},R={};switch(m._optimizationMode){case"motion":v.degradationPreference="maintain-framerate";break;case"detail":v.degradationPreference="maintain-resolution";break;default:v.degradationPreference="balanced"}var a,c,l,u;if((i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(R.maxBitrate=1e3*((a=m._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),m._hints.includes(Ft.LOW_STREAM)&&((c=m._encoderConfig)!==null&&c!==void 0&&c.frameRate&&(R.maxFramerate=qr(m._encoderConfig.frameRate)),(l=m._encoderConfig)!==null&&l!==void 0&&l.scaleResolutionDownBy&&((u=m._encoderConfig)===null||u===void 0?void 0:u.scaleResolutionDownBy)>1&&(R.scaleResolutionDownBy=m._encoderConfig.scaleResolutionDownBy)),k("DSCP_TYPE")&&cs()){const O=k("DSCP_TYPE");["very-low","low","medium","high"].includes(O)&&(R.networkPriority=O)}const w=f.sender.getParameters(),A=(o=w.encodings)===null||o===void 0?void 0:o[0];Tt()&&!A&&(v.encodings=[R]),A&&Object.assign(A,R),Object.assign(w,v),await f.sender.setParameters(w)}}}catch{T.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,i){const o=Pt.exports.parse(t);return n.forEach((a,c)=>{const l=i[c],u=o.mediaDescriptions.find(p=>p.attributes.mid===l);u&&(Ra(u,a),aA(u,a,this.store.codec))}),Pt.exports.print(o)}mungReceiveAnswerSDP(t,n,i){const o=Pt.exports.parse(t),a=o.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&i===we.AUDIO&&a.media.mediaType==="audio"&&Ao(a),Pt.exports.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var i,o,a,c;const u=t[l],p=n[l];if(p instanceof Dt&&!p._hints.includes(Ft.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=p._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=p._scalabiltyMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=p._scalabiltyMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const v=u.sender.getParameters();await u.sender.setParameters(Object.assign(v,f))}}}async applySimulcastEncodings(t,n){if(!Tt()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof Dt&&this.isVP8Simulcast(o)){const a=t[i],c={},l={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,i,o,a;return!!(t instanceof Dt&&k("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(Ft.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=t._scalabiltyMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabiltyMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(k("SDP_LOGGING"))return T.upload("exchanging ".concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Zt().supportPCSetConfiguration){const n=ed.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"connect"),$e.prototype),H($e.prototype,"receive",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"receive"),$e.prototype),H($e.prototype,"batchReceive",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"batchReceive"),$e.prototype),H($e.prototype,"stopReceiving",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"stopReceiving"),$e.prototype),H($e.prototype,"muteRemote",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"muteRemote"),$e.prototype),H($e.prototype,"unmuteRemote",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"unmuteRemote"),$e.prototype),H($e.prototype,"muteLocal",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"muteLocal"),$e.prototype),H($e.prototype,"unmuteLocal",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"unmuteLocal"),$e.prototype),H($e.prototype,"close",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"close"),$e.prototype),H($e.prototype,"updateEncoderConfig",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"updateEncoderConfig"),$e.prototype),H($e.prototype,"updateSendParameters",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"updateSendParameters"),$e.prototype),H($e.prototype,"replaceTrack",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"replaceTrack"),$e.prototype),H($e.prototype,"getRemoteSSRC",[Pi],Object.getOwnPropertyDescriptor($e.prototype,"getRemoteSSRC"),$e.prototype),$e);function Pi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}function yA(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=qr(t.width),i.height=qr(t.height);const o=qr(t.framerate||15);document.body.append(n),document.body.append(i);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const c=i.getContext("2d");if(!c)throw new N(I.UNEXPECTED_ERROR,"can not get canvas context");const l=Zt(),u=i.captureStream(l.supportRequestFrame?0:o).getVideoTracks()[0],p=QR(()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,v=n.videoHeight/m,R=i.width*v;Math.abs(R-i.height)>=2&&(T.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(R)),i.height=R)}c.drawImage(n,0,0,i.width,i.height),u.requestFrame&&u.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))})(),o),f=u.stop;return u.stop=()=>{f.call(u),p(),n&&(n.remove(),n=null),i&&(i.width=0,i.remove(),i=null),T.debug("clean low stream renderer")},u}var IA,CA,AA,wA,ki,OA,NA,bA,DA,PA,kA,vn;function LA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function iu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class MA extends YR{getUserId(){return this._userId}constructor(t,n,i,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(ht(5,""))),_(this,"_userId",void 0),_(this,"_uintId",void 0),_(this,"_isDestroyed",!1),_(this,"store",void 0),_(this,"processor",void 0),_(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let ru=(IA=_e({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),CA=_e({argsMap:e=>[e.getTrackId()]}),AA=_e({argsMap:(e,t)=>[e.getTrackId(),t.name]}),wA=_e({argsMap:e=>[e.getTrackId()]}),H((ki=class extends MA{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==dn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i){super(e,t,n,i),_(this,"_videoVisibleTimer",null),_(this,"_previousVideoVisibleStatus",void 0),_(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_(this,"trackMediaType","video"),_(this,"_videoWidth",void 0),_(this,"_videoHeight",void 0),_(this,"_player",void 0),_(this,"processorDestination",void 0),_(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new cy(this.getTrackId(),"remote"),this.processorDestination=new ay(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Rc(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),br(this,Se.GET_STATS)||iu({},AR)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=iu(iu({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new Em(n):this._player=new BI(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.emit(la.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.emit(la.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},k("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){iI(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Wl)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:a}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&a instanceof HTMLElement){const c=TC.checkOneElementVisible(o),l=Object.assign({},c);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;const u=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new N(I.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new N(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(hn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(hn.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[IA],Object.getOwnPropertyDescriptor(ki.prototype,"play"),ki.prototype),H(ki.prototype,"stop",[CA],Object.getOwnPropertyDescriptor(ki.prototype,"stop"),ki.prototype),H(ki.prototype,"pipe",[AA],Object.getOwnPropertyDescriptor(ki.prototype,"pipe"),ki.prototype),H(ki.prototype,"unpipe",[wA],Object.getOwnPropertyDescriptor(ki.prototype,"unpipe"),ki.prototype),ki),ou=(OA=_e({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),NA=_e({argsMap:(e,t)=>[e.getTrackId(),t]}),bA=_e({argsMap:e=>[e.getTrackId()]}),DA=_e({argsMap:e=>[e.getTrackId()]}),PA=_e({argsMap:(e,t)=>[e.getTrackId(),t.name]}),kA=_e({argsMap:e=>[e.getTrackId()]}),H((vn=class extends MA{get isPlaying(){return this._useAudioElement?ei.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),_(this,"trackMediaType","audio"),_(this,"_source",void 0),_(this,"_useAudioElement",!0),_(this,"_volume",100),_(this,"processorContext",void 0),_(this,"processorDestination",void 0),_(this,"_played",!1),_(this,"_bypassWebAudio",!1),k("DISABLE_WEBAUDIO")?(this._source=new tm,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new $f(e,!0),k("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Wn.RECEIVE_TRACK_BUFFER,()=>{this.emit(la.FIRST_FRAME_DECODED)}),this.processorContext=new ly(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new dy(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Wn.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Wn.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Wn.ON_AUDIO_BUFFER),this._source.on(Wn.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?ei.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement)throw new N(I.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ei.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Rc(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),br(this,Se.GET_STATS)||iu({},CR)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),ei.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ei.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ei.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new N(I.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new N(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new N(I.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(hn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(hn.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(hn.ON_TRACK),this.processorDestination.removeAllListeners(hn.ON_NODE)}}).prototype,"setVolume",[OA],Object.getOwnPropertyDescriptor(vn.prototype,"setVolume"),vn.prototype),H(vn.prototype,"setPlaybackDevice",[NA],Object.getOwnPropertyDescriptor(vn.prototype,"setPlaybackDevice"),vn.prototype),H(vn.prototype,"play",[bA],Object.getOwnPropertyDescriptor(vn.prototype,"play"),vn.prototype),H(vn.prototype,"stop",[DA],Object.getOwnPropertyDescriptor(vn.prototype,"stop"),vn.prototype),H(vn.prototype,"pipe",[PA],Object.getOwnPropertyDescriptor(vn.prototype,"pipe"),vn.prototype),H(vn.prototype,"unpipe",[kA],Object.getOwnPropertyDescriptor(vn.prototype,"unpipe"),vn.prototype),vn);function UA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function xA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?UA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class uj extends Rt{constructor(){super(),_(this,"uplinkStatsUploadInterval",void 0),_(this,"uplinkStatsUploadSlowInterval",void 0),_(this,"uplinkRelatedStatsUploadInterval",void 0),_(this,"uplinkDenoiserStatsUploadInterval",void 0),_(this,"transportStatsUploadInterval",void 0),_(this,"uplinkExtensionStatsUploadInterval",void 0),_(this,"downlinkExtensionStatsUploadInterval",void 0),_(this,"extensionUsageStatsUploadInterval",void 0),_(this,"downlinkStatsUploadInterval",void 0),_(this,"downlinkStatsUploadSlowInterval",void 0),_(this,"downlinkRelatedStatsUploadInterval",void 0),_(this,"lastStats",void 0),_(this,"uploadUnplinkStarted",!1),_(this,"uploadDownlinkStarted",!1),_(this,"uploadTransportStarted",!1),_(this,"uploadExtensionUsageStarted",!1),_(this,"requestStats",void 0),_(this,"requestLocalMedia",void 0),_(this,"requestRemoteMedia",void 0),_(this,"requestAllTracks",void 0),_(this,"requestVideoIsReady",void 0),_(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadTransportStats(n)},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var n,i,o;const a=Date.now(),c={connectionInterval:k("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let l=[];const u=((n=this.requestAllTracks)===null||n===void 0?void 0:n.call(this))||[];for(const v of u)!v.muted&&v.enabled&&(l=l.concat(await v.getProcessorUsage()));const p=((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[];for(const[v,R]of p)R.has(we.VIDEO)&&v.videoTrack&&(l=l.concat(await v.videoTrack.getProcessorUsage())),R.has(we.AUDIO)&&v.audioTrack&&(l=l.concat(await v.audioTrack.getProcessorUsage()));if(l.length===0)return;c.details=function(v,R){const w={};for(const{id:x,value:Q,level:pe,direction:Z}of v){var A;const ee=(A=R.get(x))!==null&&A!==void 0?A:0,J=Q===2?ee+k("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ee;var O,U;R.set(x,J),w[x]?(Q===2&&(w[x].value=Q),pe>w[x].level&&(w[x].level=pe),Z==="remote"&&(w[x].remoteUidCount+=1),w[x].totalTs=(O=R.get(x))!==null&&O!==void 0?O:0):w[x]={value:Q,level:pe,remoteUidCount:Z==="local"?0:1,totalTs:(U=R.get(x))!==null&&U!==void 0?U:0}}return Object.keys(w).map(x=>{const{level:Q,value:pe,totalTs:Z}=w[x];return{id:x,level:Q,value:pe,totalTs:Z}})}(l,t);const f=Date.now(),m=f>a?f:a+1;(o=this.requestUpload)===null||o===void 0||o.call(this,Gn.EXTENSION_USAGE_STATS,{usageStats:c,sendTs:m})},k("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&(this.uploadUplinkStats(n),this.lastStats=n)},3e3),this.uplinkStatsUploadSlowInterval&&window.clearInterval(this.uplinkStatsUploadSlowInterval),this.uplinkStatsUploadSlowInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadSlowUplinkStats(n)},6e4),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadRelatedUplinkStats(n,this.lastStats),this.lastStats=n},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadDenoiserStats(n)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadExtensionStats(n)},2e3))}uploadTransportStats(t){Yi(()=>{var n;(n=this.requestUpload)===null||n===void 0||n.call(this,Gn.TRANSPORT_STATS,function(i){const o={connectionType:100,googRtt:i.rtt};if(i.selectedCandidatePair.localCandidate.candidateType==="relay"){const a=i.selectedCandidatePair.localCandidate.relayProtocol;a==="udp"&&(o.connectionType=101),a==="tcp"&&(o.connectionType=103),a==="tls"&&(o.connectionType=104)}return o}(t))})}uploadUplinkStats(t){var n;(((n=this.requestLocalMedia)===null||n===void 0?void 0:n.call(this))||[]).forEach(i=>{let[o,{track:a,ssrcs:c}]=i;switch(o){case oe.LocalVideoLowTrack:case oe.LocalVideoTrack:{const l=function(f,m,v){var R;const w=m.videoSend.find(O=>O.ssrc===f);if(!w)return null;const A={id:ht(10,""),timestamp:new Date(m.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:w.ssrc.toString()};switch(A.A_vstd=v._originMediaStreamTrack&&!v._originMediaStreamTrack.enabled||v._mediaStreamTrack&&!v._mediaStreamTrack.enabled?"1":"0",w.sentFrame&&(A.A_fhs=w.sentFrame.height.toString(),A.A_frs=w.sentFrame.frameRate.toString(),A.A_fws=w.sentFrame.width.toString()),w.adaptionChangeReason){case"none":A.A_ac="0";break;case"cpu":A.A_ac="1";break;case"bandwidth":A.A_ac="2";break;case"other":A.A_ac="3"}return A.A_lvps=kf[v._player?v._player.videoElementStatus:"uninit"].toString(),A.A_nr=(R=w.nacksCount)===null||R===void 0?void 0:R.toString(),w.avgEncodeMs&&(A.A_aem=w.avgEncodeMs.toFixed(0).toString()),A}(c[0].ssrcId,t,a),u=o===oe.LocalVideoTrack?eI(c[0].ssrcId,t,a):null;l&&Yi(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,Gn.PUBLISH_STATS,{stream_type:o===oe.LocalVideoLowTrack?"low":"high",stats:xA(xA({},l),u)})});const p=function(f){const m={id:"bweforvideo",timestamp:new Date(f.timestamp).toISOString(),type:"VideoBwe"};return f.bitrate.retransmit&&(m.A_rb=f.bitrate.retransmit.toString()),f.bitrate.targetEncoded&&(m.A_teb=f.bitrate.targetEncoded.toString()),m.A_aeb=f.bitrate.actualEncoded.toString(),m.A_tb=f.bitrate.transmit.toString(),f.sendBandwidth!==void 0&&(m.A_asb=f.sendBandwidth.toString()),m}(t);p&&setTimeout(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,Gn.PUBLISH_STATS,{stream_type:o===oe.LocalVideoLowTrack?"low":"high",stats:p})},1e3);break}case oe.LocalAudioTrack:{const l=function(u,p,f){const m=p.audioSend.find(R=>R.ssrc===u);if(!m)return null;const v={id:ht(10,""),timestamp:new Date(p.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:m.ssrc.toString()};return v.A_astd=f._originMediaStreamTrack.enabled&&f._mediaStreamTrack.enabled?"0":"1",m.inputLevel?v.A_ail=Math.round(100*m.inputLevel).toString():v.A_ail=Math.round(100*f._source.getAccurateVolumeLevel()).toString(),v.A_apil=Math.round(100*f._source.getAccurateVolumeLevel()).toString(),m.aecReturnLoss&&(v.A_ecrl=Math.round(m.aecReturnLoss).toString()),m.aecReturnLossEnhancement&&(v.A_ecrle=Math.round(m.aecReturnLossEnhancement).toString()),v}(c[0].ssrcId,t,a);l&&Yi(()=>{var u;return(u=this.requestUpload)===null||u===void 0?void 0:u.call(this,Gn.PUBLISH_STATS,{stream_type:"high",stats:l})});break}}})}uploadSlowUplinkStats(t){var n;(((n=this.requestLocalMedia)===null||n===void 0?void 0:n.call(this))||[]).filter(i=>{let[o]=i;return o===oe.LocalVideoLowTrack||o===oe.LocalVideoTrack}).forEach(i=>{let[o,{ssrcs:a}]=i;const c=eI(a[0].ssrcId,t);c&&Yi(()=>{var l;return(l=this.requestUpload)===null||l===void 0?void 0:l.call(this,Gn.PUBLISH_STATS,{stream_type:o===oe.LocalVideoLowTrack?"low":"high",stats:c})})})}uploadRelatedUplinkStats(t,n){var i;(((i=this.requestLocalMedia)===null||i===void 0?void 0:i.call(this))||[]).filter(o=>{let[a]=o;return a===oe.LocalVideoLowTrack||a===oe.LocalVideoTrack}).forEach(o=>{let[a,{ssrcs:c}]=o;const l=function(u,p){const f=p.videoSend.find(m=>m.ssrc===u);return f?{mediaType:"video",isVideoMute:!1,frameRateInput:f.inputFrame&&f.inputFrame.frameRate.toString(),frameRateSent:f.sentFrame&&f.sentFrame.frameRate.toString(),googRtt:f.rttMs.toString(),qpSumPerFrame:Math.floor(f.qpSumPerFrame).toString()}:null}(c[0].ssrcId,t);l&&Yi(()=>{var u;(u=this.requestUpload)===null||u===void 0||u.call(this,Gn.PUBLISH_RELATED_STATS,{stream_type:a===oe.LocalVideoLowTrack?"low":"high",stats:l})})})}uploadDenoiserStats(t){for(let a=0;a<t.length;a++){const c=t[a];if(c instanceof jl){var n,i,o;const l=(n=(i=c._external).getDenoiserStats)===null||n===void 0?void 0:n.call(i);return void(l&&((o=this.requestUpload)===null||o===void 0||o.call(this,Gn.DENOISER_STATS,l)))}}}uploadExtensionStats(t){for(let n=0;n<t.length;n++)t[n].getProcessorStats().forEach(i=>{var o;(o=this.requestUpload)===null||o===void 0||o.call(this,i.type,i.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let n=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);o&&(this.uploadDownlinkStats(o,n,t),t=o),n=!n},3e3),this.downlinkStatsUploadSlowInterval&&window.clearInterval(this.downlinkStatsUploadSlowInterval),this.downlinkStatsUploadSlowInterval=window.setInterval(()=>{var i;const o=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);o&&this.uploadSlowDownlinkStats(o)},6e4),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);o&&(this.uploadRelatedDownlinkStats(o,this.lastStats),this.lastStats=o)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this);o&&this.uploadDownlinkExtensionStats(o)},2e3)}uploadDownlinkStats(t,n,i){var o;(((o=this.requestRemoteMedia)===null||o===void 0?void 0:o.call(this))||[]).forEach(a=>{let[c,l]=a;if(l.has(we.VIDEO)&&c.videoTrack){const u=c.videoTrack?function(p,f,m,v,R){const w=f.videoRecv.find(x=>x.ssrc===p);if(!w)return null;const A={id:ht(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:w.ssrc.toString()};var O,U;if(A.bytesReceived=w.bytes.toString(),A.packetsLost=w.packetsLost.toString(),A.packetsReceived=w.packets.toString(),w.framesRateFirefox&&(A.A_frr=w.framesRateFirefox.toString()),w.receivedFrame?(A.A_frr=w.receivedFrame.frameRate.toString(),A.A_fhr=w.receivedFrame.height.toString(),A.A_fwr=w.receivedFrame.width.toString()):(A.A_fhr=(O=v._videoHeight)===null||O===void 0?void 0:O.toString(),A.A_fwr=(U=v._videoWidth)===null||U===void 0?void 0:U.toString()),A.A_frd=w.decodeFrameRate.toString(),w.outputFrame&&(A.A_fro=w.outputFrame.frameRate.toString()),w.jitterBufferMs!==void 0&&(A.A_jbm=Math.floor(w.jitterBufferMs).toString()),w.currentDelayMs!==void 0&&(A.A_cdm=Math.floor(w.currentDelayMs).toString()),A.A_fs=w.firsCount.toString(),A.A_ns=w.nacksCount.toString(),A.A_ps=w.plisCount.toString(),v&&(A.A_vrtd=v._originMediaStreamTrack.enabled&&v._mediaStreamTrack.enabled?"0":"1"),v._player&&v._player.freezeTimeCounterList.length>0&&(A.A_vrft=Math.round(v._player.freezeTimeCounterList.splice(0,1)[0]).toString()),R&&v._player&&Yr.visibility==="visible"){const x=Math.min(6e3,v._player.renderFreezeAccTime);A.A_vrrft=Math.round(x).toString(),v._player.renderFreezeAccTime=Math.max(0,v._player.renderFreezeAccTime-x)}if(A.A_rvps=kf[v._player?v._player.videoElementStatus:"uninit"].toString(),m){const x=m.videoRecv.find(Q=>Q.ssrc===p);if(x&&w.totalInterFrameDelay!==void 0&&w.totalSquaredInterFrameDelay!==void 0&&x.totalInterFrameDelay!==void 0&&x.totalSquaredInterFrameDelay!==void 0){const Q=w.totalInterFrameDelay-x.totalInterFrameDelay,pe=w.totalSquaredInterFrameDelay-x.totalSquaredInterFrameDelay,Z=w.framesDecodeCount-x.framesDecodeCount,ee=Q/Z*1e3,J=Math.round(1e3*Math.sqrt((pe-Math.pow(Q,2)/Z)/Z));!isNaN(J)&&ee+J>Math.max(3*ee,ee+150)&&(A.A_ifdsd=J.toString())}}return A}(c._videoSSRC,t,i,c.videoTrack,n):void 0;u&&Yi(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,Gn.SUBSCRIBE_STATS,{stream_id:c.uid,stats:u})})}if(l.has(we.AUDIO)&&c.audioTrack){const u=c.audioTrack?function(p,f,m,v){const R=f.audioRecv.find(A=>A.ssrc===p);if(!R)return null;const w={id:ht(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:R.ssrc.toString()};if(w.bytesReceived=R.bytes.toString(),w.packetsLost=R.packetsLost.toString(),w.packetsReceived=R.packets.toString(),R.outputLevel?w.A_aol=Math.round(100*R.outputLevel).toString():w.A_aol=Math.round(100*v._source.getAccurateVolumeLevel()).toString(),w.A_apol=Math.round(100*v._source.getAccurateVolumeLevel()).toString(),v&&(w.A_artd=v._originMediaStreamTrack.enabled&&v._mediaStreamTrack.enabled?"0":"1"),w.A_jr=R.jitterMs.toString(),w.A_jbm=Math.floor(R.jitterBufferMs).toString(),w.A_cdm=Math.floor(R.jitterBufferMs).toString(),w.A_raps=kf[ei.getPlayerState(v.getTrackId())].toString(),m){const A=m.audioRecv.find(O=>O.ssrc===p);if(A){const O=R.concealedSamples-A.concealedSamples;O>0&&(w.A_cs=Math.round(O).toString())}}return w}(c._audioSSRC,t,i,c.audioTrack):void 0;u&&Yi(()=>{var p;return(p=this.requestUpload)===null||p===void 0?void 0:p.call(this,Gn.SUBSCRIBE_STATS,{stream_id:c.uid,stats:u})})}})}uploadSlowDownlinkStats(t){}uploadRelatedDownlinkStats(t,n){var i;(((i=this.requestRemoteMedia)===null||i===void 0?void 0:i.call(this))||[]).forEach(o=>{let[a,c]=o;if(c.has(we.VIDEO)&&a.videoTrack){var l;const u=(a._videoSSRC&&((l=this.requestVideoIsReady)===null||l===void 0?void 0:l.call(this,a._videoSSRC))||!1)===!0,p=function(f,m,v,R,w,A){const O=v.videoRecv.find(pe=>pe.ssrc===f),U=w?w.videoRecv.find(pe=>pe.ssrc===f):void 0;if(!O)return null;const x=ma.isRemoteVideoFreeze(A,O,U)&&m,Q={mediaType:"video",isVideoMute:!1,peerId:R,frameRateReceived:O.receivedFrame&&O.receivedFrame.frameRate.toString(),frameRateDecoded:O.decodedFrame&&O.decodedFrame.frameRate.toString(),isFreeze:x,bytesReceived:O.bytes.toString(),packetsReceived:O.packets.toString(),packetsLost:O.packetsLost.toString(),qpSumPerFrame:Math.floor(O.qpSumPerFrame).toString()};return O.framesRateFirefox&&(Q.frameRateDecoded=O.framesRateFirefox.toString(),Q.frameRateReceived=O.framesRateFirefox.toString()),Q}(a._videoSSRC,u,t,a.uid,n,a.videoTrack);p&&Yi(()=>{var f;(f=this.requestUpload)===null||f===void 0||f.call(this,Gn.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:p})})}if(c.has(we.AUDIO)&&a.audioTrack){const u=function(p,f,m,v){const R=f.audioRecv.find(A=>A.ssrc===p);if(!R)return null;const w=ma.isRemoteAudioFreeze(v);return{mediaType:"audio",isAudioMute:!1,peerId:m,googJitterReceived:R.jitterMs.toString(),isFreeze:w,bytesReceived:R.bytes.toString(),packetsReceived:R.packets.toString(),packetsLost:R.packetsLost.toString(),frameReceived:R.receivedFrames.toString(),frameDropped:R.droppedFrames.toString()}}(a._audioSSRC,t,a.uid,a.audioTrack);u&&Yi(()=>{var p;(p=this.requestUpload)===null||p===void 0||p.call(this,Gn.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:u})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach(n=>{let[i,o]=n;o.has(we.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(a=>{var c;(c=this.requestUpload)===null||c===void 0||c.call(this,a.type,a.stats)}),o.has(we.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(a=>{var c;(c=this.requestUpload)===null||c===void 0||c.call(this,a.type,a.stats)})})}}const VA=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,su="9",Gm=2e4,Wm=4e4;class hj{get localCapabilities(){return bt(this._localCapabilities)}get rtpCapabilities(){return bt(this._rtpCapabilities)}get candidates(){return bt(this._candidates)}get iceParameters(){return bt(this._iceParameters)}get dtlsParameters(){return bt(this._dtlsParameters)}constructor(t){_(this,"sessionDesc",void 0),_(this,"_localCapabilities",void 0),_(this,"_rtpCapabilities",void 0),_(this,"_candidates",void 0),_(this,"_iceParameters",void 0),_(this,"_dtlsParameters",void 0),_(this,"setup",void 0),_(this,"currentMidIndex",void 0),_(this,"cname",void 0),_(this,"firefoxSsrcMidMap",new Map),t=bt(t);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:c,localCapabilities:l,cname:u}=t,p=Pt.exports.parse(VA);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=l,this.setup=c,this.cname=u;const f=this.rtpCapabilities.send;for(const m of p.mediaDescriptions){if(m.attributes.iceUfrag=n.iceUfrag,m.attributes.icePwd=n.icePwd,m.attributes.fingerprints=i.fingerprints,m.attributes.candidates=o,m.attributes.setup=c,m.media.mediaType==="application"&&(m.attributes.sctpPort="5000"),m.media.mediaType==="video"&&(m.media.fmts=f.videoCodecs.map(v=>v.payloadType.toString(10)),m.attributes.payloads=f.videoCodecs,m.attributes.extmaps=f.videoExtensions,k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:v,ssrcGroups:R}=bi([{ssrcId:Wm,rtx:k("USE_RTX")?40001:void 0}],this.cname);m.attributes.ssrcs=v,m.attributes.ssrcGroups=R}if(m.media.mediaType==="audio"&&(m.media.fmts=f.audioCodecs.map(v=>v.payloadType.toString(10)),m.attributes.payloads=f.audioCodecs,m.attributes.extmaps=f.audioExtensions,Ao(m),k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:v,ssrcGroups:R}=bi([{ssrcId:Gm}],this.cname);m.attributes.ssrcs=v,m.attributes.ssrcGroups=R}}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const n=Pt.exports.parse(VA);this._rtpCapabilities=t;const i=this.rtpCapabilities.send;for(const o of n.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"&&(o.media.fmts=i.videoCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=i.videoCodecs,o.attributes.extmaps=i.videoExtensions,k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=bi([{ssrcId:Wm,rtx:k("USE_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=c}if(o.media.mediaType==="audio"&&(o.media.fmts=i.audioCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=i.audioCodecs,o.attributes.extmaps=i.audioExtensions,k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:c}=bi([{ssrcId:Gm}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=c}}this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const n=this.candidates,i=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let c=1;c<t;c++){const l=2*c+Gm,u=2*c+Wm,{ssrcs:p,ssrcGroups:f}=bi([{ssrcId:l}],this.cname),{ssrcs:m,ssrcGroups:v}=bi([{ssrcId:u,rtx:k("USE_RTX")?u+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:su,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:su,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:i.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*c)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Pt.exports.print(this.sessionDesc)}send(t,n,i,o){const{ssrcs:a,ssrcGroups:c}=bi(n,this.cname,k("SYNC_GROUP")?i:void 0),l=this.findPreloadMediaDesc(a);if(l){if(Tt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,l.attributes.mid),o&&(o.twcc||o.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(l,o),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(t,a);let p;return u===-1||yn()||In()||vT()?(p=this.createOrRecycleSendMedia(t,a,c,"sendonly",o),this.updateBundleMids()):(p=bt(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=a,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,o)),Tt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,p.attributes.mid),{mid:p.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:c,ssrcMsg:l,mslabel:u}=a;return this.send(c,l,u)}),i=[];let o=!1;return n.forEach(a=>{let{mid:c,needExchangeSDP:l}=a;l&&(o=!0),i.push(c)}),{mids:i,needExchangeSDP:o}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.mid==="0"||Tt()||yn()||In()?i.attributes.ssrcs=[]:(i.attributes.ssrcs=[],i.attributes.direction="inactive",i.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.includes(i.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}receive(t,n,i,o){t.forEach((a,c)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,i,o[c])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(i=>t.indexOf(i.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(t){t=bt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(i=>{const o=i.media.mediaType===t&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(Tt()){if(o){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!a||a!==i.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(t,n,i,o,a,c){const l=t._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,p=this.localCapabilities.send;let f=[];if(l===we.VIDEO){var m,v;if(k("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(f=u.videoCodecs.filter(U=>{var x,Q;return(((x=U.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes(o)&&(U==null||(Q=U.fmtp)===null||Q===void 0?void 0:Q.parameters["profile-level-id"])===k("H264_PROFILE_LEVEL_ID")})),!f||((m=f)===null||m===void 0?void 0:m.length)===0){const U=p.videoCodecs.filter(x=>{var Q;return(((Q=x.rtpMap)===null||Q===void 0?void 0:Q.encodingName.toLowerCase())||"").includes(o)});U.length!==0&&(f=u.videoCodecs.filter(x=>U.some(Q=>Q.payloadType===x.payloadType)))}if(k("USE_RTX")){const U=f.map(Q=>Q.payloadType.toString()),x=u.videoCodecs.filter(Q=>{var pe,Z;return((pe=Q.rtpMap)===null||pe===void 0?void 0:pe.encodingName)==="rtx"&&U.includes(((Z=Q.fmtp)===null||Z===void 0?void 0:Z.parameters.apt)||"")});f=[...f,...x]}f.length===0&&(T.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat((v=u.videoCodecs[0].rtpMap)===null||v===void 0?void 0:v.encodingName)),f=u.videoCodecs)}else f=u.audioCodecs.filter(U=>{var x;return(((x=U.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes(a)}),f.length===0&&(T.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),f=u.audioCodecs.filter(U=>{var x;return(((x=U.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"").includes("opus")}));const R=l===we.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let A={media:{mediaType:l,port:su,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};A=this.mungRecvMediaDsec(A,t,c);const O=this.findFirstClosedMedia(l);if(O){const U=this.sessionDesc.mediaDescriptions.indexOf(O);this.sessionDesc.mediaDescriptions[U]=A}else this.sessionDesc.mediaDescriptions.push(A);return A}createOrRecycleSendMedia(t,n,i,o,a){const c=this.rtpCapabilities.send,l=t===we.VIDEO?c.videoCodecs:c.audioCodecs,u=t===we.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const p="".concat(this.currentMidIndex);let f={media:{mediaType:t,port:su,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};f=this.mungSendMediaDesc(f,a);const m=this.findFirstClosedMedia(t);if(m){const v=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[v]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,i){const o=bt(t);return Um(o),Ra(o,n),xm(o,n),sA(o),eu(o,i,this.localCapabilities.send),o}mungSendMediaDesc(t,n){const i=bt(t);return eu(i,n,this.localCapabilities.recv),Ao(i),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Tt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var i,o;return((i=n.attributes)===null||i===void 0||(o=i.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(i=>i.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var Ye;function jA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function au(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let pj=(H((Ye=class Bu extends kl{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n,i){super(t,n),_(this,"store",void 0),_(this,"peerConnection",void 0),_(this,"remoteSDP",void 0),_(this,"initialOffer",void 0),_(this,"transportEventReceiver",void 0),_(this,"statsFilter",void 0),_(this,"useRTX",k("USE_RTX")),_(this,"localCapabilities",void 0),_(this,"localCandidateCount",0),_(this,"allCandidatesReceived",!1),_(this,"establishPromise",void 0),_(this,"mutex",new On("NVExtentionsConnection-mutex")),_(this,"rtcMedia",void 0),this.store=n,this.peerConnection=i,this.statsFilter=Bm(this.peerConnection,void 0,void 0,Tt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Rs(n.sdp),o=await cA(!this.useRTX,k("FILTER_VIDEO_FEC"),k("FILTER_AUDIO_FEC"));return this.localCapabilities=o,this.initialOffer=n,au(au({},i),{},{rtpCapabilities:o,offerSDP:n.sdp})}catch(n){throw new N(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t,n,i,o,a,c){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new hj({remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:Vm(this.localCapabilities),cname:c});const l=this.remoteSDP.toString(),u=Pt.exports.parse(this.initialOffer.sdp),p=u.mediaDescriptions.find(v=>v.media.mediaType==="audio");p&&Ao(p);const f=Pt.exports.print(u),m=this.logSDPExchange(f||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),m==null||m(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(l){throw new N(I.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(l.toString()))}}async updateRemoteConnect(t){var n,i,o;(n=this.remoteSDP)===null||n===void 0||n.updateRemoteRTPCapabilities(t),(i=this.remoteSDP)===null||i===void 0||i.preloadRemoteMedia(2);const a=(o=this.remoteSDP)===null||o===void 0?void 0:o.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),T.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,n,i){var o=this;return qi(function*(){const a=yield ke(o.mutex.lock("From NVExtentionsConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const c=[];t.forEach(A=>{const O=o.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});c.push(O)}),Tt()&&k("SIMULCAST")===!0&&(yield ke(o.applySimulcastForFirefox(c,t)));const l=yield ke(o.peerConnection.createOffer()),u=o.remoteSDP.predictReceivingMids(t.length),p=o.mungSendOfferSDP(l.sdp,t,u),f=Pt.exports.parse(p),m=u.map(A=>{const O=f.mediaDescriptions.find(U=>U.attributes.mid===A);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return rA(O,o.useRTX)});let v;try{v=yield m}catch(A){v=[],o.remoteSDP.receive(t,n,i,v);const O=o.remoteSDP.toString();throw yield ke(o.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ke(o.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield ke(o.stopSending(u,!0)),A}o.remoteSDP.receive(t,n,i,v);const R=o.remoteSDP.toString(),w=o.logSDPExchange(p,"offer","local","send");return yield ke(o.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield ke(o.applySimulcastEncodings(c,t)),yield ke(o.applySendEncodings(c,t)),w==null||w(R),yield ke(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),c.map((A,O)=>{const U=u[O];return{localSSRC:m[O],id:U,transceiver:A}})}catch(c){throw c instanceof N?c:new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(c.toString()))}finally{a()}})()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(u=>t.indexOf(u.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");o.map(u=>{var p;u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const l=this.remoteSDP.toString();c==null||c(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(o.toString()))}finally{i&&i()}}async receive(t,n,i,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,o);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const f=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,a,t);p==null||p(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else T.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a}}catch(a){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);if(i){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c),T.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else T.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return n.map(o=>{const a=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o}})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();i==null||i(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(c=>{c.direction="inactive"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(c=>c.mid&&t.indexOf(c.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(c,l)=>{c.direction="sendonly"});const i=await this.peerConnection.createOffer(),o=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new N(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(){var t=this;return qi(function*(){const n=yield ke(t.mutex.lock("From NVExtentionsConnection.restartICE"));try{const i=yield ke(t.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Rs(i.sdp),{remoteIceParameters:a}=yield o.iceParameters;if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");t.remoteSDP.restartICE(a);const c=t.remoteSDP.toString(),l=t.logSDPExchange(i.sdp||"","offer","local","restartICE");yield ke(t.peerConnection.setLocalDescription(i)),l==null||l(c),yield ke(t.peerConnection.setRemoteDescription({type:"answer",sdp:c}))}catch(i){T.warning("restart ICE failed, abort operation",i)}finally{n()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),c=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c==null||c(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new N(I.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter(o=>o.mid===t);i.length===1&&(this.isVP8Simulcast(n)?Tt()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find(o=>o.mid===n);i&&await i.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return au(au({},Rs(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Sc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Bu.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Bu.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),k("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Bl(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!k("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!Zt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let p=0;p<t.length;p++){const f=t[p],m=n[p];if(m&&m instanceof Dt){var i,o;if(this.isVP8Simulcast(m))continue;const v={},R={};switch(m._optimizationMode){case"motion":v.degradationPreference="maintain-framerate";break;case"detail":v.degradationPreference="maintain-resolution";break;default:v.degradationPreference="balanced"}var a,c,l,u;if((i=m._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&(R.maxBitrate=1e3*((a=m._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),m._hints.includes(Ft.LOW_STREAM)&&((c=m._encoderConfig)!==null&&c!==void 0&&c.frameRate&&(R.maxFramerate=qr(m._encoderConfig.frameRate)),(l=m._encoderConfig)!==null&&l!==void 0&&l.scaleResolutionDownBy&&((u=m._encoderConfig)===null||u===void 0?void 0:u.scaleResolutionDownBy)>1&&(R.scaleResolutionDownBy=m._encoderConfig.scaleResolutionDownBy)),k("DSCP_TYPE")&&cs()){const O=k("DSCP_TYPE");["very-low","low","medium","high"].includes(O)&&(R.networkPriority=O)}const w=f.sender.getParameters(),A=(o=w.encodings)===null||o===void 0?void 0:o[0];Tt()&&!A&&(v.encodings=[R]),A&&Object.assign(A,R),Object.assign(w,v),await f.sender.setParameters(w)}}}catch{T.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,i){const o=Pt.exports.parse(t);return n.forEach((a,c)=>{const l=i[c],u=o.mediaDescriptions.find(p=>p.attributes.mid===l);u&&(Ra(u,a),aA(u,a,this.store.codec))}),Pt.exports.print(o)}mungReceiveAnswerSDP(t,n,i){const o=Pt.exports.parse(t),a=o.mediaDescriptions.find(c=>c.attributes.mid===n);return a&&i===we.AUDIO&&a.media.mediaType==="audio"&&Ao(a),Pt.exports.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let l=0;l<t.length;l++){var i,o,a,c;const u=t[l],p=n[l];if(p instanceof Dt&&!p._hints.includes(Ft.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=p._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=p._scalabiltyMode)!==null&&a!==void 0&&a.numSpatialLayers&&((c=p._scalabiltyMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},m={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const v=u.sender.getParameters();await u.sender.setParameters(Object.assign(v,f))}}}async applySimulcastEncodings(t,n){if(!Tt()&&t.length===n.length)for(let i=0;i<t.length;i++){const o=n[i];if(o instanceof Dt&&this.isVP8Simulcast(o)){const a=t[i],c={},l={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];const u=a.sender.getParameters();await a.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,i,o,a;return!!(t instanceof Dt&&k("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(Ft.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=t._scalabiltyMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabiltyMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,i,o){if(k("SDP_LOGGING"))return T.upload("exchanging ".concat(i," ").concat(n," SDP during NVExtentionsConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(Zt().supportPCSetConfiguration){const n=Bu.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"connect"),Ye.prototype),H(Ye.prototype,"updateRemoteConnect",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"updateRemoteConnect"),Ye.prototype),H(Ye.prototype,"receive",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"receive"),Ye.prototype),H(Ye.prototype,"batchReceive",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"batchReceive"),Ye.prototype),H(Ye.prototype,"stopReceiving",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"stopReceiving"),Ye.prototype),H(Ye.prototype,"muteRemote",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"muteRemote"),Ye.prototype),H(Ye.prototype,"unmuteRemote",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"unmuteRemote"),Ye.prototype),H(Ye.prototype,"muteLocal",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"muteLocal"),Ye.prototype),H(Ye.prototype,"unmuteLocal",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"unmuteLocal"),Ye.prototype),H(Ye.prototype,"close",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"close"),Ye.prototype),H(Ye.prototype,"updateEncoderConfig",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"updateEncoderConfig"),Ye.prototype),H(Ye.prototype,"updateSendParameters",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"updateSendParameters"),Ye.prototype),H(Ye.prototype,"replaceTrack",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"replaceTrack"),Ye.prototype),H(Ye.prototype,"getRemoteSSRC",[Ei],Object.getOwnPropertyDescriptor(Ye.prototype,"getRemoteSSRC"),Ye.prototype),Ye);function Ei(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From NVExtentionsConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}var ot;function FA(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=tA,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new Hm(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function Hm(e){function t(n){if(Object(n)!==n)return re.reject(new TypeError(n+" is not an object."));var i=n.done;return re.resolve(n.value).then(function(o){return{value:o,done:i}})}return(Hm=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?re.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?re.reject(n):t(i.apply(this.s,arguments))}},new Hm(e)}let wo=(H((ot=class Gu extends kl{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n){super(t,n),_(this,"store",void 0),_(this,"peerConnection",void 0),_(this,"cname",void 0),_(this,"mutex",new On("DataChannelConnection-mutex")),_(this,"dataChannel",void 0),_(this,"_p2pConnection",void 0),_(this,"establishPromise",void 0),_(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(Gu.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new pj(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const n=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(n)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,n,i,o,a,c){return this.cname=c,await this._p2pConnection.connect(t,n,i,o,a,c),await new re((l,u)=>{const p=setTimeout(()=>{this.closeSignal(),u(new N(I.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(i))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(p),void l()},this.dataChannel.onerror=f=>{this.closeSignal(),u(f)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(t,n,i){var o=this;return qi(function*(){const a=yield ke(o.mutex.lock("From DataChannelConnection.send"));try{return yield*Lc(FA(o._p2pConnection.send(t,n,i)),ke)}finally{a()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async receive(t,n,i,o){return this._nvMedia?(T.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(T.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,i,o))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(){var t=this;return qi(function*(){return yield*Lc(FA(t._p2pConnection.restartICE()),ke)})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,i,o){if(k("SDP_LOGGING"))return T.upload("exchanging ".concat(i," ").concat(n," SDP during DataChannelConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",i==="local"?"remote":"local",o)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Sc(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Gu.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Gu.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),k("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(Bl(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!k("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,i)=>{var o;return(o=this.onFirstVideoDecoded)===null||o===void 0?void 0:o.call(this,t,n,i)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedLocalCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var i;return(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0?void 0:i.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}).prototype,"connect",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"connect"),ot.prototype),H(ot.prototype,"receive",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"receive"),ot.prototype),H(ot.prototype,"stopReceiving",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"stopReceiving"),ot.prototype),H(ot.prototype,"muteRemote",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"muteRemote"),ot.prototype),H(ot.prototype,"unmuteRemote",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"unmuteRemote"),ot.prototype),H(ot.prototype,"muteLocal",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"muteLocal"),ot.prototype),H(ot.prototype,"unmuteLocal",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"unmuteLocal"),ot.prototype),H(ot.prototype,"close",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"close"),ot.prototype),H(ot.prototype,"updateEncoderConfig",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"updateEncoderConfig"),ot.prototype),H(ot.prototype,"updateSendParameters",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"updateSendParameters"),ot.prototype),H(ot.prototype,"replaceTrack",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"replaceTrack"),ot.prototype),H(ot.prototype,"getRemoteSSRC",[Xi],Object.getOwnPropertyDescriptor(ot.prototype,"getRemoteSSRC"),ot.prototype),ot);function Xi(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From DataChannelConnection.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}var Be;function BA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function Oo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Km(e){var t,n,i,o=2;for(typeof Symbol<"u"&&(n=tA,i=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new zm(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function zm(e){function t(n){if(Object(n)!==n)return re.reject(new TypeError(n+" is not an object."));var i=n.done;return re.resolve(n.value).then(function(o){return{value:o,done:i}})}return(zm=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?re.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?re.reject(n):t(i.apply(this.s,arguments))}},new zm(e)}let fj=(H((Be=class extends Rt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Fe.StateChange,t,this._state)}constructor(e,t){super(),_(this,"store",void 0),_(this,"statsUploader",void 0),_(this,"connection",void 0),_(this,"localTrackMap",new Map),_(this,"remoteUserMap",new Map),_(this,"pendingLocalTracks",[]),_(this,"pendingRemoteTracks",[]),_(this,"statsCollector",void 0),_(this,"isPlanB",!1),_(this,"shouldForwardP2PCreation",void 0),_(this,"iceFailedCount",0),_(this,"dtlsFailedCount",0),_(this,"mutex",new On("P2PChannel-mutex")),_(this,"_state",Bt.Disconnected),_(this,"handleMuteLocalTrack",async(n,i,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Bt.Connected)return void o(new N(I.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const l=c.find(p=>p[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const u=this.createMuteMessage(c);await gt(this,Fe.RequestMuteLocal,u),i()}catch(c){o(c)}finally{a()}}),_(this,"handleUnmuteLocalTrack",async(n,i,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Bt.Connected)return void o(new N(I.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const l=c.find(p=>p[0]==="videoLowTrack");if(l){const p=l[1];if(p.track._originMediaStreamTrack.stop(),Zt().supportDualStreamEncoding){const f=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=f,p.track._originMediaStreamTrack=f}else{const f=yA(n,Ss(this,Fe.RequestLowStreamParameter));p.track._mediaStreamTrack=f,p.track._originMediaStreamTrack=f}await new re((f,m)=>{this.handleReplaceTrack(p.track,f,m,!0)})}await this.connection.unmuteLocal(c.map(p=>{let[,{id:f}]=p;return f}));const u=this.createUnmuteMessage(c);await gt(this,Fe.RequestUnmuteLocal,u),i()}catch(c){o(c)}finally{a()}}),_(this,"handleUpdateVideoEncoder",async(n,i,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const c=this.localTrackMap.get(oe.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Bt.Connected)return void i();const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),await this.connection.updateEncoderConfig(l,u),this.emit(Fe.UpdateVideoEncoder,u),i()}catch(c){o(c)}finally{a()}}),_(this,"handleSetOptimizationMode",async(n,i,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const c=this.localTrackMap.get(oe.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==Bt.Connected)return;const{id:l,track:u}=c;await this.connection.updateSendParameters(l,u),i()}catch(c){o(c)}finally{a()}}),_(this,"handleReplaceTrack",async(n,i,o,a)=>{let c;T.debug("P2PChannel handleReplaceTrack for [track-id-".concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;const p=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:m}]=f;return n===m});if(!this.connection||!p||this.state!==Bt.Connected)return void i();if(await((l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,p[1].id)),this.isPlanB){const f=p[1];f.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],f)}if(p[0]===oe.LocalVideoTrack&&Zt().supportDualStreamEncoding){const f=this.localTrackMap.get(oe.LocalVideoLowTrack);if(f){const m=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m,await new re((v,R)=>{this.handleReplaceTrack(f.track,v,R,!0)})}}i()}catch(p){o(p)}finally{var u;(u=c)===null||u===void 0||u()}}),_(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),_(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),_(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),_(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new uj,this.bindStatsUploaderEvents(),this.isPlanB=!Zt().supportUnifiedPlan||k("CHROME_FORCE_PLAN_B")&&cs(),this.shouldForwardP2PCreation=k("FORWARD_P2P_CREATION")&&Zt().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new wo({},this.store):this.isPlanB?new xc({},this.store):new Vc({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){if(this.state=Bt.New,this.shouldForwardP2PCreation||(this.connection=this.store.useDataChannel?new wo(e,this.store):this.isPlanB?new xc(e,this.store):new Vc(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new N(I.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,i,o,a){if(!this.connection)throw new N(I.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof wo?this.connection.updateRemoteConnect(i):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,i,o,a),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bt.Connected)}async preConnect(e,t,n,i,o,a){if(!this.connection)throw new N(I.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const c=await this.connection.connect(e,t,n,i,o,a);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bt.Connected,c}getEstablishParams(){if(this.connection instanceof wo)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(e,t,n){var i=this;return qi(function*(){const o=yield ke(i.mutex.lock("From P2PChannel.publish"));try{if(!i.connection||i.state!==Bt.Connected){if(i.state===Bt.Disconnected)throw new N(I.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const c=e.filter(l=>i.pendingLocalTracks.indexOf(l)===-1);return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(c))}i.store.pubId=i.store.pubId+1,wi.markPublishStart(i.store.clientId,i.store.pubId);const a=i.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield ke(i.tryToUnmuteAudio(e)));yield*Lc(Km(i.doPublish(i.connection,a)),ke)}finally{o()}})()}doPublish(e,t){var n=this;return qi(function*(){t.forEach(p=>{let{track:f,type:m}=p;const v=Date.now();n.store.publish(f.getTrackId(),m===oe.LocalAudioTrack?"audio":"video",v)}),n.bindLocalTrackEvents(t);const i=yield ke(e.send(t.map(p=>{let{track:f}=p;return f}),n.store.codec,n.store.audioCodec)),o=(yield ke(i.next())).value,a=n.createGatewayPublishMessage(t,o);let c;try{c=yield a}catch(p){throw i.throw(p),(p==null?void 0:p.code)===I.WS_ABORT&&t.forEach(f=>{let{track:m}=f;n.pendingLocalTracks.indexOf(m)===-1&&n.pendingLocalTracks.push(m)}),n.unbindLocalTrackEvents(t),p}const l=n.mapPubResToRemoteConfig(a,c),u=(yield ke(i.next(l))).value;t.forEach(p=>{let{type:f}=p;n.statsCollector.addLocalStats(f)}),n.assignLocalTracks(t,u),n.statsUploader.startUploadUplinkStats(),t.forEach(p=>{let{track:f,type:m}=p;const v=Date.now();n.store.publish(f.getTrackId(),m===oe.LocalAudioTrack?"audio":"video",void 0,v)})})()}publishLowStream(e){var t=this;return qi(function*(){if(!t.connection||t.state!==Bt.Connected)return;const n=yield ke(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(oe.LocalVideoTrack);if(!o)throw new N(I.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(oe.LocalVideoLowTrack))throw new N(I.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:t.getLowVideoTrack(o.track,e),type:oe.LocalVideoLowTrack}];if(yield*Lc(Km(t.doPublish(t.connection,a)),ke),o.track.muted||!o.track.enabled){var i;const c=(i=t.localTrackMap.get(oe.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield ke(t.connection.muteLocal([c])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublish to republish tracks."),await mn(this,Fe.RequestRePublish,this.pendingLocalTracks),this.emit(Fe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==we.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==we.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await mn(this,Fe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===we.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Fe.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Bt.Connected)return void e.forEach(i=>{const o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(i=>i[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishLowStream(){if(!this.connection||this.state!==Bt.Connected)return;const e=this.localTrackMap.get(oe.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[oe.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[o,{track:a}]=i;return{type:o,track:a}})),t.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),n}async subscribe(e,t,n,i,o){var a;if(!this.connection||this.state!==Bt.Connected)throw new N(I.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let c,l;if(o){const f=o.find(v=>{let{stream_type:R}=v;return R===t});if(!f)throw new N(I.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const m=await this.connection.receive(t,f.ssrcs,String(e._uintid),f.attributes);c=m.track,l=m.id}else{const f=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);c=f.track,l=f.id}t===we.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new ou(c,e.uid,e._uintid,this.store),T.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new ru(c,e.uid,e._uintid,this.store),T.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(e,e._videoTrack));const u=this.remoteUserMap.get(e);u?u.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats();const p=this.pendingRemoteTracks.findIndex(f=>{let{user:m,kind:v}=f;return m.uid===e.uid&&t===v});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Fe.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Bt.Connected)throw new N(I.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var i;let{user:o,mediaType:a}=n;return!((i=this.remoteUserMap.get(o))!==null&&i!==void 0&&i.has(a))});const t=await this.connection.batchReceive(e.map(n=>{let{user:i,mediaType:o,ssrcId:a,rtxSsrcId:c}=n;return{kind:o,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(i._uintid)}}));e.forEach((n,i)=>{let{user:o,mediaType:a}=n;const{track:c,id:l}=t[i];a===we.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(c):(o._audioTrack=new ou(c,o.uid,o._uintid,this.store),T.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(c):(o._videoTrack=new ru(c,o.uid,o._uintid,this.store),T.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(o,o._videoTrack));const u=this.remoteUserMap.get(o);u?u.set(a,l):this.remoteUserMap.set(o,new Map([[a,l]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadDownlinkStats();const p=this.pendingRemoteTracks.findIndex(f=>{let{user:m,kind:v}=f;return m.uid===o.uid&&a===v});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(Fe.MediaReconnectEnd,o.uid))})}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter(c=>{let{user:l,kind:u}=c;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(i.forEach(c=>{const l=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===Bt.Connected||n||i.forEach(c=>{let{kind:l}=c;var u;if(l===we.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===we.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Bt.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(c=>{let[,{id:l}]=c;return l}));const a=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),o.forEach(c=>{let[l,{kind:u}]=c;var p,f;if(u===we.VIDEO&&l._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===we.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((f=l._videoTrack)===null||f===void 0||f._destroy(),l._videoTrack=void 0);else if(u===we.AUDIO){var m;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((m=l._audioTrack)===null||m===void 0||m._destroy(),l._audioTrack=void 0)}}),a}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:a}of e){const c=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:p}=l;return a!==void 0?u.uid===o.uid&&a===p:u.uid===o.uid});c.forEach(l=>{const u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),t=t.concat(c)}if(!this.connection||this.state!==Bt.Connected)return void t.forEach(o=>{let{user:a,kind:c}=o;var l;if(c===we.AUDIO)(l=a._audioTrack)===null||l===void 0||l._destroy(),a._audioTrack=void 0;else if(c===we.VIDEO){var u;(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0}});const n=fo(e).call(e,(o,a)=>{let{user:c,mediaType:l}=a;const u=this.filterTobeUnSubscribedTracks(c,l);return o.concat(u)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:a}]=o;return a}));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),n.forEach(o=>{let[a,{kind:c}]=o;var l,u;if(c===we.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===we.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(u=a._videoTrack)===null||u===void 0||u._destroy(),a._videoTrack=void 0;else if(c===we.AUDIO){var p;this.unbindRemoteTrackEvents(a._audioTrack),(p=a._audioTrack)===null||p===void 0||p._destroy(),a._audioTrack=void 0}}),i}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("P2PChannel.muteRemote has no remote user ".concat(e.uid,"."));if(!n.get(t))return void T.warning("P2PChannel.muteRemote has no remote user ".concat(e.uid," media type ").concat(t,"."));const i=t===we.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void T.warning("P2PChannel.unmuteRemote has no remote user ".concat(e.uid,"."));n.get(t)||T.warning("P2PChannel.unmuteRemote has no remote user ".concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(oe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Ai){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return o!==oe.LocalAudioTrack}).filter(i=>{let[o]=i;return!(e&&o===oe.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return!(e&&i===oe.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i})}reportPublishEvent(e,t,n,i,o){if(e){const c=this.localTrackMap.get(oe.LocalAudioTrack),l=i?this.localTrackMap.get(oe.LocalVideoLowTrack):this.localTrackMap.get(oe.LocalVideoTrack);ue.publish(this.store.sessionId,{eventElapse:wi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.track.getTrackLabel(),videoName:l==null?void 0:l.track.getTrackLabel(),screenshare:(l==null?void 0:l.track._hints.indexOf(Ft.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var a;n||(n=[]);const c=n.find(u=>u instanceof pn),l=i?(a=this.localTrackMap.get(oe.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(u=>u instanceof Dt);ue.publish(this.store.sessionId,{eventElapse:wi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c==null?void 0:c.getTrackLabel(),videoName:l==null?void 0:l.getTrackLabel(),screenshare:(l==null?void 0:l._hints.indexOf(Ft.SCREEN_TRACK))!==-1,audio:!!c,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,i){const o=i===we.VIDEO?n._videoSSRC:n._audioSSRC;o&&ue.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===we.VIDEO,audio:i===we.AUDIO,peerid:n.uid,subscribeRequestid:i===we.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:wi.measureFromSubscribeStart(this.store.clientId,o)})}reset(){T.debug("P2PChannel.reset"),this.mutex=new On("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new wo({},this.store):this.isPlanB?new xc({},this.store):new Vc({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Bt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(oe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(oe.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Dt||t&&t.track instanceof pn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(ms(t=this.remoteUserMap).call(t)).find(i=>i.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(oe.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Nf(e).call(e,(n,i)=>n.level-i.level),e}async disconnectForReconnect(){this.connection&&(T.debug("P2PChannel.disconnectForReconnect closing P2PConnection"),this.state=Bt.Reconnecting,k("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{var t,n,i,o;let[a]=e;(t=a._videoTrack)===null||t===void 0||(n=t._player)===null||n===void 0||(i=n.getVideoElement())===null||i===void 0||i.pause(),(o=a._videoTrack)===null||o===void 0||o._originMediaStreamTrack.stop()}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new wo({},this.store):this.isPlanB?new xc({},this.store):new Vc({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;switch(t){case oe.LocalVideoTrack:n._hints.includes(Ft.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case oe.LocalAudioTrack:n instanceof Ai?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);break;case oe.LocalVideoLowTrack:}}),this.emit(Fe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(ms(n).call(n)).forEach(i=>{this.setPendingRemoteMedia(t,i)}),this.emit(Fe.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),T.debug("P2PChannel disconnected, waiting to reconnect."))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:o}=n;if((e instanceof _m?e.uid:e)===i.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(){var e=this;return qi(function*(){if(!e.connection||e.state!==Bt.Connected||e.connection instanceof wo)return;const t=yield ke(e.mutex.lock("From P2PChannel.restartICE"));try{yield*Lc(Km(e.connection.restartICE()),ke)}finally{t()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(oe.LocalVideoTrack),n=this.localTrackMap.get(oe.LocalAudioTrack),i=e.videoSend.find(R=>R.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),o=e.audioSend.find(R=>R.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!i||!o)return 1;const a=br(this,Fe.NeedSignalRTT),c=i?i.rttMs:void 0,l=o?o.rttMs:void 0,u=c&&l?(c+l)/2:c||l,p=(u&&a?(u+a)/2:u||a)||0,f=100*e.sendPacketLossRate*.7/50+.3*p/1500,m=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,v=t==null?void 0:t.track;if(v&&v._encoderConfig&&v._hints.indexOf(Ft.SCREEN_TRACK)===-1){const R=v._encoderConfig.bitrateMax,w=e.bitrate.actualEncoded;if(R&&w){const A=(1e3*R-w)/(1e3*R);return HU[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i]=n;const o=i._audioSSRC,a=i._videoSSRC,c=e.audioRecv.find(w=>w.ssrc===o),l=e.videoRecv.find(w=>w.ssrc===a);if(!c&&!l)return void(t+=1);const u=br(this,Fe.NeedSignalRTT),p=e.rtt,f=(p&&u?(p+u)/2:p||u)||0,m=c?c.jitterMs:void 0,v=e.recvPacketLossRate;let R=.7*v*100/50+.3*f/1500;m&&(R=.6*v*100/50+.2*f/1500+.2*m/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new re((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const i=[],o=Zt(),a=this.getAllTracks();e=rI(e=e.filter(u=>a.indexOf(u)===-1));let c=!1,l=!1;for(const u of e){if(u instanceof Dt&&(this.localTrackMap.has(oe.LocalVideoTrack)||c?new N(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:oe.LocalVideoTrack}),c=!0),t)){const p=this.getLowVideoTrack(u,n);i.push({track:p,type:oe.LocalVideoLowTrack})}if(u instanceof pn){const p=this.localTrackMap.get(oe.LocalAudioTrack);if(p){if(!(p.track instanceof Ai))throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(l){const f=i.find(m=>{let{type:v}=m;return v===oe.LocalAudioTrack});if(!(f.track instanceof Ai))throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(u)}else{if(!o.webAudioMediaStreamDest||u instanceof Ai||u._bypassWebAudio)i.push({track:u,type:oe.LocalAudioTrack});else{const f=new Ai;f.addAudioTrack(u),i.push({track:f,type:oe.LocalAudioTrack})}l=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=rI(e=e.filter(i=>n.indexOf(i)!==-1));for(const i of e){if(i instanceof pn){const o=this.localTrackMap.get(oe.LocalAudioTrack);if(!o)continue;o.track instanceof Ai?(o.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),o.track.trackList.length===0&&(t.push([oe.LocalAudioTrack,o]),o.track.close())):t.push([oe.LocalAudioTrack,o])}if(i instanceof Dt){const o=this.localTrackMap.get(oe.LocalVideoTrack);if(!o)continue;t.push([oe.LocalVideoTrack,o]);const a=this.localTrackMap.get(oe.LocalVideoLowTrack);a&&t.push([oe.LocalVideoLowTrack,a])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:i}=t;switch(i){case oe.LocalVideoTrack:n.addListener(Se.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Se.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Se.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.addListener(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case oe.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);break;case oe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ai?e.trackList.forEach(n=>{n.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Se.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Se.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:i}]=t;return{track:i,type:n}})),e.forEach(t=>{let{track:n,type:i}=t;switch(i){case oe.LocalVideoTrack:n.off(Se.GET_STATS,this.handleGetLocalVideoStats),n.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Se.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Se.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.off(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case oe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);break;case oe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ai?e.trackList.forEach(t=>{t.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Se.GET_STATS,this.handleGetLocalAudioStats),t.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Se.GET_STATS,this.handleGetLocalAudioStats),e.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof ru&&t.addListener(Se.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof ou&&t.addListener(Se.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Se.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(we.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(we.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,i)=>{let o,a,{track:c,type:l}=n;switch(l){case oe.LocalAudioTrack:o=Ut.Audio,a={dtx:c instanceof jl&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case oe.LocalVideoTrack:o=c._hints.includes(Ft.SCREEN_TRACK)?Ut.Screen:Ut.High,a=Oo(Oo({},Zy(c)),{},{codec:this.store.codec});break;case oe.LocalVideoLowTrack:o=Ut.Low,a=Oo(Oo({},Zy(c)),{},{codec:this.store.codec})}return{stream_type:o,attributes:a,ssrcs:t[i]}})}createGatewayUnpublishMessage(e){return e.map(t=>{let n,[i,{track:o,ssrcs:a,id:c}]=t;switch(i){case oe.LocalVideoTrack:n=o._hints.includes(Ft.SCREEN_TRACK)?Ut.Screen:Ut.High;break;case oe.LocalAudioTrack:n=Ut.Audio;break;case oe.LocalVideoLowTrack:n=Ut.Low}return{stream_type:n,ssrcs:a,mid:c}})}assignLocalTracks(e,t){e.forEach((n,i)=>{let{track:o,type:a}=n;this.localTrackMap.set(a,{track:o,id:t[i].id,ssrcs:t[i].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(T.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Fe.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&k("ICE_RESTART")&&br(this,Fe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Fe.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(T.debug("P2PConnection disconnected timeout 4000ms, force reconnect"),setTimeout(()=>this.emit(Fe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(T.debug("P2PConnection state failed, force reconnect"),setTimeout(()=>this.emit(Fe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),ue.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:mt.TRACER}).onSuccess(),this.emit(Fe.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var o;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(o=i.audioTrack)===null||o===void 0||o.emit(la.FIRST_FRAME_DECODED),ue.firstRemoteFrame(this.store.sessionId,ln.FIRST_AUDIO_DECODE,Et.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:wi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);i&&ue.firstRemoteFrame(this.store.sessionId,ln.FIRST_AUDIO_RECEIVED,Et.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:wi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(ms(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);i&&ue.firstRemoteFrame(this.store.sessionId,ln.FIRST_VIDEO_RECEIVED,Et.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:wi.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&i===o||this.emit(Fe.ConnectionTypeChange,i),T.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Gl(n))," -> ").concat(JSON.stringify(Gl(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Gl(n))," -> ").concat(JSON.stringify(Gl(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(oe.LocalAudioTrack);if(e instanceof pn&&(n==null?void 0:n.track)instanceof Ai)return n.track.isActive||t.push([oe.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(i&&(t.push(i),i[0]===oe.LocalVideoTrack)){const o=this.localTrackMap.get(oe.LocalVideoLowTrack);o&&t.push([oe.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(oe.LocalAudioTrack);if(e instanceof pn&&(n==null?void 0:n.track)instanceof Ai)return n.track.isActive&&t.push([oe.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(i)if(i[0]===oe.LocalVideoTrack){t.push(i);const o=this.localTrackMap.get(oe.LocalVideoLowTrack);o&&t.push([oe.LocalVideoLowTrack,o])}else t.push(i);return t}createMuteMessage(e){return e.map(t=>{let n,[i,{track:o,ssrcs:a,id:c}]=t;switch(i){case oe.LocalAudioTrack:n=Ut.Audio;break;case oe.LocalVideoTrack:n=o._hints.includes(Ft.SCREEN_TRACK)?Ut.Screen:Ut.High;break;case oe.LocalVideoLowTrack:n=Ut.Low}return{stream_type:n,ssrcs:a,mid:c}})}createUnmuteMessage(e){return e.map(t=>{let n,[i,{track:o,ssrcs:a,id:c}]=t;switch(i){case oe.LocalAudioTrack:n=Ut.Audio;break;case oe.LocalVideoTrack:n=o._hints.includes(Ft.SCREEN_TRACK)?Ut.Screen:Ut.High;break;case oe.LocalVideoLowTrack:n=Ut.Low}return{stream_type:n,ssrcs:a,mid:c}})}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const o=i.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(i.entries()).forEach(o=>{let[a,c]=o;n.push([e,{kind:a,id:c}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[i,{kind:o,id:a}]=n;switch(o){case we.VIDEO:return void(i._videoSSRC&&t.push({stream_type:we.VIDEO,ssrcId:i._videoSSRC}));case we.AUDIO:return void(i._audioSSRC&&t.push({stream_type:we.AUDIO,ssrcId:i._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[i,{kind:o}]=n;if(t.has(i)){let a=t.get(i);o===we.VIDEO?a|=Ot.Video:a|=Ot.Audio,t.set(i,a)}else o===we.VIDEO?t.set(i,Ot.Video):t.set(i,Ot.Audio)}),{users:Array.from(t.entries()).map(n=>{let[i,o]=n;return{stream_id:i.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:i}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(i),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(oe.LocalVideoTrack),n=this.localTrackMap.get(oe.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((n,i)=>{var o;let{stream_type:a}=n;return(o=t.find(c=>{let{stream_type:l}=c;return a===l}))===null||o===void 0?void 0:o.attributes})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof pn){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map(a=>{let[,{id:c}]=a;return c})));const o=this.createUnmuteMessage(i);return void await gt(this,Fe.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Fe.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await fn(Sf(this.dtlsFailedCount,jt)),this.emit(Fe.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await mn(this,Fe.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Fe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(oe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Dt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Dt).length>1)throw new N(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof pn).length>1&&(e.some(t=>t instanceof pn&&t._bypassWebAudio)||!Zt().webAudioMediaStreamDest))throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Dt&&this.pendingLocalTracks.some(n=>n instanceof Dt))throw new N(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof pn&&this.pendingLocalTracks.some(n=>n instanceof pn)&&(!Zt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof pn&&n._bypassWebAudio)))throw new N(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=Zt().supportDualStreamEncoding,i=Oo(Oo({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=n?e._mediaStreamTrack.clone():yA(e,i);const a=ht(8,"track-low-"),c=new Dt(o,Oo(Oo({},n&&{scaleResolutionDownBy:YV(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return c._hints.push(Ft.LOW_STREAM),e.addListener(Se.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var o;const a=Array.from(ms(o=this.remoteUserMap).call(o)).find(c=>c._videoSSRC===e);if(a){i||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,l=c.subscribe.find(u=>u.userId===a.uid&&u.type==="video");ue.firstRemoteVideoDecode(this.store.sessionId,ln.FIRST_VIDEO_DECODE,Et.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:wi.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:(l==null?void 0:l.subscribeEnd)||0,subscriberStart:(l==null?void 0:l.subscribeStart)||0,videoAddNotify:(l==null?void 0:l.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const o=i.get(t);if(!o)return!1;const a=await this.connection.getRemoteSSRC(o);return a!==void 0&&a!==n}resetConnection(e){T.debug("[P2PChannel] reset connection to ".concat(e)),this.state===Bt.Connected?(T.debug("[P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first"),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===Dl.datachannel?new wo({},this.store):this.isPlanB?new xc({},this.store):new Vc({},this.store),this.bindConnectionEvents(this.connection)))}}).prototype,"startP2PConnection",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"startP2PConnection"),Be.prototype),H(Be.prototype,"connect",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"connect"),Be.prototype),H(Be.prototype,"preConnect",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"preConnect"),Be.prototype),H(Be.prototype,"unpublish",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"unpublish"),Be.prototype),H(Be.prototype,"unpublishLowStream",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"unpublishLowStream"),Be.prototype),H(Be.prototype,"subscribe",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"subscribe"),Be.prototype),H(Be.prototype,"massSubscribe",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"massSubscribe"),Be.prototype),H(Be.prototype,"unsubscribe",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"unsubscribe"),Be.prototype),H(Be.prototype,"massUnsubscribe",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"massUnsubscribe"),Be.prototype),H(Be.prototype,"muteRemote",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"muteRemote"),Be.prototype),H(Be.prototype,"unmuteRemote",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"unmuteRemote"),Be.prototype),H(Be.prototype,"hasRemoteMediaWithLock",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"hasRemoteMediaWithLock"),Be.prototype),H(Be.prototype,"disconnectForReconnect",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"disconnectForReconnect"),Be.prototype),H(Be.prototype,"updateBitrateLimit",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"updateBitrateLimit"),Be.prototype),H(Be.prototype,"remoteMediaSsrcChanged",[ti],Object.getOwnPropertyDescriptor(Be.prototype,"remoteMediaSsrcChanged"),Be.prototype),Be);function ti(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];return await i.apply(this,l)}finally{a()}},n}function GA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GA(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GA(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}var Le;(function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(Le||(Le={}));class mj{constructor(t,n,i,o){_(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:i,clientId:o,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(t){this.state=function(n,i){switch(i.type){case Le.SET_SESSION_ID:return he(he({},n),{},{sessionId:i.sessionId});case Le.SET_P2P_ID:return he(he({},n),{},{p2pId:i.p2pId});case Le.SET_UID:return he(he({},n),{},{uid:i.uid});case Le.SET_PUB_ID:return he(he({},n),{},{pubId:i.pubId});case Le.KEY_METRIC_CLIENT_CREATED:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{clientCreated:i.metric})});case Le.KEY_METRIC_JOIN_START:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{joinStart:i.metric})});case Le.AVOID_JOIN_START:return he(he({},n),{},{avoidJoinStart:i.avoidJoinStart});case Le.KEY_METRIC_JOIN_END:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{joinEnd:i.metric})});case Le.KEY_METRIC_REQUEST_AP_START:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{requestAPStart:i.metric})});case Le.KEY_METRIC_REQUEST_AP_END:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{requestAPEnd:i.metric})});case Le.KEY_METRIC_JOIN_GATEWAY_START:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{joinGatewayStart:i.metric})});case Le.KEY_METRIC_JOIN_GATEWAY_END:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{joinGatewayEnd:i.metric})});case Le.KEY_METRIC_PEER_CONNECTION_START:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{peerConnectionStart:i.metric})});case Le.KEY_METRIC_PEER_CONNECTION_END:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{peerConnectionEnd:i.metric})});case Le.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{signalChannelOpen:i.metric})});case Le.KEY_METRIC_ICE_CONNECTION_END:return he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{iceConnectionEnd:i.metric})});case Le.KEY_METRIC_PUBLISH:{const o=n.keyMetrics.publish,a=o.findIndex(c=>c.trackId===i.metric.trackId);return a!==-1?(o[a]=he(he({},o[a]),i.metric),he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{publish:[...o]})})):he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,i.metric]})})}case Le.KEY_METRIC_SUBSCRIBE:{const o=n.keyMetrics.subscribe,a=o.findIndex(c=>c.userId===i.metric.userId&&c.type===i.metric.type);return a!==-1?(o[a]=he(he({},o[a]),i.metric),he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{subscribe:[...o]})})):he(he({},n),{},{keyMetrics:he(he({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,i.metric]})})}case Le.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=i.mode,n;case Le.RECORD_JOIN_CHANNEL_SERVICE:return typeof i.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,i.record]:(n.joinChannelServiceRecords[i.index]=he(he({},n.joinChannelServiceRecords[i.index]),i.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case Le.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case Le.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case Le.SET_USE_DATACHANNEL:return he(he({},n),{},{useDataChannel:i.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:Le.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:Le.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:Le.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:Le.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:Le.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:Le.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:Le.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:Le.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Le.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Le.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Le.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Le.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Le.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Le.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Le.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Le.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Le.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Le.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,i,o){this.dispatch({type:Le.KEY_METRIC_PUBLISH,metric:he(he({trackId:t,type:n},i&&{publishStart:i}),o&&{publishEnd:o})})}subscribe(t,n,i,o,a,c,l){this.dispatch({type:Le.KEY_METRIC_SUBSCRIBE,metric:he(he(he(he(he({userId:t,type:n},i&&{subscribeStart:i}),o&&{subscribeEnd:o}),a&&{firstFrame:a}),c&&{streamAdded:c}),l&&{firstDecoded:l})})}massSubscribe(t,n,i,o){t.forEach(a=>{this.dispatch({type:Le.KEY_METRIC_SUBSCRIBE,metric:he(he(he({userId:a.userId,type:a.type},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),o&&{firstFrame:o})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(i=>i.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:Le.RECORD_JOIN_CHANNEL_SERVICE,record:he(he({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Le.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Le.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Le.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:Le.AVOID_JOIN_START,avoidJoinStart:t})}}let cu;const Ej=()=>(cu||cu||(cu=(window.location.protocol.split(":")[0]||"").toUpperCase(),cu))==="HTTPS",WA=()=>window.isSecureContext!==void 0;function _j(e){let t=zA();return function(n,i){let o=n.appId;o!==void 0&&(We(i,10),Pr(i,o));let a=n.cid;a!==void 0&&(We(i,16),We(i,a));let c=n.cname;c!==void 0&&(We(i,26),Pr(i,c));let l=n.deviceId;l!==void 0&&(We(i,34),Pr(i,l));let u=n.elapse;u!==void 0&&(We(i,40),No(i,u));let p=n.fileSize;p!==void 0&&(We(i,48),No(i,ya(p)));let f=n.height;f!==void 0&&(We(i,56),No(i,ya(f)));let m=n.jpg;m!==void 0&&(We(i,66),We(i,m.length),function(Yn,F){let K=Ia(Yn,F.length);Yn.bytes.set(F,K)}(i,m));let v=n.networkType;v!==void 0&&(We(i,72),No(i,ya(v)));let R=n.osType;R!==void 0&&(We(i,80),No(i,ya(R)));let w=n.requestId;w!==void 0&&(We(i,90),Pr(i,w));let A=n.sdkVersion;A!==void 0&&(We(i,98),Pr(i,A));let O=n.sequence;O!==void 0&&(We(i,104),No(i,ya(O)));let U=n.sid;U!==void 0&&(We(i,114),Pr(i,U));let x=n.timestamp;x!==void 0&&(We(i,120),No(i,x));let Q=n.uid;Q!==void 0&&(We(i,128),We(i,Q));let pe=n.vid;pe!==void 0&&(We(i,136),We(i,pe));let Z=n.width;Z!==void 0&&(We(i,144),No(i,ya(Z)));let ee=n.service;ee!==void 0&&(We(i,152),We(i,ee));let J=n.callbackData;J!==void 0&&(We(i,162),Pr(i,J));let se=n.jpgEncryption;se!==void 0&&(We(i,168),We(i,se));let tt=n.requestType;tt!==void 0&&(We(i,176),We(i,tt));let Ae=n.scorePorn;Ae!==void 0&&(We(i,185),Qm(i,Ae));let lt=n.scoreSexy;lt!==void 0&&(We(i,193),Qm(i,lt));let it=n.scoreNeutral;it!==void 0&&(We(i,201),Qm(i,it));let wt=n.scene;wt!==void 0&&(We(i,208),We(i,wt));let nn=n.ossFilePrefix;nn!==void 0&&(We(i,218),Pr(i,nn));let Ct=n.serviceVendor;if(Ct!==void 0)for(let Yn of Ct){We(i,226);let F=zA();vj(Yn,F),We(i,F.limit),Ij(i,F),yj(F)}}(e,t),function(n){let i=n.bytes,o=n.limit;return i.length===o?i:i.subarray(0,o)}(t)}function gj(e){return function(n){let i={};e:for(;!YA(n);){let o=kr(n);switch(o>>>3){case 0:break e;case 1:i.code=kr(n);break;case 2:i.msg=qA(n,kr(n));break;case 3:{let a=Tj(n);i.data=Sj(n),n.limit=a;break}default:HA(n,7&o)}}return i}({bytes:t=e,offset:0,limit:t.length});var t}function Sj(e){let t={};e:for(;!YA(e);){let n=kr(e);switch(n>>>3){case 0:break e;case 1:t.requestId=qA(e,kr(e));break;case 2:t.requestType=kr(e)>>>0;break;case 3:t.scorePorn=Xm(e);break;case 4:t.scoreSexy=Xm(e);break;case 5:t.scoreNeutral=Xm(e);break;case 6:t.requestScene=kr(e)>>>0;break;case 7:t.scene=kr(e)>>>0;break;default:HA(e,7&n)}}return t}function vj(e,t){let n=e.service;n!==void 0&&(We(t,8),We(t,n));let i=e.vendor;i!==void 0&&(We(t,16),We(t,i));let o=e.token;o!==void 0&&(We(t,26),Pr(t,o));let a=e.callbackUrl;a!==void 0&&(We(t,34),Pr(t,a))}function Tj(e){let t=kr(e),n=e.limit;return e.limit=e.offset+t,n}function HA(e,t){switch(t){case 0:for(;128&JA(e););break;case 2:qm(e,kr(e));break;case 5:qm(e,4);break;case 1:qm(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Rj=new Float32Array(1);new Uint8Array(Rj.buffer);let Ym=new Float64Array(1),zn=new Uint8Array(Ym.buffer);function ya(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let KA=[];function zA(){const e=KA.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function yj(e){KA.push(e)}function qm(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function YA(e){return e.offset>=e.limit}function Ia(e,t){let n=e.bytes,i=e.offset,o=e.limit,a=i+t;if(a>n.length){let c=new Uint8Array(2*a);c.set(n),e.bytes=c}return e.offset=a,a>o&&(e.limit=a),i}function Jm(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function qA(e,t){let n=Jm(e,t),i=String.fromCharCode,o=e.bytes,a="�",c="";for(let l=0;l<t;l++){let u,p,f,m,v=o[l+n];128&v?(224&v)==192?l+1>=t?c+=a:(u=o[l+n+1],(192&u)!=128?c+=a:(m=(31&v)<<6|63&u,m<128?c+=a:(c+=i(m),l++))):(240&v)==224?l+2>=t?c+=a:(u=o[l+n+1],p=o[l+n+2],(49344&(u|p<<8))!=32896?c+=a:(m=(15&v)<<12|(63&u)<<6|63&p,m<2048||m>=55296&&m<=57343?c+=a:(c+=i(m),l+=2))):(248&v)==240?l+3>=t?c+=a:(u=o[l+n+1],p=o[l+n+2],f=o[l+n+3],(12632256&(u|p<<8|f<<16))!=8421504?c+=a:(m=(7&v)<<18|(63&u)<<12|(63&p)<<6|63&f,m<65536||m>1114111?c+=a:(m-=65536,c+=i(55296+(m>>10),56320+(1023&m)),l+=3))):c+=a:c+=i(v)}return c}function Pr(e,t){let n=t.length,i=0;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),i+=l<128?1:l<2048?2:l<65536?3:4}We(e,i);let o=Ia(e,i),a=e.bytes;for(let c=0;c<n;c++){let l=t.charCodeAt(c);l>=55296&&l<=56319&&c+1<n&&(l=(l<<10)+t.charCodeAt(++c)-56613888),l<128?a[o++]=l:(l<2048?a[o++]=l>>6&31|192:(l<65536?a[o++]=l>>12&15|224:(a[o++]=l>>18&7|240,a[o++]=l>>12&63|128),a[o++]=l>>6&63|128),a[o++]=63&l|128)}}function Ij(e,t){let n=Ia(e,t.limit),i=e.bytes,o=t.bytes;for(let a=0,c=t.limit;a<c;a++)i[a+n]=o[a]}function JA(e){return e.bytes[Jm(e,1)]}function XA(e,t){let n=Ia(e,1);e.bytes[n]=t}function Xm(e){let t=Jm(e,8),n=e.bytes;return zn[0]=n[t++],zn[1]=n[t++],zn[2]=n[t++],zn[3]=n[t++],zn[4]=n[t++],zn[5]=n[t++],zn[6]=n[t++],zn[7]=n[t++],Ym[0]}function Qm(e,t){let n=Ia(e,8),i=e.bytes;Ym[0]=t,i[n++]=zn[0],i[n++]=zn[1],i[n++]=zn[2],i[n++]=zn[3],i[n++]=zn[4],i[n++]=zn[5],i[n++]=zn[6],i[n++]=zn[7]}function kr(e){let t,n=0,i=0;do t=JA(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function We(e,t){for(t>>>=0;t>=128;)XA(e,127&t|128),t>>>=7;XA(e,t)}function No(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,a=o===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:o<128?9:10,c=Ia(e,a),l=e.bytes;switch(a){case 10:l[c+9]=o>>>7&1;case 9:l[c+8]=a!==9?128|o:127&o;case 8:l[c+7]=a!==8?i>>>21|128:i>>>21&127;case 7:l[c+6]=a!==7?i>>>14|128:i>>>14&127;case 6:l[c+5]=a!==6?i>>>7|128:i>>>7&127;case 5:l[c+4]=a!==5?128|i:127&i;case 4:l[c+3]=a!==4?n>>>21|128:n>>>21&127;case 3:l[c+2]=a!==3?n>>>14|128:n>>>14&127;case 2:l[c+1]=a!==2?n>>>7|128:n>>>7&127;case 1:l[c]=a!==1?128|n:127&n}}const Cj=async(e,t,n)=>{const i=function(c){const l=[];for(let u=0;u<c.length;u+=2)l.push(parseInt(c.slice(u,u+2),16));return Uint8Array.from(l)}(function(c){const l="0123456789abcdef";function u(tt){let Ae,lt="";for(Ae=0;Ae<=3;Ae++)lt+=l.charAt(tt>>8*Ae+4&15)+l.charAt(tt>>8*Ae&15);return lt}function p(tt,Ae){const lt=(65535&tt)+(65535&Ae);return(tt>>16)+(Ae>>16)+(lt>>16)<<16|65535&lt}function f(tt,Ae,lt,it,wt,nn){return p(function(Ct,Yn){return Ct<<Yn|Ct>>>32-Yn}(p(p(Ae,tt),p(it,nn)),wt),lt)}function m(tt,Ae,lt,it,wt,nn,Ct){return f(Ae&lt|~Ae&it,tt,Ae,wt,nn,Ct)}function v(tt,Ae,lt,it,wt,nn,Ct){return f(Ae&it|lt&~it,tt,Ae,wt,nn,Ct)}function R(tt,Ae,lt,it,wt,nn,Ct){return f(Ae^lt^it,tt,Ae,wt,nn,Ct)}function w(tt,Ae,lt,it,wt,nn,Ct){return f(lt^(Ae|~it),tt,Ae,wt,nn,Ct)}const A=function(tt){let Ae;const lt=1+(tt.length+8>>6),it=new Array(16*lt);for(Ae=0;Ae<16*lt;Ae++)it[Ae]=0;for(Ae=0;Ae<tt.length;Ae++)it[Ae>>2]|=tt.charCodeAt(Ae)<<Ae%4*8;return it[Ae>>2]|=128<<Ae%4*8,it[16*lt-2]=8*tt.length,it}(c);let O,U,x,Q,pe,Z=1732584193,ee=-271733879,J=-1732584194,se=271733878;for(O=0;O<A.length;O+=16)U=Z,x=ee,Q=J,pe=se,Z=m(Z,ee,J,se,A[O+0],7,-680876936),se=m(se,Z,ee,J,A[O+1],12,-389564586),J=m(J,se,Z,ee,A[O+2],17,606105819),ee=m(ee,J,se,Z,A[O+3],22,-1044525330),Z=m(Z,ee,J,se,A[O+4],7,-176418897),se=m(se,Z,ee,J,A[O+5],12,1200080426),J=m(J,se,Z,ee,A[O+6],17,-1473231341),ee=m(ee,J,se,Z,A[O+7],22,-45705983),Z=m(Z,ee,J,se,A[O+8],7,1770035416),se=m(se,Z,ee,J,A[O+9],12,-1958414417),J=m(J,se,Z,ee,A[O+10],17,-42063),ee=m(ee,J,se,Z,A[O+11],22,-1990404162),Z=m(Z,ee,J,se,A[O+12],7,1804603682),se=m(se,Z,ee,J,A[O+13],12,-40341101),J=m(J,se,Z,ee,A[O+14],17,-1502002290),ee=m(ee,J,se,Z,A[O+15],22,1236535329),Z=v(Z,ee,J,se,A[O+1],5,-165796510),se=v(se,Z,ee,J,A[O+6],9,-1069501632),J=v(J,se,Z,ee,A[O+11],14,643717713),ee=v(ee,J,se,Z,A[O+0],20,-373897302),Z=v(Z,ee,J,se,A[O+5],5,-701558691),se=v(se,Z,ee,J,A[O+10],9,38016083),J=v(J,se,Z,ee,A[O+15],14,-660478335),ee=v(ee,J,se,Z,A[O+4],20,-405537848),Z=v(Z,ee,J,se,A[O+9],5,568446438),se=v(se,Z,ee,J,A[O+14],9,-1019803690),J=v(J,se,Z,ee,A[O+3],14,-187363961),ee=v(ee,J,se,Z,A[O+8],20,1163531501),Z=v(Z,ee,J,se,A[O+13],5,-1444681467),se=v(se,Z,ee,J,A[O+2],9,-51403784),J=v(J,se,Z,ee,A[O+7],14,1735328473),ee=v(ee,J,se,Z,A[O+12],20,-1926607734),Z=R(Z,ee,J,se,A[O+5],4,-378558),se=R(se,Z,ee,J,A[O+8],11,-2022574463),J=R(J,se,Z,ee,A[O+11],16,1839030562),ee=R(ee,J,se,Z,A[O+14],23,-35309556),Z=R(Z,ee,J,se,A[O+1],4,-1530992060),se=R(se,Z,ee,J,A[O+4],11,1272893353),J=R(J,se,Z,ee,A[O+7],16,-155497632),ee=R(ee,J,se,Z,A[O+10],23,-1094730640),Z=R(Z,ee,J,se,A[O+13],4,681279174),se=R(se,Z,ee,J,A[O+0],11,-358537222),J=R(J,se,Z,ee,A[O+3],16,-722521979),ee=R(ee,J,se,Z,A[O+6],23,76029189),Z=R(Z,ee,J,se,A[O+9],4,-640364487),se=R(se,Z,ee,J,A[O+12],11,-421815835),J=R(J,se,Z,ee,A[O+15],16,530742520),ee=R(ee,J,se,Z,A[O+2],23,-995338651),Z=w(Z,ee,J,se,A[O+0],6,-198630844),se=w(se,Z,ee,J,A[O+7],10,1126891415),J=w(J,se,Z,ee,A[O+14],15,-1416354905),ee=w(ee,J,se,Z,A[O+5],21,-57434055),Z=w(Z,ee,J,se,A[O+12],6,1700485571),se=w(se,Z,ee,J,A[O+3],10,-1894986606),J=w(J,se,Z,ee,A[O+10],15,-1051523),ee=w(ee,J,se,Z,A[O+1],21,-2054922799),Z=w(Z,ee,J,se,A[O+8],6,1873313359),se=w(se,Z,ee,J,A[O+15],10,-30611744),J=w(J,se,Z,ee,A[O+6],15,-1560198380),ee=w(ee,J,se,Z,A[O+13],21,1309151649),Z=w(Z,ee,J,se,A[O+4],6,-145523070),se=w(se,Z,ee,J,A[O+11],10,-1120210379),J=w(J,se,Z,ee,A[O+2],15,718787259),ee=w(ee,J,se,Z,A[O+9],21,-343485551),Z=p(Z,U),ee=p(ee,x),J=p(J,Q),se=p(se,pe);return u(Z)+u(ee)+u(J)+u(se)}(""+t+n)).slice(0,16),o=i.slice(0,12),a=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},a,e))};function QA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}const Aj=new Map([["moderation",1],["supervise",2]]);class du extends Rt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(xt.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=fo(n=t.map(i=>Aj.get(i)||0)).call(n,(i,o)=>i+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),_(this,"name","AgoraRTCVideoContentInspect"),_(this,"_connectionState",li.CONNECTING),_(this,"_innerConnectionState",void 0),_(this,"sequence",0),_(this,"inspectStartTime",void 0),_(this,"workerManagerConnection",void 0),_(this,"workerConnection",void 0),_(this,"workerMessageLengthLimit",void 0),_(this,"inspectIntervalMinimum",void 0),_(this,"qualityRatio",void 0),_(this,"_connectInfo",void 0),_(this,"_cancelTokenSource",Wi.CancelToken.source()),_(this,"_retryConfig",void 0),_(this,"wmSequence",0),_(this,"inspectInterval",void 0),_(this,"inspectTimer",null),_(this,"ossFilePrefix",void 0),_(this,"extraInfo",void 0),_(this,"_inspectType",void 0),_(this,"_inspectMode",void 0),_(this,"_quality",1),_(this,"qualityTimer",null),_(this,"_inspectId",void 0),_(this,"_needWorkUrlOnly",!1),_(this,"inspectImage",()=>{if(this.connectionState!==li.CONNECTED)throw new N(I.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===li.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ht(5,"inspect-"),this.workerMessageLengthLimit=k("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=k("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=k("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new ga("worker-manager-"+this._inspectId,jt),this.on(xt.STATE_CHANGE,(n,i)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ui[n]," ").concat(i||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new ga("worker-"+this._inspectId,jt),this.handleWorkerEvents()}async init(t,n){this.emit(xt.STATE_CHANGE,ui.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new re((o,a)=>{this.on(xt.CONNECTION_STATE_CHANGE,(c,l)=>{l===li.CONNECTED&&o()}),this.requestAP(t,i,n).then(c=>{this.connectWorkerManager(c)}).catch(c=>{a(c)})})}async requestAP(t,n,i){const o=k("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),a=await function(l,u,p,f){let{appId:m,areaCode:v,cname:R,sid:w,token:A,uid:O}=u;pm++;const U="image_moderation_api",x={service_name:U,json_body:JSON.stringify({appId:m,areaCode:v,cname:R,command:"allocateEdge",requestId:pm,seq:pm,sid:w,token:A,ts:Date.now(),uid:O+""})};let Q,pe,Z=l[0];return Ar(async()=>{Q=Date.now();const ee=await hr(Z,{data:x,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(pe=Date.now()-Q,ee.code!==0){const Ae=new N(I.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ee.code,{retry:!0,responseTime:pe});throw T.error(Ae.toString()),Ae}const J=JSON.parse(ee.json_body);if(J.code!==200){const Ae=new N(I.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:pe});throw T.error(Ae.toString()),Ae}if(!J.servers||!Array.isArray(J.servers)||J.servers.length===0){const Ae=new N(I.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:J.code,responseTime:pe});throw T.error(Ae.toString()),Ae}const se=k("VIDEO_INSPECT_WORKER_MANAGER_HOST"),tt=k("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:J.servers.map(Ae=>{let{address:lt,wss:it}=Ae;if(lt&&it)return"wss://".concat(lt.replace(/\./g,"-"),".").concat(se,":").concat(tt||it)}).filter(Ae=>!!Ae),workerToken:J.workerToken,vid:J.vid,responseTime:pe}},(ee,J)=>(ue.apworkerEvent(w,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify(ee.addressList),firstSuccess:J===0,responseTime:pe,serverIp:l[J%l.length]}),!1),(ee,J)=>(ue.apworkerEvent(w,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:U,responseTime:pe,serverIp:l[J%l.length]}),!!(ee.code!==I.OPERATION_ABORTED&&ee.code!==I.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&(Z=l[(J+1)%l.length],!0)),f)}(o,t,n,i);this.emit(xt.STATE_CHANGE,ui.AP_CONNECTED);const{addressList:c}=a;return this.wmSequence++,c}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(xt.STATE_CHANGE,ui.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Oe.CONNECTED,async()=>{this.emit(xt.STATE_CHANGE,ui.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.17.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Oe.CLOSED,()=>{this._innerConnectionState<ui.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Oe.FAILED,()=>{this._innerConnectionState<ui.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Oe.RECONNECTING,()=>{this._innerConnectionState<ui.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Oe.ON_MESSAGE,async t=>{this.emit(xt.STATE_CHANGE,ui.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new N(I.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new N(I.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const o=k("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(o));this.emit(xt.STATE_CHANGE,ui.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(xt.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(Oe.WILL_RECONNECT,(t,n)=>{n(t)}),this.workerManagerConnection.on(Oe.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Oe.CONNECTED,async()=>{this.emit(xt.STATE_CHANGE,ui.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=li.CONNECTED}),this.workerConnection.on(Oe.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const i=gj(new Uint8Array(t.data));if(k("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(xt.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const o={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},a=fo(n=Object.keys(o)).call(n,(l,u)=>o[l]>o[u]?l:u,"porn"),c=Object.keys(o).find(l=>l===a);this.emit(xt.INSPECT_RESULT,c)}else this.emit(xt.INSPECT_RESULT,void 0,new N(I.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(xt.INSPECT_RESULT,void 0,new N(I.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(xt.INSPECT_RESULT,void 0,new N(I.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Oe.CLOSED,()=>{this.connectionState=li.CLOSED}),this.workerConnection.on(Oe.FAILED,()=>{this.connectionState=li.CLOSED}),this.workerConnection.on(Oe.RECONNECTING,()=>{this.connectionState=this.connectionState===li.CONNECTED?li.RECONNECTING:li.CONNECTING}),this.workerConnection.on(Oe.WILL_RECONNECT,(t,n)=>{t==="recover"&&n(t),n("tryNext")}),this.workerConnection.on(Oe.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(xt.REQUEST_NEW_WORKER_URL,i=>{t([i])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i=>{this.connectWorkerManager(i,!0)}).catch(i=>{n(i)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=br(this,xt.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(xt.INSPECT_RESULT,void 0,new N(I.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(xt.INSPECT_RESULT,void 0,new N(I.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:o,cid:a,vid:c,sid:l,uid:u}=n;const p=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),m=await(async(A,O,U)=>await Cj(A.buffer,O,U))(f,i,o),v=this.sequence+"-"+a+"-"+u+"-"+p+"-"+ht(12,""),R={appId:i,cid:a,cname:o,deviceId:"",elapse:du.intToLong(Number(p-this.inspectStartTime)),fileSize:m.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:m,networkType:6,osType:7,requestId:v,sdkVersion:"4.17.2",sequence:this.sequence,sid:l,timestamp:du.intToLong(p),uid:u,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete R.callbackData,this.ossFilePrefix===void 0&&delete R.ossFilePrefix;const w=_j(R);if(w.byteLength<this.workerMessageLengthLimit){if(k("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const A=function(O){for(var U=1;U<arguments.length;U++){var x=arguments[U]!=null?arguments[U]:{};U%2?QA(Object(x),!0).forEach(function(Q){_(O,Q,x[Q])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(x)):QA(Object(x)).forEach(function(Q){Object.defineProperty(O,Q,Object.getOwnPropertyDescriptor(x,Q))})}return O}({},R);delete A.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(A))}return w}{const A=this.quality*this.qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:i,cname:o,cid:a,vid:c,sid:l,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Wi.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=li.CLOSED,this.emit(xt.STATE_CHANGE,ui.CLOSED)}}var $A,ZA,ew,tw,nw,iw,rw,ow,sw,aw,cw,dw,lw,uw,hw,pw,fw,mw,Ew,_w,gw,Sw,vw,Tw,Rw,yw,Iw,Cw,Aw,ww,Ow,Nw,bw,Dw,Pw,kw,Lw,Mw,te;function Uw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function jc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Uw(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Uw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}let wj=($A=_e(),ZA=_e({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),t.map(n=>n?Object(n).toString():"null"))}),ew=_e({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId()))}),tw=_e({argsMap:(e,t,n)=>[t.uid,n]}),nw=_e({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return[i==null?void 0:i.uid,o]})}),iw=_e({argsMap:(e,t,n)=>[t.uid,n]}),rw=_e({argsMap:(e,t)=>t.map(n=>{let{user:i,mediaType:o}=n;return{uid:i==null?void 0:i.uid,mediaType:o}})}),ow=_e(),sw=_e(),aw=_e(),cw=_e(),dw=_e(),lw=_e(),uw=_e(),hw=_e(),pw=_e(),fw=_e(),mw=_e(),Ew=_e(),_w=_e(),gw=_e(),Sw=_e({argsMap:(e,t)=>[t]}),vw=_e(),Tw=_e(),Rw=_e(),yw=_e(),Iw=_e(),Cw=_e(),Aw=_e(),ww=_e(),Ow=_e(),Nw=_e(),bw=_e({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),Dw=_e(),Pw=_e(),kw=_e(),Lw=_e({reportResult:!0}),Mw=_e(),H((te=class extends Rt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),_(this,"store",void 0),_(this,"_uid",void 0),_(this,"_channelName",void 0),_(this,"_uintUid",void 0),_(this,"_users",[]),_(this,"_codec",void 0),_(this,"_mode",void 0),_(this,"_config",void 0),_(this,"_clientId",void 0),_(this,"_appId",void 0),_(this,"_sessionId",null),_(this,"_key",void 0),_(this,"_joinInfo",void 0),_(this,"_gateway",void 0),_(this,"_statsCollector",void 0),_(this,"_configDistribute",void 0),_(this,"_leaveMutex",new On("client-leave")),_(this,"_publishMutex",new On("client-publish")),_(this,"_renewTokenMutex",new On("client-renewtoken")),_(this,"_subscribeMutex",new On("client-subscribe")),_(this,"_encryptionMode","none"),_(this,"_encryptionSecret",null),_(this,"_encryptionSalt",null),_(this,"_proxyServer",void 0),_(this,"_turnServer",{servers:[],mode:"auto"}),_(this,"_cloudProxyServerMode","disabled"),_(this,"_isDualStreamEnabled",!1),_(this,"_defaultStreamFallbackType",void 0),_(this,"_lowStreamParameter",void 0),_(this,"_streamFallbackTypeCacheMap",new Map),_(this,"_remoteStreamTypeCacheMap",new Map),_(this,"_axiosCancelSource",Wi.CancelToken.source()),_(this,"_audioVolumeIndicationInterval",void 0),_(this,"_networkQualityInterval",void 0),_(this,"_userOfflineTimeout",void 0),_(this,"_streamRemovedTimeout",void 0),_(this,"_injectStreamingClient",void 0),_(this,"_liveTranscodeStreamingClient",void 0),_(this,"_liveRawStreamingClient",void 0),_(this,"_channelMediaRelayClient",void 0),_(this,"_networkQualitySensitivity","normal"),_(this,"_p2pChannel",void 0),_(this,"_useLocalAccessPoint",!1),_(this,"_setLocalAPVersion",void 0),_(this,"_joinAndNotLeaveYet",!1),_(this,"_numberOfJoinCount",0),_(this,"_remoteDefaultVideoStreamType",void 0),_(this,"_inspect",void 0),_(this,"_license",void 0),_(this,"_handleLocalTrackEnable",(n,i,o)=>{this.publish(n,!1).then(i).catch(o)}),_(this,"_handleLocalTrackDisable",(n,i,o)=>{this.unpublish(n).then(i).catch(o)}),_(this,"_handleUserOnline",n=>{if(k("BLOCK_LOCAL_CLIENT")&&ps(n.uid,this.channelName))return void T.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const i=this._users.find(o=>o.uid===n.uid);if(i)i._trust_in_room_=!0;else{const o=new _m(n.uid,n.uint_id||n.uid);this._users.push(o),T.debug("[".concat(this._clientId,"] user online"),n.uid),this.emit(Pe.USER_JOINED,o)}}),_(this,"_handleUserOffline",n=>{if(k("BLOCK_LOCAL_CLIENT")&&ps(n.uid,this.channelName))return;const i=this._users.find(o=>o.uid===n.uid);i&&(this._handleRemoveStream(n),sm(this._users,i),this._remoteStreamTypeCacheMap.delete(i.uid),this._streamFallbackTypeCacheMap.delete(i.uid),T.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.emit(Pe.USER_LEAVED,i,n.reason))}),_(this,"_handleAddAudioOrVideoStream",(n,i,o,a,c,l,u)=>{if(k("BLOCK_LOCAL_CLIENT")&&ps(i,this.channelName))return;const p=this._users.find(m=>m.uid===i);if(!p)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(i,", type ").concat(n)),this.store.subscribe(p.uid,n,void 0,void 0,void 0,Date.now());const f=n==="audio"?p.hasAudio:p.hasVideo;p._uintid||(p._uintid=c||i),n==="audio"?p._trust_audio_stream_added_state_=!0:p._trust_video_stream_added_state_=!0,n==="audio"?(p._audio_added_=!0,o!==void 0&&(p._audioSSRC=o),a!==void 0&&(p._cname=a),l&&(p._audioOrtc=l)):(p._video_added_=!0,o!==void 0&&(p._videoSSRC=o),a!==void 0&&(p._cname=a),u!==void 0&&(p._rtxSsrcId=u),l&&(p._videoOrtc=l)),(n==="audio"?p.hasAudio:p.hasVideo)&&!f&&(T.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published ").concat(n)),this.emit(Pe.USER_PUBLISHED,p,n)),n==="video"?ue.onGatewayStream(this._sessionId,ln.ON_ADD_VIDEO_STREAM,Et.ON_ADD_VIDEO_STREAM,{peer:c||i}):ue.onGatewayStream(this._sessionId,ln.ON_ADD_AUDIO_STREAM,Et.ON_ADD_AUDIO_STREAM,{peer:c||i}),this._p2pChannel.remoteMediaSsrcChanged(p,n,o).then(m=>{if(m)return T.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(p.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(p,n,!0).then(()=>this._subscribe(p,n,!0).catch(v=>{T.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(p,n)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(p.uid," after reconnect.")),this._subscribe(p,n,!0).catch(m=>{T.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),_(this,"_handleRemoveStream",n=>{if(k("BLOCK_LOCAL_CLIENT")&&ps(n.uid,this.channelName))return;const i=this._users.find(a=>a.uid===n.uid);if(!i)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let o=()=>{};i.hasAudio&&i.hasVideo?o=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.emit(Pe.USER_UNPUBLISHED,i,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.emit(Pe.USER_UNPUBLISHED,i,"video")}:i.hasVideo?o=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.emit(Pe.USER_UNPUBLISHED,i,"video")}:i.hasAudio&&(o=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.emit(Pe.USER_UNPUBLISHED,i,"audio")}),i._trust_audio_stream_added_state_=!0,i._trust_video_stream_added_state_=!0,i._audio_added_=!1,i._video_added_=!1,this._p2pChannel.unsubscribe(i).then(a=>{if(a)return this._gateway.unsubscribe(a,i.uid)}),i._audioSSRC=void 0,i._videoSSRC=void 0,i._audioOrtc=void 0,i._videoOrtc=void 0,i._rtxSsrcId=void 0,ue.onGatewayStream(this._sessionId,ln.ON_REMOVE_STREAM,Et.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),o()}),_(this,"_handleSetStreamLocalEnable",(n,i,o)=>{if(k("BLOCK_LOCAL_CLIENT")&&ps(i,this.channelName))return;const a=this._users.find(u=>u.uid===i);if(!a)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(o?"enabled":"disabled"," with uid ").concat(i));const c=n==="audio"?a.hasAudio:a.hasVideo;if(n==="audio"){a._trust_audio_enabled_state_=!0;const u=a._audio_enabled_;if(a._audio_enabled_=o,a._audio_enabled_===u)return;{const p=a._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(i,", msg: ").concat(p)),this.emit(Pe.USER_INFO_UPDATED,i,p)}}else{a._trust_video_enabled_state_=!0;const u=a._video_enabled_;if(a._video_enabled_=o,a._video_enabled_===u)return;{const p=a._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(p)),this.emit(Pe.USER_INFO_UPDATED,i,p)}}const l=n==="audio"?a.hasAudio:a.hasVideo;return c!==l?!c&&l?(T.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(n)),void this.emit(Pe.USER_PUBLISHED,a,n)):(n==="video"&&a._videoTrack&&a._videoTrack._destroy(),n==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,n),T.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(n)),void this.emit(Pe.USER_UNPUBLISHED,a,n)):void 0}),_(this,"_handleMuteStream",(n,i,o)=>{if(k("BLOCK_LOCAL_CLIENT")&&ps(n,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),n,i,o);const a=this._users.find(u=>u.uid===n);if(!a)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const c=i==="audio"?a.hasAudio:a.hasVideo;if(i==="audio"){a._trust_audio_mute_state_=!0;const u=a._audio_muted_;if(a._audio_muted_=o,a._audio_muted_===u)return;{const p=a._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(p)),this.emit(Pe.USER_INFO_UPDATED,n,p)}}else{a._trust_video_mute_state_=!0;const u=a._video_muted_;if(a._video_muted_=o,a._video_muted_===u)return;{const p=a._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(p)),this.emit(Pe.USER_INFO_UPDATED,n,p)}}const l=i==="audio"?a.hasAudio:a.hasVideo;if(c!==l){if(!c&&l)return(i==="audio"?a._audioSSRC:a._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(i)),void this.emit(Pe.USER_PUBLISHED,a,i)):void T.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(i," unmute message  before add stream message, ").concat(i," SSRC doesn't exist yet."));i==="video"&&a._videoTrack&&a._videoTrack._destroy(),i==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,i),T.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(i)),this.emit(Pe.USER_UNPUBLISHED,a,i)}}),_(this,"_handleP2PLost",async n=>{T.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():T.warning("P2PLost stream not found",n)}),_(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(Pe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),_(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),_(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(Pe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit(Pe.NETWORK_QUALITY,n)}),this._codec=e.codec,this._mode=e.mode,this._clientId=ht(5,"client-"),this.store=new mj(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ci," build: ").concat(Tf,", mode: ").concat(this._mode,", codec: ").concat(this._codec)),e.clientRoleOptions)try{IR(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(n){T.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new ma(this.store),this._statsCollector.onStatsException=(n,i,o)=>{T.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(i,", uid: ").concat(o)),this.emit(Pe.EXCEPTION,{code:n,msg:i,uid:o})},this._statsCollector.onUploadPublishDuration=(n,i,o,a)=>{const c=this._users.find(l=>l.uid===n);c&&ue.peerPublishStatus(this._sessionId,{subscribeElapse:a,audioPublishDuration:i,videoPublishDuration:o,peer:c._uintid})},this.store.useDataChannel=Zt().supportDataChannel&&k("SIGNAL_CHANNEL"),this._gateway=new ZV(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:e.websocketRetryConfig||jt,httpRetryConfig:e.httpRetryConfig||jt,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._config=e,this._configDistribute=new c2,this._p2pChannel=new fj(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(e,t,n,i,o){const a=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=Ej(),l=WA()?window.isSecureContext:"Browser Not Support";if(!WA()&&!c||!window.isSecureContext){const R="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";T.warning(R)}const u=om();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const p=ue.reportApiInvoke(u,{name:Lt.JOIN,options:[e,t,n,i],states:{isHttps:c,isSecureContext:l},tag:mt.TRACER});ue.setAppId(e);try{if(!n&&n!==null)throw new N(I.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&cn(n,"token",1,2047),cn(e,"appid",1,2047),Df(t),i&&Pf(i),o&&cn(o,"optionalInfo",1,2047)}catch(R){throw p.onError(R),R}if(T.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const R=new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw p.onError(R),R}this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const f=jc({clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:o,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(f.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(f.stringUid=i,this._uintUid?(f.uid=this._uintUid,this._uintUid=void 0):f.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(f.aesmode=this._encryptionMode,f.aespassword=await(async R=>{const w=am(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),A=await window.crypto.subtle.importKey("spki",w,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),O=Jf(R),U=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},A,O);return Hl(new Uint8Array(U))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(f.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:t,appId:e});const m=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&m===this._sessionId&&ue.joinChannelTimeout(this._sessionId,5)},5e3);try{let R;const w=f.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(w)){const x=k("PROXY_SERVER_TYPE3");Array.isArray(x)?f.proxyServer=x[0]:f.proxyServer=x}if(ue.setProxyServer(f.proxyServer),T.setProxyServer(f.proxyServer),this.store.requestAPStart(),f.stringUid&&!f.uid){const x=await OI(f.stringUid,f,this._axiosCancelSource.token,this._config.httpRetryConfig||jt,this.store);T.debug("getUserAccount Success ".concat(f.stringUid," => ").concat(x)),f.uid=x,R=await wI(f,this._axiosCancelSource.token,this._config.httpRetryConfig||jt,!0,this.store)}else R=await wI(f,this._axiosCancelSource.token,this._config.httpRetryConfig||jt,!0,this.store);if(!this._joinAndNotLeaveYet)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(f,this._axiosCancelSource.token),this._configDistribute.on(vc.UPDATE_BITRATE_LIMIT,x=>{this._p2pChannel.updateBitrateLimit(x)})},0),this._key=n||e;const A=R.gatewayInfo;this._joinInfo=jc(jc({},f),{},{cid:A.cid,uid:f.uid?f.uid:A.uid,vid:A.vid,apResponse:A.res,uni_lbs_ip:A.uni_lbs_ip,gatewayAddrs:A.gatewayAddrs});const O=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));p.onSuccess(O),this._appId=e,this._channelName=f.cname,this._uid=O,this.store.uid=O,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(yn()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const U=f.stringUid?"string uid: ".concat(f.stringUid,",uid: ").concat(f.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(U)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),v=this,hs.includes(v)||hs.push(v),O}catch(R){const w=Array.isArray(R)?R[0]:R;throw T.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),w),w.code!==I.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),p.onError(w),w}var v}_joinGateway(){if(!this._joinInfo||!this._key)throw new N(I.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!k("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===I.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Ke.FALLBACK),e;if(e.code===I.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Ke.FALLBACK),e;throw e}).then(e=>{if(e instanceof N){if(e.code===I.INIT_WEBSOCKET_TIMEOUT){if(T.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new N(I.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=k("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const i=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),o=i.slice(i.length-2).join(".");t.forEach(a=>{this._joinInfo&&a.includes(o)&&(this._joinInfo.proxyServer=a)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const n=k("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return n&&n[1]&&n[1]!=="443"&&T.setProxyServer(this._joinInfo.proxyServer),k("STATS_COLLECTOR_PORT").toString()!=="443"&&ue.setProxyServer(this._joinInfo.proxyServer),ue.reportApiInvoke(this._sessionId,{name:Lt.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:mt.TRACER}).onSuccess(),this.emit(Pe.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),k("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(i=>{"forceturn"in i&&(i.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(T.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new N(I.INVALID_OPERATION);return ue.reportApiInvoke(this._sessionId,{name:Lt.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:mt.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(yn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=hs.indexOf(t);n!==-1&&hs.splice(n,1)}(this);const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(e)||(e=[e]),e.length===0)throw new N(I.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new N(I.INVALID_OPERATION,"audience can not publish stream");for(const i of e){if(!(i instanceof Xf))throw new N(I.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new N(I.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(e.map(i=>"".concat(i.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),t&&e.forEach(i=>{const o=this._configDistribute.getBitrateLimit();i instanceof Dt&&o&&i.setBitrateLimit(o.uplink)});const n=await this._publishMutex.lock();try{await this._publishHighStream(e),T.info("[".concat(this._clientId,"] Publish success, id ").concat(e.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw T.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new N(I.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");e?Array.isArray(e)||(e=[e]):e=this._p2pChannel.getAllTracks(!0),T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(n=>"".concat(n.getTrackId()," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublish(e);n&&await this._gateway.unpublish(n,this._uid),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(i=>"".concat(i.getTrackId()))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t){return this._subscribe(e,t)}async _subscribe(e,t,n){if(qt(t,"mediaType",["audio","video"]),!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new N(I.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new N(I.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const u=new N(I.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),u}const i=t==="audio"?e._audioSSRC:e._videoSSRC,o=t==="audio"?e._audioOrtc:e._videoOrtc,a=t==="video"?e._rtxSsrcId:void 0,c={stream_type:t==="audio"?we.AUDIO:we.VIDEO,ssrcId:i},l=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{wi.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,a,o);try{await this._gateway.subscribe(e.uid,c,!0)}catch(p){if((p==null?void 0:p.code)!==I.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),p;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(p){throw this._p2pChannel.reportSubscribeEvent(!1,p==null?void 0:p.code,e,t),p}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(p=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),p)});const u=t==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new N(I.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{l()}}async massSubscribe(e){if(Kr(e,"subscribeList"),!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:u,mediaType:p}=l;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(p)}).join("; ")));const o=(e=[...e]).map(l=>{let{user:u,mediaType:p}=l;return{user:u,mediaType:p}}),a=await this._p2pChannel.globalLock();try{var c;for(let u=e.length-1;u>=0;u--){const p=e[u],{user:f,mediaType:m}=p;if(qt(m,"mediaType",["audio","video"]),!f){const w=new N(I.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),w}if(!this._users.find(w=>w===f)){const w=new N(I.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),o[u].error=w,e.splice(u,1);continue}if(m==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||m==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){const w=new N(I.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(m,", remote user is not published")),o[u].error=w,e.splice(u,1);continue}const v=Ot.Video|Ot.LwoVideo,R=n.get(f);if(R){if(m==="video"?R&v:R&Ot.Audio){e.splice(u,1),T.warning("repeat massSubscribe user:".concat(f.uid,", mediaType:").concat(m," twice"));continue}n.set(f,R|(m==="video"?v:Ot.Audio))}else n.set(f,m==="video"?v:Ot.Audio)}for(let u=e.length-1;u>=0;u--){const p=e[u],{user:f,mediaType:m}=p,v=Ot.Video|Ot.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,m)){await this._p2pChannel.unmuteRemoteNoLock(f,m);const R=n.get(f);n.set(f,m==="video"?R^v:R^Ot.Audio),e.splice(u,1)}}this.store.massSubscribe(e.map(u=>({userId:u.user.uid,type:u.mediaType})),t);const l=fo(c=Array.from(n.entries())).call(c,(u,p)=>{let[f,m]=p;if(m===0)return u;const v={stream_id:f.uid,stream_type:m};return m&Ot.Audio&&(v.audio_ssrc=f._audioSSRC),m&Ot.Video&&(v.video_ssrc=f._videoSSRC),u.push(v),u},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(p=>{let{user:f,mediaType:m}=p;return{user:f,mediaType:m,ssrcId:m===we.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:f._rtxSsrcId}}));const u=new Map;if(l.length>0){const p=await this._gateway.subscribeAll(l,!0);((p==null?void 0:p.users)||[]).forEach(f=>{let{stream_id:m,video_error_code:v,audio_error_code:R,error_code:w}=f;(v||R||w)&&u.set(m,{video_error_code:v,audio_error_code:R,error_code:w})})}if(Array.from(u.entries()).length>0){const p=Array.from(u.entries()).map(f=>{let m,[v,R]=f;return R.error_code||R.video_error_code&&R.audio_error_code?m=void 0:R.video_error_code?m=we.VIDEO:R.audio_error_code&&(m=we.AUDIO),{user:this.remoteUsers.find(w=>w.uid===v),mediaType:m}});await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of o){const f=u.get(p.user.uid);if(f){const m=f.error_code||p.mediaType==="audio"&&f.audio_error_code||p.mediaType==="video"&&f.video_error_code;if(m){const v=Ic(m);T.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(v.desc)),p.error=new N(I.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(v.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(o.filter(p=>!p.error).map(p=>({userId:p.user.uid,type:p.mediaType})),void 0,Date.now()),o.forEach(p=>{var f;ue.subscribe(this.store.sessionId,{succ:!!p.error,ec:((f=p.error)===null||f===void 0?void 0:f.code)||null,video:p.mediaType===we.VIDEO,audio:p.mediaType===we.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===we.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(p=>{let{user:f,mediaType:m}=p;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(m)}).join("; "))),o}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(e),u}}finally{a(),i()}}async unsubscribe(e,t){if(t&&qt(t,"mediaType",["audio","video"]),!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(n=>n===e)){const n=new N(I.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),n}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));try{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}catch(n){if(n.code===I.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),n.toString()),n}}async massUnsubscribe(e){if(Kr(e,"unsubscribeList"),!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:o}=e[n];if(!i){const c=new N(I.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),c}if(qt(o,"mediaType",["video","audio",void 0]),!this._users.find(c=>c===i)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const a=Ot.Video|Ot.LwoVideo;if(t.has(i)){const c=t.get(i);let l;switch(o){case"video":l=c&a;break;case"audio":l=c&Ot.Audio;break;default:l=c&(Ot.Audio|a)}if(l){T.warning("repeat massUnsubscribe user:".concat(i.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(i,c|Ot.Audio):o==="video"&&t.set(i,c|a):t.set(i,c|Ot.Audio|a)}else o?o==="audio"?t.set(i,Ot.Audio):o==="video"&&t.set(i,a):t.set(i,Ot.Audio|a)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(i=>{let{user:o,mediaType:a}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===I.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}setLowStreamParameter(e){(function(n){if(!n)throw new N(I.INVALID_PARAMS);ut(n.width)||bf(n.width,"streamParameter.width"),ut(n.height)||bf(n.height,"streamParameter.height"),ut(n.framerate)||bf(n.framerate,"streamParameter.framerate"),ut(n.bitrate)||dt(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e}async enableDualStream(){if(!Zt().supportDualStream)throw ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new N(I.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new N(I.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new N(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(oe.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,ue.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){qt(n,"role",["audience","host"])}(e),t&&IR(t),this._mode==="rtc")throw T.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new N(I.INVALID_OPERATION,"rtc mode can not use setClientRole");if(t&&t.level&&e==="host")throw new N(I.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new N(I.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),T.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}setProxyServer(e,t){if(cn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new N(I.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,ue.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new N(I.INVALID_OPERATION,"You have already set the proxy")}if(Sc(e))return this._turnServer={servers:e,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>yR(n)),this._turnServer={servers:e,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"you should set license before join channel");if(cn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new N(I.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,T.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new N(I.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new N(I.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new N(I.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new N(I.INVALID_OPERATION,"Stop proxy server after leave channel");ue.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new N(I.INVALID_PARAMS,"accessPoints is required.");Kr(e.accessPoints.serverList,"accessPoints.serverList"),cn(e.accessPoints.domain,"accessPoints.domain");const t=(v,R)=>{dt(v,R,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new N(I.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");k("CLOSE_AFB_FOR_LOCAL_AP")&&(et("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),et("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,a=e.accessPoints.serverList.map(v=>i.test(v)?"".concat(v.replace(/\./g,"-"),".").concat(o):v),c=a.map(v=>"".concat(v,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,et("WEBCS_DOMAIN",c),et("WEBCS_DOMAIN_BACKUP_LIST",c),et("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Kr(e.report.hostname,"report.hostname"),et("EVENT_REPORT_DOMAIN",e.report.hostname[0]),et("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(et("EVENT_REPORT_DOMAIN",a[0]),et("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),et("STATS_COLLECTOR_PORT",l),e.report?et("ENABLE_EVENT_REPORT",!0):et("ENABLE_EVENT_REPORT",!1);let u="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Kr(e.log.hostname,"log.hostname"),u=e.log.hostname[0]):u=a[0];let p=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),p=e.log.port),et("LOG_UPLOAD_SERVER","".concat(u,":").concat(p));let f=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Kr(e.cds.hostname,"cds.hostname"),f=e.cds.hostname):f=a;let m=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),m=e.cds.port),et("CDS_AP",f.map(v=>"".concat(v,":").concat(m))),e.cds?et("ENABLE_CONFIG_DISTRIBUTE",!0):et("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Kr(e,"serverList"),cn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new N(I.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,et("WEBCS_DOMAIN",e),et("WEBCS_DOMAIN_BACKUP_LIST",e),et("GATEWAY_DOMAINS",[t]),et("EVENT_REPORT_DOMAIN",e[0]),et("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),et("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),T.info("set local access point success")}async setRemoteDefaultVideoStreamType(e){if(qt(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else T.debug("haven't joined yet, cache remoteDefaultVideoStreamType ".concat(e))}async setRemoteVideoStreamType(e,t){qt(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(i=>i.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){qt(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n){if(function(i){qt(i,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),cn(t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new N(I.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new N(I.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Hl(n))}async renewToken(e){if(cn(e,"token",1,2047),!this._key||!this._joinInfo)throw new N(I.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(k("USE_NEW_TOKEN")){T.debug("start renew token with ticket from unilbs");const i=await a2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||jt);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else T.debug("start renew token without ticket"),await this._gateway.renewToken({token:e});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,T.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.emit(Pe.VOLUME_INDICATOR,e)},k("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this._codec!=="h264")throw new N(I.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new N(I.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new N(I.LIVE_STREAMING_TASK_CONFLICT);const n=t?Mt.TRANSCODE:Mt.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Mt.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new N(I.INVALID_PARAMS,"can not find live streaming url to stop");await re.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new N(I.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(Mt.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,Mt.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(Mt.INJECT),n=Array.from(Or(e=t.streamingTasks).call(e)).find(i=>i.mode===Mt.INJECT);if(!this._joinInfo||!n)throw new N(I.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){UI(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){UI(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay()}sendStreamMessage(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new N(I.INVALID_OPERATION,"can not send data stream, not joined");if(typeof e=="string"&&(e=new TextEncoder().encode(e)),new Blob([e]).size>1024)throw new N(I.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(ge.DATA_STREAM,{payload:Hl(e)},!t)}sendMetadata(e){if(!this._joinInfo)throw new N(I.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new N(I.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ge.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Hl(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Tx),!this._joinInfo)throw new N(I.INVALID_OPERATION,"can not send custom report, not joined");await ue.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){qt(t.spatialLayer,"spatialLayer",[0,1,2,3]),qt(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Wi.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new On("client-publish"),this._subscribeMutex=new On("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}}_startSession(e,t){const n=e||om();e?T.debug("[".concat(this._clientId,"] new Session ").concat(n)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?ue.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:t.channel,appid:t.appId,mode:this._mode}):this._joinInfo?ue.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&ue.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new N(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&k("FORCE_TURN")&&!k("TURN_ENABLE_TCP")&&!k("TURN_ENABLE_UDP"))throw new N(I.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==I.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof Dt&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===I.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new N(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new N(I.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let o;try{o=await this._gateway.publish(this._uid,i,!0)}catch(a){if(a.code!==I.DISCONNECT_P2P)throw n.throw(a),a}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===I.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new N(I.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new l2(this._joinInfo,this._config.websocketRetryConfig||jt,this._config.httpRetryConfig||jt),n=i=>{i.onLiveStreamError=(o,a)=>{ue.reportApiInvoke(this._sessionId,{name:Lt.ON_LIVE_STREAM_ERROR,options:[o,a],tag:mt.TRACER}).onSuccess(),this.emit(Pe.LIVE_STREAMING_ERROR,o,a)},i.onLiveStreamWarning=(o,a)=>{ue.reportApiInvoke(this._sessionId,{name:Lt.ON_LIVE_STREAM_WARNING,options:[o,a],tag:mt.TRACER}).onSuccess(),this.emit(Pe.LIVE_STREAMING_WARNING,o,a)},i.on(da.REQUEST_WORKER_MANAGER_LIST,(o,a,c)=>{if(!this._joinInfo)return c(new N(I.INVALID_OPERATION,"can not find join info to get worker manager"));bI(o,this._joinInfo,this._axiosCancelSource.token,jt).then(a).catch(c)})};switch(e){case Mt.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Mt.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Mt.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(da.REQUEST_WORKER_MANAGER_LIST,(i,o,a)=>{if(!this._joinInfo)return a(new N(I.INVALID_OPERATION,"can not find join info to get worker manager"));bI(i,this._joinInfo,this._axiosCancelSource.token,jt).then(o).catch(a)}),this._injectStreamingClient.onInjectStatusChange=(i,o,a)=>{this.emit(Pe.INJECT_STREAM_STATUS,i,o,a)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new h2(this._joinInfo,this._clientId,this._config.websocketRetryConfig||jt,this._config.httpRetryConfig||jt),this._channelMediaRelayClient.on("state",e=>{e===Ln.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(Pe.CHANNEL_MEDIA_RELAY_STATE,e)}),this._channelMediaRelayClient.on("event",e=>{this.emit(Pe.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient):new N(I.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(ft.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ft.CONNECTION_STATE_CHANGE,(e,t,n)=>{var i;if(n===Ke.FALLBACK)return;const o=()=>{this.emit(Pe.CONNECTION_STATE_CHANGE,e,t,n)};if(ue.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Lt.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:mt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),T.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._audioSSRC=void 0,c._videoSSRC=void 0,c._videoOrtc=void 0,c._audioOrtc=void 0,c._cname=void 0,c._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((c,l)=>{this._gateway.setStreamFallbackOption(l,c).catch(u=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)})}),this._remoteStreamTypeCacheMap.forEach((c,l)=>{this._gateway.setRemoteVideoStreamType(l,c).catch(u=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(c=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(c=>!c._trust_in_room_).forEach(c=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(c=>{c._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,"audio",!1)),c._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,"video",!1)),c._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))}))},1e3)}o()}),this._gateway.on(ft.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new N(I.UNEXPECTED_ERROR,"can not recover, no join info"));fm(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||jt,this.store).then(n=>{this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip),e(n.gatewayInfo.gatewayAddrs.map(i=>{if(this._joinInfo&&this._joinInfo.proxyServer){const o=i.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(o[0],"&p=").concat(o[1])}return"wss://".concat(i.address)}))}).catch(t)}),this._gateway.on(ft.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.emit(Pe.NETWORK_QUALITY,e)}),this._gateway.on(ft.STREAM_TYPE_CHANGE,(e,t)=>{this.emit(Pe.STREAM_TYPE_CHANGED,e,t),ue.reportApiInvoke(this._sessionId,{name:Lt.STREAM_TYPE_CHANGE,options:[e,t],tag:mt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(ft.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(ft.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(ft.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(i){n(i)}}),this._gateway.on(ft.JOIN_RESPONSE,(e,t)=>{const{dtlsParameters:n,iceParameters:i,candidates:o,rtpCapabilities:a,setup:c,cname:l}=oA(e.ortc,t);this._p2pChannel.connect(i,n,o,a,c,l)}),this._gateway.on(ft.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(ft.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(ft.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(ft.DATACHANNEL_PRECONNECT,async(e,t,n,i)=>{var o,a,c,l,u,p;await this._p2pChannel.startP2PConnection({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},!0);const f=function(m,v){let R;return v&&v.ip&&typeof v.port=="number"?(R=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:v.ip,port:v.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(v.ip,":").concat(v.port)),v.ip6&&(R.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:v.ip6,port:v.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(v.ip6,":").concat(v.port)))):R=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:m.ip,port:m.port.toString(),type:"host",extension:{}}],R}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cid,"_").concat((c=this._joinInfo)===null||c===void 0?void 0:c.apResponse.cert),icePwd:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(p=k("FINGERPRINT"))!==null&&p!==void 0?p:e.fingerprint}]},f,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(i)})}_handleGatewaySignalEvents(){this._gateway.signal.on(be.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(be.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(be.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(be.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(be.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(be.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(be.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!0)),this._gateway.signal.on(be.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!1)),this._gateway.signal.on(be.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!0)),this._gateway.signal.on(be.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!1)),this._gateway.signal.on(be.RECEIVE_METADATA,e=>{const t=am(e.metadata);this.emit(Pe.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(be.ON_DATA_STREAM,e=>{e.seq&&delete e.seq,e.payload=am(e.payload),this.emit(Pe.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)}),this._gateway.signal.on(be.ON_CRYPT_ERROR,()=>{Rc(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.emit(Pe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(be.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(be.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.emit(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(be.ON_STREAM_FALLBACK_UPDATE,e=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.emit(Pe.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(be.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(be.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(be.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(le.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ge.PUBLISH:{if(!t)return;const c=(t=t).ortc;if(c){var n,i,o,a;const l=c.some(f=>{let{stream_type:m}=f;return m===Ut.Audio}),u=c.some(f=>{let{stream_type:m}=f;return m!==Ut.Audio}),p=c.some(f=>{let{stream_type:m}=f;return m===Ut.Screen||m===Ut.ScreenLow});t.state==="offer"&&ue.publish(this._joinInfo.sid,{eventElapse:wi.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:I.TIMEOUT,audio:l,video:u,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:p,audioName:l?(n=c.find(f=>{let{stream_type:m}=f;return m===Ut.Audio}))===null||n===void 0||(i=n.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:u?(o=c.find(f=>{let{stream_type:m}=f;return m!==Ut.Audio}))===null||o===void 0||(a=o.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case ge.SUBSCRIBE:(t=t)&&ue.subscribe(this._joinInfo.sid,{succ:!1,ec:I.TIMEOUT,audio:t.stream_type===we.AUDIO,video:t.stream_type===we.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:wi.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(be.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(be.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;k("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(i=>!ps(i.audio_ssrc,this.channelName)));const t=[],n=[];for(const i of e.users){let o=this._users.find(p=>p.uid===i.stream_id);o?o._trust_in_room_=!0:(o=new _m(i.stream_id,i.stream_id),this._users.push(o),this.getListeners(Pe.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.emit(Pe.USER_JOINED,o)));const a=Ot.Audio&i.stream_type,c=(Ot.Video|Ot.LwoVideo)&i.stream_type,l=a&&o.hasAudio,u=c&&o.hasVideo;c&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=i.video_ssrc),a&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=i.audio_ssrc),a&&!l&&this.getListeners(Pe.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.emit(Pe.USER_PUBLISHED,o,"audio")),c&&!u&&this.getListeners(Pe.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.emit(Pe.USER_PUBLISHED,o,"video")),(a&&!l||c&&!u)&&t.push(o),c&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(i=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())})),this.getListeners(Pe.PUBLISHED_USER_LIST).length>0?(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(i=>i.uid).join(", "))),this.emit(Pe.PUBLISHED_USER_LIST,t)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(i=>i.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(Fe.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===I.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Fe.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===I.DISCONNECT_P2P?t():n(i)}else t()}),this._p2pChannel.on(Fe.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Fe.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:i,kind:o}of e)o===we.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}}),this._p2pChannel.on(Fe.RequestUploadStats,(e,t)=>{this._gateway.uploadStats(e,t)}),this._p2pChannel.on(Fe.MediaReconnectStart,e=>{this.emit(Pe.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Fe.MediaReconnectEnd,e=>{this.emit(Pe.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Fe.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Fe.RequestRestartICE,async()=>{const e=await this._p2pChannel.restartICE(),t=await e.next();if(t.done)return;const n=t.value;let i;try{i=await this._gateway.restartICE({iceParameters:n})}catch(a){return void e.throw(a)}const{iceParameters:o}=function(a){const c=a.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}}(i);await e.next({remoteIceParameters:o})}),this._p2pChannel.on(Fe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Fe.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),{dtlsParameters:c,iceParameters:l,candidates:u,rtpCapabilities:p,setup:f,cname:m}=oA(o,a);await this._p2pChannel.connect(l,c,u,p,f,m),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Fe.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Fe.P2PLost,()=>{this.emit(Pe.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Fe.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Fe.ConnectionTypeChange,e=>{this.emit(Pe.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Fe.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Fe.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(n=>{if(!["supervise","moderation"].includes(n))throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(n," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new N(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new du(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},jt)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new N(I.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}handleVideoInspectEvents(e){e.on(xt.CONNECTION_STATE_CHANGE,(t,n)=>{switch(this.emit(Pe.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n){case li.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(Pe.CONTENT_INSPECT_ERROR,new N(I.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(xt.INSPECT_RESULT,(t,n)=>{var i;if((n==null?void 0:n.code)===I.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.emit(Pe.CONTENT_INSPECT_RESULT,t,n)}),e.on(xt.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){_c(e,"enabled"),et("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[$A],Object.getOwnPropertyDescriptor(te.prototype,"leave"),te.prototype),H(te.prototype,"publish",[ZA],Object.getOwnPropertyDescriptor(te.prototype,"publish"),te.prototype),H(te.prototype,"unpublish",[ew],Object.getOwnPropertyDescriptor(te.prototype,"unpublish"),te.prototype),H(te.prototype,"subscribe",[tw],Object.getOwnPropertyDescriptor(te.prototype,"subscribe"),te.prototype),H(te.prototype,"massSubscribe",[nw],Object.getOwnPropertyDescriptor(te.prototype,"massSubscribe"),te.prototype),H(te.prototype,"unsubscribe",[iw],Object.getOwnPropertyDescriptor(te.prototype,"unsubscribe"),te.prototype),H(te.prototype,"massUnsubscribe",[rw],Object.getOwnPropertyDescriptor(te.prototype,"massUnsubscribe"),te.prototype),H(te.prototype,"setLowStreamParameter",[ow],Object.getOwnPropertyDescriptor(te.prototype,"setLowStreamParameter"),te.prototype),H(te.prototype,"enableDualStream",[sw],Object.getOwnPropertyDescriptor(te.prototype,"enableDualStream"),te.prototype),H(te.prototype,"disableDualStream",[aw],Object.getOwnPropertyDescriptor(te.prototype,"disableDualStream"),te.prototype),H(te.prototype,"setClientRole",[cw],Object.getOwnPropertyDescriptor(te.prototype,"setClientRole"),te.prototype),H(te.prototype,"setProxyServer",[dw],Object.getOwnPropertyDescriptor(te.prototype,"setProxyServer"),te.prototype),H(te.prototype,"setTurnServer",[lw],Object.getOwnPropertyDescriptor(te.prototype,"setTurnServer"),te.prototype),H(te.prototype,"setLicense",[uw],Object.getOwnPropertyDescriptor(te.prototype,"setLicense"),te.prototype),H(te.prototype,"startProxyServer",[hw],Object.getOwnPropertyDescriptor(te.prototype,"startProxyServer"),te.prototype),H(te.prototype,"stopProxyServer",[pw],Object.getOwnPropertyDescriptor(te.prototype,"stopProxyServer"),te.prototype),H(te.prototype,"setLocalAccessPointsV2",[fw],Object.getOwnPropertyDescriptor(te.prototype,"setLocalAccessPointsV2"),te.prototype),H(te.prototype,"setLocalAccessPoints",[mw],Object.getOwnPropertyDescriptor(te.prototype,"setLocalAccessPoints"),te.prototype),H(te.prototype,"setRemoteDefaultVideoStreamType",[Ew],Object.getOwnPropertyDescriptor(te.prototype,"setRemoteDefaultVideoStreamType"),te.prototype),H(te.prototype,"setRemoteVideoStreamType",[_w],Object.getOwnPropertyDescriptor(te.prototype,"setRemoteVideoStreamType"),te.prototype),H(te.prototype,"setStreamFallbackOption",[gw],Object.getOwnPropertyDescriptor(te.prototype,"setStreamFallbackOption"),te.prototype),H(te.prototype,"setEncryptionConfig",[Sw],Object.getOwnPropertyDescriptor(te.prototype,"setEncryptionConfig"),te.prototype),H(te.prototype,"renewToken",[vw],Object.getOwnPropertyDescriptor(te.prototype,"renewToken"),te.prototype),H(te.prototype,"enableAudioVolumeIndicator",[Tw],Object.getOwnPropertyDescriptor(te.prototype,"enableAudioVolumeIndicator"),te.prototype),H(te.prototype,"startLiveStreaming",[Rw],Object.getOwnPropertyDescriptor(te.prototype,"startLiveStreaming"),te.prototype),H(te.prototype,"setLiveTranscoding",[yw],Object.getOwnPropertyDescriptor(te.prototype,"setLiveTranscoding"),te.prototype),H(te.prototype,"stopLiveStreaming",[Iw],Object.getOwnPropertyDescriptor(te.prototype,"stopLiveStreaming"),te.prototype),H(te.prototype,"addInjectStreamUrl",[Cw],Object.getOwnPropertyDescriptor(te.prototype,"addInjectStreamUrl"),te.prototype),H(te.prototype,"removeInjectStreamUrl",[Aw],Object.getOwnPropertyDescriptor(te.prototype,"removeInjectStreamUrl"),te.prototype),H(te.prototype,"startChannelMediaRelay",[ww],Object.getOwnPropertyDescriptor(te.prototype,"startChannelMediaRelay"),te.prototype),H(te.prototype,"updateChannelMediaRelay",[Ow],Object.getOwnPropertyDescriptor(te.prototype,"updateChannelMediaRelay"),te.prototype),H(te.prototype,"stopChannelMediaRelay",[Nw],Object.getOwnPropertyDescriptor(te.prototype,"stopChannelMediaRelay"),te.prototype),H(te.prototype,"sendCustomReportMessage",[bw],Object.getOwnPropertyDescriptor(te.prototype,"sendCustomReportMessage"),te.prototype),H(te.prototype,"pickSVCLayer",[Dw],Object.getOwnPropertyDescriptor(te.prototype,"pickSVCLayer"),te.prototype),H(te.prototype,"enableContentInspect",[Pw],Object.getOwnPropertyDescriptor(te.prototype,"enableContentInspect"),te.prototype),H(te.prototype,"disableContentInspect",[kw],Object.getOwnPropertyDescriptor(te.prototype,"disableContentInspect"),te.prototype),H(te.prototype,"getJoinChannelServiceRecords",[Lw],Object.getOwnPropertyDescriptor(te.prototype,"getJoinChannelServiceRecords"),te.prototype),H(te.prototype,"setPublishAudioFilterEnabled",[Mw],Object.getOwnPropertyDescriptor(te.prototype,"setPublishAudioFilterEnabled"),te.prototype),te);class Oj extends ZR{set currentState(t){t!==this._currentState&&(this._currentState=t,this.emit(Wn.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),_(this,"audioBuffer",void 0),_(this,"sourceNode",void 0),_(this,"startPlayTime",0),_(this,"startPlayOffset",0),_(this,"pausePlayTime",0),_(this,"options",void 0),_(this,"currentLoopCount",0),_(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const xw=new Map;async function Nj(e,t){let n=null;if(typeof e=="string"){const o=xw.get(e);if(o)return T.debug("use cached audio resource: ",e),o;try{n=(await Ar(()=>Wi.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(a){throw new N(I.FETCH_AUDIO_FILE_FAILED,a.toString())}}else n=await new re((a,c)=>{const l=new FileReader;l.onload=u=>{u.target?a(u.target.result):c(new N(I.READ_LOCAL_AUDIO_FILE_ERROR))},l.onerror=()=>{c(new N(I.READ_LOCAL_AUDIO_FILE_ERROR))},l.readAsArrayBuffer(e)});const i=await function(o){const a=ha();return new re((c,l)=>{a.decodeAudioData(o,u=>{c(u)},u=>{l(new N(I.DECODE_AUDIO_FILE_FAILED,u.toString()))})})}(n);return typeof e=="string"&&t&&xw.set(e,i),i}function Vw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,i)}return n}function lu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Vw(Object(n),!0).forEach(function(i){_(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vw(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function $m(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=lu(lu({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?T.debug("[".concat(e,"] set content hint to"),n.optimizationMode):T.debug("[".concat(e,"] set content hint failed")))):T.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const bj=Xe().name;function Dj(e,t,n,i){let o,a=0,c=null;return new re((l,u)=>{setTimeout(()=>{o&&(o(),l(a))},t),o=QR(()=>{(function(){a>i&&o&&(o(),l(a));const p=n.getContext("2d");if(!p){const v=new N(I.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(v.toString()),void u(v)}p.drawImage(e,0,0,160,120);const f=p.getImageData(0,0,n.width,n.height),m=Math.floor(f.data.length/3);if(c){for(let v=0;v<m;v+=3)if(f.data[v]!==c[v])return a+=1,void(c=f.data);c=f.data}else c=f.data})()},30)})}class Fc{constructor(t,n){_(this,"id",0),_(this,"element",void 0),_(this,"peerPair",void 0),_(this,"context",void 0),_(this,"audioPlayerElement",void 0),_(this,"audioTrack",void 0),Fc.count+=1,this.id=Fc.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,o)=>{const a=o==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(a),i.iceGatheringState==="complete"?i.localDescription:new re(c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}})},n=async(i,o)=>await i.setRemoteDescription(o);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(i){throw new N(I.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new N(I.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new N(I.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var jw,uu;_(Fc,"count",0);const Pj=window.AudioContext||window.webkitAudioContext,kj=new(jw=_e({report:ue}),H((uu=class{constructor(){_(this,"units",[]),_(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Pj);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Fc(e,this.context),this.units.push(t)),t.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Xe().name!==qe.SAFARI}}).prototype,"processExternalMediaAEC",[jw],Object.getOwnPropertyDescriptor(uu.prototype,"processExternalMediaAEC"),uu.prototype),uu);et("PROCESS_ID","process-".concat(ht(8,""),"-").concat(ht(4,""),"-").concat(ht(4,""),"-").concat(ht(4,""),"-").concat(ht(12,""))),function(){const e=Xe();wn.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),wn.getStreamFromExtension=e.name===qe.CHROME&&Number(e.version)>34,wn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),wn.supportMinBitrate=e.name===qe.CHROME||e.name===qe.EDGE,wn.supportSetRtpSenderParameters=function(){const t=Xe();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!cs()||!(!yn()&&!gl())||t.name===qe.FIREFOX&&Number(t.version)>=64}(),e.name===qe.SAFARI&&(Number(e.version)>=14?wn.supportDualStream=!0:wn.supportDualStream=!1),wn.webAudioMediaStreamDest=function(){const t=Xe();return!(t.name===qe.SAFARI&&Number(t.version)<12)}(),wn.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),wn.supportWebGL=typeof WebGLRenderingContext<"u",wn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,cs()||(wn.webAudioWithAEC=!0),wn.supportShareAudio=function(){const t=Xe();return(t.os===gn.WIN_10||t.os===gn.WIN_81||t.os===gn.WIN_7||t.os===gn.LINUX||t.os===gn.MAC_OS)&&t.name===qe.CHROME&&Number(t.version)>=74}(),wn.supportDualStreamEncoding=function(){const t=Xe();return k("DISABLE_WEBAUDIO")?!0:t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&k("CHROME_DUAL_STREAM_USE_ENCODING"))}(),wn.supportDataChannel=function(){return!!(ef(76)||function(t){const n=Xe();return!(n.name!==qe.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||function(t){const n=Xe();return!(n.name!==qe.SAFARI||!n.osVersion)&&Number(n.version)>=t}(14))}(),wn.supportPCSetConfiguration=!Tt()&&!!RTCPeerConnection.prototype.setConfiguration,T.info("browser compatibility",JSON.stringify(wn),JSON.stringify(e))}(),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();T.debug("Loading global parameters from cache",t),Object.keys(t).forEach(i=>{if(Object.prototype.hasOwnProperty.call(Bn,i)){const{value:o,expires:a}=t[i];if(a&&a<=n)return;us[i]=o,Bn[i]=o}})}catch(t){T.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(us.AREAS)&&us.AREAS.length>0&&lm(us.AREAS,!0);const Un={__CLIENT_LIST__:hs,__TRACK_LIST__:Ec,VERSION:Ci,BUILD:Tf,setParameter:(e,t,n)=>{T.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),et(e,t,n)},getParameter:k,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return e;t.close(),t=null,e=function(i){const o={video:[],audio:[]};return i.match(/ VP8/i)&&o.video.push("VP8"),i.match(/ VP9/i)&&o.video.push("VP9"),i.match(/ AV1/i)&&o.video.push("AV1"),i.match(/ H264/i)&&o.video.push("H264"),i.match(/ opus/i)&&o.audio.push("OPUS"),i.match(/ PCMU/i)&&o.audio.push("PCMU"),i.match(/ PCMA/i)&&o.audio.push("PCMA"),i.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new N(I.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=ue.reportApiInvoke(null,{name:Lt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:mt.TRACER});let t=!1;try{const a=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(a&&c&&l)}catch(a){return T.error("check system requirement failed: ",a),!1}let n=!1;const i=Xe();i.name===qe.CHROME&&Number(i.version)>=58&&(!qM()||YM())&&(n=!0),i.name===qe.FIREFOX&&Number(i.version)>=56&&(n=!0),i.name===qe.OPERA&&Number(i.version)>=45&&(n=!0),i.name===qe.SAFARI&&Number(i.version)>=11&&(n=!0),(IT()||Xe().name===qe.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",t,"browser",n);const o=t&&n;return e.onSuccess(o),o},getDevices:function(e){return fi.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return fi.getRecordingDevices(e)},getCameras:function(e){return fi.getCamerasDevices(e)},getElectronScreenSources:ty,getPlaybackDevices:function(e){return fi.getSpeakers(e)},createClient:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=ue.reportApiInvoke(null,{name:Lt.CREATE_CLIENT,options:[e],tag:mt.TRACER});try{yx(e)}catch(n){throw t.onError(n),n}return e.audioCodec===void 0&&(e.audioCodec="opus"),t.onSuccess(),new wj(jc(jc({forceWaitGatewayResponse:!0},e),{},{role:e.mode==="rtc"?"host":e.role}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CREATE_CAM_VIDEO_TRACK,options:[lu({},e)]}),n=ql(e),i=ht(8,"track-cam-");let o=null;T.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{o=(await zi({video:n},i)).getVideoTracks()[0]||null}catch(c){throw t.onError(c),c}if(!o){const c=new N(I.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw()}e.optimizationMode&&$m(i,o,e,ls(e.encoderConfig));const a=new yC(o,e,n,e.scalabiltyMode?Nl(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return t.onSuccess(a.getTrackId()),T.info("create camera video success, trackId:",i),a},createCustomVideoTrack:function(e){const t=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new Dt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?Nl(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,ht(8,"track-cus-"),[Ft.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),T.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CREATE_SCREEN_VIDEO_TRACK,options:[lu({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const i=p2(e),o=ht(8,"track-scr-v-");let a=null,c=null;const l=Zt();if(!l.supportShareAudio&&t==="enable"){const f=new N(I.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(f),f.throw()}T.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{const f=await zi({screen:i,screenAudio:t==="auto"?l.supportShareAudio:t==="enable"},o);a=f.getVideoTracks()[0]||null,c=f.getAudioTracks()[0]||null}catch(f){throw n.onError(f),f}if(!a){const f=new N(I.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(f),f.throw()}if(!c&&t==="enable"){a&&a.stop();const f=new N(I.SHARE_AUDIO_NOT_ALLOWED);return n.onError(f),f.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&($m(o,a,e,e.encoderConfig&&yf(e.encoderConfig)),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const u=new Dt(a,e.encoderConfig?yf(e.encoderConfig):{},e.scalabiltyMode?Nl(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[Ft.SCREEN_TRACK]);if(!c)return n.onSuccess(u.getTrackId()),T.info("create screen video track success","video:",u.getTrackId()),u;const p=new pn(c,void 0,ht(8,"track-scr-a-"),!1,!0);return n.onSuccess([u.getTrackId(),p.getTrackId()]),T.info("create screen video track success","video:",u.getTrackId(),"audio:",p.getTrackId()),[u,p]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),i=ql(t),o=GI(e),a=ht(8,"track-mic-"),c=ht(8,"track-cam-");let l=null,u=null;T.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const m=await zi({audio:o,video:i},"".concat(a,"-").concat(c));l=m.getAudioTracks()[0],u=m.getVideoTracks()[0]}catch(m){throw n.onError(m),m}if(!l||!u){const m=new N(I.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(m),m.throw()}t.optimizationMode&&$m(c,u,t,ls(t.encoderConfig));const p=new jl(l,e,o,a),f=new yC(u,t,i,t.scalabiltyMode?Nl(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,c);return n.onSuccess([p.getTrackId(),f.getTrackId()]),T.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[p,f]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=GI(e),i=ht(8,"track-mic-");let o=null;T.info("start create microphone audio track with config",JSON.stringify(e),"trackId",i);try{o=(await zi({audio:n},i)).getAudioTracks()[0]||null}catch(c){throw t.onError(c),c}if(!o){const c=new N(I.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(c),c.throw()}const a=new jl(o,e,n,i);return t.onSuccess(a.getTrackId()),T.info("create microphone audio track success, trackId:",i),a},createCustomAudioTrack:function(e){const t=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new pn(e.mediaStreamTrack,e.encoderConfig?bl(e.encoderConfig):{},ht(8,"track-cus-"),!1,!0);return T.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){const t=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CREATE_BUFFER_AUDIO_TRACK,options:[e]});if(k("DISABLE_WEBAUDIO"))throw new N(I.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const n=ht(8,"track-buf-");T.info("start create buffer source audio track with config",JSON.stringify(e),"trackId",n);const i=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await Nj(e.source,e.cacheOnlineFile)}catch(c){return t.onError(c),c.throw()}const o=new Oj(e.source),a=new HV(i,o,e.encoderConfig?bl(e.encoderConfig):{},n);return T.info("create buffer source audio track success, trackId:",n),t.onSuccess(a.getTrackId()),a},setAppType:function(e){if(T.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw T.debug("Invalid appType"),new N(I.INVALID_PARAMS,"invalid app type",e);et("APP_TYPE",Math.floor(e))},setLogLevel:function(e){T.setLogLevel(e)},enableLogUpload:function(){k("USE_NEW_LOG")?et("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){k("USE_NEW_LOG")?et("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new MI},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof pn||e instanceof ou)){const u=new N(I.INVALID_TRACK,"the parameter is not a audio track");return n.onError(u),u.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof pn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let a=o,c=o;const l=Date.now();return new re(u=>{const p=setInterval(()=>{const f=e.getVolumeLevel();a=f>a?f:a,c=f<c?f:c;const m=a-c>1e-4,v=Date.now()-l;if(m||v>t){clearInterval(p);const R=m,w={duration:v,deviceLabel:i,maxVolumeLevel:a,result:R};T.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(w))),n.onSuccess(w),u(R)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=ue.reportApiInvoke(null,{tag:mt.TRACER,name:Lt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Dt||e instanceof ru)){const v=new N(I.INVALID_TRACK,"the parameter is not a video track");return n.onError(v),v.throw()}const i=4;t&&t<1e3&&(t=1e3);const o=e instanceof Dt?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),c=document.createElement("video");c.style.width="1px",c.style.height="1px",c.setAttribute("muted",""),c.muted=!0,c.setAttribute("playsinline",""),c.controls=!1,(yn()||gl())&&(c.style.opacity="0.01",c.style.position="fixed",c.style.left="0",c.style.top="0",document.body.appendChild(c)),c.srcObject=new MediaStream([a]),c.play();const l=document.createElement("canvas");l.width=160,l.height=120;let u=0,p=0;try{const v=Date.now();u=await Dj(c,t,l,i),p=Date.now()-v}catch(v){throw n.onError(v),v}bj===qe.SAFARI&&(c.pause(),c.remove()),c.srcObject=null;const f=u>i,m={duration:p,changedPicNum:u,deviceLabel:o,result:f};return T.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),f},setArea:lm,audioElementPlayCenter:ei,processExternalMediaAEC:function(e){kj.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach(t=>{const n=t;n.__registered__=!0,n.logger.hookLog=T.extLog,n.reporter.hookApiInvoke=ue.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(i=>{n.parameters[i]=k(i)})})},ChannelMediaRelayError:vo,ChannelMediaRelayEvent:ur,ChannelMediaRelayState:Ln,RemoteStreamFallbackType:Bf,RemoteStreamType:Ff,ConnectionDisconnectedReason:Ke,AudienceLatencyLevelType:Mf,AREAS:Ue},Zm=window||document;return Object.defineProperties(Un,{onAudioAutoplayFailed:{get:()=>hi.onAudioAutoplayFailed,set:e=>{hi.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>hi.onAutoplayFailed,set:e=>{hi.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Un._onSecurityPolicyViolation,set(e){if(Un._onSecurityPolicyViolation=e,!Zm)return;const t=i=>{if(!(i&&i.blockedURI&&Un.onSecurityPolicyViolation))return;const o=i.blockedURI;k("CSP_DETECTED_HOSTNAME_LIST").some(a=>o.includes(a))&&Un.onSecurityPolicyViolation&&typeof Un.onSecurityPolicyViolation=="function"&&Un.onSecurityPolicyViolation(i)},n=Un._cspEventHandlerPointer;n&&Zm.removeEventListener("securitypolicyviolation",n),e&&typeof e=="function"&&Zm.addEventListener("securitypolicyviolation",t),Un._cspEventHandlerPointer=t}}}),fi.on(zr.CAMERA_DEVICE_CHANGED,e=>{T.info("camera device changed",JSON.stringify(e)),Un.onCameraChanged&&Un.onCameraChanged(e)}),fi.on(zr.RECORDING_DEVICE_CHANGED,e=>{T.info("microphone device changed",JSON.stringify(e)),Un.onMicrophoneChanged&&Un.onMicrophoneChanged(e)}),fi.on(zr.PLAYOUT_DEVICE_CHANGED,e=>{T.debug("playout device changed",JSON.stringify(e)),Un.onPlaybackDeviceChanged&&Un.onPlaybackDeviceChanged(e)}),ei.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),hi.onAudioAutoplayFailed&&hi.onAudioAutoplayFailed()},xe.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),hi.onAudioAutoplayFailed&&hi.onAudioAutoplayFailed()}),window&&(window.__ARTC__=Un),Un})})(ub);var o3=ub.exports;const wd=QO(o3),pb=({role:r,appId:s,channel:d,uid:h})=>{const[E,S]=at.useState([]),[y,D]=at.useState(!1),[P,V]=at.useState([]),[X,W]=at.useState([]),B=at.useMemo(()=>wd.createClient({mode:"live",codec:"vp8",role:r}),[r]),fe=at.useCallback(async q=>{if(await B.join(s,d,null,h),D(!0),r==="host"&&q){const ce=[];for(const M of q)if(M.kind==="audioinput"){const L=await wd.createMicrophoneAudioTrack();L.setDevice(M.deviceId),L.setMuted(!1);const j=100;L.setVolume(j),ce.push(L),S(z=>[...z,{track:L,deviceId:M.deviceId,deviceName:M.label,volume:j,setVolume:ae=>{L.setVolume(ae),S(ie=>ie.map(Ee=>Ee.deviceId===M.deviceId?{...Ee,volume:ae}:Ee))},muted:L.muted,setMuted:ae=>{L.setMuted(ae),S(ie=>ie.map(Ee=>Ee.deviceId===M.deviceId?{...Ee,muted:ae}:Ee))},volumeLevel:L.getVolumeLevel()}])}await B.publish([...ce])}},[s,d,B,r,h]),Y=at.useCallback(async()=>{E.forEach(({track:q})=>{q.stop(),q.close()}),S([]),V([]),D(!1),await B.leave()},[B,E]);return at.useEffect(()=>{const q=[...X.filter(ce=>P.find(M=>ce.uid===M.uid))];W([...X.filter(ce=>P.find(M=>ce.uid===M.uid))]),P.forEach(ce=>{const M=ce.audioTrack;M&&!X.find(L=>L.uid===ce.uid)&&q.push({track:M,uid:ce.uid,volume:100,setVolume:L=>{M.setVolume(L),W(j=>j.map(z=>z.uid===ce.uid?{...z,volume:L}:z))},muted:!1,setMuted:(L,j)=>{M.setVolume(L?0:j),W(z=>z.map(ae=>ae.uid===ce.uid?{...ae,muted:L}:ae))},volumeLevel:M.getVolumeLevel()})}),W(q)},[P]),at.useEffect(()=>{V(B.remoteUsers);const q=async(z,ae)=>{var ie,Ee;console.log("event: UserPublished",z,ae),await B.subscribe(z,ae),V(Array.from(B.remoteUsers)),ae==="audio"&&((ie=z.audioTrack)==null||ie.setVolume(100),(Ee=z.audioTrack)==null||Ee.play())},ce=z=>{console.log("event: UserUnpublished",z),V(Array.from(B.remoteUsers))},M=z=>{console.log("event: UserJoined",z),V(Array.from(B.remoteUsers))},L=z=>{console.log("event: UserLeft",z),V(Array.from(B.remoteUsers))},j=(z,ae)=>{console.log("event: UserInfoUpdated",z,ae)};return B.on("user-published",q),B.on("user-unpublished",ce),B.on("user-joined",M),B.on("user-left",L),B.on("user-info-updated",j),()=>{B.off("user-published",q),B.off("user-unpublished",ce),B.off("user-joined",M),B.off("user-left",L),B.off("user-info-updated",j)}},[B,r]),at.useEffect(()=>{if(y){const q=setInterval(()=>{S(ce=>ce.map(M=>({...M,volumeLevel:M.track.getVolumeLevel()}))),W(ce=>ce.map(M=>({...M,volumeLevel:M.track.getVolumeLevel()})))},200);return()=>{clearInterval(q)}}},[y]),{localAudios:E,isJoin:y,leave:Y,join:fe,remoteAudioUsers:X}},s3=({role:r,appId:s,channel:d,uid:h})=>{const[E,S]=at.useState(!1),[y,D]=at.useState([]),[P,V]=at.useState([]),[X,W]=at.useState([]),B=at.useCallback(async Y=>{for(const q of Y){const ce=wd.createClient({mode:"live",codec:"vp8",role:r});if(await ce.join(s,d,null,`${h}-${q.deviceId}`),q.kind==="audioinput"){const M=await wd.createMicrophoneAudioTrack();M.setDevice(q.deviceId),M.setMuted(!1);const L=100;M.setVolume(L),await ce.publish(M),V(j=>[...j,{client:ce,track:M,deviceId:q.deviceId,deviceName:q.label,volume:L,setVolume:z=>{M.setVolume(z),V(ae=>ae.map(ie=>ie.deviceId===q.deviceId?{...ie,volume:z}:ie))},muted:M.muted,setMuted:z=>{M.setMuted(z),V(ae=>ae.map(ie=>ie.deviceId===q.deviceId?{...ie,muted:z}:ie))},volumeLevel:M.getVolumeLevel()}])}}S(!0)},[s,d,r,h]),fe=at.useCallback(async()=>{for(const{client:Y,track:q}of P)q.stop(),q.close(),await Y.leave();V([]),D([]),S(!1)},[P]);return at.useEffect(()=>{const Y=[...X.filter(q=>y.find(ce=>q.uid===ce.uid))];W([...X.filter(q=>y.find(ce=>q.uid===ce.uid))]),y.forEach(q=>{const ce=q.audioTrack;ce&&!X.find(M=>M.uid===q.uid)&&Y.push({track:ce,uid:q.uid,volume:100,setVolume:M=>{ce.setVolume(M),W(L=>L.map(j=>j.uid===q.uid?{...j,volume:M}:j))},muted:!1,setMuted:(M,L)=>{ce.setVolume(M?0:L),W(j=>j.map(z=>z.uid===q.uid?{...z,muted:M}:z))},volumeLevel:ce.getVolumeLevel()})}),W(Y)},[y]),at.useEffect(()=>{var ae;const Y=(ae=P[0])==null?void 0:ae.client;if(!Y)return;D(Y.remoteUsers);const q=ie=>P.find(Ee=>Ee.client.uid===ie),ce=async(ie,Ee)=>{var Ce,nt;q(ie.uid)||(console.log("event: UserPublished",ie,Ee),await Y.subscribe(ie,Ee),D(Array.from(Y.remoteUsers)),Ee==="audio"&&((Ce=ie.audioTrack)==null||Ce.setVolume(100),(nt=ie.audioTrack)==null||nt.play()))},M=ie=>{q(ie.uid)||(console.log("event: UserUnpublished",ie),D(Array.from(Y.remoteUsers)))},L=ie=>{q(ie.uid)||(console.log("event: UserJoined",ie),D(Array.from(Y.remoteUsers)))},j=ie=>{q(ie.uid)||(console.log("event: UserLeft",ie),D(Array.from(Y.remoteUsers)))},z=(ie,Ee)=>{q(ie)||console.log("event: UserInfoUpdated",ie,Ee)};return Y.on("user-published",ce),Y.on("user-unpublished",M),Y.on("user-joined",L),Y.on("user-left",j),Y.on("user-info-updated",z),()=>{Y.off("user-published",ce),Y.off("user-unpublished",M),Y.off("user-joined",L),Y.off("user-left",j),Y.off("user-info-updated",z)}},[P,r]),at.useEffect(()=>{if(E){const Y=setInterval(()=>{V(q=>q.map(ce=>({...ce,volumeLevel:ce.track.getVolumeLevel()}))),W(q=>q.map(ce=>({...ce,volumeLevel:ce.track.getVolumeLevel()})))},200);return()=>{clearInterval(Y)}}},[E]),{list:P,isJoin:E,leave:fe,join:B,remoteAudioUsers:X}},v_=at.memo(({type:r,label:s,volume:d,maxVolume:h,setVolume:E,muted:S,setMuted:y,volumeLevel:D})=>Re.jsxs("div",{className:"volumeController",children:[Re.jsx("h3",{children:s}),Re.jsxs("div",{className:"volumeController__items",style:{display:"flex",alignItems:"center",gap:16},children:[Re.jsxs("div",{children:[Re.jsx("p",{children:"音量調整"}),Re.jsx("input",{style:{height:30},type:"range",min:0,max:h,step:1,defaultValue:d,onChange:P=>{const V=Number(P.target.value);Number.isNaN(V)||E(V)}})]}),Re.jsxs("div",{children:[Re.jsx("p",{children:"ミュート切り替え"}),Re.jsx("button",{style:{width:80,margin:"3px 0"},onClick:()=>{y(!S)},children:`${S?"ON":"OFF"}`})]}),Re.jsxs("div",{children:[Re.jsx("p",{children:`${r==="remote"?"配信者側の":""}音量レベル`}),Re.jsx("div",{style:{height:12,margin:"9px 0",width:100,backgroundColor:"#1a1a1a"},children:Re.jsx("div",{style:{height:"100%",width:`${D*100}%`,backgroundColor:"#1FE381"}})})]}),r==="remote"&&Re.jsxs("div",{children:[Re.jsx("p",{children:"視聴者側の音量レベル"}),Re.jsx("div",{style:{height:12,margin:"9px 0",width:100,backgroundColor:"#1a1a1a"},children:Re.jsx("div",{style:{height:"100%",width:`${+!S*D*d/h*100}%`,backgroundColor:"#1FE381"}})})]})]})]})),a3=at.memo(({appId:r,channel:s,uid:d})=>{const h=pb({appId:r,channel:s,role:"host",uid:d}),E=s3({appId:r,channel:s,role:"host",uid:d}),[S,y]=at.useState(0),[D,P]=at.useState([]),[V,X]=at.useState([]),{isJoin:W,join:B,remoteAudioUsers:fe,audios:Y}=at.useMemo(()=>{const{isJoin:q,join:ce,remoteAudioUsers:M}=S?E:h,L=(S?E.list:h.localAudios).map(({deviceId:j,deviceName:z,volume:ae,setVolume:ie,muted:Ee,setMuted:Ce,volumeLevel:nt})=>({deviceId:j,deviceName:z,volume:ae,setVolume:ie,muted:Ee,setMuted:Ce,volumeLevel:nt}));return{isJoin:q,join:ce,remoteAudioUsers:M,audios:L}},[h,E,S]);return at.useEffect(()=>{navigator.mediaDevices.getUserMedia({audio:!0}),wd.getDevices().then(q=>{console.log(q.filter(ce=>ce.kind==="audioinput")),P(q.filter(ce=>ce.deviceId!=="default"&&ce.kind==="audioinput")),X(q.filter(ce=>ce.deviceId!=="default"&&ce.kind==="audioinput").filter((ce,M)=>M===0))}).catch(q=>{console.log("get devices error!",q)})},[]),Re.jsxs("div",{children:[Re.jsx("h1",{children:`配信者画面 (appId: ${r}, channel: ${s}, uid: ${d})`}),W?Re.jsxs("div",{children:[Re.jsx("h2",{children:"使用中の音声入力デバイス一覧"}),Y.map((q,ce)=>Re.jsx(v_,{type:"local",label:q.deviceName,volume:q.volume,maxVolume:1e3,setVolume:q.setVolume,muted:q.muted,setMuted:q.setMuted,volumeLevel:q.volumeLevel},ce)),Re.jsx("h2",{children:"他の配信者一覧"}),fe.map(q=>Re.jsx(v_,{type:"remote",label:`${q.uid}`,volume:q.volume,maxVolume:100,setVolume:q.setVolume,muted:q.muted,setMuted:ce=>q.setMuted(ce,q.volume),volumeLevel:q.volumeLevel},q.uid))]}):Re.jsxs(Re.Fragment,{children:[Re.jsxs("div",{children:[Re.jsx("h2",{children:"配信手法"}),Re.jsx("div",{children:[{label:"複数音声入力を1つのclientで配信する",value:0},{label:"各音声入力につき1つのclientで配信する",value:1}].map(({label:q,value:ce},M)=>Re.jsxs("p",{children:[Re.jsx("input",{type:"radio",value:ce,checked:S===ce,onChange:()=>y(ce)}),Re.jsx("span",{children:q})]},M))}),Re.jsx("h2",{children:"音声入力デバイス"}),D.map(q=>Re.jsxs("p",{children:[Re.jsx("input",{type:"checkbox",checked:!!V.find(ce=>ce.deviceId===q.deviceId),onChange:ce=>{X(M=>D.filter(L=>L.deviceId===q.deviceId?ce.target.checked:M.find(j=>j.deviceId===L.deviceId)))}}),Re.jsx("span",{children:q.label})]},q.deviceId))]}),Re.jsx("button",{onClick:()=>B(V),disabled:V.length===0,children:"配信する"})]})]})}),c3=at.memo(({appId:r,channel:s,uid:d})=>{const h=pb({appId:r,channel:s,role:"audience",uid:d});return Re.jsxs("div",{children:[Re.jsx("h1",{children:`視聴者画面 (appId: ${r}, channel: ${s}, uid: ${d})`}),h.isJoin?Re.jsxs(Re.Fragment,{children:[Re.jsx("h2",{children:"配信者一覧"}),h.remoteAudioUsers.map(E=>Re.jsx(v_,{type:"remote",label:`${E.uid}`,volume:E.volume,maxVolume:100,setVolume:E.setVolume,muted:E.muted,setMuted:S=>E.setMuted(S,E.volume),volumeLevel:E.volumeLevel},E.uid))]}):Re.jsx("button",{onClick:()=>h.join(),children:"参加する"})]})}),XO=()=>{const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from(Array(16),d=>r[Math.floor(Math.random()*r.length)]).join("")},d3=at.memo(({appId:r,channel:s})=>{const[d,h]=at.useState([]),[E,S]=at.useState([]),[y,D]=at.useState({appId:"",channel:""}),P=at.useCallback(X=>()=>{let W="";for(;!W||[...d,...E].includes(W);)W=`${Math.floor(Math.random()*4294967295)}`;X==="host"?h(B=>[...B,W]):S(B=>[...B,W])},[d,E]),V=at.useCallback(()=>{D(X=>({...X,channel:XO()}))},[]);return at.useEffect(()=>{r&&!s&&location.replace(`${location.origin}${location.pathname}?appId=${r}&channel=${XO()}`)},[]),r?s?Re.jsxs("div",{children:[Re.jsx("h1",{children:`準備画面（appId: ${r}, channel: ${s}）`}),Re.jsx("button",{onClick:P("host"),children:"配信者追加"}),Re.jsx("button",{onClick:P("audience"),children:"視聴者追加"}),["host","audience"].map(X=>Re.jsxs("div",{children:[Re.jsx("h2",{children:`${X==="host"?"配信者":"視聴者"}一覧`}),(X==="host"?d:E).map((W,B)=>Re.jsx("p",{children:Re.jsx("a",{href:`${location.origin}${location.pathname}?appId=${r}&channel=${s}&role=${X}&uid=${W}`,target:"_blank",rel:"noopener noreferrer",children:`${X==="host"?"配信者":"視聴者"}${B+1} (uid: ${W})`})},`${X}-${W}`))]},X))]}):null:Re.jsxs("div",{children:[Re.jsx("h1",{children:"準備画面"}),Re.jsxs("div",{children:[Re.jsx("h2",{children:"APP ID"}),Re.jsx("input",{value:y.appId,onChange:X=>D(W=>({...W,appId:X.target.value}))})]}),Re.jsxs("div",{children:[Re.jsx("h2",{children:"channel"}),Re.jsx("input",{value:y.channel,onChange:X=>{/^[a-zA-Z0-9 !#$%&()+\-:;<=>?@[\]^_{|}~,."]{0,64}$/.test(X.target.value)&&D(W=>({...W,channel:X.target.value}))}}),Re.jsx("button",{onClick:()=>V(),children:"ランダム作成"})]}),Re.jsx("button",{disabled:!y.appId||!y.channel,onClick:()=>location.replace(`${location.origin}${location.pathname}?appId=${y.appId}&channel=${y.channel}`),children:"設定"})]})}),l3=at.memo(()=>{const{appId:r,channel:s,role:d,uid:h}=at.useMemo(()=>{let E="",S="",y="",D="";return window.location.search.replace("?","").split("&").forEach(P=>{/appId=/.test(P)?E=P.replace("appId=",""):/channel=/.test(P)?S=P.replace("channel=",""):/role=(host|audience)/.test(P)?y=P.replace("role=",""):/uid=/.test(P)&&(D=P.replace("uid=",""))}),{appId:E,channel:S,role:y,uid:D}},[]);return r&&s&&d&&h?d==="host"?Re.jsx(a3,{appId:r,channel:s,uid:h}):d==="audience"?Re.jsx(c3,{appId:r,channel:s,uid:h}):null:Re.jsx(d3,{appId:r,channel:s})});wE.createRoot(document.getElementById("root")).render(Re.jsx(at.StrictMode,{children:Re.jsx(l3,{})}));
